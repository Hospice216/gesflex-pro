var e,t,s,r,a,n,i,o,l,c,d,u,h,m,p,f,x,g,v,j,y,b,w,N,_,k,S,C,E,M,T,A,P,D,R,O,q,I,F,L,$,z,U,W,V,B,H,K,Y,G,Q,J,X,Z,ee,te,se,re,ae,ne,ie,oe,le,ce,de,ue,he,me,pe=Object.defineProperty,fe=e=>{throw TypeError(e)},xe=(e,t,s)=>((e,t,s)=>t in e?pe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,"symbol"!=typeof t?t+"":t,s),ge=(e,t,s)=>t.has(e)||fe("Cannot "+s),ve=(e,t,s)=>(ge(e,t,"read from private field"),s?s.call(e):t.get(e)),je=(e,t,s)=>t.has(e)?fe("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,s),ye=(e,t,s,r)=>(ge(e,t,"write to private field"),r?r.call(e,s):t.set(e,s),s),be=(e,t,s)=>(ge(e,t,"access private method"),s),we=(e,t,s,r)=>({set _(r){ye(e,t,r,s)},get _(){return ve(e,t,r)}});import{j as Ne,P as _e,c as ke,a as Se,u as Ce,B as Ee,b as Me,d as Te,e as Ae,f as Pe,R as De,g as Re,h as Oe,i as qe,k as Ie,D as Fe,C as Le,l as $e,m as ze,n as Ue,A as We,o as Ve,S as Be,O as He,p as Ke,q as Ye,r as Ge,T as Qe,s as Je,t as Xe,v as Ze,w as et,x as tt,y as st,I as rt,z as at,E as nt,F as it,L as ot,G as lt,H as ct,J as dt,K as ut,M as ht,N as mt,Q as pt,U as ft,V as xt,W as gt,X as vt,Y as jt,Z as yt,_ as bt}from"./ui-B7mCvKk4.js";import{a as wt,r as Nt,R as _t,b as kt,c as St,e as Ct,d as Et}from"./vendor-BRxKgMa0.js";import{c as Mt,R as Tt,L as At,C as Pt,X as Dt,Y as Rt,T as Ot,a as qt,A as It,b as Ft,P as Lt,d as $t,e as zt,f as Ut,B as Wt,g as Vt,h as Bt,i as Ht,j as Kt,k as Yt,l as Gt,m as Qt}from"./charts-DRzp865s.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var Jt=wt;me=Jt.createRoot,Jt.hydrateRoot;let Xt=0;const Zt=new Map,es=e=>{if(Zt.has(e))return;const t=setTimeout(()=>{Zt.delete(e),as({type:"REMOVE_TOAST",toastId:e})},1e6);Zt.set(e,t)},ts=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{const{toastId:s}=t;return s?es(s):e.toasts.forEach(e=>{es(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===s||void 0===s?{...e,open:!1}:e)}}case"REMOVE_TOAST":return void 0===t.toastId?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},ss=[];let rs={toasts:[]};function as(e){rs=ts(rs,e),ss.forEach(e=>{e(rs)})}function ns({...e}){const t=(Xt=(Xt+1)%Number.MAX_SAFE_INTEGER,Xt.toString()),s=()=>as({type:"DISMISS_TOAST",toastId:t});return as({type:"ADD_TOAST",toast:{...e,id:t,open:!0,onOpenChange:e=>{e||s()}}}),{id:t,dismiss:s,update:e=>as({type:"UPDATE_TOAST",toast:{...e,id:t}})}}function is(){const[e,t]=Nt.useState(rs);return Nt.useEffect(()=>(ss.push(t),()=>{const e=ss.indexOf(t);e>-1&&ss.splice(e,1)}),[e]),{...e,toast:ns,dismiss:e=>as({type:"DISMISS_TOAST",toastId:e})}}var os=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),ls=Nt.forwardRef((e,t)=>Ne.jsx(_e.span,{...e,ref:t,style:{...os,...e.style}}));ls.displayName="VisuallyHidden";var cs=ls,ds="ToastProvider",[us,hs,ms]=Se("Toast"),[ps,fs]=ke("Toast",[ms]),[xs,gs]=ps(ds),vs=e=>{const{__scopeToast:t,label:s="Notification",duration:r=5e3,swipeDirection:a="right",swipeThreshold:n=50,children:i}=e,[o,l]=Nt.useState(null),[c,d]=Nt.useState(0),u=Nt.useRef(!1),h=Nt.useRef(!1);return s.trim(),Ne.jsx(us.Provider,{scope:t,children:Ne.jsx(xs,{scope:t,label:s,duration:r,swipeDirection:a,swipeThreshold:n,toastCount:c,viewport:o,onViewportChange:l,onToastAdd:Nt.useCallback(()=>d(e=>e+1),[]),onToastRemove:Nt.useCallback(()=>d(e=>e-1),[]),isFocusedToastEscapeKeyDownRef:u,isClosePausedRef:h,children:i})})};vs.displayName=ds;var js="ToastViewport",ys=["F8"],bs="toast.viewportPause",ws="toast.viewportResume",Ns=Nt.forwardRef((e,t)=>{const{__scopeToast:s,hotkey:r=ys,label:a="Notifications ({hotkey})",...n}=e,i=gs(js,s),o=hs(s),l=Nt.useRef(null),c=Nt.useRef(null),d=Nt.useRef(null),u=Nt.useRef(null),h=Ce(t,u,i.onViewportChange),m=r.join("+").replace(/Key/g,"").replace(/Digit/g,""),p=i.toastCount>0;Nt.useEffect(()=>{const e=e=>{var t;0!==r.length&&r.every(t=>e[t]||e.code===t)&&(null==(t=u.current)||t.focus())};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[r]),Nt.useEffect(()=>{const e=l.current,t=u.current;if(p&&e&&t){const s=()=>{if(!i.isClosePausedRef.current){const e=new CustomEvent(bs);t.dispatchEvent(e),i.isClosePausedRef.current=!0}},r=()=>{if(i.isClosePausedRef.current){const e=new CustomEvent(ws);t.dispatchEvent(e),i.isClosePausedRef.current=!1}},a=t=>{!e.contains(t.relatedTarget)&&r()},n=()=>{e.contains(document.activeElement)||r()};return e.addEventListener("focusin",s),e.addEventListener("focusout",a),e.addEventListener("pointermove",s),e.addEventListener("pointerleave",n),window.addEventListener("blur",s),window.addEventListener("focus",r),()=>{e.removeEventListener("focusin",s),e.removeEventListener("focusout",a),e.removeEventListener("pointermove",s),e.removeEventListener("pointerleave",n),window.removeEventListener("blur",s),window.removeEventListener("focus",r)}}},[p,i.isClosePausedRef]);const f=Nt.useCallback(({tabbingDirection:e})=>{const t=o().map(t=>{const s=t.ref.current,r=[s,...zs(s)];return"forwards"===e?r:r.reverse()});return("forwards"===e?t.reverse():t).flat()},[o]);return Nt.useEffect(()=>{const e=u.current;if(e){const t=t=>{var s,r,a;const n=t.altKey||t.ctrlKey||t.metaKey;if("Tab"===t.key&&!n){const n=document.activeElement,i=t.shiftKey;if(t.target===e&&i)return void(null==(s=c.current)||s.focus());const o=f({tabbingDirection:i?"backwards":"forwards"}),l=o.findIndex(e=>e===n);Us(o.slice(l+1))?t.preventDefault():i?null==(r=c.current)||r.focus():null==(a=d.current)||a.focus()}};return e.addEventListener("keydown",t),()=>e.removeEventListener("keydown",t)}},[o,f]),Ne.jsxs(Ee,{ref:l,role:"region","aria-label":a.replace("{hotkey}",m),tabIndex:-1,style:{pointerEvents:p?void 0:"none"},children:[p&&Ne.jsx(ks,{ref:c,onFocusFromOutsideViewport:()=>{Us(f({tabbingDirection:"forwards"}))}}),Ne.jsx(us.Slot,{scope:s,children:Ne.jsx(_e.ol,{tabIndex:-1,...n,ref:h})}),p&&Ne.jsx(ks,{ref:d,onFocusFromOutsideViewport:()=>{Us(f({tabbingDirection:"backwards"}))}})]})});Ns.displayName=js;var _s="ToastFocusProxy",ks=Nt.forwardRef((e,t)=>{const{__scopeToast:s,onFocusFromOutsideViewport:r,...a}=e,n=gs(_s,s);return Ne.jsx(ls,{"aria-hidden":!0,tabIndex:0,...a,ref:t,style:{position:"fixed"},onFocus:e=>{var t;const s=e.relatedTarget;!(null==(t=n.viewport)?void 0:t.contains(s))&&r()}})});ks.displayName=_s;var Ss="Toast",Cs=Nt.forwardRef((e,t)=>{const{forceMount:s,open:r,defaultOpen:a,onOpenChange:n,...i}=e,[o,l]=Me({prop:r,defaultProp:a??!0,onChange:n,caller:Ss});return Ne.jsx(Te,{present:s||o,children:Ne.jsx(Ts,{open:o,...i,ref:t,onClose:()=>l(!1),onPause:Pe(e.onPause),onResume:Pe(e.onResume),onSwipeStart:Ae(e.onSwipeStart,e=>{e.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:Ae(e.onSwipeMove,e=>{const{x:t,y:s}=e.detail.delta;e.currentTarget.setAttribute("data-swipe","move"),e.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${t}px`),e.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${s}px`)}),onSwipeCancel:Ae(e.onSwipeCancel,e=>{e.currentTarget.setAttribute("data-swipe","cancel"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),e.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),e.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:Ae(e.onSwipeEnd,e=>{const{x:t,y:s}=e.detail.delta;e.currentTarget.setAttribute("data-swipe","end"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),e.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${t}px`),e.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${s}px`),l(!1)})})})});Cs.displayName=Ss;var[Es,Ms]=ps(Ss,{onClose(){}}),Ts=Nt.forwardRef((e,t)=>{const{__scopeToast:s,type:r="foreground",duration:a,open:n,onClose:i,onEscapeKeyDown:o,onPause:l,onResume:c,onSwipeStart:d,onSwipeMove:u,onSwipeCancel:h,onSwipeEnd:m,...p}=e,f=gs(Ss,s),[x,g]=Nt.useState(null),v=Ce(t,e=>g(e)),j=Nt.useRef(null),y=Nt.useRef(null),b=a||f.duration,w=Nt.useRef(0),N=Nt.useRef(b),_=Nt.useRef(0),{onToastAdd:k,onToastRemove:S}=f,C=Pe(()=>{var e;(null==x?void 0:x.contains(document.activeElement))&&(null==(e=f.viewport)||e.focus()),i()}),E=Nt.useCallback(e=>{e&&e!==1/0&&(window.clearTimeout(_.current),w.current=(new Date).getTime(),_.current=window.setTimeout(C,e))},[C]);Nt.useEffect(()=>{const e=f.viewport;if(e){const t=()=>{E(N.current),null==c||c()},s=()=>{const e=(new Date).getTime()-w.current;N.current=N.current-e,window.clearTimeout(_.current),null==l||l()};return e.addEventListener(bs,s),e.addEventListener(ws,t),()=>{e.removeEventListener(bs,s),e.removeEventListener(ws,t)}}},[f.viewport,b,l,c,E]),Nt.useEffect(()=>{n&&!f.isClosePausedRef.current&&E(b)},[n,b,f.isClosePausedRef,E]),Nt.useEffect(()=>(k(),()=>S()),[k,S]);const M=Nt.useMemo(()=>x?Fs(x):null,[x]);return f.viewport?Ne.jsxs(Ne.Fragment,{children:[M&&Ne.jsx(As,{__scopeToast:s,role:"status","aria-live":"foreground"===r?"assertive":"polite","aria-atomic":!0,children:M}),Ne.jsx(Es,{scope:s,onClose:C,children:wt.createPortal(Ne.jsx(us.ItemSlot,{scope:s,children:Ne.jsx(De,{asChild:!0,onEscapeKeyDown:Ae(o,()=>{f.isFocusedToastEscapeKeyDownRef.current||C(),f.isFocusedToastEscapeKeyDownRef.current=!1}),children:Ne.jsx(_e.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":n?"open":"closed","data-swipe-direction":f.swipeDirection,...p,ref:v,style:{userSelect:"none",touchAction:"none",...e.style},onKeyDown:Ae(e.onKeyDown,e=>{"Escape"===e.key&&(null==o||o(e.nativeEvent),e.nativeEvent.defaultPrevented||(f.isFocusedToastEscapeKeyDownRef.current=!0,C()))}),onPointerDown:Ae(e.onPointerDown,e=>{0===e.button&&(j.current={x:e.clientX,y:e.clientY})}),onPointerMove:Ae(e.onPointerMove,e=>{if(!j.current)return;const t=e.clientX-j.current.x,s=e.clientY-j.current.y,r=Boolean(y.current),a=["left","right"].includes(f.swipeDirection),n=["left","up"].includes(f.swipeDirection)?Math.min:Math.max,i=a?n(0,t):0,o=a?0:n(0,s),l="touch"===e.pointerType?10:2,c={x:i,y:o},h={originalEvent:e,delta:c};r?(y.current=c,Ls("toast.swipeMove",u,h,{discrete:!1})):$s(c,f.swipeDirection,l)?(y.current=c,Ls("toast.swipeStart",d,h,{discrete:!1}),e.target.setPointerCapture(e.pointerId)):(Math.abs(t)>l||Math.abs(s)>l)&&(j.current=null)}),onPointerUp:Ae(e.onPointerUp,e=>{const t=y.current,s=e.target;if(s.hasPointerCapture(e.pointerId)&&s.releasePointerCapture(e.pointerId),y.current=null,j.current=null,t){const s=e.currentTarget,r={originalEvent:e,delta:t};$s(t,f.swipeDirection,f.swipeThreshold)?Ls("toast.swipeEnd",m,r,{discrete:!0}):Ls("toast.swipeCancel",h,r,{discrete:!0}),s.addEventListener("click",e=>e.preventDefault(),{once:!0})}})})})}),f.viewport)})]}):null}),As=e=>{const{__scopeToast:t,children:s,...r}=e,a=gs(Ss,t),[n,i]=Nt.useState(!1),[o,l]=Nt.useState(!1);return function(e=()=>{}){const t=Pe(e);Oe(()=>{let e=0,s=0;return e=window.requestAnimationFrame(()=>s=window.requestAnimationFrame(t)),()=>{window.cancelAnimationFrame(e),window.cancelAnimationFrame(s)}},[t])}(()=>i(!0)),Nt.useEffect(()=>{const e=window.setTimeout(()=>l(!0),1e3);return()=>window.clearTimeout(e)},[]),o?null:Ne.jsx(Re,{asChild:!0,children:Ne.jsx(ls,{...r,children:n&&Ne.jsxs(Ne.Fragment,{children:[a.label," ",s]})})})},Ps=Nt.forwardRef((e,t)=>{const{__scopeToast:s,...r}=e;return Ne.jsx(_e.div,{...r,ref:t})});Ps.displayName="ToastTitle";var Ds=Nt.forwardRef((e,t)=>{const{__scopeToast:s,...r}=e;return Ne.jsx(_e.div,{...r,ref:t})});Ds.displayName="ToastDescription";var Rs=Nt.forwardRef((e,t)=>{const{altText:s,...r}=e;return s.trim()?Ne.jsx(Is,{altText:s,asChild:!0,children:Ne.jsx(qs,{...r,ref:t})}):null});Rs.displayName="ToastAction";var Os="ToastClose",qs=Nt.forwardRef((e,t)=>{const{__scopeToast:s,...r}=e,a=Ms(Os,s);return Ne.jsx(Is,{asChild:!0,children:Ne.jsx(_e.button,{type:"button",...r,ref:t,onClick:Ae(e.onClick,a.onClose)})})});qs.displayName=Os;var Is=Nt.forwardRef((e,t)=>{const{__scopeToast:s,altText:r,...a}=e;return Ne.jsx(_e.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":r||void 0,...a,ref:t})});function Fs(e){const t=[];return Array.from(e.childNodes).forEach(e=>{if(e.nodeType===e.TEXT_NODE&&e.textContent&&t.push(e.textContent),function(e){return e.nodeType===e.ELEMENT_NODE}(e)){const s=e.ariaHidden||e.hidden||"none"===e.style.display,r=""===e.dataset.radixToastAnnounceExclude;if(!s)if(r){const s=e.dataset.radixToastAnnounceAlt;s&&t.push(s)}else t.push(...Fs(e))}}),t}function Ls(e,t,s,{discrete:r}){const a=s.originalEvent.currentTarget,n=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:s});t&&a.addEventListener(e,t,{once:!0}),r?qe(a,n):a.dispatchEvent(n)}var $s=(e,t,s=0)=>{const r=Math.abs(e.x),a=Math.abs(e.y),n=r>a;return"left"===t||"right"===t?n&&r>s:!n&&a>s};function zs(e){const t=[],s=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{const t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;s.nextNode();)t.push(s.currentNode);return t}function Us(e){const t=document.activeElement;return e.some(e=>e===t||(e.focus(),document.activeElement!==t))}var Ws=vs,Vs=Ns,Bs=Cs,Hs=Ps,Ks=Ds,Ys=Rs,Gs=qs;const Qs=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,Js=Mt,Xs=(e,t)=>s=>{var r;if(null==(null==t?void 0:t.variants))return Js(e,null==s?void 0:s.class,null==s?void 0:s.className);const{variants:a,defaultVariants:n}=t,i=Object.keys(a).map(e=>{const t=null==s?void 0:s[e],r=null==n?void 0:n[e];if(null===t)return null;const i=Qs(t)||Qs(r);return a[e][i]}),o=s&&Object.entries(s).reduce((e,t)=>{let[s,r]=t;return void 0===r||(e[s]=r),e},{}),l=null==t||null===(r=t.compoundVariants)||void 0===r?void 0:r.reduce((e,t)=>{let{class:s,className:r,...a}=t;return Object.entries(a).every(e=>{let[t,s]=e;return Array.isArray(s)?s.includes({...n,...o}[t]):{...n,...o}[t]===s})?[...e,s,r]:e},[]);return Js(e,i,l,null==s?void 0:s.class,null==s?void 0:s.className)};
/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
var Zs={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};
/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const er=(e,t)=>{const s=Nt.forwardRef(({color:s="currentColor",size:r=24,strokeWidth:a=2,absoluteStrokeWidth:n,className:i="",children:o,...l},c)=>{return Nt.createElement("svg",{ref:c,...Zs,width:r,height:r,stroke:s,strokeWidth:n?24*Number(a)/Number(r):a,className:["lucide",`lucide-${d=e,d.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim()}`,i].join(" "),...l},[...t.map(([e,t])=>Nt.createElement(e,t)),...Array.isArray(o)?o:[o]]);var d});return s.displayName=`${e}`,s},tr=er("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]),sr=er("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),rr=er("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),ar=er("ArrowRightLeft",[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]]),nr=er("ArrowUpDown",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]),ir=er("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]),or=er("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),lr=er("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]),cr=er("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]),dr=er("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]),ur=er("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),hr=er("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),mr=er("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),pr=er("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),fr=er("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),xr=er("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),gr=er("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),vr=er("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),jr=er("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),yr=er("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]),br=er("Crown",[["path",{d:"m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14",key:"zkxr6b"}]]),wr=er("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]),Nr=er("Dice6",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["path",{d:"M16 8h.01",key:"cr5u4v"}],["path",{d:"M16 12h.01",key:"1l6xoz"}],["path",{d:"M16 16h.01",key:"1f9h7w"}],["path",{d:"M8 8h.01",key:"1e4136"}],["path",{d:"M8 12h.01",key:"czm47f"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]),_r=er("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]),kr=er("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),Sr=er("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]),Cr=er("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Er=er("FileDown",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]]),Mr=er("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),Tr=er("Gem",[["path",{d:"M6 3h12l4 6-10 13L2 9Z",key:"1pcd5k"}],["path",{d:"M11 3 8 9l4 13 4-13-3-6",key:"1fcu3u"}],["path",{d:"M2 9h20",key:"16fsjt"}]]),Ar=er("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]),Pr=er("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]),Dr=er("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]),Rr=er("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),Or=er("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),qr=er("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]),Ir=er("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]),Fr=er("Medal",[["path",{d:"M7.21 15 2.66 7.14a2 2 0 0 1 .13-2.2L4.4 2.8A2 2 0 0 1 6 2h12a2 2 0 0 1 1.6.8l1.6 2.14a2 2 0 0 1 .14 2.2L16.79 15",key:"143lza"}],["path",{d:"M11 12 5.12 2.2",key:"qhuxz6"}],["path",{d:"m13 12 5.88-9.8",key:"hbye0f"}],["path",{d:"M8 7h8",key:"i86dvs"}],["circle",{cx:"12",cy:"17",r:"5",key:"qbz8iq"}],["path",{d:"M12 18v-2h-.5",key:"fawc4q"}]]),Lr=er("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]),$r=er("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]),zr=er("MoreHorizontal",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]),Ur=er("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]),Wr=er("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",key:"1xcu5"}],["circle",{cx:"17.5",cy:"10.5",r:".5",key:"736e4u"}],["circle",{cx:"8.5",cy:"7.5",r:".5",key:"clrty"}],["circle",{cx:"6.5",cy:"12.5",r:".5",key:"1s4xz9"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]),Vr=er("PanelLeft",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["line",{x1:"9",x2:"9",y1:"3",y2:"21",key:"13tij5"}]]),Br=er("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]),Hr=er("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]),Kr=er("PieChart",[["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}],["path",{d:"M22 12A10 10 0 0 0 12 2v10z",key:"1rfc4y"}]]),Yr=er("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),Gr=er("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),Qr=er("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),Jr=er("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),Xr=er("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),Zr=er("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),ea=er("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]),ta=er("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]),sa=er("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),ra=er("Store",[["path",{d:"m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7",key:"ztvudi"}],["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["path",{d:"M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4",key:"2ebpfo"}],["path",{d:"M2 7h20",key:"1fcdvo"}],["path",{d:"M22 7v3a2 2 0 0 1-2 2v0a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 16 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 12 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 8 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 4 12v0a2 2 0 0 1-2-2V7",key:"jon5kx"}]]),aa=er("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),na=er("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]),ia=er("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),oa=er("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]),la=er("Truck",[["path",{d:"M5 18H3c-.6 0-1-.4-1-1V7c0-.6.4-1 1-1h10c.6 0 1 .4 1 1v11",key:"hs4xqm"}],["path",{d:"M14 9h4l4 4v4c0 .6-.4 1-1 1h-2",key:"11fp61"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}]]),ca=er("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),da=er("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]),ua=er("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]),ha=er("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),ma=er("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),pa=er("Warehouse",[["path",{d:"M22 8.35V20a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8.35A2 2 0 0 1 3.26 6.5l8-3.2a2 2 0 0 1 1.48 0l8 3.2A2 2 0 0 1 22 8.35Z",key:"gksnxg"}],["path",{d:"M6 18h12",key:"9pbo8z"}],["path",{d:"M6 14h12",key:"4cwo0f"}],["rect",{width:"12",height:"12",x:"6",y:"10",key:"apd30q"}]]),fa=er("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),xa=er("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),ga=er("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),va=e=>{const t=wa(e),{conflictingClassGroups:s,conflictingClassGroupModifiers:r}=e;return{getClassGroupId:e=>{const s=e.split("-");return""===s[0]&&1!==s.length&&s.shift(),ja(s,t)||ba(e)},getConflictingClassGroupIds:(e,t)=>{const a=s[e]||[];return t&&r[e]?[...a,...r[e]]:a}}},ja=(e,t)=>{var s;if(0===e.length)return t.classGroupId;const r=e[0],a=t.nextPart.get(r),n=a?ja(e.slice(1),a):void 0;if(n)return n;if(0===t.validators.length)return;const i=e.join("-");return null==(s=t.validators.find(({validator:e})=>e(i)))?void 0:s.classGroupId},ya=/^\[(.+)\]$/,ba=e=>{if(ya.test(e)){const t=ya.exec(e)[1],s=null==t?void 0:t.substring(0,t.indexOf(":"));if(s)return"arbitrary.."+s}},wa=e=>{const{theme:t,prefix:s}=e,r={nextPart:new Map,validators:[]};return Sa(Object.entries(e.classGroups),s).forEach(([e,s])=>{Na(s,r,e,t)}),r},Na=(e,t,s,r)=>{e.forEach(e=>{if("string"==typeof e){return void((""===e?t:_a(t,e)).classGroupId=s)}if("function"==typeof e)return ka(e)?void Na(e(r),t,s,r):void t.validators.push({validator:e,classGroupId:s});Object.entries(e).forEach(([e,a])=>{Na(a,_a(t,e),s,r)})})},_a=(e,t)=>{let s=e;return t.split("-").forEach(e=>{s.nextPart.has(e)||s.nextPart.set(e,{nextPart:new Map,validators:[]}),s=s.nextPart.get(e)}),s},ka=e=>e.isThemeGetter,Sa=(e,t)=>t?e.map(([e,s])=>[e,s.map(e=>"string"==typeof e?t+e:"object"==typeof e?Object.fromEntries(Object.entries(e).map(([e,s])=>[t+e,s])):e)]):e,Ca=e=>{if(e<1)return{get:()=>{},set:()=>{}};let t=0,s=new Map,r=new Map;const a=(a,n)=>{s.set(a,n),t++,t>e&&(t=0,r=s,s=new Map)};return{get(e){let t=s.get(e);return void 0!==t?t:void 0!==(t=r.get(e))?(a(e,t),t):void 0},set(e,t){s.has(e)?s.set(e,t):a(e,t)}}},Ea=e=>{const{separator:t,experimentalParseClassName:s}=e,r=1===t.length,a=t[0],n=t.length,i=e=>{const s=[];let i,o=0,l=0;for(let u=0;u<e.length;u++){let c=e[u];if(0===o){if(c===a&&(r||e.slice(u,u+n)===t)){s.push(e.slice(l,u)),l=u+n;continue}if("/"===c){i=u;continue}}"["===c?o++:"]"===c&&o--}const c=0===s.length?e:e.substring(l),d=c.startsWith("!");return{modifiers:s,hasImportantModifier:d,baseClassName:d?c.substring(1):c,maybePostfixModifierPosition:i&&i>l?i-l:void 0}};return s?e=>s({className:e,parseClassName:i}):i},Ma=e=>{if(e.length<=1)return e;const t=[];let s=[];return e.forEach(e=>{"["===e[0]?(t.push(...s.sort(),e),s=[]):s.push(e)}),t.push(...s.sort()),t},Ta=/\s+/;function Aa(){let e,t,s=0,r="";for(;s<arguments.length;)(e=arguments[s++])&&(t=Pa(e))&&(r&&(r+=" "),r+=t);return r}const Pa=e=>{if("string"==typeof e)return e;let t,s="";for(let r=0;r<e.length;r++)e[r]&&(t=Pa(e[r]))&&(s&&(s+=" "),s+=t);return s};function Da(e,...t){let s,r,a,n=function(o){const l=t.reduce((e,t)=>t(e),e());return s=(e=>({cache:Ca(e.cacheSize),parseClassName:Ea(e),...va(e)}))(l),r=s.cache.get,a=s.cache.set,n=i,i(o)};function i(e){const t=r(e);if(t)return t;const n=((e,t)=>{const{parseClassName:s,getClassGroupId:r,getConflictingClassGroupIds:a}=t,n=[],i=e.trim().split(Ta);let o="";for(let l=i.length-1;l>=0;l-=1){const e=i[l],{modifiers:t,hasImportantModifier:c,baseClassName:d,maybePostfixModifierPosition:u}=s(e);let h=Boolean(u),m=r(h?d.substring(0,u):d);if(!m){if(!h){o=e+(o.length>0?" "+o:o);continue}if(m=r(d),!m){o=e+(o.length>0?" "+o:o);continue}h=!1}const p=Ma(t).join(":"),f=c?p+"!":p,x=f+m;if(n.includes(x))continue;n.push(x);const g=a(m,h);for(let s=0;s<g.length;++s){const e=g[s];n.push(f+e)}o=e+(o.length>0?" "+o:o)}return o})(e,s);return a(e,n),n}return function(){return n(Aa.apply(null,arguments))}}const Ra=e=>{const t=t=>t[e]||[];return t.isThemeGetter=!0,t},Oa=/^\[(?:([a-z-]+):)?(.+)\]$/i,qa=/^\d+\/\d+$/,Ia=new Set(["px","full","screen"]),Fa=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,La=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,$a=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,za=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,Ua=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Wa=e=>Ba(e)||Ia.has(e)||qa.test(e),Va=e=>an(e,"length",nn),Ba=e=>Boolean(e)&&!Number.isNaN(Number(e)),Ha=e=>an(e,"number",Ba),Ka=e=>Boolean(e)&&Number.isInteger(Number(e)),Ya=e=>e.endsWith("%")&&Ba(e.slice(0,-1)),Ga=e=>Oa.test(e),Qa=e=>Fa.test(e),Ja=new Set(["length","size","percentage"]),Xa=e=>an(e,Ja,on),Za=e=>an(e,"position",on),en=new Set(["image","url"]),tn=e=>an(e,en,cn),sn=e=>an(e,"",ln),rn=()=>!0,an=(e,t,s)=>{const r=Oa.exec(e);return!!r&&(r[1]?"string"==typeof t?r[1]===t:t.has(r[1]):s(r[2]))},nn=e=>La.test(e)&&!$a.test(e),on=()=>!1,ln=e=>za.test(e),cn=e=>Ua.test(e),dn=Da(()=>{const e=Ra("colors"),t=Ra("spacing"),s=Ra("blur"),r=Ra("brightness"),a=Ra("borderColor"),n=Ra("borderRadius"),i=Ra("borderSpacing"),o=Ra("borderWidth"),l=Ra("contrast"),c=Ra("grayscale"),d=Ra("hueRotate"),u=Ra("invert"),h=Ra("gap"),m=Ra("gradientColorStops"),p=Ra("gradientColorStopPositions"),f=Ra("inset"),x=Ra("margin"),g=Ra("opacity"),v=Ra("padding"),j=Ra("saturate"),y=Ra("scale"),b=Ra("sepia"),w=Ra("skew"),N=Ra("space"),_=Ra("translate"),k=()=>["auto",Ga,t],S=()=>[Ga,t],C=()=>["",Wa,Va],E=()=>["auto",Ba,Ga],M=()=>["","0",Ga],T=()=>[Ba,Ga];return{cacheSize:500,separator:":",theme:{colors:[rn],spacing:[Wa,Va],blur:["none","",Qa,Ga],brightness:T(),borderColor:[e],borderRadius:["none","","full",Qa,Ga],borderSpacing:S(),borderWidth:C(),contrast:T(),grayscale:M(),hueRotate:T(),invert:M(),gap:S(),gradientColorStops:[e],gradientColorStopPositions:[Ya,Va],inset:k(),margin:k(),opacity:T(),padding:S(),saturate:T(),scale:T(),sepia:M(),skew:T(),space:S(),translate:S()},classGroups:{aspect:[{aspect:["auto","square","video",Ga]}],container:["container"],columns:[{columns:[Qa]}],"break-after":[{"break-after":["auto","avoid","all","avoid-page","page","left","right","column"]}],"break-before":[{"break-before":["auto","avoid","all","avoid-page","page","left","right","column"]}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top",Ga]}],overflow:[{overflow:["auto","hidden","clip","visible","scroll"]}],"overflow-x":[{"overflow-x":["auto","hidden","clip","visible","scroll"]}],"overflow-y":[{"overflow-y":["auto","hidden","clip","visible","scroll"]}],overscroll:[{overscroll:["auto","contain","none"]}],"overscroll-x":[{"overscroll-x":["auto","contain","none"]}],"overscroll-y":[{"overscroll-y":["auto","contain","none"]}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[f]}],"inset-x":[{"inset-x":[f]}],"inset-y":[{"inset-y":[f]}],start:[{start:[f]}],end:[{end:[f]}],top:[{top:[f]}],right:[{right:[f]}],bottom:[{bottom:[f]}],left:[{left:[f]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Ka,Ga]}],basis:[{basis:k()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",Ga]}],grow:[{grow:M()}],shrink:[{shrink:M()}],order:[{order:["first","last","none",Ka,Ga]}],"grid-cols":[{"grid-cols":[rn]}],"col-start-end":[{col:["auto",{span:["full",Ka,Ga]},Ga]}],"col-start":[{"col-start":E()}],"col-end":[{"col-end":E()}],"grid-rows":[{"grid-rows":[rn]}],"row-start-end":[{row:["auto",{span:[Ka,Ga]},Ga]}],"row-start":[{"row-start":E()}],"row-end":[{"row-end":E()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",Ga]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",Ga]}],gap:[{gap:[h]}],"gap-x":[{"gap-x":[h]}],"gap-y":[{"gap-y":[h]}],"justify-content":[{justify:["normal","start","end","center","between","around","evenly","stretch"]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal","start","end","center","between","around","evenly","stretch","baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":["start","end","center","between","around","evenly","stretch","baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[v]}],px:[{px:[v]}],py:[{py:[v]}],ps:[{ps:[v]}],pe:[{pe:[v]}],pt:[{pt:[v]}],pr:[{pr:[v]}],pb:[{pb:[v]}],pl:[{pl:[v]}],m:[{m:[x]}],mx:[{mx:[x]}],my:[{my:[x]}],ms:[{ms:[x]}],me:[{me:[x]}],mt:[{mt:[x]}],mr:[{mr:[x]}],mb:[{mb:[x]}],ml:[{ml:[x]}],"space-x":[{"space-x":[N]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[N]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",Ga,t]}],"min-w":[{"min-w":[Ga,t,"min","max","fit"]}],"max-w":[{"max-w":[Ga,t,"none","full","min","max","fit","prose",{screen:[Qa]},Qa]}],h:[{h:[Ga,t,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[Ga,t,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[Ga,t,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[Ga,t,"auto","min","max","fit"]}],"font-size":[{text:["base",Qa,Va]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",Ha]}],"font-family":[{font:[rn]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",Ga]}],"line-clamp":[{"line-clamp":["none",Ba,Ha]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Wa,Ga]}],"list-image":[{"list-image":["none",Ga]}],"list-style-type":[{list:["none","disc","decimal",Ga]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[g]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[g]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:["solid","dashed","dotted","double","none","wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Wa,Va]}],"underline-offset":[{"underline-offset":["auto",Wa,Ga]}],"text-decoration-color":[{decoration:[e]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:S()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Ga]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Ga]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[g]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top",Za]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",Xa]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},tn]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[p]}],"gradient-via-pos":[{via:[p]}],"gradient-to-pos":[{to:[p]}],"gradient-from":[{from:[m]}],"gradient-via":[{via:[m]}],"gradient-to":[{to:[m]}],rounded:[{rounded:[n]}],"rounded-s":[{"rounded-s":[n]}],"rounded-e":[{"rounded-e":[n]}],"rounded-t":[{"rounded-t":[n]}],"rounded-r":[{"rounded-r":[n]}],"rounded-b":[{"rounded-b":[n]}],"rounded-l":[{"rounded-l":[n]}],"rounded-ss":[{"rounded-ss":[n]}],"rounded-se":[{"rounded-se":[n]}],"rounded-ee":[{"rounded-ee":[n]}],"rounded-es":[{"rounded-es":[n]}],"rounded-tl":[{"rounded-tl":[n]}],"rounded-tr":[{"rounded-tr":[n]}],"rounded-br":[{"rounded-br":[n]}],"rounded-bl":[{"rounded-bl":[n]}],"border-w":[{border:[o]}],"border-w-x":[{"border-x":[o]}],"border-w-y":[{"border-y":[o]}],"border-w-s":[{"border-s":[o]}],"border-w-e":[{"border-e":[o]}],"border-w-t":[{"border-t":[o]}],"border-w-r":[{"border-r":[o]}],"border-w-b":[{"border-b":[o]}],"border-w-l":[{"border-l":[o]}],"border-opacity":[{"border-opacity":[g]}],"border-style":[{border:["solid","dashed","dotted","double","none","hidden"]}],"divide-x":[{"divide-x":[o]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[o]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[g]}],"divide-style":[{divide:["solid","dashed","dotted","double","none"]}],"border-color":[{border:[a]}],"border-color-x":[{"border-x":[a]}],"border-color-y":[{"border-y":[a]}],"border-color-s":[{"border-s":[a]}],"border-color-e":[{"border-e":[a]}],"border-color-t":[{"border-t":[a]}],"border-color-r":[{"border-r":[a]}],"border-color-b":[{"border-b":[a]}],"border-color-l":[{"border-l":[a]}],"divide-color":[{divide:[a]}],"outline-style":[{outline:["","solid","dashed","dotted","double","none"]}],"outline-offset":[{"outline-offset":[Wa,Ga]}],"outline-w":[{outline:[Wa,Va]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:C()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[g]}],"ring-offset-w":[{"ring-offset":[Wa,Va]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:["","inner","none",Qa,sn]}],"shadow-color":[{shadow:[rn]}],opacity:[{opacity:[g]}],"mix-blend":[{"mix-blend":["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity","plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"]}],filter:[{filter:["","none"]}],blur:[{blur:[s]}],brightness:[{brightness:[r]}],contrast:[{contrast:[l]}],"drop-shadow":[{"drop-shadow":["","none",Qa,Ga]}],grayscale:[{grayscale:[c]}],"hue-rotate":[{"hue-rotate":[d]}],invert:[{invert:[u]}],saturate:[{saturate:[j]}],sepia:[{sepia:[b]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[s]}],"backdrop-brightness":[{"backdrop-brightness":[r]}],"backdrop-contrast":[{"backdrop-contrast":[l]}],"backdrop-grayscale":[{"backdrop-grayscale":[c]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[d]}],"backdrop-invert":[{"backdrop-invert":[u]}],"backdrop-opacity":[{"backdrop-opacity":[g]}],"backdrop-saturate":[{"backdrop-saturate":[j]}],"backdrop-sepia":[{"backdrop-sepia":[b]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[i]}],"border-spacing-x":[{"border-spacing-x":[i]}],"border-spacing-y":[{"border-spacing-y":[i]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",Ga]}],duration:[{duration:T()}],ease:[{ease:["linear","in","out","in-out",Ga]}],delay:[{delay:T()}],animate:[{animate:["none","spin","ping","pulse","bounce",Ga]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[y]}],"scale-x":[{"scale-x":[y]}],"scale-y":[{"scale-y":[y]}],rotate:[{rotate:[Ka,Ga]}],"translate-x":[{"translate-x":[_]}],"translate-y":[{"translate-y":[_]}],"skew-x":[{"skew-x":[w]}],"skew-y":[{"skew-y":[w]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",Ga]}],accent:[{accent:["auto",e]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Ga]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":S()}],"scroll-mx":[{"scroll-mx":S()}],"scroll-my":[{"scroll-my":S()}],"scroll-ms":[{"scroll-ms":S()}],"scroll-me":[{"scroll-me":S()}],"scroll-mt":[{"scroll-mt":S()}],"scroll-mr":[{"scroll-mr":S()}],"scroll-mb":[{"scroll-mb":S()}],"scroll-ml":[{"scroll-ml":S()}],"scroll-p":[{"scroll-p":S()}],"scroll-px":[{"scroll-px":S()}],"scroll-py":[{"scroll-py":S()}],"scroll-ps":[{"scroll-ps":S()}],"scroll-pe":[{"scroll-pe":S()}],"scroll-pt":[{"scroll-pt":S()}],"scroll-pr":[{"scroll-pr":S()}],"scroll-pb":[{"scroll-pb":S()}],"scroll-pl":[{"scroll-pl":S()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Ga]}],fill:[{fill:[e,"none"]}],"stroke-w":[{stroke:[Wa,Va,Ha]}],stroke:[{stroke:[e,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}});function un(...e){return dn(Mt(e))}const hn=Ws,mn=Nt.forwardRef(({className:e,...t},s)=>Ne.jsx(Vs,{ref:s,className:un("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",e),...t}));mn.displayName=Vs.displayName;const pn=Xs("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),fn=Nt.forwardRef(({className:e,variant:t,...s},r)=>Ne.jsx(Bs,{ref:r,className:un(pn({variant:t}),e),...s}));fn.displayName=Bs.displayName;Nt.forwardRef(({className:e,...t},s)=>Ne.jsx(Ys,{ref:s,className:un("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",e),...t})).displayName=Ys.displayName;const xn=Nt.forwardRef(({className:e,...t},s)=>Ne.jsx(Gs,{ref:s,className:un("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",e),"toast-close":"",...t,children:Ne.jsx(xa,{className:"h-4 w-4"})}));xn.displayName=Gs.displayName;const gn=Nt.forwardRef(({className:e,...t},s)=>Ne.jsx(Hs,{ref:s,className:un("text-sm font-semibold",e),...t}));gn.displayName=Hs.displayName;const vn=Nt.forwardRef(({className:e,...t},s)=>Ne.jsx(Ks,{ref:s,className:un("text-sm opacity-90",e),...t}));function jn(){const{toasts:e}=is();return Ne.jsxs(hn,{children:[e.map(function({id:e,title:t,description:s,action:r,...a}){return Ne.jsxs(fn,{...a,children:[Ne.jsxs("div",{className:"grid gap-1",children:[t&&Ne.jsx(gn,{children:t}),s&&Ne.jsx(vn,{children:s})]}),r,Ne.jsx(xn,{})]},e)}),Ne.jsx(mn,{})]})}vn.displayName=Ks.displayName;var yn=(e,t,s,r,a,n,i,o)=>{let l=document.documentElement,c=["light","dark"];function d(t){(Array.isArray(e)?e:[e]).forEach(e=>{let s="class"===e,r=s&&n?a.map(e=>n[e]||e):a;s?(l.classList.remove(...r),l.classList.add(n&&n[t]?n[t]:t)):l.setAttribute(e,t)}),function(e){o&&c.includes(e)&&(l.style.colorScheme=e)}(t)}if(r)d(r);else try{let e=localStorage.getItem(t)||s;d(i&&"system"===e?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":e)}catch(u){}},bn=Nt.createContext(void 0),wn={setTheme:e=>{},themes:[]};Nt.memo(({forcedTheme:e,storageKey:t,attribute:s,enableSystem:r,enableColorScheme:a,defaultTheme:n,value:i,themes:o,nonce:l,scriptProps:c})=>{let d=JSON.stringify([s,t,n,e,o,i,r,a]).slice(1,-1);return Nt.createElement("script",{...c,suppressHydrationWarning:!0,nonce:"undefined"==typeof window?l:"",dangerouslySetInnerHTML:{__html:`(${yn.toString()})(${d})`}})});const Nn=Array(12).fill(0),_n=({visible:e,className:t})=>_t.createElement("div",{className:["sonner-loading-wrapper",t].filter(Boolean).join(" "),"data-visible":e},_t.createElement("div",{className:"sonner-spinner"},Nn.map((e,t)=>_t.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${t}`})))),kn=_t.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},_t.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),Sn=_t.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},_t.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),Cn=_t.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},_t.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),En=_t.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},_t.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),Mn=_t.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},_t.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),_t.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"}));let Tn=1;const An=new class{constructor(){this.subscribe=e=>(this.subscribers.push(e),()=>{const t=this.subscribers.indexOf(e);this.subscribers.splice(t,1)}),this.publish=e=>{this.subscribers.forEach(t=>t(e))},this.addToast=e=>{this.publish(e),this.toasts=[...this.toasts,e]},this.create=e=>{var t;const{message:s,...r}=e,a="number"==typeof(null==e?void 0:e.id)||(null==(t=e.id)?void 0:t.length)>0?e.id:Tn++,n=this.toasts.find(e=>e.id===a),i=void 0===e.dismissible||e.dismissible;return this.dismissedToasts.has(a)&&this.dismissedToasts.delete(a),n?this.toasts=this.toasts.map(t=>t.id===a?(this.publish({...t,...e,id:a,title:s}),{...t,...e,id:a,dismissible:i,title:s}):t):this.addToast({title:s,...r,dismissible:i,id:a}),a},this.dismiss=e=>(e?(this.dismissedToasts.add(e),requestAnimationFrame(()=>this.subscribers.forEach(t=>t({id:e,dismiss:!0})))):this.toasts.forEach(e=>{this.subscribers.forEach(t=>t({id:e.id,dismiss:!0}))}),e),this.message=(e,t)=>this.create({...t,message:e}),this.error=(e,t)=>this.create({...t,message:e,type:"error"}),this.success=(e,t)=>this.create({...t,type:"success",message:e}),this.info=(e,t)=>this.create({...t,type:"info",message:e}),this.warning=(e,t)=>this.create({...t,type:"warning",message:e}),this.loading=(e,t)=>this.create({...t,type:"loading",message:e}),this.promise=(e,t)=>{if(!t)return;let s;void 0!==t.loading&&(s=this.create({...t,promise:e,type:"loading",message:t.loading,description:"function"!=typeof t.description?t.description:void 0}));const r=Promise.resolve(e instanceof Function?e():e);let a,n=void 0!==s;const i=r.then(async e=>{a=["resolve",e];if(_t.isValidElement(e))n=!1,this.create({id:s,type:"default",message:e});else if(Pn(e)&&!e.ok){n=!1;const r="function"==typeof t.error?await t.error(`HTTP error! status: ${e.status}`):t.error,a="function"==typeof t.description?await t.description(`HTTP error! status: ${e.status}`):t.description,i="object"==typeof r&&!_t.isValidElement(r)?r:{message:r};this.create({id:s,type:"error",description:a,...i})}else if(e instanceof Error){n=!1;const r="function"==typeof t.error?await t.error(e):t.error,a="function"==typeof t.description?await t.description(e):t.description,i="object"==typeof r&&!_t.isValidElement(r)?r:{message:r};this.create({id:s,type:"error",description:a,...i})}else if(void 0!==t.success){n=!1;const r="function"==typeof t.success?await t.success(e):t.success,a="function"==typeof t.description?await t.description(e):t.description,i="object"==typeof r&&!_t.isValidElement(r)?r:{message:r};this.create({id:s,type:"success",description:a,...i})}}).catch(async e=>{if(a=["reject",e],void 0!==t.error){n=!1;const r="function"==typeof t.error?await t.error(e):t.error,a="function"==typeof t.description?await t.description(e):t.description,i="object"==typeof r&&!_t.isValidElement(r)?r:{message:r};this.create({id:s,type:"error",description:a,...i})}}).finally(()=>{n&&(this.dismiss(s),s=void 0),null==t.finally||t.finally.call(t)}),o=()=>new Promise((e,t)=>i.then(()=>"reject"===a[0]?t(a[1]):e(a[1])).catch(t));return"string"!=typeof s&&"number"!=typeof s?{unwrap:o}:Object.assign(s,{unwrap:o})},this.custom=(e,t)=>{const s=(null==t?void 0:t.id)||Tn++;return this.create({jsx:e(s),id:s,...t}),s},this.getActiveToasts=()=>this.toasts.filter(e=>!this.dismissedToasts.has(e.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},Pn=e=>e&&"object"==typeof e&&"ok"in e&&"boolean"==typeof e.ok&&"status"in e&&"number"==typeof e.status,Dn=(e,t)=>{const s=(null==t?void 0:t.id)||Tn++;return An.addToast({title:e,...t,id:s}),s};function Rn(e){return void 0!==e.label}Object.assign(Dn,{success:An.success,info:An.info,warning:An.warning,error:An.error,custom:An.custom,message:An.message,promise:An.promise,dismiss:An.dismiss,loading:An.loading},{getHistory:()=>An.toasts,getToasts:()=>An.getActiveToasts()}),function(e){if("undefined"==typeof document)return;let t=document.head||document.getElementsByTagName("head")[0],s=document.createElement("style");s.type="text/css",t.appendChild(s),s.styleSheet?s.styleSheet.cssText=e:s.appendChild(document.createTextNode(e))}("[data-sonner-toaster][dir=ltr],html[dir=ltr]{--toast-icon-margin-start:-3px;--toast-icon-margin-end:4px;--toast-svg-margin-start:-1px;--toast-svg-margin-end:0px;--toast-button-margin-start:auto;--toast-button-margin-end:0;--toast-close-button-start:0;--toast-close-button-end:unset;--toast-close-button-transform:translate(-35%, -35%)}[data-sonner-toaster][dir=rtl],html[dir=rtl]{--toast-icon-margin-start:4px;--toast-icon-margin-end:-3px;--toast-svg-margin-start:0px;--toast-svg-margin-end:-1px;--toast-button-margin-start:0;--toast-button-margin-end:auto;--toast-close-button-start:unset;--toast-close-button-end:0;--toast-close-button-transform:translate(35%, -35%)}[data-sonner-toaster]{position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1:hsl(0, 0%, 99%);--gray2:hsl(0, 0%, 97.3%);--gray3:hsl(0, 0%, 95.1%);--gray4:hsl(0, 0%, 93%);--gray5:hsl(0, 0%, 90.9%);--gray6:hsl(0, 0%, 88.7%);--gray7:hsl(0, 0%, 85.8%);--gray8:hsl(0, 0%, 78%);--gray9:hsl(0, 0%, 56.1%);--gray10:hsl(0, 0%, 52.3%);--gray11:hsl(0, 0%, 43.5%);--gray12:hsl(0, 0%, 9%);--border-radius:8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:0;z-index:999999999;transition:transform .4s ease}@media (hover:none) and (pointer:coarse){[data-sonner-toaster][data-lifted=true]{transform:none}}[data-sonner-toaster][data-x-position=right]{right:var(--offset-right)}[data-sonner-toaster][data-x-position=left]{left:var(--offset-left)}[data-sonner-toaster][data-x-position=center]{left:50%;transform:translateX(-50%)}[data-sonner-toaster][data-y-position=top]{top:var(--offset-top)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--offset-bottom)}[data-sonner-toast]{--y:translateY(100%);--lift-amount:calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:0;overflow-wrap:anywhere}[data-sonner-toast][data-styled=true]{padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px rgba(0,0,0,.1);width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}[data-sonner-toast]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-y-position=top]{top:0;--y:translateY(-100%);--lift:1;--lift-amount:calc(1 * var(--gap))}[data-sonner-toast][data-y-position=bottom]{bottom:0;--y:translateY(100%);--lift:-1;--lift-amount:calc(var(--lift) * var(--gap))}[data-sonner-toast][data-styled=true] [data-description]{font-weight:400;line-height:1.4;color:#3f3f3f}[data-rich-colors=true][data-sonner-toast][data-styled=true] [data-description]{color:inherit}[data-sonner-toaster][data-sonner-theme=dark] [data-description]{color:#e8e8e8}[data-sonner-toast][data-styled=true] [data-title]{font-weight:500;line-height:1.5;color:inherit}[data-sonner-toast][data-styled=true] [data-icon]{display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}[data-sonner-toast][data-promise=true] [data-icon]>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}[data-sonner-toast][data-styled=true] [data-icon]>*{flex-shrink:0}[data-sonner-toast][data-styled=true] [data-icon] svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}[data-sonner-toast][data-styled=true] [data-content]{display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;font-weight:500;cursor:pointer;outline:0;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}[data-sonner-toast][data-styled=true] [data-button]:focus-visible{box-shadow:0 0 0 2px rgba(0,0,0,.4)}[data-sonner-toast][data-styled=true] [data-button]:first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}[data-sonner-toast][data-styled=true] [data-cancel]{color:var(--normal-text);background:rgba(0,0,0,.08)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-styled=true] [data-cancel]{background:rgba(255,255,255,.3)}[data-sonner-toast][data-styled=true] [data-close-button]{position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);background:var(--normal-bg);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast][data-styled=true] [data-close-button]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-styled=true] [data-disabled=true]{cursor:not-allowed}[data-sonner-toast][data-styled=true]:hover [data-close-button]:hover{background:var(--gray2);border-color:var(--gray5)}[data-sonner-toast][data-swiping=true]::before{content:'';position:absolute;left:-100%;right:-100%;height:100%;z-index:-1}[data-sonner-toast][data-y-position=top][data-swiping=true]::before{bottom:50%;transform:scaleY(3) translateY(50%)}[data-sonner-toast][data-y-position=bottom][data-swiping=true]::before{top:50%;transform:scaleY(3) translateY(-50%)}[data-sonner-toast][data-swiping=false][data-removed=true]::before{content:'';position:absolute;inset:0;transform:scaleY(2)}[data-sonner-toast][data-expanded=true]::after{content:'';position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}[data-sonner-toast][data-mounted=true]{--y:translateY(0);opacity:1}[data-sonner-toast][data-expanded=false][data-front=false]{--scale:var(--toasts-before) * 0.05 + 1;--y:translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}[data-sonner-toast]>*{transition:opacity .4s}[data-sonner-toast][data-x-position=right]{right:0}[data-sonner-toast][data-x-position=left]{left:0}[data-sonner-toast][data-expanded=false][data-front=false][data-styled=true]>*{opacity:0}[data-sonner-toast][data-visible=false]{opacity:0;pointer-events:none}[data-sonner-toast][data-mounted=true][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}[data-sonner-toast][data-removed=true][data-front=true][data-swipe-out=false]{--y:translateY(calc(var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=false]{--y:translateY(40%);opacity:0;transition:transform .5s,opacity .2s}[data-sonner-toast][data-removed=true][data-front=false]::before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y,0)) translateX(var(--swipe-amount-x,0));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width:600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-sonner-theme=light]{--normal-bg:#fff;--normal-border:var(--gray4);--normal-text:var(--gray12);--success-bg:hsl(143, 85%, 96%);--success-border:hsl(145, 92%, 87%);--success-text:hsl(140, 100%, 27%);--info-bg:hsl(208, 100%, 97%);--info-border:hsl(221, 91%, 93%);--info-text:hsl(210, 92%, 45%);--warning-bg:hsl(49, 100%, 97%);--warning-border:hsl(49, 91%, 84%);--warning-text:hsl(31, 92%, 45%);--error-bg:hsl(359, 100%, 97%);--error-border:hsl(359, 100%, 94%);--error-text:hsl(360, 100%, 45%)}[data-sonner-toaster][data-sonner-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg:#000;--normal-border:hsl(0, 0%, 20%);--normal-text:var(--gray1)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg:#fff;--normal-border:var(--gray3);--normal-text:var(--gray12)}[data-sonner-toaster][data-sonner-theme=dark]{--normal-bg:#000;--normal-bg-hover:hsl(0, 0%, 12%);--normal-border:hsl(0, 0%, 20%);--normal-border-hover:hsl(0, 0%, 25%);--normal-text:var(--gray1);--success-bg:hsl(150, 100%, 6%);--success-border:hsl(147, 100%, 12%);--success-text:hsl(150, 86%, 65%);--info-bg:hsl(215, 100%, 6%);--info-border:hsl(223, 43%, 17%);--info-text:hsl(216, 87%, 65%);--warning-bg:hsl(64, 100%, 6%);--warning-border:hsl(60, 100%, 9%);--warning-text:hsl(46, 87%, 65%);--error-bg:hsl(358, 76%, 10%);--error-border:hsl(357, 89%, 16%);--error-text:hsl(358, 100%, 81%)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size:16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:first-child{animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}100%{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}100%{opacity:.15}}@media (prefers-reduced-motion){.sonner-loading-bar,[data-sonner-toast],[data-sonner-toast]>*{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}");const On=3,qn=14;function In(...e){return e.filter(Boolean).join(" ")}const Fn=e=>{var t,s,r,a,n,i,o,l,c;const{invert:d,toast:u,unstyled:h,interacting:m,setHeights:p,visibleToasts:f,heights:x,index:g,toasts:v,expanded:j,removeToast:y,defaultRichColors:b,closeButton:w,style:N,cancelButtonStyle:_,actionButtonStyle:k,className:S="",descriptionClassName:C="",duration:E,position:M,gap:T,expandByDefault:A,classNames:P,icons:D,closeButtonAriaLabel:R="Close toast"}=e,[O,q]=_t.useState(null),[I,F]=_t.useState(null),[L,$]=_t.useState(!1),[z,U]=_t.useState(!1),[W,V]=_t.useState(!1),[B,H]=_t.useState(!1),[K,Y]=_t.useState(!1),[G,Q]=_t.useState(0),[J,X]=_t.useState(0),Z=_t.useRef(u.duration||E||4e3),ee=_t.useRef(null),te=_t.useRef(null),se=0===g,re=g+1<=f,ae=u.type,ne=!1!==u.dismissible,ie=u.className||"",oe=u.descriptionClassName||"",le=_t.useMemo(()=>x.findIndex(e=>e.toastId===u.id)||0,[x,u.id]),ce=_t.useMemo(()=>{var e;return null!=(e=u.closeButton)?e:w},[u.closeButton,w]),de=_t.useMemo(()=>u.duration||E||4e3,[u.duration,E]),ue=_t.useRef(0),he=_t.useRef(0),me=_t.useRef(0),pe=_t.useRef(null),[fe,xe]=M.split("-"),ge=_t.useMemo(()=>x.reduce((e,t,s)=>s>=le?e:e+t.height,0),[x,le]),ve=(()=>{const[e,t]=_t.useState(document.hidden);return _t.useEffect(()=>{const e=()=>{t(document.hidden)};return document.addEventListener("visibilitychange",e),()=>window.removeEventListener("visibilitychange",e)},[]),e})(),je=u.invert||d,ye="loading"===ae;he.current=_t.useMemo(()=>le*T+ge,[le,ge]),_t.useEffect(()=>{Z.current=de},[de]),_t.useEffect(()=>{$(!0)},[]),_t.useEffect(()=>{const e=te.current;if(e){const t=e.getBoundingClientRect().height;return X(t),p(e=>[{toastId:u.id,height:t,position:u.position},...e]),()=>p(e=>e.filter(e=>e.toastId!==u.id))}},[p,u.id]),_t.useLayoutEffect(()=>{if(!L)return;const e=te.current,t=e.style.height;e.style.height="auto";const s=e.getBoundingClientRect().height;e.style.height=t,X(s),p(e=>e.find(e=>e.toastId===u.id)?e.map(e=>e.toastId===u.id?{...e,height:s}:e):[{toastId:u.id,height:s,position:u.position},...e])},[L,u.title,u.description,p,u.id,u.jsx,u.action,u.cancel]);const be=_t.useCallback(()=>{U(!0),Q(he.current),p(e=>e.filter(e=>e.toastId!==u.id)),setTimeout(()=>{y(u)},200)},[u,y,p,he]);_t.useEffect(()=>{if(u.promise&&"loading"===ae||u.duration===1/0||"loading"===u.type)return;let e;return j||m||ve?(()=>{if(me.current<ue.current){const e=(new Date).getTime()-ue.current;Z.current=Z.current-e}me.current=(new Date).getTime()})():Z.current!==1/0&&(ue.current=(new Date).getTime(),e=setTimeout(()=>{null==u.onAutoClose||u.onAutoClose.call(u,u),be()},Z.current)),()=>clearTimeout(e)},[j,m,u,ae,ve,be]),_t.useEffect(()=>{u.delete&&(be(),null==u.onDismiss||u.onDismiss.call(u,u))},[be,u.delete]);const we=u.icon||(null==D?void 0:D[ae])||(e=>{switch(e){case"success":return kn;case"info":return Cn;case"warning":return Sn;case"error":return En;default:return null}})(ae);var Ne,_e,ke,Se;return _t.createElement("li",{tabIndex:0,ref:te,className:In(S,ie,null==P?void 0:P.toast,null==u||null==(t=u.classNames)?void 0:t.toast,null==P?void 0:P.default,null==P?void 0:P[ae],null==u||null==(s=u.classNames)?void 0:s[ae]),"data-sonner-toast":"","data-rich-colors":null!=(Ne=u.richColors)?Ne:b,"data-styled":!Boolean(u.jsx||u.unstyled||h),"data-mounted":L,"data-promise":Boolean(u.promise),"data-swiped":K,"data-removed":z,"data-visible":re,"data-y-position":fe,"data-x-position":xe,"data-index":g,"data-front":se,"data-swiping":W,"data-dismissible":ne,"data-type":ae,"data-invert":je,"data-swipe-out":B,"data-swipe-direction":I,"data-expanded":Boolean(j||A&&L),"data-testid":u.testId,style:{"--index":g,"--toasts-before":g,"--z-index":v.length-g,"--offset":`${z?G:he.current}px`,"--initial-height":A?"auto":`${J}px`,...N,...u.style},onDragEnd:()=>{V(!1),q(null),pe.current=null},onPointerDown:e=>{2!==e.button&&!ye&&ne&&(ee.current=new Date,Q(he.current),e.target.setPointerCapture(e.pointerId),"BUTTON"!==e.target.tagName&&(V(!0),pe.current={x:e.clientX,y:e.clientY}))},onPointerUp:()=>{var e,t,s;if(B||!ne)return;pe.current=null;const r=Number((null==(e=te.current)?void 0:e.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),a=Number((null==(t=te.current)?void 0:t.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),n=(new Date).getTime()-(null==(s=ee.current)?void 0:s.getTime()),i="x"===O?r:a,o=Math.abs(i)/n;if(Math.abs(i)>=45||o>.11)return Q(he.current),null==u.onDismiss||u.onDismiss.call(u,u),F("x"===O?r>0?"right":"left":a>0?"down":"up"),be(),void H(!0);var l,c;null==(l=te.current)||l.style.setProperty("--swipe-amount-x","0px"),null==(c=te.current)||c.style.setProperty("--swipe-amount-y","0px"),Y(!1),V(!1),q(null)},onPointerMove:t=>{var s,r,a;if(!pe.current||!ne)return;if((null==(s=window.getSelection())?void 0:s.toString().length)>0)return;const n=t.clientY-pe.current.y,i=t.clientX-pe.current.x;var o;const l=null!=(o=e.swipeDirections)?o:function(e){const[t,s]=e.split("-"),r=[];return t&&r.push(t),s&&r.push(s),r}(M);!O&&(Math.abs(i)>1||Math.abs(n)>1)&&q(Math.abs(i)>Math.abs(n)?"x":"y");let c={x:0,y:0};const d=e=>1/(1.5+Math.abs(e)/20);if("y"===O){if(l.includes("top")||l.includes("bottom"))if(l.includes("top")&&n<0||l.includes("bottom")&&n>0)c.y=n;else{const e=n*d(n);c.y=Math.abs(e)<Math.abs(n)?e:n}}else if("x"===O&&(l.includes("left")||l.includes("right")))if(l.includes("left")&&i<0||l.includes("right")&&i>0)c.x=i;else{const e=i*d(i);c.x=Math.abs(e)<Math.abs(i)?e:i}(Math.abs(c.x)>0||Math.abs(c.y)>0)&&Y(!0),null==(r=te.current)||r.style.setProperty("--swipe-amount-x",`${c.x}px`),null==(a=te.current)||a.style.setProperty("--swipe-amount-y",`${c.y}px`)}},ce&&!u.jsx&&"loading"!==ae?_t.createElement("button",{"aria-label":R,"data-disabled":ye,"data-close-button":!0,onClick:ye||!ne?()=>{}:()=>{be(),null==u.onDismiss||u.onDismiss.call(u,u)},className:In(null==P?void 0:P.closeButton,null==u||null==(r=u.classNames)?void 0:r.closeButton)},null!=(_e=null==D?void 0:D.close)?_e:Mn):null,(ae||u.icon||u.promise)&&null!==u.icon&&(null!==(null==D?void 0:D[ae])||u.icon)?_t.createElement("div",{"data-icon":"",className:In(null==P?void 0:P.icon,null==u||null==(a=u.classNames)?void 0:a.icon)},u.promise||"loading"===u.type&&!u.icon?u.icon||((null==D?void 0:D.loading)?_t.createElement("div",{className:In(null==P?void 0:P.loader,null==u||null==(Se=u.classNames)?void 0:Se.loader,"sonner-loader"),"data-visible":"loading"===ae},D.loading):_t.createElement(_n,{className:In(null==P?void 0:P.loader,null==u||null==(ke=u.classNames)?void 0:ke.loader),visible:"loading"===ae})):null,"loading"!==u.type?we:null):null,_t.createElement("div",{"data-content":"",className:In(null==P?void 0:P.content,null==u||null==(n=u.classNames)?void 0:n.content)},_t.createElement("div",{"data-title":"",className:In(null==P?void 0:P.title,null==u||null==(i=u.classNames)?void 0:i.title)},u.jsx?u.jsx:"function"==typeof u.title?u.title():u.title),u.description?_t.createElement("div",{"data-description":"",className:In(C,oe,null==P?void 0:P.description,null==u||null==(o=u.classNames)?void 0:o.description)},"function"==typeof u.description?u.description():u.description):null),_t.isValidElement(u.cancel)?u.cancel:u.cancel&&Rn(u.cancel)?_t.createElement("button",{"data-button":!0,"data-cancel":!0,style:u.cancelButtonStyle||_,onClick:e=>{Rn(u.cancel)&&ne&&(null==u.cancel.onClick||u.cancel.onClick.call(u.cancel,e),be())},className:In(null==P?void 0:P.cancelButton,null==u||null==(l=u.classNames)?void 0:l.cancelButton)},u.cancel.label):null,_t.isValidElement(u.action)?u.action:u.action&&Rn(u.action)?_t.createElement("button",{"data-button":!0,"data-action":!0,style:u.actionButtonStyle||k,onClick:e=>{Rn(u.action)&&(null==u.action.onClick||u.action.onClick.call(u.action,e),e.defaultPrevented||be())},className:In(null==P?void 0:P.actionButton,null==u||null==(c=u.classNames)?void 0:c.actionButton)},u.action.label):null)};function Ln(){if("undefined"==typeof window)return"ltr";if("undefined"==typeof document)return"ltr";const e=document.documentElement.getAttribute("dir");return"auto"!==e&&e?e:window.getComputedStyle(document.documentElement).direction}function $n(e,t){const s={};return[e,t].forEach((e,t)=>{const r=1===t,a=r?"--mobile-offset":"--offset",n=r?"16px":"24px";function i(e){["top","right","bottom","left"].forEach(t=>{s[`${a}-${t}`]="number"==typeof e?`${e}px`:e})}"number"==typeof e||"string"==typeof e?i(e):"object"==typeof e?["top","right","bottom","left"].forEach(t=>{void 0===e[t]?s[`${a}-${t}`]=n:s[`${a}-${t}`]="number"==typeof e[t]?`${e[t]}px`:e[t]}):i(n)}),s}const zn=_t.forwardRef(function(e,t){const{id:s,invert:r,position:a="bottom-right",hotkey:n=["altKey","KeyT"],expand:i,closeButton:o,className:l,offset:c,mobileOffset:d,theme:u="light",richColors:h,duration:m,style:p,visibleToasts:f=On,toastOptions:x,dir:g=Ln(),gap:v=qn,icons:j,containerAriaLabel:y="Notifications"}=e,[b,w]=_t.useState([]),N=_t.useMemo(()=>s?b.filter(e=>e.toasterId===s):b.filter(e=>!e.toasterId),[b,s]),_=_t.useMemo(()=>Array.from(new Set([a].concat(N.filter(e=>e.position).map(e=>e.position)))),[N,a]),[k,S]=_t.useState([]),[C,E]=_t.useState(!1),[M,T]=_t.useState(!1),[A,P]=_t.useState("system"!==u?u:"undefined"!=typeof window&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),D=_t.useRef(null),R=n.join("+").replace(/Key/g,"").replace(/Digit/g,""),O=_t.useRef(null),q=_t.useRef(!1),I=_t.useCallback(e=>{w(t=>{var s;return(null==(s=t.find(t=>t.id===e.id))?void 0:s.delete)||An.dismiss(e.id),t.filter(({id:t})=>t!==e.id)})},[]);return _t.useEffect(()=>An.subscribe(e=>{e.dismiss?requestAnimationFrame(()=>{w(t=>t.map(t=>t.id===e.id?{...t,delete:!0}:t))}):setTimeout(()=>{kt.flushSync(()=>{w(t=>{const s=t.findIndex(t=>t.id===e.id);return-1!==s?[...t.slice(0,s),{...t[s],...e},...t.slice(s+1)]:[e,...t]})})})}),[b]),_t.useEffect(()=>{if("system"!==u)return void P(u);if("system"===u&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?P("dark"):P("light")),"undefined"==typeof window)return;const e=window.matchMedia("(prefers-color-scheme: dark)");try{e.addEventListener("change",({matches:e})=>{P(e?"dark":"light")})}catch(t){e.addListener(({matches:e})=>{try{P(e?"dark":"light")}catch(t){}})}},[u]),_t.useEffect(()=>{b.length<=1&&E(!1)},[b]),_t.useEffect(()=>{const e=e=>{var t;var s;n.every(t=>e[t]||e.code===t)&&(E(!0),null==(s=D.current)||s.focus());"Escape"!==e.code||document.activeElement!==D.current&&!(null==(t=D.current)?void 0:t.contains(document.activeElement))||E(!1)};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[n]),_t.useEffect(()=>{if(D.current)return()=>{O.current&&(O.current.focus({preventScroll:!0}),O.current=null,q.current=!1)}},[D.current]),_t.createElement("section",{ref:t,"aria-label":`${y} ${R}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},_.map((t,s)=>{var a;const[n,u]=t.split("-");return N.length?_t.createElement("ol",{key:t,dir:"auto"===g?Ln():g,tabIndex:-1,ref:D,className:l,"data-sonner-toaster":!0,"data-sonner-theme":A,"data-y-position":n,"data-x-position":u,style:{"--front-toast-height":`${(null==(a=k[0])?void 0:a.height)||0}px`,"--width":"356px","--gap":`${v}px`,...p,...$n(c,d)},onBlur:e=>{q.current&&!e.currentTarget.contains(e.relatedTarget)&&(q.current=!1,O.current&&(O.current.focus({preventScroll:!0}),O.current=null))},onFocus:e=>{e.target instanceof HTMLElement&&"false"===e.target.dataset.dismissible||q.current||(q.current=!0,O.current=e.relatedTarget)},onMouseEnter:()=>E(!0),onMouseMove:()=>E(!0),onMouseLeave:()=>{M||E(!1)},onDragEnd:()=>E(!1),onPointerDown:e=>{e.target instanceof HTMLElement&&"false"===e.target.dataset.dismissible||T(!0)},onPointerUp:()=>T(!1)},N.filter(e=>!e.position&&0===s||e.position===t).map((s,a)=>{var n,l;return _t.createElement(Fn,{key:s.id,icons:j,index:a,toast:s,defaultRichColors:h,duration:null!=(n=null==x?void 0:x.duration)?n:m,className:null==x?void 0:x.className,descriptionClassName:null==x?void 0:x.descriptionClassName,invert:r,visibleToasts:f,closeButton:null!=(l=null==x?void 0:x.closeButton)?l:o,interacting:M,position:t,style:null==x?void 0:x.style,unstyled:null==x?void 0:x.unstyled,classNames:null==x?void 0:x.classNames,cancelButtonStyle:null==x?void 0:x.cancelButtonStyle,actionButtonStyle:null==x?void 0:x.actionButtonStyle,closeButtonAriaLabel:null==x?void 0:x.closeButtonAriaLabel,removeToast:I,toasts:N.filter(e=>e.position==s.position),heights:k.filter(e=>e.position==s.position),setHeights:S,expandByDefault:i,gap:v,expanded:C,swipeDirections:e.swipeDirections})})):null}))}),Un=({...e})=>{const{theme:t="system"}=null!=(s=Nt.useContext(bn))?s:wn;var s;return Ne.jsx(zn,{theme:t,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...e})};var[Wn,Vn]=ke("Tooltip",[Ie]),Bn=Ie(),Hn="TooltipProvider",Kn=700,Yn="tooltip.open",[Gn,Qn]=Wn(Hn),Jn=e=>{const{__scopeTooltip:t,delayDuration:s=Kn,skipDelayDuration:r=300,disableHoverableContent:a=!1,children:n}=e,i=Nt.useRef(!0),o=Nt.useRef(!1),l=Nt.useRef(0);return Nt.useEffect(()=>{const e=l.current;return()=>window.clearTimeout(e)},[]),Ne.jsx(Gn,{scope:t,isOpenDelayedRef:i,delayDuration:s,onOpen:Nt.useCallback(()=>{window.clearTimeout(l.current),i.current=!1},[]),onClose:Nt.useCallback(()=>{window.clearTimeout(l.current),l.current=window.setTimeout(()=>i.current=!0,r)},[r]),isPointerInTransitRef:o,onPointerInTransitChange:Nt.useCallback(e=>{o.current=e},[]),disableHoverableContent:a,children:n})};Jn.displayName=Hn;var Xn="Tooltip",[Zn,ei]=Wn(Xn),ti=e=>{const{__scopeTooltip:t,children:s,open:r,defaultOpen:a,onOpenChange:n,disableHoverableContent:i,delayDuration:o}=e,l=Qn(Xn,e.__scopeTooltip),c=Bn(t),[d,u]=Nt.useState(null),h=ze(),m=Nt.useRef(0),p=i??l.disableHoverableContent,f=o??l.delayDuration,x=Nt.useRef(!1),[g,v]=Me({prop:r,defaultProp:a??!1,onChange:e=>{e?(l.onOpen(),document.dispatchEvent(new CustomEvent(Yn))):l.onClose(),null==n||n(e)},caller:Xn}),j=Nt.useMemo(()=>g?x.current?"delayed-open":"instant-open":"closed",[g]),y=Nt.useCallback(()=>{window.clearTimeout(m.current),m.current=0,x.current=!1,v(!0)},[v]),b=Nt.useCallback(()=>{window.clearTimeout(m.current),m.current=0,v(!1)},[v]),w=Nt.useCallback(()=>{window.clearTimeout(m.current),m.current=window.setTimeout(()=>{x.current=!0,v(!0),m.current=0},f)},[f,v]);return Nt.useEffect(()=>()=>{m.current&&(window.clearTimeout(m.current),m.current=0)},[]),Ne.jsx(Ue,{...c,children:Ne.jsx(Zn,{scope:t,contentId:h,open:g,stateAttribute:j,trigger:d,onTriggerChange:u,onTriggerEnter:Nt.useCallback(()=>{l.isOpenDelayedRef.current?w():y()},[l.isOpenDelayedRef,w,y]),onTriggerLeave:Nt.useCallback(()=>{p?b():(window.clearTimeout(m.current),m.current=0)},[b,p]),onOpen:y,onClose:b,disableHoverableContent:p,children:s})})};ti.displayName=Xn;var si="TooltipTrigger",ri=Nt.forwardRef((e,t)=>{const{__scopeTooltip:s,...r}=e,a=ei(si,s),n=Qn(si,s),i=Bn(s),o=Nt.useRef(null),l=Ce(t,o,a.onTriggerChange),c=Nt.useRef(!1),d=Nt.useRef(!1),u=Nt.useCallback(()=>c.current=!1,[]);return Nt.useEffect(()=>()=>document.removeEventListener("pointerup",u),[u]),Ne.jsx(We,{asChild:!0,...i,children:Ne.jsx(_e.button,{"aria-describedby":a.open?a.contentId:void 0,"data-state":a.stateAttribute,...r,ref:l,onPointerMove:Ae(e.onPointerMove,e=>{"touch"!==e.pointerType&&(d.current||n.isPointerInTransitRef.current||(a.onTriggerEnter(),d.current=!0))}),onPointerLeave:Ae(e.onPointerLeave,()=>{a.onTriggerLeave(),d.current=!1}),onPointerDown:Ae(e.onPointerDown,()=>{a.open&&a.onClose(),c.current=!0,document.addEventListener("pointerup",u,{once:!0})}),onFocus:Ae(e.onFocus,()=>{c.current||a.onOpen()}),onBlur:Ae(e.onBlur,a.onClose),onClick:Ae(e.onClick,a.onClose)})})});ri.displayName=si;var[ai,ni]=Wn("TooltipPortal",{forceMount:void 0}),ii="TooltipContent",oi=Nt.forwardRef((e,t)=>{const s=ni(ii,e.__scopeTooltip),{forceMount:r=s.forceMount,side:a="top",...n}=e,i=ei(ii,e.__scopeTooltip);return Ne.jsx(Te,{present:r||i.open,children:i.disableHoverableContent?Ne.jsx(hi,{side:a,...n,ref:t}):Ne.jsx(li,{side:a,...n,ref:t})})}),li=Nt.forwardRef((e,t)=>{const s=ei(ii,e.__scopeTooltip),r=Qn(ii,e.__scopeTooltip),a=Nt.useRef(null),n=Ce(t,a),[i,o]=Nt.useState(null),{trigger:l,onClose:c}=s,d=a.current,{onPointerInTransitChange:u}=r,h=Nt.useCallback(()=>{o(null),u(!1)},[u]),m=Nt.useCallback((e,t)=>{const s=e.currentTarget,r={x:e.clientX,y:e.clientY},a=function(e,t,s=5){const r=[];switch(t){case"top":r.push({x:e.x-s,y:e.y+s},{x:e.x+s,y:e.y+s});break;case"bottom":r.push({x:e.x-s,y:e.y-s},{x:e.x+s,y:e.y-s});break;case"left":r.push({x:e.x+s,y:e.y-s},{x:e.x+s,y:e.y+s});break;case"right":r.push({x:e.x-s,y:e.y-s},{x:e.x-s,y:e.y+s})}return r}(r,function(e,t){const s=Math.abs(t.top-e.y),r=Math.abs(t.bottom-e.y),a=Math.abs(t.right-e.x),n=Math.abs(t.left-e.x);switch(Math.min(s,r,a,n)){case n:return"left";case a:return"right";case s:return"top";case r:return"bottom";default:throw new Error("unreachable")}}(r,s.getBoundingClientRect())),n=function(e){const t=e.slice();return t.sort((e,t)=>e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0),function(e){if(e.length<=1)return e.slice();const t=[];for(let r=0;r<e.length;r++){const s=e[r];for(;t.length>=2;){const e=t[t.length-1],r=t[t.length-2];if(!((e.x-r.x)*(s.y-r.y)>=(e.y-r.y)*(s.x-r.x)))break;t.pop()}t.push(s)}t.pop();const s=[];for(let r=e.length-1;r>=0;r--){const t=e[r];for(;s.length>=2;){const e=s[s.length-1],r=s[s.length-2];if(!((e.x-r.x)*(t.y-r.y)>=(e.y-r.y)*(t.x-r.x)))break;s.pop()}s.push(t)}return s.pop(),1===t.length&&1===s.length&&t[0].x===s[0].x&&t[0].y===s[0].y?t:t.concat(s)}(t)}([...a,...function(e){const{top:t,right:s,bottom:r,left:a}=e;return[{x:a,y:t},{x:s,y:t},{x:s,y:r},{x:a,y:r}]}(t.getBoundingClientRect())]);o(n),u(!0)},[u]);return Nt.useEffect(()=>()=>h(),[h]),Nt.useEffect(()=>{if(l&&d){const e=e=>m(e,d),t=e=>m(e,l);return l.addEventListener("pointerleave",e),d.addEventListener("pointerleave",t),()=>{l.removeEventListener("pointerleave",e),d.removeEventListener("pointerleave",t)}}},[l,d,m,h]),Nt.useEffect(()=>{if(i){const e=e=>{const t=e.target,s={x:e.clientX,y:e.clientY},r=(null==l?void 0:l.contains(t))||(null==d?void 0:d.contains(t)),a=!function(e,t){const{x:s,y:r}=e;let a=!1;for(let n=0,i=t.length-1;n<t.length;i=n++){const e=t[n],o=t[i],l=e.x,c=e.y,d=o.x,u=o.y;c>r!=u>r&&s<(d-l)*(r-c)/(u-c)+l&&(a=!a)}return a}(s,i);r?h():a&&(h(),c())};return document.addEventListener("pointermove",e),()=>document.removeEventListener("pointermove",e)}},[l,d,i,c,h]),Ne.jsx(hi,{...e,ref:n})}),[ci,di]=Wn(Xn,{isInside:!1}),ui=$e("TooltipContent"),hi=Nt.forwardRef((e,t)=>{const{__scopeTooltip:s,children:r,"aria-label":a,onEscapeKeyDown:n,onPointerDownOutside:i,...o}=e,l=ei(ii,s),c=Bn(s),{onClose:d}=l;return Nt.useEffect(()=>(document.addEventListener(Yn,d),()=>document.removeEventListener(Yn,d)),[d]),Nt.useEffect(()=>{if(l.trigger){const e=e=>{const t=e.target;(null==t?void 0:t.contains(l.trigger))&&d()};return window.addEventListener("scroll",e,{capture:!0}),()=>window.removeEventListener("scroll",e,{capture:!0})}},[l.trigger,d]),Ne.jsx(Fe,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:n,onPointerDownOutside:i,onFocusOutside:e=>e.preventDefault(),onDismiss:d,children:Ne.jsxs(Le,{"data-state":l.stateAttribute,...c,...o,ref:t,style:{...o.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[Ne.jsx(ui,{children:r}),Ne.jsx(ci,{scope:s,isInside:!0,children:Ne.jsx(cs,{id:l.contentId,role:"tooltip",children:a||r})})]})})});oi.displayName=ii;var mi="TooltipArrow";Nt.forwardRef((e,t)=>{const{__scopeTooltip:s,...r}=e,a=Bn(s);return di(mi,s).isInside?null:Ne.jsx(Ve,{...a,...r,ref:t})}).displayName=mi;var pi=oi;const fi=Jn,xi=ti,gi=ri,vi=Nt.forwardRef(({className:e,sideOffset:t=4,...s},r)=>Ne.jsx(pi,{ref:r,sideOffset:t,className:un("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...s}));vi.displayName=pi.displayName;var ji=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},yi="undefined"==typeof window||"Deno"in globalThis;function bi(){}function wi(e){return"number"==typeof e&&e>=0&&e!==1/0}function Ni(e,t){return Math.max(e+(t||0)-Date.now(),0)}function _i(e,t){return"function"==typeof e?e(t):e}function ki(e,t){return"function"==typeof e?e(t):e}function Si(e,t){const{type:s="all",exact:r,fetchStatus:a,predicate:n,queryKey:i,stale:o}=e;if(i)if(r){if(t.queryHash!==Ei(i,t.options))return!1}else if(!Ti(t.queryKey,i))return!1;if("all"!==s){const e=t.isActive();if("active"===s&&!e)return!1;if("inactive"===s&&e)return!1}return("boolean"!=typeof o||t.isStale()===o)&&((!a||a===t.state.fetchStatus)&&!(n&&!n(t)))}function Ci(e,t){const{exact:s,status:r,predicate:a,mutationKey:n}=e;if(n){if(!t.options.mutationKey)return!1;if(s){if(Mi(t.options.mutationKey)!==Mi(n))return!1}else if(!Ti(t.options.mutationKey,n))return!1}return(!r||t.state.status===r)&&!(a&&!a(t))}function Ei(e,t){return((null==t?void 0:t.queryKeyHashFn)||Mi)(e)}function Mi(e){return JSON.stringify(e,(e,t)=>Ri(t)?Object.keys(t).sort().reduce((e,s)=>(e[s]=t[s],e),{}):t)}function Ti(e,t){return e===t||typeof e==typeof t&&(!(!e||!t||"object"!=typeof e||"object"!=typeof t)&&Object.keys(t).every(s=>Ti(e[s],t[s])))}function Ai(e,t){if(e===t)return e;const s=Di(e)&&Di(t);if(s||Ri(e)&&Ri(t)){const r=s?e:Object.keys(e),a=r.length,n=s?t:Object.keys(t),i=n.length,o=s?[]:{},l=new Set(r);let c=0;for(let d=0;d<i;d++){const r=s?d:n[d];(!s&&l.has(r)||s)&&void 0===e[r]&&void 0===t[r]?(o[r]=void 0,c++):(o[r]=Ai(e[r],t[r]),o[r]===e[r]&&void 0!==e[r]&&c++)}return a===i&&c===a?e:o}return t}function Pi(e,t){if(!t||Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}function Di(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function Ri(e){if(!Oi(e))return!1;const t=e.constructor;if(void 0===t)return!0;const s=t.prototype;return!!Oi(s)&&(!!s.hasOwnProperty("isPrototypeOf")&&Object.getPrototypeOf(e)===Object.prototype)}function Oi(e){return"[object Object]"===Object.prototype.toString.call(e)}function qi(e,t,s){return"function"==typeof s.structuralSharing?s.structuralSharing(e,t):!1!==s.structuralSharing?Ai(e,t):t}function Ii(e,t,s=0){const r=[...e,t];return s&&r.length>s?r.slice(1):r}function Fi(e,t,s=0){const r=[t,...e];return s&&r.length>s?r.slice(0,-1):r}var Li=Symbol();function $i(e,t){return!e.queryFn&&(null==t?void 0:t.initialPromise)?()=>t.initialPromise:e.queryFn&&e.queryFn!==Li?e.queryFn:()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`))}var zi=new(r=class extends ji{constructor(){super(),je(this,e),je(this,t),je(this,s),ye(this,s,e=>{if(!yi&&window.addEventListener){const t=()=>e();return window.addEventListener("visibilitychange",t,!1),()=>{window.removeEventListener("visibilitychange",t)}}})}onSubscribe(){ve(this,t)||this.setEventListener(ve(this,s))}onUnsubscribe(){var e;this.hasListeners()||(null==(e=ve(this,t))||e.call(this),ye(this,t,void 0))}setEventListener(e){var r;ye(this,s,e),null==(r=ve(this,t))||r.call(this),ye(this,t,e(e=>{"boolean"==typeof e?this.setFocused(e):this.onFocus()}))}setFocused(t){ve(this,e)!==t&&(ye(this,e,t),this.onFocus())}onFocus(){const e=this.isFocused();this.listeners.forEach(t=>{t(e)})}isFocused(){var t;return"boolean"==typeof ve(this,e)?ve(this,e):"hidden"!==(null==(t=globalThis.document)?void 0:t.visibilityState)}},e=new WeakMap,t=new WeakMap,s=new WeakMap,r),Ui=new(o=class extends ji{constructor(){super(),je(this,a,!0),je(this,n),je(this,i),ye(this,i,e=>{if(!yi&&window.addEventListener){const t=()=>e(!0),s=()=>e(!1);return window.addEventListener("online",t,!1),window.addEventListener("offline",s,!1),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",s)}}})}onSubscribe(){ve(this,n)||this.setEventListener(ve(this,i))}onUnsubscribe(){var e;this.hasListeners()||(null==(e=ve(this,n))||e.call(this),ye(this,n,void 0))}setEventListener(e){var t;ye(this,i,e),null==(t=ve(this,n))||t.call(this),ye(this,n,e(this.setOnline.bind(this)))}setOnline(e){ve(this,a)!==e&&(ye(this,a,e),this.listeners.forEach(t=>{t(e)}))}isOnline(){return ve(this,a)}},a=new WeakMap,n=new WeakMap,i=new WeakMap,o);function Wi(){let e,t;const s=new Promise((s,r)=>{e=s,t=r});function r(e){Object.assign(s,e),delete s.resolve,delete s.reject}return s.status="pending",s.catch(()=>{}),s.resolve=t=>{r({status:"fulfilled",value:t}),e(t)},s.reject=e=>{r({status:"rejected",reason:e}),t(e)},s}function Vi(e){return Math.min(1e3*2**e,3e4)}function Bi(e){return"online"!==(e??"online")||Ui.isOnline()}var Hi=class extends Error{constructor(e){super("CancelledError"),this.revert=null==e?void 0:e.revert,this.silent=null==e?void 0:e.silent}};function Ki(e){return e instanceof Hi}function Yi(e){let t,s=!1,r=0,a=!1;const n=Wi(),i=()=>zi.isFocused()&&("always"===e.networkMode||Ui.isOnline())&&e.canRun(),o=()=>Bi(e.networkMode)&&e.canRun(),l=s=>{var r;a||(a=!0,null==(r=e.onSuccess)||r.call(e,s),null==t||t(),n.resolve(s))},c=s=>{var r;a||(a=!0,null==(r=e.onError)||r.call(e,s),null==t||t(),n.reject(s))},d=()=>new Promise(s=>{var r;t=e=>{(a||i())&&s(e)},null==(r=e.onPause)||r.call(e)}).then(()=>{var s;t=void 0,a||null==(s=e.onContinue)||s.call(e)}),u=()=>{if(a)return;let t;const n=0===r?e.initialPromise:void 0;try{t=n??e.fn()}catch(o){t=Promise.reject(o)}Promise.resolve(t).then(l).catch(t=>{var n;if(a)return;const o=e.retry??(yi?0:3),l=e.retryDelay??Vi,h="function"==typeof l?l(r,t):l,m=!0===o||"number"==typeof o&&r<o||"function"==typeof o&&o(r,t);var p;!s&&m?(r++,null==(n=e.onFail)||n.call(e,r,t),(p=h,new Promise(e=>{setTimeout(e,p)})).then(()=>i()?void 0:d()).then(()=>{s?c(t):u()})):c(t)})};return{promise:n,cancel:t=>{var s;a||(c(new Hi(t)),null==(s=e.abort)||s.call(e))},continue:()=>(null==t||t(),n),cancelRetry:()=>{s=!0},continueRetry:()=>{s=!1},canStart:o,start:()=>(o()?u():d().then(u),n)}}var Gi=e=>setTimeout(e,0);var Qi=function(){let e=[],t=0,s=e=>{e()},r=e=>{e()},a=Gi;const n=r=>{t?e.push(r):a(()=>{s(r)})};return{batch:n=>{let i;t++;try{i=n()}finally{t--,t||(()=>{const t=e;e=[],t.length&&a(()=>{r(()=>{t.forEach(e=>{s(e)})})})})()}return i},batchCalls:e=>(...t)=>{n(()=>{e(...t)})},schedule:n,setNotifyFunction:e=>{s=e},setBatchNotifyFunction:e=>{r=e},setScheduler:e=>{a=e}}}(),Ji=(c=class{constructor(){je(this,l)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),wi(this.gcTime)&&ye(this,l,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??(yi?1/0:3e5))}clearGcTimeout(){ve(this,l)&&(clearTimeout(ve(this,l)),ye(this,l,void 0))}},l=new WeakMap,c),Xi=(j=class extends Ji{constructor(e){super(),je(this,g),je(this,d),je(this,u),je(this,h),je(this,m),je(this,p),je(this,f),je(this,x),ye(this,x,!1),ye(this,f,e.defaultOptions),this.setOptions(e.options),this.observers=[],ye(this,m,e.client),ye(this,h,ve(this,m).getQueryCache()),this.queryKey=e.queryKey,this.queryHash=e.queryHash,ye(this,d,function(e){const t="function"==typeof e.initialData?e.initialData():e.initialData,s=void 0!==t,r=s?"function"==typeof e.initialDataUpdatedAt?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:s?r??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:s?"success":"pending",fetchStatus:"idle"}}(this.options)),this.state=e.state??ve(this,d),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var e;return null==(e=ve(this,p))?void 0:e.promise}setOptions(e){this.options={...ve(this,f),...e},this.updateGcTime(this.options.gcTime)}optionalRemove(){this.observers.length||"idle"!==this.state.fetchStatus||ve(this,h).remove(this)}setData(e,t){const s=qi(this.state.data,e,this.options);return be(this,g,v).call(this,{data:s,type:"success",dataUpdatedAt:null==t?void 0:t.updatedAt,manual:null==t?void 0:t.manual}),s}setState(e,t){be(this,g,v).call(this,{type:"setState",state:e,setStateOptions:t})}cancel(e){var t,s;const r=null==(t=ve(this,p))?void 0:t.promise;return null==(s=ve(this,p))||s.cancel(e),r?r.then(bi).catch(bi):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(ve(this,d))}isActive(){return this.observers.some(e=>!1!==ki(e.options.enabled,this))}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===Li||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0&&this.observers.some(e=>"static"===_i(e.options.staleTime,this))}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):void 0===this.state.data||this.state.isInvalidated}isStaleByTime(e=0){return void 0===this.state.data||"static"!==e&&(!!this.state.isInvalidated||!Ni(this.state.dataUpdatedAt,e))}onFocus(){var e;const t=this.observers.find(e=>e.shouldFetchOnWindowFocus());null==t||t.refetch({cancelRefetch:!1}),null==(e=ve(this,p))||e.continue()}onOnline(){var e;const t=this.observers.find(e=>e.shouldFetchOnReconnect());null==t||t.refetch({cancelRefetch:!1}),null==(e=ve(this,p))||e.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),ve(this,h).notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(t=>t!==e),this.observers.length||(ve(this,p)&&(ve(this,x)?ve(this,p).cancel({revert:!0}):ve(this,p).cancelRetry()),this.scheduleGc()),ve(this,h).notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||be(this,g,v).call(this,{type:"invalidate"})}fetch(e,t){var s,r,a;if("idle"!==this.state.fetchStatus)if(void 0!==this.state.data&&(null==t?void 0:t.cancelRefetch))this.cancel({silent:!0});else if(ve(this,p))return ve(this,p).continueRetry(),ve(this,p).promise;if(e&&this.setOptions(e),!this.options.queryFn){const e=this.observers.find(e=>e.options.queryFn);e&&this.setOptions(e.options)}const n=new AbortController,i=e=>{Object.defineProperty(e,"signal",{enumerable:!0,get:()=>(ye(this,x,!0),n.signal)})},o=()=>{const e=$i(this.options,t),s=(()=>{const e={client:ve(this,m),queryKey:this.queryKey,meta:this.meta};return i(e),e})();return ye(this,x,!1),this.options.persister?this.options.persister(e,s,this):e(s)},l=(()=>{const e={fetchOptions:t,options:this.options,queryKey:this.queryKey,client:ve(this,m),state:this.state,fetchFn:o};return i(e),e})();null==(s=this.options.behavior)||s.onFetch(l,this),ye(this,u,this.state),"idle"!==this.state.fetchStatus&&this.state.fetchMeta===(null==(r=l.fetchOptions)?void 0:r.meta)||be(this,g,v).call(this,{type:"fetch",meta:null==(a=l.fetchOptions)?void 0:a.meta});const c=e=>{var t,s,r,a;Ki(e)&&e.silent||be(this,g,v).call(this,{type:"error",error:e}),Ki(e)||(null==(s=(t=ve(this,h).config).onError)||s.call(t,e,this),null==(a=(r=ve(this,h).config).onSettled)||a.call(r,this.state.data,e,this)),this.scheduleGc()};return ye(this,p,Yi({initialPromise:null==t?void 0:t.initialPromise,fn:l.fetchFn,abort:n.abort.bind(n),onSuccess:e=>{var t,s,r,a;if(void 0!==e){try{this.setData(e)}catch(n){return void c(n)}null==(s=(t=ve(this,h).config).onSuccess)||s.call(t,e,this),null==(a=(r=ve(this,h).config).onSettled)||a.call(r,e,this.state.error,this),this.scheduleGc()}else c(new Error(`${this.queryHash} data is undefined`))},onError:c,onFail:(e,t)=>{be(this,g,v).call(this,{type:"failed",failureCount:e,error:t})},onPause:()=>{be(this,g,v).call(this,{type:"pause"})},onContinue:()=>{be(this,g,v).call(this,{type:"continue"})},retry:l.options.retry,retryDelay:l.options.retryDelay,networkMode:l.options.networkMode,canRun:()=>!0})),ve(this,p).start()}},d=new WeakMap,u=new WeakMap,h=new WeakMap,m=new WeakMap,p=new WeakMap,f=new WeakMap,x=new WeakMap,g=new WeakSet,v=function(e){this.state=(t=>{switch(e.type){case"failed":return{...t,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...t,fetchStatus:"paused"};case"continue":return{...t,fetchStatus:"fetching"};case"fetch":return{...t,...Zi(t.data,this.options),fetchMeta:e.meta??null};case"success":return ye(this,u,void 0),{...t,data:e.data,dataUpdateCount:t.dataUpdateCount+1,dataUpdatedAt:e.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const s=e.error;return Ki(s)&&s.revert&&ve(this,u)?{...ve(this,u),fetchStatus:"idle"}:{...t,error:s,errorUpdateCount:t.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:t.fetchFailureCount+1,fetchFailureReason:s,fetchStatus:"idle",status:"error"};case"invalidate":return{...t,isInvalidated:!0};case"setState":return{...t,...e.state}}})(this.state),Qi.batch(()=>{this.observers.forEach(e=>{e.onQueryUpdate()}),ve(this,h).notify({query:this,type:"updated",action:e})})},j);function Zi(e,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:Bi(t.networkMode)?"fetching":"paused",...void 0===e&&{error:null,status:"pending"}}}var eo=(b=class extends ji{constructor(e={}){super(),je(this,y),this.config=e,ye(this,y,new Map)}build(e,t,s){const r=t.queryKey,a=t.queryHash??Ei(r,t);let n=this.get(a);return n||(n=new Xi({client:e,queryKey:r,queryHash:a,options:e.defaultQueryOptions(t),state:s,defaultOptions:e.getQueryDefaults(r)}),this.add(n)),n}add(e){ve(this,y).has(e.queryHash)||(ve(this,y).set(e.queryHash,e),this.notify({type:"added",query:e}))}remove(e){const t=ve(this,y).get(e.queryHash);t&&(e.destroy(),t===e&&ve(this,y).delete(e.queryHash),this.notify({type:"removed",query:e}))}clear(){Qi.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}get(e){return ve(this,y).get(e)}getAll(){return[...ve(this,y).values()]}find(e){const t={exact:!0,...e};return this.getAll().find(e=>Si(t,e))}findAll(e={}){const t=this.getAll();return Object.keys(e).length>0?t.filter(t=>Si(e,t)):t}notify(e){Qi.batch(()=>{this.listeners.forEach(t=>{t(e)})})}onFocus(){Qi.batch(()=>{this.getAll().forEach(e=>{e.onFocus()})})}onOnline(){Qi.batch(()=>{this.getAll().forEach(e=>{e.onOnline()})})}},y=new WeakMap,b),to=(C=class extends Ji{constructor(e){super(),je(this,k),je(this,w),je(this,N),je(this,_),this.mutationId=e.mutationId,ye(this,N,e.mutationCache),ye(this,w,[]),this.state=e.state||{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0},this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){ve(this,w).includes(e)||(ve(this,w).push(e),this.clearGcTimeout(),ve(this,N).notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){ye(this,w,ve(this,w).filter(t=>t!==e)),this.scheduleGc(),ve(this,N).notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){ve(this,w).length||("pending"===this.state.status?this.scheduleGc():ve(this,N).remove(this))}continue(){var e;return(null==(e=ve(this,_))?void 0:e.continue())??this.execute(this.state.variables)}async execute(e){var t,s,r,a,n,i,o,l,c,d,u,h,m,p,f,x,g,v,j,y;const b=()=>{be(this,k,S).call(this,{type:"continue"})};ye(this,_,Yi({fn:()=>this.options.mutationFn?this.options.mutationFn(e):Promise.reject(new Error("No mutationFn found")),onFail:(e,t)=>{be(this,k,S).call(this,{type:"failed",failureCount:e,error:t})},onPause:()=>{be(this,k,S).call(this,{type:"pause"})},onContinue:b,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>ve(this,N).canRun(this)}));const w="pending"===this.state.status,C=!ve(this,_).canStart();try{if(w)b();else{be(this,k,S).call(this,{type:"pending",variables:e,isPaused:C}),await(null==(s=(t=ve(this,N).config).onMutate)?void 0:s.call(t,e,this));const n=await(null==(a=(r=this.options).onMutate)?void 0:a.call(r,e));n!==this.state.context&&be(this,k,S).call(this,{type:"pending",context:n,variables:e,isPaused:C})}const m=await ve(this,_).start();return await(null==(i=(n=ve(this,N).config).onSuccess)?void 0:i.call(n,m,e,this.state.context,this)),await(null==(l=(o=this.options).onSuccess)?void 0:l.call(o,m,e,this.state.context)),await(null==(d=(c=ve(this,N).config).onSettled)?void 0:d.call(c,m,null,this.state.variables,this.state.context,this)),await(null==(h=(u=this.options).onSettled)?void 0:h.call(u,m,null,e,this.state.context)),be(this,k,S).call(this,{type:"success",data:m}),m}catch(E){try{throw await(null==(p=(m=ve(this,N).config).onError)?void 0:p.call(m,E,e,this.state.context,this)),await(null==(x=(f=this.options).onError)?void 0:x.call(f,E,e,this.state.context)),await(null==(v=(g=ve(this,N).config).onSettled)?void 0:v.call(g,void 0,E,this.state.variables,this.state.context,this)),await(null==(y=(j=this.options).onSettled)?void 0:y.call(j,void 0,E,e,this.state.context)),E}finally{be(this,k,S).call(this,{type:"error",error:E})}}finally{ve(this,N).runNext(this)}}},w=new WeakMap,N=new WeakMap,_=new WeakMap,k=new WeakSet,S=function(e){this.state=(t=>{switch(e.type){case"failed":return{...t,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...t,isPaused:!0};case"continue":return{...t,isPaused:!1};case"pending":return{...t,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...t,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...t,data:void 0,error:e.error,failureCount:t.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}})(this.state),Qi.batch(()=>{ve(this,w).forEach(t=>{t.onMutationUpdate(e)}),ve(this,N).notify({mutation:this,type:"updated",action:e})})},C);var so=(A=class extends ji{constructor(e={}){super(),je(this,E),je(this,M),je(this,T),this.config=e,ye(this,E,new Set),ye(this,M,new Map),ye(this,T,0)}build(e,t,s){const r=new to({mutationCache:this,mutationId:++we(this,T)._,options:e.defaultMutationOptions(t),state:s});return this.add(r),r}add(e){ve(this,E).add(e);const t=ro(e);if("string"==typeof t){const s=ve(this,M).get(t);s?s.push(e):ve(this,M).set(t,[e])}this.notify({type:"added",mutation:e})}remove(e){if(ve(this,E).delete(e)){const t=ro(e);if("string"==typeof t){const s=ve(this,M).get(t);if(s)if(s.length>1){const t=s.indexOf(e);-1!==t&&s.splice(t,1)}else s[0]===e&&ve(this,M).delete(t)}}this.notify({type:"removed",mutation:e})}canRun(e){const t=ro(e);if("string"==typeof t){const s=ve(this,M).get(t),r=null==s?void 0:s.find(e=>"pending"===e.state.status);return!r||r===e}return!0}runNext(e){var t;const s=ro(e);if("string"==typeof s){const r=null==(t=ve(this,M).get(s))?void 0:t.find(t=>t!==e&&t.state.isPaused);return(null==r?void 0:r.continue())??Promise.resolve()}return Promise.resolve()}clear(){Qi.batch(()=>{ve(this,E).forEach(e=>{this.notify({type:"removed",mutation:e})}),ve(this,E).clear(),ve(this,M).clear()})}getAll(){return Array.from(ve(this,E))}find(e){const t={exact:!0,...e};return this.getAll().find(e=>Ci(t,e))}findAll(e={}){return this.getAll().filter(t=>Ci(e,t))}notify(e){Qi.batch(()=>{this.listeners.forEach(t=>{t(e)})})}resumePausedMutations(){const e=this.getAll().filter(e=>e.state.isPaused);return Qi.batch(()=>Promise.all(e.map(e=>e.continue().catch(bi))))}},E=new WeakMap,M=new WeakMap,T=new WeakMap,A);function ro(e){var t;return null==(t=e.options.scope)?void 0:t.id}function ao(e){return{onFetch:(t,s)=>{var r,a,n,i,o;const l=t.options,c=null==(n=null==(a=null==(r=t.fetchOptions)?void 0:r.meta)?void 0:a.fetchMore)?void 0:n.direction,d=(null==(i=t.state.data)?void 0:i.pages)||[],u=(null==(o=t.state.data)?void 0:o.pageParams)||[];let h={pages:[],pageParams:[]},m=0;const p=async()=>{let s=!1;const r=$i(t.options,t.fetchOptions),a=async(e,a,n)=>{if(s)return Promise.reject();if(null==a&&e.pages.length)return Promise.resolve(e);const i=(()=>{const e={client:t.client,queryKey:t.queryKey,pageParam:a,direction:n?"backward":"forward",meta:t.options.meta};var r;return r=e,Object.defineProperty(r,"signal",{enumerable:!0,get:()=>(t.signal.aborted?s=!0:t.signal.addEventListener("abort",()=>{s=!0}),t.signal)}),e})(),o=await r(i),{maxPages:l}=t.options,c=n?Fi:Ii;return{pages:c(e.pages,o,l),pageParams:c(e.pageParams,a,l)}};if(c&&d.length){const e="backward"===c,t={pages:d,pageParams:u},s=(e?io:no)(l,t);h=await a(t,s,e)}else{const t=e??d.length;do{const e=0===m?u[0]??l.initialPageParam:no(l,h);if(m>0&&null==e)break;h=await a(h,e),m++}while(m<t)}return h};t.options.persister?t.fetchFn=()=>{var e,r;return null==(r=(e=t.options).persister)?void 0:r.call(e,p,{client:t.client,queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},s)}:t.fetchFn=p}}}function no(e,{pages:t,pageParams:s}){const r=t.length-1;return t.length>0?e.getNextPageParam(t[r],t,s[r],s):void 0}function io(e,{pages:t,pageParams:s}){var r;return t.length>0?null==(r=e.getPreviousPageParam)?void 0:r.call(e,t[0],t,s[0],s):void 0}var oo=($=class{constructor(e={}){je(this,P),je(this,D),je(this,R),je(this,O),je(this,q),je(this,I),je(this,F),je(this,L),ye(this,P,e.queryCache||new eo),ye(this,D,e.mutationCache||new so),ye(this,R,e.defaultOptions||{}),ye(this,O,new Map),ye(this,q,new Map),ye(this,I,0)}mount(){we(this,I)._++,1===ve(this,I)&&(ye(this,F,zi.subscribe(async e=>{e&&(await this.resumePausedMutations(),ve(this,P).onFocus())})),ye(this,L,Ui.subscribe(async e=>{e&&(await this.resumePausedMutations(),ve(this,P).onOnline())})))}unmount(){var e,t;we(this,I)._--,0===ve(this,I)&&(null==(e=ve(this,F))||e.call(this),ye(this,F,void 0),null==(t=ve(this,L))||t.call(this),ye(this,L,void 0))}isFetching(e){return ve(this,P).findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return ve(this,D).findAll({...e,status:"pending"}).length}getQueryData(e){var t;const s=this.defaultQueryOptions({queryKey:e});return null==(t=ve(this,P).get(s.queryHash))?void 0:t.state.data}ensureQueryData(e){const t=this.defaultQueryOptions(e),s=ve(this,P).build(this,t),r=s.state.data;return void 0===r?this.fetchQuery(e):(e.revalidateIfStale&&s.isStaleByTime(_i(t.staleTime,s))&&this.prefetchQuery(t),Promise.resolve(r))}getQueriesData(e){return ve(this,P).findAll(e).map(({queryKey:e,state:t})=>[e,t.data])}setQueryData(e,t,s){const r=this.defaultQueryOptions({queryKey:e}),a=ve(this,P).get(r.queryHash),n=function(e,t){return"function"==typeof e?e(t):e}(t,null==a?void 0:a.state.data);if(void 0!==n)return ve(this,P).build(this,r).setData(n,{...s,manual:!0})}setQueriesData(e,t,s){return Qi.batch(()=>ve(this,P).findAll(e).map(({queryKey:e})=>[e,this.setQueryData(e,t,s)]))}getQueryState(e){var t;const s=this.defaultQueryOptions({queryKey:e});return null==(t=ve(this,P).get(s.queryHash))?void 0:t.state}removeQueries(e){const t=ve(this,P);Qi.batch(()=>{t.findAll(e).forEach(e=>{t.remove(e)})})}resetQueries(e,t){const s=ve(this,P);return Qi.batch(()=>(s.findAll(e).forEach(e=>{e.reset()}),this.refetchQueries({type:"active",...e},t)))}cancelQueries(e,t={}){const s={revert:!0,...t},r=Qi.batch(()=>ve(this,P).findAll(e).map(e=>e.cancel(s)));return Promise.all(r).then(bi).catch(bi)}invalidateQueries(e,t={}){return Qi.batch(()=>(ve(this,P).findAll(e).forEach(e=>{e.invalidate()}),"none"===(null==e?void 0:e.refetchType)?Promise.resolve():this.refetchQueries({...e,type:(null==e?void 0:e.refetchType)??(null==e?void 0:e.type)??"active"},t)))}refetchQueries(e,t={}){const s={...t,cancelRefetch:t.cancelRefetch??!0},r=Qi.batch(()=>ve(this,P).findAll(e).filter(e=>!e.isDisabled()&&!e.isStatic()).map(e=>{let t=e.fetch(void 0,s);return s.throwOnError||(t=t.catch(bi)),"paused"===e.state.fetchStatus?Promise.resolve():t}));return Promise.all(r).then(bi)}fetchQuery(e){const t=this.defaultQueryOptions(e);void 0===t.retry&&(t.retry=!1);const s=ve(this,P).build(this,t);return s.isStaleByTime(_i(t.staleTime,s))?s.fetch(t):Promise.resolve(s.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(bi).catch(bi)}fetchInfiniteQuery(e){return e.behavior=ao(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(bi).catch(bi)}ensureInfiniteQueryData(e){return e.behavior=ao(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return Ui.isOnline()?ve(this,D).resumePausedMutations():Promise.resolve()}getQueryCache(){return ve(this,P)}getMutationCache(){return ve(this,D)}getDefaultOptions(){return ve(this,R)}setDefaultOptions(e){ye(this,R,e)}setQueryDefaults(e,t){ve(this,O).set(Mi(e),{queryKey:e,defaultOptions:t})}getQueryDefaults(e){const t=[...ve(this,O).values()],s={};return t.forEach(t=>{Ti(e,t.queryKey)&&Object.assign(s,t.defaultOptions)}),s}setMutationDefaults(e,t){ve(this,q).set(Mi(e),{mutationKey:e,defaultOptions:t})}getMutationDefaults(e){const t=[...ve(this,q).values()],s={};return t.forEach(t=>{Ti(e,t.mutationKey)&&Object.assign(s,t.defaultOptions)}),s}defaultQueryOptions(e){if(e._defaulted)return e;const t={...ve(this,R).queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return t.queryHash||(t.queryHash=Ei(t.queryKey,t)),void 0===t.refetchOnReconnect&&(t.refetchOnReconnect="always"!==t.networkMode),void 0===t.throwOnError&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.queryFn===Li&&(t.enabled=!1),t}defaultMutationOptions(e){return(null==e?void 0:e._defaulted)?e:{...ve(this,R).mutations,...(null==e?void 0:e.mutationKey)&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){ve(this,P).clear(),ve(this,D).clear()}},P=new WeakMap,D=new WeakMap,R=new WeakMap,O=new WeakMap,q=new WeakMap,I=new WeakMap,F=new WeakMap,L=new WeakMap,$),lo=(he=class extends ji{constructor(e,t){super(),je(this,se),je(this,z),je(this,U),je(this,W),je(this,V),je(this,B),je(this,H),je(this,K),je(this,Y),je(this,G),je(this,Q),je(this,J),je(this,X),je(this,Z),je(this,ee),je(this,te,new Set),this.options=t,ye(this,z,e),ye(this,Y,null),ye(this,K,Wi()),this.options.experimental_prefetchInRender||ve(this,K).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(t)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){1===this.listeners.size&&(ve(this,U).addObserver(this),co(ve(this,U),this.options)?be(this,se,re).call(this):this.updateResult(),be(this,se,oe).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return uo(ve(this,U),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return uo(ve(this,U),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,be(this,se,le).call(this),be(this,se,ce).call(this),ve(this,U).removeObserver(this)}setOptions(e){const t=this.options,s=ve(this,U);if(this.options=ve(this,z).defaultQueryOptions(e),void 0!==this.options.enabled&&"boolean"!=typeof this.options.enabled&&"function"!=typeof this.options.enabled&&"boolean"!=typeof ki(this.options.enabled,ve(this,U)))throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");be(this,se,de).call(this),ve(this,U).setOptions(this.options),t._defaulted&&!Pi(this.options,t)&&ve(this,z).getQueryCache().notify({type:"observerOptionsUpdated",query:ve(this,U),observer:this});const r=this.hasListeners();r&&ho(ve(this,U),s,this.options,t)&&be(this,se,re).call(this),this.updateResult(),!r||ve(this,U)===s&&ki(this.options.enabled,ve(this,U))===ki(t.enabled,ve(this,U))&&_i(this.options.staleTime,ve(this,U))===_i(t.staleTime,ve(this,U))||be(this,se,ae).call(this);const a=be(this,se,ne).call(this);!r||ve(this,U)===s&&ki(this.options.enabled,ve(this,U))===ki(t.enabled,ve(this,U))&&a===ve(this,ee)||be(this,se,ie).call(this,a)}getOptimisticResult(e){const t=ve(this,z).getQueryCache().build(ve(this,z),e),s=this.createResult(t,e);return function(e,t){if(!Pi(e.getCurrentResult(),t))return!0;return!1}(this,s)&&(ye(this,V,s),ye(this,H,this.options),ye(this,B,ve(this,U).state)),s}getCurrentResult(){return ve(this,V)}trackResult(e,t){return new Proxy(e,{get:(e,s)=>(this.trackProp(s),null==t||t(s),Reflect.get(e,s))})}trackProp(e){ve(this,te).add(e)}getCurrentQuery(){return ve(this,U)}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const t=ve(this,z).defaultQueryOptions(e),s=ve(this,z).getQueryCache().build(ve(this,z),t);return s.fetch().then(()=>this.createResult(s,t))}fetch(e){return be(this,se,re).call(this,{...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),ve(this,V)))}createResult(e,t){var s;const r=ve(this,U),a=this.options,n=ve(this,V),i=ve(this,B),o=ve(this,H),l=e!==r?e.state:ve(this,W),{state:c}=e;let d,u={...c},h=!1;if(t._optimisticResults){const s=this.hasListeners(),n=!s&&co(e,t),i=s&&ho(e,r,t,a);(n||i)&&(u={...u,...Zi(c.data,e.options)}),"isRestoring"===t._optimisticResults&&(u.fetchStatus="idle")}let{error:m,errorUpdatedAt:p,status:f}=u;d=u.data;let x=!1;if(void 0!==t.placeholderData&&void 0===d&&"pending"===f){let e;(null==n?void 0:n.isPlaceholderData)&&t.placeholderData===(null==o?void 0:o.placeholderData)?(e=n.data,x=!0):e="function"==typeof t.placeholderData?t.placeholderData(null==(s=ve(this,J))?void 0:s.state.data,ve(this,J)):t.placeholderData,void 0!==e&&(f="success",d=qi(null==n?void 0:n.data,e,t),h=!0)}if(t.select&&void 0!==d&&!x)if(n&&d===(null==i?void 0:i.data)&&t.select===ve(this,G))d=ve(this,Q);else try{ye(this,G,t.select),d=t.select(d),d=qi(null==n?void 0:n.data,d,t),ye(this,Q,d),ye(this,Y,null)}catch(N){ye(this,Y,N)}ve(this,Y)&&(m=ve(this,Y),d=ve(this,Q),p=Date.now(),f="error");const g="fetching"===u.fetchStatus,v="pending"===f,j="error"===f,y=v&&g,b=void 0!==d,w={status:f,fetchStatus:u.fetchStatus,isPending:v,isSuccess:"success"===f,isError:j,isInitialLoading:y,isLoading:y,data:d,dataUpdatedAt:u.dataUpdatedAt,error:m,errorUpdatedAt:p,failureCount:u.fetchFailureCount,failureReason:u.fetchFailureReason,errorUpdateCount:u.errorUpdateCount,isFetched:u.dataUpdateCount>0||u.errorUpdateCount>0,isFetchedAfterMount:u.dataUpdateCount>l.dataUpdateCount||u.errorUpdateCount>l.errorUpdateCount,isFetching:g,isRefetching:g&&!v,isLoadingError:j&&!b,isPaused:"paused"===u.fetchStatus,isPlaceholderData:h,isRefetchError:j&&b,isStale:mo(e,t),refetch:this.refetch,promise:ve(this,K),isEnabled:!1!==ki(t.enabled,e)};if(this.options.experimental_prefetchInRender){const t=e=>{"error"===w.status?e.reject(w.error):void 0!==w.data&&e.resolve(w.data)},s=()=>{const e=ye(this,K,w.promise=Wi());t(e)},a=ve(this,K);switch(a.status){case"pending":e.queryHash===r.queryHash&&t(a);break;case"fulfilled":"error"!==w.status&&w.data===a.value||s();break;case"rejected":"error"===w.status&&w.error===a.reason||s()}}return w}updateResult(){const e=ve(this,V),t=this.createResult(ve(this,U),this.options);if(ye(this,B,ve(this,U).state),ye(this,H,this.options),void 0!==ve(this,B).data&&ye(this,J,ve(this,U)),Pi(t,e))return;ye(this,V,t);be(this,se,ue).call(this,{listeners:(()=>{if(!e)return!0;const{notifyOnChangeProps:t}=this.options,s="function"==typeof t?t():t;if("all"===s||!s&&!ve(this,te).size)return!0;const r=new Set(s??ve(this,te));return this.options.throwOnError&&r.add("error"),Object.keys(ve(this,V)).some(t=>{const s=t;return ve(this,V)[s]!==e[s]&&r.has(s)})})()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&be(this,se,oe).call(this)}},z=new WeakMap,U=new WeakMap,W=new WeakMap,V=new WeakMap,B=new WeakMap,H=new WeakMap,K=new WeakMap,Y=new WeakMap,G=new WeakMap,Q=new WeakMap,J=new WeakMap,X=new WeakMap,Z=new WeakMap,ee=new WeakMap,te=new WeakMap,se=new WeakSet,re=function(e){be(this,se,de).call(this);let t=ve(this,U).fetch(this.options,e);return(null==e?void 0:e.throwOnError)||(t=t.catch(bi)),t},ae=function(){be(this,se,le).call(this);const e=_i(this.options.staleTime,ve(this,U));if(yi||ve(this,V).isStale||!wi(e))return;const t=Ni(ve(this,V).dataUpdatedAt,e);ye(this,X,setTimeout(()=>{ve(this,V).isStale||this.updateResult()},t+1))},ne=function(){return("function"==typeof this.options.refetchInterval?this.options.refetchInterval(ve(this,U)):this.options.refetchInterval)??!1},ie=function(e){be(this,se,ce).call(this),ye(this,ee,e),!yi&&!1!==ki(this.options.enabled,ve(this,U))&&wi(ve(this,ee))&&0!==ve(this,ee)&&ye(this,Z,setInterval(()=>{(this.options.refetchIntervalInBackground||zi.isFocused())&&be(this,se,re).call(this)},ve(this,ee)))},oe=function(){be(this,se,ae).call(this),be(this,se,ie).call(this,be(this,se,ne).call(this))},le=function(){ve(this,X)&&(clearTimeout(ve(this,X)),ye(this,X,void 0))},ce=function(){ve(this,Z)&&(clearInterval(ve(this,Z)),ye(this,Z,void 0))},de=function(){const e=ve(this,z).getQueryCache().build(ve(this,z),this.options);if(e===ve(this,U))return;const t=ve(this,U);ye(this,U,e),ye(this,W,e.state),this.hasListeners()&&(null==t||t.removeObserver(this),e.addObserver(this))},ue=function(e){Qi.batch(()=>{e.listeners&&this.listeners.forEach(e=>{e(ve(this,V))}),ve(this,z).getQueryCache().notify({query:ve(this,U),type:"observerResultsUpdated"})})},he);function co(e,t){return function(e,t){return!1!==ki(t.enabled,e)&&void 0===e.state.data&&!("error"===e.state.status&&!1===t.retryOnMount)}(e,t)||void 0!==e.state.data&&uo(e,t,t.refetchOnMount)}function uo(e,t,s){if(!1!==ki(t.enabled,e)&&"static"!==_i(t.staleTime,e)){const r="function"==typeof s?s(e):s;return"always"===r||!1!==r&&mo(e,t)}return!1}function ho(e,t,s,r){return(e!==t||!1===ki(r.enabled,e))&&(!s.suspense||"error"!==e.state.status)&&mo(e,s)}function mo(e,t){return!1!==ki(t.enabled,e)&&e.isStaleByTime(_i(t.staleTime,e))}var po=Nt.createContext(void 0),fo=({client:e,children:t})=>(Nt.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),Ne.jsx(po.Provider,{value:e,children:t})),xo=Nt.createContext(!1);xo.Provider;var go,vo,jo=Nt.createContext(function(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}()),yo=(e,t,s)=>t.fetchOptimistic(e).catch(()=>{s.clearReset()});function bo(e,t,s){var r,a,n,i,o;const l=Nt.useContext(xo),c=Nt.useContext(jo),d=(()=>{const e=Nt.useContext(po);if(!e)throw new Error("No QueryClient set, use QueryClientProvider to set one");return e})(),u=d.defaultQueryOptions(e);null==(a=null==(r=d.getDefaultOptions().queries)?void 0:r._experimental_beforeQuery)||a.call(r,u),u._optimisticResults=l?"isRestoring":"optimistic",(e=>{if(e.suspense){const t=e=>"static"===e?e:Math.max(e??1e3,1e3),s=e.staleTime;e.staleTime="function"==typeof s?(...e)=>t(s(...e)):t(s),"number"==typeof e.gcTime&&(e.gcTime=Math.max(e.gcTime,1e3))}})(u),((e,t)=>{(e.suspense||e.throwOnError||e.experimental_prefetchInRender)&&(t.isReset()||(e.retryOnMount=!1))})(u,c),(e=>{Nt.useEffect(()=>{e.clearReset()},[e])})(c);const h=!d.getQueryCache().get(u.queryHash),[m]=Nt.useState(()=>new t(d,u)),p=m.getOptimisticResult(u),f=!l&&!1!==e.subscribed;if(Nt.useSyncExternalStore(Nt.useCallback(e=>{const t=f?m.subscribe(Qi.batchCalls(e)):bi;return m.updateResult(),t},[m,f]),()=>m.getCurrentResult(),()=>m.getCurrentResult()),Nt.useEffect(()=>{m.setOptions(u)},[u,m]),((e,t)=>(null==e?void 0:e.suspense)&&t.isPending)(u,p))throw yo(u,m,c);if((({result:e,errorResetBoundary:t,throwOnError:s,query:r,suspense:a})=>e.isError&&!t.isReset()&&!e.isFetching&&r&&(a&&void 0===e.data||function(e,t){return"function"==typeof e?e(...t):!!e}(s,[e.error,r])))({result:p,errorResetBoundary:c,throwOnError:u.throwOnError,query:d.getQueryCache().get(u.queryHash),suspense:u.suspense}))throw p.error;if(null==(i=null==(n=d.getDefaultOptions().queries)?void 0:n._experimental_afterQuery)||i.call(n,u,p),u.experimental_prefetchInRender&&!yi&&((e,t)=>e.isLoading&&e.isFetching&&!t)(p,l)){const e=h?yo(u,m,c):null==(o=d.getQueryCache().get(u.queryHash))?void 0:o.promise;null==e||e.catch(bi).finally(()=>{m.updateResult()})}return u.notifyOnChangeProps?p:m.trackResult(p)}function wo(e,t){return bo(e,lo)}
/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function No(){return No=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r])}return e},No.apply(this,arguments)}(vo=go||(go={})).Pop="POP",vo.Push="PUSH",vo.Replace="REPLACE";const _o="popstate";function ko(e){return void 0===e&&(e={}),function(e,t,s,r){void 0===r&&(r={});let{window:a=document.defaultView,v5Compat:n=!1}=r,i=a.history,o=go.Pop,l=null,c=d();null==c&&(c=0,i.replaceState(No({},i.state,{idx:c}),""));function d(){return(i.state||{idx:null}).idx}function u(){o=go.Pop;let e=d(),t=null==e?null:e-c;c=e,l&&l({action:o,location:f.location,delta:t})}function h(e,t){o=go.Push;let s=Mo(f.location,e,t);c=d()+1;let r=Eo(s,c),u=f.createHref(s);try{i.pushState(r,"",u)}catch(h){if(h instanceof DOMException&&"DataCloneError"===h.name)throw h;a.location.assign(u)}n&&l&&l({action:o,location:f.location,delta:1})}function m(e,t){o=go.Replace;let s=Mo(f.location,e,t);c=d();let r=Eo(s,c),a=f.createHref(s);i.replaceState(r,"",a),n&&l&&l({action:o,location:f.location,delta:0})}function p(e){let t="null"!==a.location.origin?a.location.origin:a.location.href,s="string"==typeof e?e:To(e);return s=s.replace(/ $/,"%20"),So(t,"No window.location.(origin|href) available to create URL for href: "+s),new URL(s,t)}let f={get action(){return o},get location(){return e(a,i)},listen(e){if(l)throw new Error("A history only accepts one active listener");return a.addEventListener(_o,u),l=e,()=>{a.removeEventListener(_o,u),l=null}},createHref:e=>t(a,e),createURL:p,encodeLocation(e){let t=p(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:h,replace:m,go:e=>i.go(e)};return f}(function(e,t){let{pathname:s,search:r,hash:a}=e.location;return Mo("",{pathname:s,search:r,hash:a},t.state&&t.state.usr||null,t.state&&t.state.key||"default")},function(e,t){return"string"==typeof t?t:To(t)},0,e)}function So(e,t){if(!1===e||null==e)throw new Error(t)}function Co(e,t){if(!e)try{throw new Error(t)}catch(s){}}function Eo(e,t){return{usr:e.state,key:e.key,idx:t}}function Mo(e,t,s,r){return void 0===s&&(s=null),No({pathname:"string"==typeof e?e:e.pathname,search:"",hash:""},"string"==typeof t?Ao(t):t,{state:s,key:t&&t.key||r||Math.random().toString(36).substr(2,8)})}function To(e){let{pathname:t="/",search:s="",hash:r=""}=e;return s&&"?"!==s&&(t+="?"===s.charAt(0)?s:"?"+s),r&&"#"!==r&&(t+="#"===r.charAt(0)?r:"#"+r),t}function Ao(e){let t={};if(e){let s=e.indexOf("#");s>=0&&(t.hash=e.substr(s),e=e.substr(0,s));let r=e.indexOf("?");r>=0&&(t.search=e.substr(r),e=e.substr(0,r)),e&&(t.pathname=e)}return t}var Po,Do;function Ro(e,t,s){return void 0===s&&(s="/"),function(e,t,s){let r="string"==typeof t?Ao(t):t,a=Yo(r.pathname||"/",s);if(null==a)return null;let n=Oo(e);!function(e){e.sort((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){let s=e.length===t.length&&e.slice(0,-1).every((e,s)=>e===t[s]);return s?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map(e=>e.childrenIndex),t.routesMeta.map(e=>e.childrenIndex)))}(n);let i=null;for(let o=0;null==i&&o<n.length;++o){let e=Ko(a);i=Bo(n[o],e)}return i}(e,t,s)}function Oo(e,t,s,r){void 0===t&&(t=[]),void 0===s&&(s=[]),void 0===r&&(r="");let a=(e,a,n)=>{let i={relativePath:void 0===n?e.path||"":n,caseSensitive:!0===e.caseSensitive,childrenIndex:a,route:e};i.relativePath.startsWith("/")&&(So(i.relativePath.startsWith(r),'Absolute route path "'+i.relativePath+'" nested under path "'+r+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),i.relativePath=i.relativePath.slice(r.length));let o=Xo([r,i.relativePath]),l=s.concat(i);e.children&&e.children.length>0&&(So(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'+o+'".'),Oo(e.children,t,l,o)),(null!=e.path||e.index)&&t.push({path:o,score:Vo(o,e.index),routesMeta:l})};return e.forEach((e,t)=>{var s;if(""!==e.path&&null!=(s=e.path)&&s.includes("?"))for(let r of qo(e.path))a(e,t,r);else a(e,t)}),t}function qo(e){let t=e.split("/");if(0===t.length)return[];let[s,...r]=t,a=s.endsWith("?"),n=s.replace(/\?$/,"");if(0===r.length)return a?[n,""]:[n];let i=qo(r.join("/")),o=[];return o.push(...i.map(e=>""===e?n:[n,e].join("/"))),a&&o.push(...i),o.map(t=>e.startsWith("/")&&""===t?"/":t)}(Do=Po||(Po={})).data="data",Do.deferred="deferred",Do.redirect="redirect",Do.error="error";const Io=/^:[\w-]+$/,Fo=3,Lo=2,$o=1,zo=10,Uo=-2,Wo=e=>"*"===e;function Vo(e,t){let s=e.split("/"),r=s.length;return s.some(Wo)&&(r+=Uo),t&&(r+=Lo),s.filter(e=>!Wo(e)).reduce((e,t)=>e+(Io.test(t)?Fo:""===t?$o:zo),r)}function Bo(e,t,s){let{routesMeta:r}=e,a={},n="/",i=[];for(let o=0;o<r.length;++o){let e=r[o],s=o===r.length-1,l="/"===n?t:t.slice(n.length)||"/",c=Ho({path:e.relativePath,caseSensitive:e.caseSensitive,end:s},l),d=e.route;if(!c)return null;Object.assign(a,c.params),i.push({params:a,pathname:Xo([n,c.pathname]),pathnameBase:Zo(Xo([n,c.pathnameBase])),route:d}),"/"!==c.pathnameBase&&(n=Xo([n,c.pathnameBase]))}return i}function Ho(e,t){"string"==typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[s,r]=function(e,t,s){void 0===t&&(t=!1);void 0===s&&(s=!0);Co("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were "'+e.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+e.replace(/\*$/,"/*")+'".');let r=[],a="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(e,t,s)=>(r.push({paramName:t,isOptional:null!=s}),s?"/?([^\\/]+)?":"/([^\\/]+)"));e.endsWith("*")?(r.push({paramName:"*"}),a+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):s?a+="\\/*$":""!==e&&"/"!==e&&(a+="(?:(?=\\/|$))");let n=new RegExp(a,t?void 0:"i");return[n,r]}(e.path,e.caseSensitive,e.end),a=t.match(s);if(!a)return null;let n=a[0],i=n.replace(/(.)\/+$/,"$1"),o=a.slice(1);return{params:r.reduce((e,t,s)=>{let{paramName:r,isOptional:a}=t;if("*"===r){let e=o[s]||"";i=n.slice(0,n.length-e.length).replace(/(.)\/+$/,"$1")}const l=o[s];return e[r]=a&&!l?void 0:(l||"").replace(/%2F/g,"/"),e},{}),pathname:n,pathnameBase:i,pattern:e}}function Ko(e){try{return e.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(t){return Co(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+t+")."),e}}function Yo(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let s=t.endsWith("/")?t.length-1:t.length,r=e.charAt(s);return r&&"/"!==r?null:e.slice(s)||"/"}function Go(e,t,s,r){return"Cannot include a '"+e+"' character in a manually specified `to."+t+"` field ["+JSON.stringify(r)+"].  Please separate it out to the `to."+s+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function Qo(e,t){let s=function(e){return e.filter((e,t)=>0===t||e.route.path&&e.route.path.length>0)}(e);return t?s.map((e,t)=>t===s.length-1?e.pathname:e.pathnameBase):s.map(e=>e.pathnameBase)}function Jo(e,t,s,r){let a;void 0===r&&(r=!1),"string"==typeof e?a=Ao(e):(a=No({},e),So(!a.pathname||!a.pathname.includes("?"),Go("?","pathname","search",a)),So(!a.pathname||!a.pathname.includes("#"),Go("#","pathname","hash",a)),So(!a.search||!a.search.includes("#"),Go("#","search","hash",a)));let n,i=""===e||""===a.pathname,o=i?"/":a.pathname;if(null==o)n=s;else{let e=t.length-1;if(!r&&o.startsWith("..")){let t=o.split("/");for(;".."===t[0];)t.shift(),e-=1;a.pathname=t.join("/")}n=e>=0?t[e]:"/"}let l=function(e,t){void 0===t&&(t="/");let{pathname:s,search:r="",hash:a=""}="string"==typeof e?Ao(e):e,n=s?s.startsWith("/")?s:function(e,t){let s=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(e=>{".."===e?s.length>1&&s.pop():"."!==e&&s.push(e)}),s.length>1?s.join("/"):"/"}(s,t):t;return{pathname:n,search:el(r),hash:tl(a)}}(a,n),c=o&&"/"!==o&&o.endsWith("/"),d=(i||"."===o)&&s.endsWith("/");return l.pathname.endsWith("/")||!c&&!d||(l.pathname+="/"),l}const Xo=e=>e.join("/").replace(/\/\/+/g,"/"),Zo=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),el=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",tl=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";const sl=["post","put","patch","delete"];new Set(sl);const rl=["get",...sl];
/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */
function al(){return al=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r])}return e},al.apply(this,arguments)}new Set(rl);const nl=Nt.createContext(null),il=Nt.createContext(null),ol=Nt.createContext(null),ll=Nt.createContext(null),cl=Nt.createContext({outlet:null,matches:[],isDataRoute:!1}),dl=Nt.createContext(null);function ul(){return null!=Nt.useContext(ll)}function hl(){return ul()||So(!1),Nt.useContext(ll).location}function ml(e){Nt.useContext(ol).static||Nt.useLayoutEffect(e)}function pl(){let{isDataRoute:e}=Nt.useContext(cl);return e?function(){let{router:e}=function(){let e=Nt.useContext(nl);return e||So(!1),e}(bl.UseNavigateStable),t=Nl(wl.UseNavigateStable),s=Nt.useRef(!1);return ml(()=>{s.current=!0}),Nt.useCallback(function(r,a){void 0===a&&(a={}),s.current&&("number"==typeof r?e.navigate(r):e.navigate(r,al({fromRouteId:t},a)))},[e,t])}():function(){ul()||So(!1);let e=Nt.useContext(nl),{basename:t,future:s,navigator:r}=Nt.useContext(ol),{matches:a}=Nt.useContext(cl),{pathname:n}=hl(),i=JSON.stringify(Qo(a,s.v7_relativeSplatPath)),o=Nt.useRef(!1);return ml(()=>{o.current=!0}),Nt.useCallback(function(s,a){if(void 0===a&&(a={}),!o.current)return;if("number"==typeof s)return void r.go(s);let l=Jo(s,JSON.parse(i),n,"path"===a.relative);null==e&&"/"!==t&&(l.pathname="/"===l.pathname?t:Xo([t,l.pathname])),(a.replace?r.replace:r.push)(l,a.state,a)},[t,r,i,n,e])}()}function fl(e,t){let{relative:s}=void 0===t?{}:t,{future:r}=Nt.useContext(ol),{matches:a}=Nt.useContext(cl),{pathname:n}=hl(),i=JSON.stringify(Qo(a,r.v7_relativeSplatPath));return Nt.useMemo(()=>Jo(e,JSON.parse(i),n,"path"===s),[e,i,n,s])}function xl(e,t){return function(e,t,s,r){ul()||So(!1);let{navigator:a}=Nt.useContext(ol),{matches:n}=Nt.useContext(cl),i=n[n.length-1],o=i?i.params:{};!i||i.pathname;let l=i?i.pathnameBase:"/";i&&i.route;let c,d=hl();if(t){var u;let e="string"==typeof t?Ao(t):t;"/"===l||(null==(u=e.pathname)?void 0:u.startsWith(l))||So(!1),c=e}else c=d;let h=c.pathname||"/",m=h;if("/"!==l){let e=l.replace(/^\//,"").split("/");m="/"+h.replace(/^\//,"").split("/").slice(e.length).join("/")}let p=Ro(e,{pathname:m}),f=function(e,t,s,r){var a;void 0===t&&(t=[]);void 0===s&&(s=null);void 0===r&&(r=null);if(null==e){var n;if(!s)return null;if(s.errors)e=s.matches;else{if(!(null!=(n=r)&&n.v7_partialHydration&&0===t.length&&!s.initialized&&s.matches.length>0))return null;e=s.matches}}let i=e,o=null==(a=s)?void 0:a.errors;if(null!=o){let e=i.findIndex(e=>e.route.id&&void 0!==(null==o?void 0:o[e.route.id]));e>=0||So(!1),i=i.slice(0,Math.min(i.length,e+1))}let l=!1,c=-1;if(s&&r&&r.v7_partialHydration)for(let d=0;d<i.length;d++){let e=i[d];if((e.route.HydrateFallback||e.route.hydrateFallbackElement)&&(c=d),e.route.id){let{loaderData:t,errors:r}=s,a=e.route.loader&&void 0===t[e.route.id]&&(!r||void 0===r[e.route.id]);if(e.route.lazy||a){l=!0,i=c>=0?i.slice(0,c+1):[i[0]];break}}}return i.reduceRight((e,r,a)=>{let n,d=!1,u=null,h=null;var m;s&&(n=o&&r.route.id?o[r.route.id]:void 0,u=r.route.errorElement||vl,l&&(c<0&&0===a?(_l[m="route-fallback"]||(_l[m]=!0),d=!0,h=null):c===a&&(d=!0,h=r.route.hydrateFallbackElement||null)));let p=t.concat(i.slice(0,a+1)),f=()=>{let t;return t=n?u:d?h:r.route.Component?Nt.createElement(r.route.Component,null):r.route.element?r.route.element:e,Nt.createElement(yl,{match:r,routeContext:{outlet:e,matches:p,isDataRoute:null!=s},children:t})};return s&&(r.route.ErrorBoundary||r.route.errorElement||0===a)?Nt.createElement(jl,{location:s.location,revalidation:s.revalidation,component:u,error:n,children:f(),routeContext:{outlet:null,matches:p,isDataRoute:!0}}):f()},null)}(p&&p.map(e=>Object.assign({},e,{params:Object.assign({},o,e.params),pathname:Xo([l,a.encodeLocation?a.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?l:Xo([l,a.encodeLocation?a.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])})),n,s,r);if(t&&f)return Nt.createElement(ll.Provider,{value:{location:al({pathname:"/",search:"",hash:"",state:null,key:"default"},c),navigationType:go.Pop}},f);return f}(e,t)}function gl(){let e=function(){var e;let t=Nt.useContext(dl),s=function(){let e=Nt.useContext(il);return e||So(!1),e}(),r=Nl();if(void 0!==t)return t;return null==(e=s.errors)?void 0:e[r]}(),t=function(e){return null!=e&&"number"==typeof e.status&&"string"==typeof e.statusText&&"boolean"==typeof e.internal&&"data"in e}(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),s=e instanceof Error?e.stack:null,r={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return Nt.createElement(Nt.Fragment,null,Nt.createElement("h2",null,"Unexpected Application Error!"),Nt.createElement("h3",{style:{fontStyle:"italic"}},t),s?Nt.createElement("pre",{style:r},s):null,null)}const vl=Nt.createElement(gl,null);class jl extends Nt.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){}render(){return void 0!==this.state.error?Nt.createElement(cl.Provider,{value:this.props.routeContext},Nt.createElement(dl.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function yl(e){let{routeContext:t,match:s,children:r}=e,a=Nt.useContext(nl);return a&&a.static&&a.staticContext&&(s.route.errorElement||s.route.ErrorBoundary)&&(a.staticContext._deepestRenderedBoundaryId=s.route.id),Nt.createElement(cl.Provider,{value:t},r)}var bl=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(bl||{}),wl=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(wl||{});function Nl(e){let t=function(){let e=Nt.useContext(cl);return e||So(!1),e}(),s=t.matches[t.matches.length-1];return s.route.id||So(!1),s.route.id}const _l={};function kl(e){So(!1)}function Sl(e){let{basename:t="/",children:s=null,location:r,navigationType:a=go.Pop,navigator:n,static:i=!1,future:o}=e;ul()&&So(!1);let l=t.replace(/^\/*/,"/"),c=Nt.useMemo(()=>({basename:l,navigator:n,static:i,future:al({v7_relativeSplatPath:!1},o)}),[l,o,n,i]);"string"==typeof r&&(r=Ao(r));let{pathname:d="/",search:u="",hash:h="",state:m=null,key:p="default"}=r,f=Nt.useMemo(()=>{let e=Yo(d,l);return null==e?null:{location:{pathname:e,search:u,hash:h,state:m,key:p},navigationType:a}},[l,d,u,h,m,p,a]);return null==f?null:Nt.createElement(ol.Provider,{value:c},Nt.createElement(ll.Provider,{children:s,value:f}))}function Cl(e){let{children:t,location:s}=e;return xl(El(t),s)}function El(e,t){void 0===t&&(t=[]);let s=[];return Nt.Children.forEach(e,(e,r)=>{if(!Nt.isValidElement(e))return;let a=[...t,r];if(e.type===Nt.Fragment)return void s.push.apply(s,El(e.props.children,a));e.type!==kl&&So(!1),e.props.index&&e.props.children&&So(!1);let n={id:e.props.id||a.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(n.children=El(e.props.children,a)),s.push(n)}),s}
/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Ml(){return Ml=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r])}return e},Ml.apply(this,arguments)}function Tl(e,t){if(null==e)return{};var s,r,a={},n=Object.keys(e);for(r=0;r<n.length;r++)s=n[r],t.indexOf(s)>=0||(a[s]=e[s]);return a}new Promise(()=>{});const Al=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],Pl=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"];try{window.__reactRouterVersion="6"}catch(zw){}const Dl=Nt.createContext({isTransitioning:!1}),Rl=St.startTransition;function Ol(e){let{basename:t,children:s,future:r,window:a}=e,n=Nt.useRef();null==n.current&&(n.current=ko({window:a,v5Compat:!0}));let i=n.current,[o,l]=Nt.useState({action:i.action,location:i.location}),{v7_startTransition:c}=r||{},d=Nt.useCallback(e=>{c&&Rl?Rl(()=>l(e)):l(e)},[l,c]);return Nt.useLayoutEffect(()=>i.listen(d),[i,d]),Nt.useEffect(()=>{return null==(e=r)||e.v7_startTransition,void(null==e||e.v7_relativeSplatPath);var e},[r]),Nt.createElement(Sl,{basename:t,children:s,location:o.location,navigationType:o.action,navigator:i,future:r})}const ql="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement,Il=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Fl=Nt.forwardRef(function(e,t){let s,{onClick:r,relative:a,reloadDocument:n,replace:i,state:o,target:l,to:c,preventScrollReset:d,viewTransition:u}=e,h=Tl(e,Al),{basename:m}=Nt.useContext(ol),p=!1;if("string"==typeof c&&Il.test(c)&&(s=c,ql))try{let e=new URL(window.location.href),t=c.startsWith("//")?new URL(e.protocol+c):new URL(c),s=Yo(t.pathname,m);t.origin===e.origin&&null!=s?c=s+t.search+t.hash:p=!0}catch(zw){}let f=function(e,t){let{relative:s}=void 0===t?{}:t;ul()||So(!1);let{basename:r,navigator:a}=Nt.useContext(ol),{hash:n,pathname:i,search:o}=fl(e,{relative:s}),l=i;return"/"!==r&&(l="/"===i?r:Xo([r,i])),a.createHref({pathname:l,search:o,hash:n})}(c,{relative:a}),x=function(e,t){let{target:s,replace:r,state:a,preventScrollReset:n,relative:i,viewTransition:o}=void 0===t?{}:t,l=pl(),c=hl(),d=fl(e,{relative:i});return Nt.useCallback(t=>{if(function(e,t){return!(0!==e.button||t&&"_self"!==t||function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e))}(t,s)){t.preventDefault();let s=void 0!==r?r:To(c)===To(d);l(e,{replace:s,state:a,preventScrollReset:n,relative:i,viewTransition:o})}},[c,l,d,r,a,s,e,n,i,o])}(c,{replace:i,state:o,target:l,preventScrollReset:d,relative:a,viewTransition:u});return Nt.createElement("a",Ml({},h,{href:s||f,onClick:p||n?r:function(e){r&&r(e),e.defaultPrevented||x(e)},ref:t,target:l}))}),Ll=Nt.forwardRef(function(e,t){let{"aria-current":s="page",caseSensitive:r=!1,className:a="",end:n=!1,style:i,to:o,viewTransition:l,children:c}=e,d=Tl(e,Pl),u=fl(o,{relative:d.relative}),h=hl(),m=Nt.useContext(il),{navigator:p,basename:f}=Nt.useContext(ol),x=null!=m&&function(e,t){void 0===t&&(t={});let s=Nt.useContext(Dl);null==s&&So(!1);let{basename:r}=function(){let e=Nt.useContext(nl);return e||So(!1),e}($l.useViewTransitionState),a=fl(e,{relative:t.relative});if(!s.isTransitioning)return!1;let n=Yo(s.currentLocation.pathname,r)||s.currentLocation.pathname,i=Yo(s.nextLocation.pathname,r)||s.nextLocation.pathname;return null!=Ho(a.pathname,i)||null!=Ho(a.pathname,n)}(u)&&!0===l,g=p.encodeLocation?p.encodeLocation(u).pathname:u.pathname,v=h.pathname,j=m&&m.navigation&&m.navigation.location?m.navigation.location.pathname:null;r||(v=v.toLowerCase(),j=j?j.toLowerCase():null,g=g.toLowerCase()),j&&f&&(j=Yo(j,f)||j);const y="/"!==g&&g.endsWith("/")?g.length-1:g.length;let b,w=v===g||!n&&v.startsWith(g)&&"/"===v.charAt(y),N=null!=j&&(j===g||!n&&j.startsWith(g)&&"/"===j.charAt(g.length)),_={isActive:w,isPending:N,isTransitioning:x},k=w?s:void 0;b="function"==typeof a?a(_):[a,w?"active":null,N?"pending":null,x?"transitioning":null].filter(Boolean).join(" ");let S="function"==typeof i?i(_):i;return Nt.createElement(Fl,Ml({},d,{"aria-current":k,className:b,ref:t,style:S,to:o,viewTransition:l}),"function"==typeof c?c(_):c)});var $l,zl,Ul,Wl;(zl=$l||($l={})).UseScrollRestoration="useScrollRestoration",zl.UseSubmit="useSubmit",zl.UseSubmitFetcher="useSubmitFetcher",zl.UseFetcher="useFetcher",zl.useViewTransitionState="useViewTransitionState",(Wl=Ul||(Ul={})).UseFetcher="useFetcher",Wl.UseFetchers="useFetchers",Wl.UseScrollRestoration="useScrollRestoration";const Vl={},Bl=function(e,t,s){let r=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),s=(null==e?void 0:e.nonce)||(null==e?void 0:e.getAttribute("nonce"));r=Promise.allSettled(t.map(e=>{if((e=function(e){return"/"+e}(e))in Vl)return;Vl[e]=!0;const t=e.endsWith(".css"),r=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${r}`))return;const a=document.createElement("link");return a.rel=t?"stylesheet":"modulepreload",t||(a.as="script"),a.crossOrigin="",a.href=e,s&&a.setAttribute("nonce",s),document.head.appendChild(a),t?new Promise((t,s)=>{a.addEventListener("load",t),a.addEventListener("error",()=>s(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function a(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return r.then(t=>{for(const e of t||[])"rejected"===e.status&&a(e.reason);return e().catch(a)})};class Hl extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class Kl extends Hl{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Yl extends Hl{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Gl extends Hl{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Ql,Jl;(Jl=Ql||(Ql={})).Any="any",Jl.ApNortheast1="ap-northeast-1",Jl.ApNortheast2="ap-northeast-2",Jl.ApSouth1="ap-south-1",Jl.ApSoutheast1="ap-southeast-1",Jl.ApSoutheast2="ap-southeast-2",Jl.CaCentral1="ca-central-1",Jl.EuCentral1="eu-central-1",Jl.EuWest1="eu-west-1",Jl.EuWest2="eu-west-2",Jl.EuWest3="eu-west-3",Jl.SaEast1="sa-east-1",Jl.UsEast1="us-east-1",Jl.UsWest1="us-west-1",Jl.UsWest2="us-west-2";var Xl=function(e,t,s,r){return new(s||(s=Promise))(function(a,n){function i(e){try{l(r.next(e))}catch(zw){n(zw)}}function o(e){try{l(r.throw(e))}catch(zw){n(zw)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(i,o)}l((r=r.apply(e,t||[])).next())})};class Zl{constructor(e,{headers:t={},customFetch:s,region:r=Ql.Any}={}){this.url=e,this.headers=t,this.region=r,this.fetch=(e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>Bl(async()=>{const{default:e}=await Promise.resolve().then(()=>hc);return{default:e}},void 0).then(({default:t})=>t(...e)):fetch),(...e)=>t(...e)})(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var s;return Xl(this,void 0,void 0,function*(){try{const{headers:r,method:a,body:n}=t;let i={},{region:o}=t;o||(o=this.region);const l=new URL(`${this.url}/${e}`);let c;o&&"any"!==o&&(i["x-region"]=o,l.searchParams.set("forceFunctionRegion",o)),n&&(r&&!Object.prototype.hasOwnProperty.call(r,"Content-Type")||!r)&&("undefined"!=typeof Blob&&n instanceof Blob||n instanceof ArrayBuffer?(i["Content-Type"]="application/octet-stream",c=n):"string"==typeof n?(i["Content-Type"]="text/plain",c=n):"undefined"!=typeof FormData&&n instanceof FormData?c=n:(i["Content-Type"]="application/json",c=JSON.stringify(n)));const d=yield this.fetch(l.toString(),{method:a||"POST",headers:Object.assign(Object.assign(Object.assign({},i),this.headers),r),body:c}).catch(e=>{throw new Kl(e)}),u=d.headers.get("x-relay-error");if(u&&"true"===u)throw new Yl(d);if(!d.ok)throw new Gl(d);let h,m=(null!==(s=d.headers.get("Content-Type"))&&void 0!==s?s:"text/plain").split(";")[0].trim();return h="application/json"===m?yield d.json():"application/octet-stream"===m?yield d.blob():"text/event-stream"===m?d:"multipart/form-data"===m?yield d.formData():yield d.text(),{data:h,error:null,response:d}}catch(r){return{data:null,error:r,response:r instanceof Gl||r instanceof Yl?r.context:void 0}}})}}var ec={},tc={},sc={},rc={},ac={},nc={},ic=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")}();const oc=ic.fetch,lc=ic.fetch.bind(ic),cc=ic.Headers,dc=ic.Request,uc=ic.Response,hc=Object.freeze(Object.defineProperty({__proto__:null,Headers:cc,Request:dc,Response:uc,default:lc,fetch:oc},Symbol.toStringTag,{value:"Module"})),mc=Ct(hc);var pc={};Object.defineProperty(pc,"__esModule",{value:!0});let fc=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};pc.default=fc;var xc=Et&&Et.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(nc,"__esModule",{value:!0});const gc=xc(mc),vc=xc(pc);nc.default=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:"undefined"==typeof fetch?this.fetch=gc.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=Object.assign({},this.headers),this.headers[e]=t,this}then(e,t){void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),"GET"!==this.method&&"HEAD"!==this.method&&(this.headers["Content-Type"]="application/json");let s=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async e=>{var t,s,r;let a=null,n=null,i=null,o=e.status,l=e.statusText;if(e.ok){if("HEAD"!==this.method){const t=await e.text();""===t||(n="text/csv"===this.headers.Accept||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?t:JSON.parse(t))}const r=null===(t=this.headers.Prefer)||void 0===t?void 0:t.match(/count=(exact|planned|estimated)/),c=null===(s=e.headers.get("content-range"))||void 0===s?void 0:s.split("/");r&&c&&c.length>1&&(i=parseInt(c[1])),this.isMaybeSingle&&"GET"===this.method&&Array.isArray(n)&&(n.length>1?(a={code:"PGRST116",details:`Results contain ${n.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},n=null,i=null,o=406,l="Not Acceptable"):n=1===n.length?n[0]:null)}else{const t=await e.text();try{a=JSON.parse(t),Array.isArray(a)&&404===e.status&&(n=[],a=null,o=200,l="OK")}catch(c){404===e.status&&""===t?(o=204,l="No Content"):a={message:t}}if(a&&this.isMaybeSingle&&(null===(r=null==a?void 0:a.details)||void 0===r?void 0:r.includes("0 rows"))&&(a=null,o=200,l="OK"),a&&this.shouldThrowOnError)throw new vc.default(a)}return{error:a,data:n,count:i,status:o,statusText:l}});return this.shouldThrowOnError||(s=s.catch(e=>{var t,s,r;return{error:{message:`${null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"FetchError"}: ${null==e?void 0:e.message}`,details:`${null!==(s=null==e?void 0:e.stack)&&void 0!==s?s:""}`,hint:"",code:`${null!==(r=null==e?void 0:e.code)&&void 0!==r?r:""}`},data:null,count:null,status:0,statusText:""}})),s.then(e,t)}returns(){return this}overrideTypes(){return this}};var jc=Et&&Et.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ac,"__esModule",{value:!0});const yc=jc(nc);let bc=class extends yc.default{select(e){let t=!1;const s=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!t?"":('"'===e&&(t=!t),e)).join("");return this.url.searchParams.set("select",s),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:s,foreignTable:r,referencedTable:a=r}={}){const n=a?`${a}.order`:"order",i=this.url.searchParams.get(n);return this.url.searchParams.set(n,`${i?`${i},`:""}${e}.${t?"asc":"desc"}${void 0===s?"":s?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:s=t}={}){const r=void 0===s?"limit":`${s}.limit`;return this.url.searchParams.set(r,`${e}`),this}range(e,t,{foreignTable:s,referencedTable:r=s}={}){const a=void 0===r?"offset":`${r}.offset`,n=void 0===r?"limit":`${r}.limit`;return this.url.searchParams.set(a,`${e}`),this.url.searchParams.set(n,""+(t-e+1)),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return"GET"===this.method?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:s=!1,buffers:r=!1,wal:a=!1,format:n="text"}={}){var i;const o=[e?"analyze":null,t?"verbose":null,s?"settings":null,r?"buffers":null,a?"wal":null].filter(Boolean).join("|"),l=null!==(i=this.headers.Accept)&&void 0!==i?i:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${n}; for="${l}"; options=${o};`,this}rollback(){var e;return(null!==(e=this.headers.Prefer)&&void 0!==e?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};ac.default=bc;var wc=Et&&Et.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(rc,"__esModule",{value:!0});const Nc=wc(ac);let _c=class extends Nc.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const s=Array.from(new Set(t)).map(e=>"string"==typeof e&&new RegExp("[,()]").test(e)?`"${e}"`:`${e}`).join(",");return this.url.searchParams.append(e,`in.(${s})`),this}contains(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return"string"==typeof t?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:s,type:r}={}){let a="";"plain"===r?a="pl":"phrase"===r?a="ph":"websearch"===r&&(a="w");const n=void 0===s?"":`(${s})`;return this.url.searchParams.append(e,`${a}fts${n}.${t}`),this}match(e){return Object.entries(e).forEach(([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)}),this}not(e,t,s){return this.url.searchParams.append(e,`not.${t}.${s}`),this}or(e,{foreignTable:t,referencedTable:s=t}={}){const r=s?`${s}.or`:"or";return this.url.searchParams.append(r,`(${e})`),this}filter(e,t,s){return this.url.searchParams.append(e,`${t}.${s}`),this}};rc.default=_c;var kc=Et&&Et.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(sc,"__esModule",{value:!0});const Sc=kc(rc);sc.default=class{constructor(e,{headers:t={},schema:s,fetch:r}){this.url=e,this.headers=t,this.schema=s,this.fetch=r}select(e,{head:t=!1,count:s}={}){const r=t?"HEAD":"GET";let a=!1;const n=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!a?"":('"'===e&&(a=!a),e)).join("");return this.url.searchParams.set("select",n),s&&(this.headers.Prefer=`count=${s}`),new Sc.default({method:r,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:s=!0}={}){const r=[];if(this.headers.Prefer&&r.push(this.headers.Prefer),t&&r.push(`count=${t}`),s||r.push("missing=default"),this.headers.Prefer=r.join(","),Array.isArray(e)){const t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){const e=[...new Set(t)].map(e=>`"${e}"`);this.url.searchParams.set("columns",e.join(","))}}return new Sc.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:s=!1,count:r,defaultToNull:a=!0}={}){const n=[`resolution=${s?"ignore":"merge"}-duplicates`];if(void 0!==t&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&n.push(this.headers.Prefer),r&&n.push(`count=${r}`),a||n.push("missing=default"),this.headers.Prefer=n.join(","),Array.isArray(e)){const t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){const e=[...new Set(t)].map(e=>`"${e}"`);this.url.searchParams.set("columns",e.join(","))}}return new Sc.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const s=[];return this.headers.Prefer&&s.push(this.headers.Prefer),t&&s.push(`count=${t}`),this.headers.Prefer=s.join(","),new Sc.default({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t=[];return e&&t.push(`count=${e}`),this.headers.Prefer&&t.unshift(this.headers.Prefer),this.headers.Prefer=t.join(","),new Sc.default({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};var Cc={},Ec={};Object.defineProperty(Ec,"__esModule",{value:!0}),Ec.version=void 0,Ec.version="0.0.0-automated",Object.defineProperty(Cc,"__esModule",{value:!0}),Cc.DEFAULT_HEADERS=void 0;const Mc=Ec;Cc.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${Mc.version}`};var Tc=Et&&Et.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(tc,"__esModule",{value:!0});const Ac=Tc(sc),Pc=Tc(rc),Dc=Cc;tc.default=class e{constructor(e,{headers:t={},schema:s,fetch:r}={}){this.url=e,this.headers=Object.assign(Object.assign({},Dc.DEFAULT_HEADERS),t),this.schemaName=s,this.fetch=r}from(e){const t=new URL(`${this.url}/${e}`);return new Ac.default(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new e(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(e,t={},{head:s=!1,get:r=!1,count:a}={}){let n;const i=new URL(`${this.url}/rpc/${e}`);let o;s||r?(n=s?"HEAD":"GET",Object.entries(t).filter(([e,t])=>void 0!==t).map(([e,t])=>[e,Array.isArray(t)?`{${t.join(",")}}`:`${t}`]).forEach(([e,t])=>{i.searchParams.append(e,t)})):(n="POST",o=t);const l=Object.assign({},this.headers);return a&&(l.Prefer=`count=${a}`),new Pc.default({method:n,url:i,headers:l,schema:this.schemaName,body:o,fetch:this.fetch,allowEmpty:!1})}};var Rc=Et&&Et.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ec,"__esModule",{value:!0}),ec.PostgrestError=ec.PostgrestBuilder=ec.PostgrestTransformBuilder=ec.PostgrestFilterBuilder=ec.PostgrestQueryBuilder=ec.PostgrestClient=void 0;const Oc=Rc(tc);ec.PostgrestClient=Oc.default;const qc=Rc(sc);ec.PostgrestQueryBuilder=qc.default;const Ic=Rc(rc);ec.PostgrestFilterBuilder=Ic.default;const Fc=Rc(ac);ec.PostgrestTransformBuilder=Fc.default;const Lc=Rc(nc);ec.PostgrestBuilder=Lc.default;const $c=Rc(pc);ec.PostgrestError=$c.default;var zc=ec.default={PostgrestClient:Oc.default,PostgrestQueryBuilder:qc.default,PostgrestFilterBuilder:Ic.default,PostgrestTransformBuilder:Fc.default,PostgrestBuilder:Lc.default,PostgrestError:$c.default};const{PostgrestClient:Uc,PostgrestQueryBuilder:Wc,PostgrestFilterBuilder:Vc,PostgrestTransformBuilder:Bc,PostgrestBuilder:Hc,PostgrestError:Kc}=zc;class Yc{static detectEnvironment(){var e;if("undefined"!=typeof WebSocket)return{type:"native",constructor:WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocket)return{type:"native",constructor:globalThis.WebSocket};if("undefined"!=typeof global&&void 0!==global.WebSocket)return{type:"native",constructor:global.WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocketPair&&void 0===globalThis.WebSocket)return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if("undefined"!=typeof globalThis&&globalThis.EdgeRuntime||"undefined"!=typeof navigator&&(null===(e=navigator.userAgent)||void 0===e?void 0:e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if("undefined"!=typeof process&&process.versions&&process.versions.node){const e=parseInt(process.versions.node.split(".")[0]);return e>=22?void 0!==globalThis.WebSocket?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${e} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${e} detected without native WebSocket support.`,workaround:'For Node.js < 22, install "ws" package and provide it via the transport option:\nimport ws from "ws"\nnew RealtimeClient(url, { transport: ws })'}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`\n\nSuggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){return new(this.getWebSocketConstructor())(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return"native"===e.type||"ws"===e.type}catch(e){return!1}}}const Gc=1e4;var Qc,Jc,Xc,Zc,ed,td,sd,rd,ad,nd,id;(Jc=Qc||(Qc={}))[Jc.connecting=0]="connecting",Jc[Jc.open=1]="open",Jc[Jc.closing=2]="closing",Jc[Jc.closed=3]="closed",(Zc=Xc||(Xc={})).closed="closed",Zc.errored="errored",Zc.joined="joined",Zc.joining="joining",Zc.leaving="leaving",(td=ed||(ed={})).close="phx_close",td.error="phx_error",td.join="phx_join",td.reply="phx_reply",td.leave="phx_leave",td.access_token="access_token",(sd||(sd={})).websocket="websocket",(ad=rd||(rd={})).Connecting="connecting",ad.Open="open",ad.Closing="closing",ad.Closed="closed";class od{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t("string"==typeof e?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),s=new TextDecoder;return this._decodeBroadcast(e,t,s)}_decodeBroadcast(e,t,s){const r=t.getUint8(1),a=t.getUint8(2);let n=this.HEADER_LENGTH+2;const i=s.decode(e.slice(n,n+r));n+=r;const o=s.decode(e.slice(n,n+a));n+=a;return{ref:null,topic:i,event:o,payload:JSON.parse(s.decode(e.slice(n,e.byteLength)))}}}class ld{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}(id=nd||(nd={})).abstime="abstime",id.bool="bool",id.date="date",id.daterange="daterange",id.float4="float4",id.float8="float8",id.int2="int2",id.int4="int4",id.int4range="int4range",id.int8="int8",id.int8range="int8range",id.json="json",id.jsonb="jsonb",id.money="money",id.numeric="numeric",id.oid="oid",id.reltime="reltime",id.text="text",id.time="time",id.timestamp="timestamp",id.timestamptz="timestamptz",id.timetz="timetz",id.tsrange="tsrange",id.tstzrange="tstzrange";const cd=(e,t,s={})=>{var r;const a=null!==(r=s.skipTypes)&&void 0!==r?r:[];return Object.keys(t).reduce((s,r)=>(s[r]=dd(r,e,t,a),s),{})},dd=(e,t,s,r)=>{const a=t.find(t=>t.name===e),n=null==a?void 0:a.type,i=s[e];return n&&!r.includes(n)?ud(n,i):hd(i)},ud=(e,t)=>{if("_"===e.charAt(0)){const s=e.slice(1,e.length);return xd(t,s)}switch(e){case nd.bool:return md(t);case nd.float4:case nd.float8:case nd.int2:case nd.int4:case nd.int8:case nd.numeric:case nd.oid:return pd(t);case nd.json:case nd.jsonb:return fd(t);case nd.timestamp:return gd(t);case nd.abstime:case nd.date:case nd.daterange:case nd.int4range:case nd.int8range:case nd.money:case nd.reltime:case nd.text:case nd.time:case nd.timestamptz:case nd.timetz:case nd.tsrange:case nd.tstzrange:default:return hd(t)}},hd=e=>e,md=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},pd=e=>{if("string"==typeof e){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},fd=e=>{if("string"==typeof e)try{return JSON.parse(e)}catch(t){return e}return e},xd=(e,t)=>{if("string"!=typeof e)return e;const s=e.length-1,r=e[s];if("{"===e[0]&&"}"===r){let r;const n=e.slice(1,s);try{r=JSON.parse("["+n+"]")}catch(a){r=n?n.split(","):[]}return r.map(e=>ud(t,e))}return e},gd=e=>"string"==typeof e?e.replace(" ","T"):e,vd=e=>{let t=e;return t=t.replace(/^ws/i,"http"),t=t.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),t.replace(/\/+$/,"")+"/api/broadcast"};class jd{constructor(e,t,s={},r=1e4){this.channel=e,this.event=t,this.payload=s,this.timeout=r,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t(null===(s=this.receivedResp)||void 0===s?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);this.channel._on(this.refEvent,{},e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)}),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(t=>t.status===e).forEach(e=>e.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var yd,bd,wd,Nd,_d,kd,Sd,Cd;(bd=yd||(yd={})).SYNC="sync",bd.JOIN="join",bd.LEAVE="leave";class Ed{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(null==t?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},e=>{const{onJoin:t,onLeave:s,onSync:r}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Ed.syncState(this.state,e,t,s),this.pendingDiffs.forEach(e=>{this.state=Ed.syncDiff(this.state,e,t,s)}),this.pendingDiffs=[],r()}),this.channel._on(s.diff,{},e=>{const{onJoin:t,onLeave:s,onSync:r}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(e):(this.state=Ed.syncDiff(this.state,e,t,s),r())}),this.onJoin((e,t,s)=>{this.channel._trigger("presence",{event:"join",key:e,currentPresences:t,newPresences:s})}),this.onLeave((e,t,s)=>{this.channel._trigger("presence",{event:"leave",key:e,currentPresences:t,leftPresences:s})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,s,r){const a=this.cloneDeep(e),n=this.transformState(t),i={},o={};return this.map(a,(e,t)=>{n[e]||(o[e]=t)}),this.map(n,(e,t)=>{const s=a[e];if(s){const r=t.map(e=>e.presence_ref),a=s.map(e=>e.presence_ref),n=t.filter(e=>a.indexOf(e.presence_ref)<0),l=s.filter(e=>r.indexOf(e.presence_ref)<0);n.length>0&&(i[e]=n),l.length>0&&(o[e]=l)}else i[e]=t}),this.syncDiff(a,{joins:i,leaves:o},s,r)}static syncDiff(e,t,s,r){const{joins:a,leaves:n}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),r||(r=()=>{}),this.map(a,(t,r)=>{var a;const n=null!==(a=e[t])&&void 0!==a?a:[];if(e[t]=this.cloneDeep(r),n.length>0){const s=e[t].map(e=>e.presence_ref),r=n.filter(e=>s.indexOf(e.presence_ref)<0);e[t].unshift(...r)}s(t,n,r)}),this.map(n,(t,s)=>{let a=e[t];if(!a)return;const n=s.map(e=>e.presence_ref);a=a.filter(e=>n.indexOf(e.presence_ref)<0),e[t]=a,r(t,a,s),0===a.length&&delete e[t]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(s=>t(s,e[s]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,s)=>{const r=e[s];return t[s]="metas"in r?r.metas.map(e=>(e.presence_ref=e.phx_ref,delete e.phx_ref,delete e.phx_ref_prev,e)):r,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}(Nd=wd||(wd={})).ALL="*",Nd.INSERT="INSERT",Nd.UPDATE="UPDATE",Nd.DELETE="DELETE",(kd=_d||(_d={})).BROADCAST="broadcast",kd.PRESENCE="presence",kd.POSTGRES_CHANGES="postgres_changes",kd.SYSTEM="system",(Cd=Sd||(Sd={})).SUBSCRIBED="SUBSCRIBED",Cd.TIMED_OUT="TIMED_OUT",Cd.CLOSED="CLOSED",Cd.CHANNEL_ERROR="CHANNEL_ERROR";class Md{constructor(e,t={config:{}},s){this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=Xc.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new jd(this,ed.join,this.params,this.timeout),this.rejoinTimer=new ld(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Xc.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(e=>e.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Xc.closed,this.socket._remove(this)}),this._onError(e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=Xc.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Xc.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=Xc.errored,this.rejoinTimer.scheduleTimeout())}),this._on(ed.reply,{},(e,t)=>{this._trigger(this._replyEventName(t),e)}),this.presence=new Ed(this),this.broadcastEndpointURL=vd(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var s,r;if(this.socket.isConnected()||this.socket.connect(),this.state==Xc.closed){const{config:{broadcast:a,presence:n,private:i}}=this.params,o=null!==(r=null===(s=this.bindings.postgres_changes)||void 0===s?void 0:s.map(e=>e.filter))&&void 0!==r?r:[],l=!!this.bindings[_d.PRESENCE]&&this.bindings[_d.PRESENCE].length>0,c={},d={broadcast:a,presence:Object.assign(Object.assign({},n),{enabled:l}),postgres_changes:o,private:i};this.socket.accessTokenValue&&(c.access_token=this.socket.accessTokenValue),this._onError(t=>null==e?void 0:e(Sd.CHANNEL_ERROR,t)),this._onClose(()=>null==e?void 0:e(Sd.CLOSED)),this.updateJoinPayload(Object.assign({config:d},c)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:t})=>{var s;if(this.socket.setAuth(),void 0!==t){const r=this.bindings.postgres_changes,a=null!==(s=null==r?void 0:r.length)&&void 0!==s?s:0,n=[];for(let s=0;s<a;s++){const a=r[s],{filter:{event:i,schema:o,table:l,filter:c}}=a,d=t&&t[s];if(!d||d.event!==i||d.schema!==o||d.table!==l||d.filter!==c)return this.unsubscribe(),this.state=Xc.errored,void(null==e||e(Sd.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes")));n.push(Object.assign(Object.assign({},a),{id:d.id}))}return this.bindings.postgres_changes=n,void(e&&e(Sd.SUBSCRIBED))}null==e||e(Sd.SUBSCRIBED)}).receive("error",t=>{this.state=Xc.errored,null==e||e(Sd.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(t).join(", ")||"error")))}).receive("timeout",()=>{null==e||e(Sd.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,s){return this.state===Xc.joined&&e===_d.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,s)}async send(e,t={}){var s,r;if(this._canPush()||"broadcast"!==e.type)return new Promise(s=>{var r,a,n;const i=this._push(e.type,e,t.timeout||this.timeout);"broadcast"!==e.type||(null===(n=null===(a=null===(r=this.params)||void 0===r?void 0:r.config)||void 0===a?void 0:a.broadcast)||void 0===n?void 0:n.ack)||s("ok"),i.receive("ok",()=>s("ok")),i.receive("error",()=>s("error")),i.receive("timeout",()=>s("timed out"))});{const{event:n,payload:i}=e,o={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:n,payload:i,private:this.private}]})};try{const e=await this._fetchWithTimeout(this.broadcastEndpointURL,o,null!==(s=t.timeout)&&void 0!==s?s:this.timeout);return await(null===(r=e.body)||void 0===r?void 0:r.cancel()),e.ok?"ok":"error"}catch(a){return"AbortError"===a.name?"timed out":"error"}}}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Xc.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(ed.close,"leave",this._joinRef())};this.joinPush.destroy();let s=null;return new Promise(r=>{s=new jd(this,ed.leave,{},e),s.receive("ok",()=>{t(),r("ok")}).receive("timeout",()=>{t(),r("timed out")}).receive("error",()=>{r("error")}),s.send(),this._canPush()||s.trigger("ok",{})}).finally(()=>{null==s||s.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Xc.closed,this.bindings={}}async _fetchWithTimeout(e,t,s){const r=new AbortController,a=setTimeout(()=>r.abort(),s),n=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:r.signal}));return clearTimeout(a),n}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let r=new jd(this,e,t,s);return this._canPush()?r.send():this._addToPushBuffer(r),r}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>100){const e=this.pushBuffer.shift();e&&(e.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${e.event}`,e.payload))}}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var r,a;const n=e.toLocaleLowerCase(),{close:i,error:o,leave:l,join:c}=ed;if(s&&[i,o,l,c].indexOf(n)>=0&&s!==this._joinRef())return;let d=this._onMessage(n,t,s);if(t&&!d)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(n)?null===(r=this.bindings.postgres_changes)||void 0===r||r.filter(e=>{var t,s,r;return"*"===(null===(t=e.filter)||void 0===t?void 0:t.event)||(null===(r=null===(s=e.filter)||void 0===s?void 0:s.event)||void 0===r?void 0:r.toLocaleLowerCase())===n}).map(e=>e.callback(d,s)):null===(a=this.bindings[n])||void 0===a||a.filter(e=>{var s,r,a,i,o,l;if(["broadcast","presence","postgres_changes"].includes(n)){if("id"in e){const n=e.id,i=null===(s=e.filter)||void 0===s?void 0:s.event;return n&&(null===(r=t.ids)||void 0===r?void 0:r.includes(n))&&("*"===i||(null==i?void 0:i.toLocaleLowerCase())===(null===(a=t.data)||void 0===a?void 0:a.type.toLocaleLowerCase()))}{const s=null===(o=null===(i=null==e?void 0:e.filter)||void 0===i?void 0:i.event)||void 0===o?void 0:o.toLocaleLowerCase();return"*"===s||s===(null===(l=null==t?void 0:t.event)||void 0===l?void 0:l.toLocaleLowerCase())}}return e.type.toLocaleLowerCase()===n}).map(e=>{if("object"==typeof d&&"ids"in d){const e=d.data,{schema:t,table:s,commit_timestamp:r,type:a,errors:n}=e,i={schema:t,table:s,commit_timestamp:r,eventType:a,new:{},old:{},errors:n};d=Object.assign(Object.assign({},i),this._getPayloadRecords(e))}e.callback(d,s)})}_isClosed(){return this.state===Xc.closed}_isJoined(){return this.state===Xc.joined}_isJoining(){return this.state===Xc.joining}_isLeaving(){return this.state===Xc.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){const r=e.toLocaleLowerCase(),a={type:r,filter:t,callback:s};return this.bindings[r]?this.bindings[r].push(a):this.bindings[r]=[a],this}_off(e,t){const s=e.toLocaleLowerCase();return this.bindings[s]&&(this.bindings[s]=this.bindings[s].filter(e=>{var r;return!((null===(r=e.type)||void 0===r?void 0:r.toLocaleLowerCase())===s&&Md.isEqual(e.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(ed.close,{},e)}_onError(e){this._on(ed.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Xc.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return"INSERT"!==e.type&&"UPDATE"!==e.type||(t.new=cd(e.columns,e.record)),"UPDATE"!==e.type&&"DELETE"!==e.type||(t.old=cd(e.columns,e.old_record)),t}}const Td=()=>{},Ad=25e3,Pd=10,Dd=100,Rd=[1e3,2e3,5e3,1e4];class Od{constructor(e,t){var s;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Gc,this.transport=null,this.heartbeatIntervalMs=Ad,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Td,this.ref=0,this.reconnectTimer=null,this.logger=Td,this.conn=null,this.sendBuffer=[],this.serializer=new od,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>Bl(async()=>{const{default:e}=await Promise.resolve().then(()=>hc);return{default:e}},void 0).then(({default:t})=>t(...e)).catch(e=>{throw new Error(`Failed to load @supabase/node-fetch: ${e.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):fetch),(...e)=>t(...e)},!(null===(s=null==t?void 0:t.params)||void 0===s?void 0:s.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${sd.websocket}`,this.httpEndpoint=vd(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(null==t?void 0:t.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||null!==this.conn&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=Yc.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;if(t.includes("Node.js"))throw new Error(`${t}\n\nTo use Realtime in Node.js, you need to provide a WebSocket implementation:\n\nOption 1: Use Node.js 22+ which has native WebSocket support\nOption 2: Install and provide the "ws" package:\n\n  npm install ws\n\n  import ws from "ws"\n  const client = new RealtimeClient(url, {\n    ...options,\n    transport: ws\n  })`);throw new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const s=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(s),this._setConnectionState("disconnected")},e?this.conn.close(e,null!=t?t:""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return 0===this.channels.length&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(e=>e.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case Qc.connecting:return rd.Connecting;case Qc.open:return rd.Open;case Qc.closing:return rd.Closing;default:return rd.Closed}}isConnected(){return this.connectionState()===rd.Open}isConnecting(){return"connecting"===this._connectionState}isDisconnecting(){return"disconnecting"===this._connectionState}channel(e,t={config:{}}){const s=`realtime:${e}`,r=this.getChannels().find(e=>e.topic===s);if(r)return r;{const s=new Md(`realtime:${e}`,t,this);return this.channels.push(s),s}}push(e){const{topic:t,event:s,payload:r,ref:a}=e,n=()=>{this.encode(e,e=>{var t;null===(t=this.conn)||void 0===t||t.send(e)})};this.log("push",`${t} ${s} (${a})`,r),this.isConnected()?n():this.sendBuffer.push(n)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef)return this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),this._wasManualDisconnect=!1,null===(e=this.conn)||void 0===e||e.close(1e3,"heartbeat timeout"),void setTimeout(()=>{var e;this.isConnected()||null===(e=this.reconnectTimer)||void 0===e||e.scheduleTimeout()},Dd);this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),this._setAuthSafely("heartbeat")}else this.heartbeatCallback("disconnected")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(t=>t.topic===e&&(t._isJoined()||t._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,e=>{"phoenix"===e.topic&&"phx_reply"===e.event&&this.heartbeatCallback("ok"===e.payload.status?"ok":"error"),e.ref&&e.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:t,event:s,payload:r,ref:a}=e,n=a?`(${a})`:"",i=r.status||"";this.log("receive",`${i} ${t} ${s} ${n}`.trim(),r),this.channels.filter(e=>e._isMember(t)).forEach(e=>e._trigger(s,r,a)),this._triggerStateCallbacks("message",e)})}_clearTimer(e){var t;"heartbeat"===e&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):"reconnect"===e&&(null===(t=this.reconnectTimer)||void 0===t||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this.workerRef.terminate()},this.workerRef.onmessage=e=>{"keepAlive"===e.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||null===(t=this.reconnectTimer)||void 0===t||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(ed.error))}_appendParams(e,t){if(0===Object.keys(t).length)return e;const s=e.match(/\?/)?"&":"?";return`${e}${s}${new URLSearchParams(t)}`}_workerObjectUrl(e){let t;if(e)t=e;else{const e=new Blob(['\n  addEventListener("message", (e) => {\n    if (e.data.event === "start") {\n      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);\n    }\n  });'],{type:"application/javascript"});t=URL.createObjectURL(e)}return t}_setConnectionState(e,t=!1){this._connectionState=e,"connecting"===e?this._wasManualDisconnect=!1:"disconnecting"===e&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t;t=e||(this.accessToken?await this.accessToken():this.accessTokenValue),this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(e=>{const s={access_token:t,version:"realtime-js/2.15.1"};t&&e.updateJoinPayload(s),e.joinedOnce&&e._isJoined()&&e._push(ed.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(s=>{try{s(t)}catch(zw){this.log("error",`error in ${e} callback`,zw)}})}catch(zw){this.log("error",`error triggering ${e} callbacks`,zw)}}_setupReconnectionTimer(){this.reconnectTimer=new ld(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Pd)},this.reconnectAfterMs)}_initializeOptions(e){var t,s,r,a,n,i,o,l;if(this.transport=null!==(t=null==e?void 0:e.transport)&&void 0!==t?t:null,this.timeout=null!==(s=null==e?void 0:e.timeout)&&void 0!==s?s:Gc,this.heartbeatIntervalMs=null!==(r=null==e?void 0:e.heartbeatIntervalMs)&&void 0!==r?r:Ad,this.worker=null!==(a=null==e?void 0:e.worker)&&void 0!==a&&a,this.accessToken=null!==(n=null==e?void 0:e.accessToken)&&void 0!==n?n:null,(null==e?void 0:e.params)&&(this.params=e.params),(null==e?void 0:e.logger)&&(this.logger=e.logger),((null==e?void 0:e.logLevel)||(null==e?void 0:e.log_level))&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=null!==(i=null==e?void 0:e.reconnectAfterMs)&&void 0!==i?i:e=>Rd[e-1]||1e4,this.encode=null!==(o=null==e?void 0:e.encode)&&void 0!==o?o:(e,t)=>t(JSON.stringify(e)),this.decode=null!==(l=null==e?void 0:e.decode)&&void 0!==l?l:this.serializer.decode.bind(this.serializer),this.worker){if("undefined"!=typeof window&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=null==e?void 0:e.workerUrl}}}class qd extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Id(e){return"object"==typeof e&&null!==e&&"__isStorageError"in e}class Fd extends qd{constructor(e,t,s){super(e),this.name="StorageApiError",this.status=t,this.statusCode=s}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class Ld extends qd{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var $d=function(e,t,s,r){return new(s||(s=Promise))(function(a,n){function i(e){try{l(r.next(e))}catch(zw){n(zw)}}function o(e){try{l(r.throw(e))}catch(zw){n(zw)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(i,o)}l((r=r.apply(e,t||[])).next())})};const zd=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>Bl(async()=>{const{default:e}=await Promise.resolve().then(()=>hc);return{default:e}},void 0).then(({default:t})=>t(...e)):fetch),(...e)=>t(...e)},Ud=e=>{if(Array.isArray(e))return e.map(e=>Ud(e));if("function"==typeof e||e!==Object(e))return e;const t={};return Object.entries(e).forEach(([e,s])=>{const r=e.replace(/([-_][a-z])/gi,e=>e.toUpperCase().replace(/[-_]/g,""));t[r]=Ud(s)}),t};var Wd=function(e,t,s,r){return new(s||(s=Promise))(function(a,n){function i(e){try{l(r.next(e))}catch(zw){n(zw)}}function o(e){try{l(r.throw(e))}catch(zw){n(zw)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(i,o)}l((r=r.apply(e,t||[])).next())})};const Vd=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),Bd=(e,t,s)=>Wd(void 0,void 0,void 0,function*(){const r=yield $d(void 0,void 0,void 0,function*(){return"undefined"==typeof Response?(yield Bl(()=>Promise.resolve().then(()=>hc),void 0)).Response:Response});e instanceof r&&!(null==s?void 0:s.noResolveJson)?e.json().then(s=>{const r=e.status||500,a=(null==s?void 0:s.statusCode)||r+"";t(new Fd(Vd(s),r,a))}).catch(e=>{t(new Ld(Vd(e),e))}):t(new Ld(Vd(e),e))}),Hd=(e,t,s,r)=>{const a={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"!==e&&r?((e=>{if("object"!=typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)})(r)?(a.headers=Object.assign({"Content-Type":"application/json"},null==t?void 0:t.headers),a.body=JSON.stringify(r)):a.body=r,(null==t?void 0:t.duplex)&&(a.duplex=t.duplex),Object.assign(Object.assign({},a),s)):a};function Kd(e,t,s,r,a,n){return Wd(this,void 0,void 0,function*(){return new Promise((i,o)=>{e(s,Hd(t,r,a,n)).then(e=>{if(!e.ok)throw e;return(null==r?void 0:r.noResolveJson)?e:e.json()}).then(e=>i(e)).catch(e=>Bd(e,o,r))})})}function Yd(e,t,s,r){return Wd(this,void 0,void 0,function*(){return Kd(e,"GET",t,s,r)})}function Gd(e,t,s,r,a){return Wd(this,void 0,void 0,function*(){return Kd(e,"POST",t,r,a,s)})}function Qd(e,t,s,r,a){return Wd(this,void 0,void 0,function*(){return Kd(e,"PUT",t,r,a,s)})}function Jd(e,t,s,r,a){return Wd(this,void 0,void 0,function*(){return Kd(e,"DELETE",t,r,a,s)})}var Xd=function(e,t,s,r){return new(s||(s=Promise))(function(a,n){function i(e){try{l(r.next(e))}catch(zw){n(zw)}}function o(e){try{l(r.throw(e))}catch(zw){n(zw)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(i,o)}l((r=r.apply(e,t||[])).next())})};const Zd={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},eu={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class tu{constructor(e,t={},s,r){this.url=e,this.headers=t,this.bucketId=s,this.fetch=zd(r)}uploadOrUpdate(e,t,s,r){return Xd(this,void 0,void 0,function*(){try{let a;const n=Object.assign(Object.assign({},eu),r);let i=Object.assign(Object.assign({},this.headers),"POST"===e&&{"x-upsert":String(n.upsert)});const o=n.metadata;"undefined"!=typeof Blob&&s instanceof Blob?(a=new FormData,a.append("cacheControl",n.cacheControl),o&&a.append("metadata",this.encodeMetadata(o)),a.append("",s)):"undefined"!=typeof FormData&&s instanceof FormData?(a=s,a.append("cacheControl",n.cacheControl),o&&a.append("metadata",this.encodeMetadata(o))):(a=s,i["cache-control"]=`max-age=${n.cacheControl}`,i["content-type"]=n.contentType,o&&(i["x-metadata"]=this.toBase64(this.encodeMetadata(o)))),(null==r?void 0:r.headers)&&(i=Object.assign(Object.assign({},i),r.headers));const l=this._removeEmptyFolders(t),c=this._getFinalPath(l),d=yield("PUT"==e?Qd:Gd)(this.fetch,`${this.url}/object/${c}`,a,Object.assign({headers:i},(null==n?void 0:n.duplex)?{duplex:n.duplex}:{}));return{data:{path:l,id:d.Id,fullPath:d.Key},error:null}}catch(a){if(Id(a))return{data:null,error:a};throw a}})}upload(e,t,s){return Xd(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,s)})}uploadToSignedUrl(e,t,s,r){return Xd(this,void 0,void 0,function*(){const a=this._removeEmptyFolders(e),n=this._getFinalPath(a),i=new URL(this.url+`/object/upload/sign/${n}`);i.searchParams.set("token",t);try{let e;const t=Object.assign({upsert:eu.upsert},r),n=Object.assign(Object.assign({},this.headers),{"x-upsert":String(t.upsert)});"undefined"!=typeof Blob&&s instanceof Blob?(e=new FormData,e.append("cacheControl",t.cacheControl),e.append("",s)):"undefined"!=typeof FormData&&s instanceof FormData?(e=s,e.append("cacheControl",t.cacheControl)):(e=s,n["cache-control"]=`max-age=${t.cacheControl}`,n["content-type"]=t.contentType);return{data:{path:a,fullPath:(yield Qd(this.fetch,i.toString(),e,{headers:n})).Key},error:null}}catch(o){if(Id(o))return{data:null,error:o};throw o}})}createSignedUploadUrl(e,t){return Xd(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e);const r=Object.assign({},this.headers);(null==t?void 0:t.upsert)&&(r["x-upsert"]="true");const a=yield Gd(this.fetch,`${this.url}/object/upload/sign/${s}`,{},{headers:r}),n=new URL(this.url+a.url),i=n.searchParams.get("token");if(!i)throw new qd("No token returned by API");return{data:{signedUrl:n.toString(),path:e,token:i},error:null}}catch(s){if(Id(s))return{data:null,error:s};throw s}})}update(e,t,s){return Xd(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,s)})}move(e,t,s){return Xd(this,void 0,void 0,function*(){try{return{data:yield Gd(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==s?void 0:s.destinationBucket},{headers:this.headers}),error:null}}catch(r){if(Id(r))return{data:null,error:r};throw r}})}copy(e,t,s){return Xd(this,void 0,void 0,function*(){try{return{data:{path:(yield Gd(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==s?void 0:s.destinationBucket},{headers:this.headers})).Key},error:null}}catch(r){if(Id(r))return{data:null,error:r};throw r}})}createSignedUrl(e,t,s){return Xd(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e),a=yield Gd(this.fetch,`${this.url}/object/sign/${r}`,Object.assign({expiresIn:t},(null==s?void 0:s.transform)?{transform:s.transform}:{}),{headers:this.headers});const n=(null==s?void 0:s.download)?`&download=${!0===s.download?"":s.download}`:"";return a={signedUrl:encodeURI(`${this.url}${a.signedURL}${n}`)},{data:a,error:null}}catch(r){if(Id(r))return{data:null,error:r};throw r}})}createSignedUrls(e,t,s){return Xd(this,void 0,void 0,function*(){try{const r=yield Gd(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),a=(null==s?void 0:s.download)?`&download=${!0===s.download?"":s.download}`:"";return{data:r.map(e=>Object.assign(Object.assign({},e),{signedUrl:e.signedURL?encodeURI(`${this.url}${e.signedURL}${a}`):null})),error:null}}catch(r){if(Id(r))return{data:null,error:r};throw r}})}download(e,t){return Xd(this,void 0,void 0,function*(){const s=void 0!==(null==t?void 0:t.transform)?"render/image/authenticated":"object",r=this.transformOptsToQueryString((null==t?void 0:t.transform)||{}),a=r?`?${r}`:"";try{const t=this._getFinalPath(e),r=yield Yd(this.fetch,`${this.url}/${s}/${t}${a}`,{headers:this.headers,noResolveJson:!0});return{data:yield r.blob(),error:null}}catch(n){if(Id(n))return{data:null,error:n};throw n}})}info(e){return Xd(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const e=yield Yd(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:Ud(e),error:null}}catch(s){if(Id(s))return{data:null,error:s};throw s}})}exists(e){return Xd(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield function(e,t,s,r){return Wd(this,void 0,void 0,function*(){return Kd(e,"HEAD",t,Object.assign(Object.assign({},s),{noResolveJson:!0}),r)})}(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(s){if(Id(s)&&s instanceof Ld){const e=s.originalError;if([400,404].includes(null==e?void 0:e.status))return{data:!1,error:s}}throw s}})}getPublicUrl(e,t){const s=this._getFinalPath(e),r=[],a=(null==t?void 0:t.download)?`download=${!0===t.download?"":t.download}`:"";""!==a&&r.push(a);const n=void 0!==(null==t?void 0:t.transform)?"render/image":"object",i=this.transformOptsToQueryString((null==t?void 0:t.transform)||{});""!==i&&r.push(i);let o=r.join("&");return""!==o&&(o=`?${o}`),{data:{publicUrl:encodeURI(`${this.url}/${n}/public/${s}${o}`)}}}remove(e){return Xd(this,void 0,void 0,function*(){try{return{data:yield Jd(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(Id(t))return{data:null,error:t};throw t}})}list(e,t,s){return Xd(this,void 0,void 0,function*(){try{const r=Object.assign(Object.assign(Object.assign({},Zd),t),{prefix:e||""});return{data:yield Gd(this.fetch,`${this.url}/object/list/${this.bucketId}`,r,{headers:this.headers},s),error:null}}catch(r){if(Id(r))return{data:null,error:r};throw r}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return"undefined"!=typeof Buffer?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const su={"X-Client-Info":"storage-js/2.10.5"};var ru=function(e,t,s,r){return new(s||(s=Promise))(function(a,n){function i(e){try{l(r.next(e))}catch(zw){n(zw)}}function o(e){try{l(r.throw(e))}catch(zw){n(zw)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(i,o)}l((r=r.apply(e,t||[])).next())})};class au{constructor(e,t={},s,r){const a=new URL(e);if(null==r?void 0:r.useNewHostname){/supabase\.(co|in|red)$/.test(a.hostname)&&!a.hostname.includes("storage.supabase.")&&(a.hostname=a.hostname.replace("supabase.","storage.supabase."))}this.url=a.href,this.headers=Object.assign(Object.assign({},su),t),this.fetch=zd(s)}listBuckets(){return ru(this,void 0,void 0,function*(){try{return{data:yield Yd(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(Id(e))return{data:null,error:e};throw e}})}getBucket(e){return ru(this,void 0,void 0,function*(){try{return{data:yield Yd(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(Id(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return ru(this,void 0,void 0,function*(){try{return{data:yield Gd(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(Id(s))return{data:null,error:s};throw s}})}updateBucket(e,t){return ru(this,void 0,void 0,function*(){try{return{data:yield Qd(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(Id(s))return{data:null,error:s};throw s}})}emptyBucket(e){return ru(this,void 0,void 0,function*(){try{return{data:yield Gd(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(Id(t))return{data:null,error:t};throw t}})}deleteBucket(e){return ru(this,void 0,void 0,function*(){try{return{data:yield Jd(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(Id(t))return{data:null,error:t};throw t}})}}class nu extends au{constructor(e,t={},s,r){super(e,t,s,r)}from(e){return new tu(this.url,this.headers,e,this.fetch)}}let iu="";iu="undefined"!=typeof Deno?"deno":"undefined"!=typeof document?"web":"undefined"!=typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";const ou={headers:{"X-Client-Info":`supabase-js-${iu}/2.55.0`}},lu={schema:"public"},cu={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},du={};var uu=function(e,t,s,r){return new(s||(s=Promise))(function(a,n){function i(e){try{l(r.next(e))}catch(zw){n(zw)}}function o(e){try{l(r.throw(e))}catch(zw){n(zw)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(i,o)}l((r=r.apply(e,t||[])).next())})};const hu=(e,t,s)=>{const r=(e=>{let t;return t=e||("undefined"==typeof fetch?lc:fetch),(...e)=>t(...e)})(s),a="undefined"==typeof Headers?cc:Headers;return(s,n)=>uu(void 0,void 0,void 0,function*(){var i;const o=null!==(i=yield t())&&void 0!==i?i:e;let l=new a(null==n?void 0:n.headers);return l.has("apikey")||l.set("apikey",e),l.has("Authorization")||l.set("Authorization",`Bearer ${o}`),r(s,Object.assign(Object.assign({},n),{headers:l}))})};var mu=function(e,t,s,r){return new(s||(s=Promise))(function(a,n){function i(e){try{l(r.next(e))}catch(zw){n(zw)}}function o(e){try{l(r.throw(e))}catch(zw){n(zw)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(i,o)}l((r=r.apply(e,t||[])).next())})};const pu="2.71.1",fu=3e4,xu=9e4,gu={"X-Client-Info":`gotrue-js/${pu}`},vu="X-Supabase-Api-Version",ju={timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"},yu=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i;class bu extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}}function wu(e){return"object"==typeof e&&null!==e&&"__isAuthError"in e}class Nu extends bu{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}}class _u extends bu{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class ku extends bu{constructor(e,t,s,r){super(e,s,r),this.name=t,this.status=s}}class Su extends ku{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class Cu extends ku{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Eu extends ku{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Mu extends ku{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Tu extends ku{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Au extends ku{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Pu(e){return wu(e)&&"AuthRetryableFetchError"===e.name}class Du extends ku{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}}class Ru extends ku{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Ou="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),qu=" \t\n\r=".split(""),Iu=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<qu.length;t+=1)e[qu[t].charCodeAt(0)]=-2;for(let t=0;t<Ou.length;t+=1)e[Ou[t].charCodeAt(0)]=t;return e})();function Fu(e,t,s){if(null!==e)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;s(Ou[e]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;s(Ou[e]),t.queuedBits-=6}}function Lu(e,t,s){const r=Iu[e];if(!(r>-1)){if(-2===r)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}for(t.queue=t.queue<<6|r,t.queuedBits+=6;t.queuedBits>=8;)s(t.queue>>t.queuedBits-8&255),t.queuedBits-=8}function $u(e){const t=[],s=e=>{t.push(String.fromCodePoint(e))},r={utf8seq:0,codepoint:0},a={queue:0,queuedBits:0},n=e=>{!function(e,t,s){if(0===t.utf8seq){if(e<=127)return void s(e);for(let s=1;s<6;s+=1)if(!(e>>7-s&1)){t.utf8seq=s;break}if(2===t.utf8seq)t.codepoint=31&e;else if(3===t.utf8seq)t.codepoint=15&e;else{if(4!==t.utf8seq)throw new Error("Invalid UTF-8 sequence");t.codepoint=7&e}t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|63&e,t.utf8seq-=1,0===t.utf8seq&&s(t.codepoint)}}(e,r,s)};for(let i=0;i<e.length;i+=1)Lu(e.charCodeAt(i),a,n);return t.join("")}function zu(e,t){if(!(e<=127)){if(e<=2047)return t(192|e>>6),void t(128|63&e);if(e<=65535)return t(224|e>>12),t(128|e>>6&63),void t(128|63&e);if(e<=1114111)return t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),void t(128|63&e);throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}t(e)}function Uu(e){const t=[],s={queue:0,queuedBits:0},r=e=>{t.push(e)};for(let a=0;a<e.length;a+=1)Lu(e.charCodeAt(a),s,r);return new Uint8Array(t)}function Wu(e){const t=[];return function(e,t){for(let s=0;s<e.length;s+=1){let r=e.charCodeAt(s);if(r>55295&&r<=56319){const t=1024*(r-55296)&65535;r=65536+(e.charCodeAt(s+1)-56320&65535|t),s+=1}zu(r,t)}}(e,e=>t.push(e)),new Uint8Array(t)}function Vu(e){const t=[],s={queue:0,queuedBits:0},r=e=>{t.push(e)};return e.forEach(e=>Fu(e,s,r)),Fu(null,s,r),t.join("")}const Bu=()=>"undefined"!=typeof window&&"undefined"!=typeof document,Hu={tested:!1,writable:!1},Ku=()=>{if(!Bu())return!1;try{if("object"!=typeof globalThis.localStorage)return!1}catch(zw){return!1}if(Hu.tested)return Hu.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),Hu.tested=!0,Hu.writable=!0}catch(zw){Hu.tested=!0,Hu.writable=!1}return Hu.writable};const Yu=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>Bl(async()=>{const{default:e}=await Promise.resolve().then(()=>hc);return{default:e}},void 0).then(({default:t})=>t(...e)):fetch),(...e)=>t(...e)},Gu=async(e,t,s)=>{await e.setItem(t,JSON.stringify(s))},Qu=async(e,t)=>{const s=await e.getItem(t);if(!s)return null;try{return JSON.parse(s)}catch(r){return s}},Ju=async(e,t)=>{await e.removeItem(t)};class Xu{constructor(){this.promise=new Xu.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}function Zu(e){const t=e.split(".");if(3!==t.length)throw new Ru("Invalid JWT structure");for(let s=0;s<t.length;s++)if(!yu.test(t[s]))throw new Ru("JWT not in base64url format");return{header:JSON.parse($u(t[0])),payload:JSON.parse($u(t[1])),signature:Uu(t[2]),raw:{header:t[0],payload:t[1]}}}function eh(e){return("0"+e.toString(16)).substr(-2)}async function th(e){if(!("undefined"!=typeof crypto&&void 0!==crypto.subtle&&"undefined"!=typeof TextEncoder))return e;const t=await async function(e){const t=(new TextEncoder).encode(e),s=await crypto.subtle.digest("SHA-256",t),r=new Uint8Array(s);return Array.from(r).map(e=>String.fromCharCode(e)).join("")}(e);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function sh(e,t,s=!1){const r=function(){const e=new Uint32Array(56);if("undefined"==typeof crypto){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",t=e.length;let s="";for(let r=0;r<56;r++)s+=e.charAt(Math.floor(Math.random()*t));return s}return crypto.getRandomValues(e),Array.from(e,eh).join("")}();let a=r;s&&(a+="/PASSWORD_RECOVERY"),await Gu(e,`${t}-code-verifier`,a);const n=await th(r);return[n,r===n?"plain":"s256"]}Xu.promiseConstructor=Promise;const rh=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;const ah=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function nh(e){if(!ah.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function ih(){return new Proxy({},{get:(e,t)=>{if("__isUserNotAvailableProxy"===t)return!0;if("symbol"==typeof t){const e=t.toString();if("Symbol(Symbol.toPrimitive)"===e||"Symbol(Symbol.toStringTag)"===e||"Symbol(util.inspect.custom)"===e)return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function oh(e){return JSON.parse(JSON.stringify(e))}const lh=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),ch=[502,503,504];async function dh(e){var t,s;if(!("object"==typeof(s=e)&&null!==s&&"status"in s&&"ok"in s&&"json"in s&&"function"==typeof s.json))throw new Au(lh(e),0);if(ch.includes(e.status))throw new Au(lh(e),e.status);let r,a;try{r=await e.json()}catch(zw){throw new _u(lh(zw),zw)}const n=function(e){const t=e.headers.get(vu);if(!t)return null;if(!t.match(rh))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch(zw){return null}}(e);if(n&&n.getTime()>=ju.timestamp&&"object"==typeof r&&r&&"string"==typeof r.code?a=r.code:"object"==typeof r&&r&&"string"==typeof r.error_code&&(a=r.error_code),a){if("weak_password"===a)throw new Du(lh(r),e.status,(null===(t=r.weak_password)||void 0===t?void 0:t.reasons)||[]);if("session_not_found"===a)throw new Su}else if("object"==typeof r&&r&&"object"==typeof r.weak_password&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((e,t)=>e&&"string"==typeof t,!0))throw new Du(lh(r),e.status,r.weak_password.reasons);throw new Nu(lh(r),e.status||500,a)}async function uh(e,t,s,r){var a;const n=Object.assign({},null==r?void 0:r.headers);n[vu]||(n[vu]=ju.name),(null==r?void 0:r.jwt)&&(n.Authorization=`Bearer ${r.jwt}`);const i=null!==(a=null==r?void 0:r.query)&&void 0!==a?a:{};(null==r?void 0:r.redirectTo)&&(i.redirect_to=r.redirectTo);const o=Object.keys(i).length?"?"+new URLSearchParams(i).toString():"",l=await async function(e,t,s,r,a,n){const i=((e,t,s,r)=>{const a={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?a:(a.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==t?void 0:t.headers),a.body=JSON.stringify(r),Object.assign(Object.assign({},a),s))})(t,r,a,n);let o;try{o=await e(s,Object.assign({},i))}catch(zw){throw new Au(lh(zw),0)}o.ok||await dh(o);if(null==r?void 0:r.noResolveJson)return o;try{return await o.json()}catch(zw){await dh(zw)}}(e,t,s+o,{headers:n,noResolveJson:null==r?void 0:r.noResolveJson},{},null==r?void 0:r.body);return(null==r?void 0:r.xform)?null==r?void 0:r.xform(l):{data:Object.assign({},l),error:null}}function hh(e){var t;let s=null;var r;(function(e){return e.access_token&&e.refresh_token&&e.expires_in})(e)&&(s=Object.assign({},e),e.expires_at||(s.expires_at=(r=e.expires_in,Math.round(Date.now()/1e3)+r)));return{data:{session:s,user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function mh(e){const t=hh(e);return!t.error&&e.weak_password&&"object"==typeof e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&"string"==typeof e.weak_password.message&&e.weak_password.reasons.reduce((e,t)=>e&&"string"==typeof t,!0)&&(t.data.weak_password=e.weak_password),t}function ph(e){var t;return{data:{user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function fh(e){return{data:e,error:null}}function xh(e){const{action_link:t,email_otp:s,hashed_token:r,redirect_to:a,verification_type:n}=e,i=function(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(s[r[a]]=e[r[a]])}return s}(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:t,email_otp:s,hashed_token:r,redirect_to:a,verification_type:n},user:Object.assign({},i)},error:null}}function gh(e){return e}const vh=["global","local","others"];class jh{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=Yu(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=vh[0]){if(vh.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${vh.join(", ")}`);try{return await uh(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(wu(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e,t={}){try{return await uh(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:ph})}catch(s){if(wu(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{const{options:t}=e,s=function(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(s[r[a]]=e[r[a]])}return s}(e,["options"]),r=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(r.new_email=null==s?void 0:s.newEmail,delete r.newEmail),await uh(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:r,headers:this.headers,xform:xh,redirectTo:null==t?void 0:t.redirectTo})}catch(t){if(wu(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await uh(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:ph})}catch(t){if(wu(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,s,r,a,n,i,o;try{const l={nextPage:null,lastPage:0,total:0},c=await uh(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(s=null===(t=null==e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==s?s:"",per_page:null!==(a=null===(r=null==e?void 0:e.perPage)||void 0===r?void 0:r.toString())&&void 0!==a?a:""},xform:gh});if(c.error)throw c.error;const d=await c.json(),u=null!==(n=c.headers.get("x-total-count"))&&void 0!==n?n:0,h=null!==(o=null===(i=c.headers.get("link"))||void 0===i?void 0:i.split(","))&&void 0!==o?o:[];return h.length>0&&(h.forEach(e=>{const t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),s=JSON.parse(e.split(";")[1].split("=")[1]);l[`${s}Page`]=t}),l.total=parseInt(u)),{data:Object.assign(Object.assign({},d),l),error:null}}catch(l){if(wu(l))return{data:{users:[]},error:l};throw l}}async getUserById(e){nh(e);try{return await uh(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:ph})}catch(t){if(wu(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){nh(e);try{return await uh(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:ph})}catch(s){if(wu(s))return{data:{user:null},error:s};throw s}}async deleteUser(e,t=!1){nh(e);try{return await uh(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:ph})}catch(s){if(wu(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){nh(e.userId);try{const{data:t,error:s}=await uh(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:e=>({data:{factors:e},error:null})});return{data:t,error:s}}catch(t){if(wu(t))return{data:null,error:t};throw t}}async _deleteFactor(e){nh(e.userId),nh(e.id);try{return{data:await uh(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(wu(t))return{data:null,error:t};throw t}}}function yh(e={}){return{getItem:t=>e[t]||null,setItem:(t,s)=>{e[t]=s},removeItem:t=>{delete e[t]}}}const bh=!!(globalThis&&Ku()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"));class wh extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Nh extends wh{}async function _h(e,t,s){const r=new globalThis.AbortController;return t>0&&setTimeout(()=>{r.abort()},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,0===t?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async r=>{if(!r){if(0===t)throw new Nh(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(bh)try{await globalThis.navigator.locks.query()}catch(zw){}return await s()}try{return await s()}finally{}}))}!function(){if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(zw){"undefined"!=typeof self&&(self.globalThis=self)}}();const kh={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:gu,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Sh(e,t,s){return await s()}const Ch={};class Eh{constructor(e){var t,s;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Eh.nextInstanceID,Eh.nextInstanceID+=1,this.instanceID>0&&Bu();const r=Object.assign(Object.assign({},kh),e);if(this.logDebugMessages=!!r.debug,"function"==typeof r.debug&&(this.logger=r.debug),this.persistSession=r.persistSession,this.storageKey=r.storageKey,this.autoRefreshToken=r.autoRefreshToken,this.admin=new jh({url:r.url,headers:r.headers,fetch:r.fetch}),this.url=r.url,this.headers=r.headers,this.fetch=Yu(r.fetch),this.lock=r.lock||Sh,this.detectSessionInUrl=r.detectSessionInUrl,this.flowType=r.flowType,this.hasCustomAuthorizationHeader=r.hasCustomAuthorizationHeader,r.lock?this.lock=r.lock:Bu()&&(null===(t=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===t?void 0:t.locks)?this.lock=_h:this.lock=Sh,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(r.storage?this.storage=r.storage:Ku()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=yh(this.memoryStorage)),r.userStorage&&(this.userStorage=r.userStorage)):(this.memoryStorage={},this.storage=yh(this.memoryStorage)),Bu()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(zw){}null===(s=this.broadcastChannel)||void 0===s||s.addEventListener("message",async e=>{this._debug("received broadcast notification from other tab or client",e),await this._notifyAllSubscribers(e.data.event,e.data.session,!1)})}this.initialize()}get jwks(){var e,t;return null!==(t=null===(e=Ch[this.storageKey])||void 0===e?void 0:e.jwks)&&void 0!==t?t:{keys:[]}}set jwks(e){Ch[this.storageKey]=Object.assign(Object.assign({},Ch[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return null!==(t=null===(e=Ch[this.storageKey])||void 0===e?void 0:e.cachedAt)&&void 0!==t?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Ch[this.storageKey]=Object.assign(Object.assign({},Ch[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${pu}) ${(new Date).toISOString()}`,...e),this}async initialize(){return this.initializePromise||(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))()),await this.initializePromise}async _initialize(){var e;try{const t=function(e){const t={},s=new URL(e);if(s.hash&&"#"===s.hash[0])try{new URLSearchParams(s.hash.substring(1)).forEach((e,s)=>{t[s]=e})}catch(zw){}return s.searchParams.forEach((e,s)=>{t[s]=e}),t}(window.location.href);let s="none";if(this._isImplicitGrantCallback(t)?s="implicit":await this._isPKCECallback(t)&&(s="pkce"),Bu()&&this.detectSessionInUrl&&"none"!==s){const{data:r,error:a}=await this._getSessionFromURL(t,s);if(a){if(this._debug("#_initialize()","error detecting session from URL",a),function(e){return wu(e)&&"AuthImplicitGrantRedirectError"===e.name}(a)){const t=null===(e=a.details)||void 0===e?void 0:e.code;if("identity_already_exists"===t||"identity_not_found"===t||"single_identity_not_deletable"===t)return{error:a}}return await this._removeSession(),{error:a}}const{session:n,redirectType:i}=r;return this._debug("#_initialize()","detected session in URL",n,"redirect type",i),await this._saveSession(n),setTimeout(async()=>{"recovery"===i?await this._notifyAllSubscribers("PASSWORD_RECOVERY",n):await this._notifyAllSubscribers("SIGNED_IN",n)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return wu(t)?{error:t}:{error:new _u("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,s,r;try{const a=await uh(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:null!==(s=null===(t=null==e?void 0:e.options)||void 0===t?void 0:t.data)&&void 0!==s?s:{},gotrue_meta_security:{captcha_token:null===(r=null==e?void 0:e.options)||void 0===r?void 0:r.captchaToken}},xform:hh}),{data:n,error:i}=a;if(i||!n)return{data:{user:null,session:null},error:i};const o=n.session,l=n.user;return n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",o)),{data:{user:l,session:o},error:null}}catch(a){if(wu(a))return{data:{user:null,session:null},error:a};throw a}}async signUp(e){var t,s,r;try{let a;if("email"in e){const{email:s,password:r,options:n}=e;let i=null,o=null;"pkce"===this.flowType&&([i,o]=await sh(this.storage,this.storageKey)),a=await uh(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:null==n?void 0:n.emailRedirectTo,body:{email:s,password:r,data:null!==(t=null==n?void 0:n.data)&&void 0!==t?t:{},gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken},code_challenge:i,code_challenge_method:o},xform:hh})}else{if(!("phone"in e))throw new Eu("You must provide either an email or phone number and a password");{const{phone:t,password:n,options:i}=e;a=await uh(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:t,password:n,data:null!==(s=null==i?void 0:i.data)&&void 0!==s?s:{},channel:null!==(r=null==i?void 0:i.channel)&&void 0!==r?r:"sms",gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}},xform:hh})}}const{data:n,error:i}=a;if(i||!n)return{data:{user:null,session:null},error:i};const o=n.session,l=n.user;return n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",o)),{data:{user:l,session:o},error:null}}catch(a){if(wu(a))return{data:{user:null,session:null},error:a};throw a}}async signInWithPassword(e){try{let t;if("email"in e){const{email:s,password:r,options:a}=e;t=await uh(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:s,password:r,gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken}},xform:mh})}else{if(!("phone"in e))throw new Eu("You must provide either an email or phone number and a password");{const{phone:s,password:r,options:a}=e;t=await uh(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:s,password:r,gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken}},xform:mh})}}const{data:s,error:r}=t;return r?{data:{user:null,session:null},error:r}:s&&s.session&&s.user?(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:r}):{data:{user:null,session:null},error:new Cu}}catch(t){if(wu(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,s,r,a;return await this._handleProviderSignIn(e.provider,{redirectTo:null===(t=e.options)||void 0===t?void 0:t.redirectTo,scopes:null===(s=e.options)||void 0===s?void 0:s.scopes,queryParams:null===(r=e.options)||void 0===r?void 0:r.queryParams,skipBrowserRedirect:null===(a=e.options)||void 0===a?void 0:a.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;if("solana"===t)return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}async signInWithSolana(e){var t,s,r,a,n,i,o,l,c,d,u,h;let m,p;if("message"in e)m=e.message,p=e.signature;else{const{chain:u,wallet:h,statement:f,options:x}=e;let g;if(Bu())if("object"==typeof h)g=h;else{const e=window;if(!("solana"in e)||"object"!=typeof e.solana||!("signIn"in e.solana&&"function"==typeof e.solana.signIn||"signMessage"in e.solana&&"function"==typeof e.solana.signMessage))throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.");g=e.solana}else{if("object"!=typeof h||!(null==x?void 0:x.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");g=h}const v=new URL(null!==(t=null==x?void 0:x.url)&&void 0!==t?t:window.location.href);if("signIn"in g&&g.signIn){const e=await g.signIn(Object.assign(Object.assign(Object.assign({issuedAt:(new Date).toISOString()},null==x?void 0:x.signInWithSolana),{version:"1",domain:v.host,uri:v.href}),f?{statement:f}:null));let t;if(Array.isArray(e)&&e[0]&&"object"==typeof e[0])t=e[0];else{if(!(e&&"object"==typeof e&&"signedMessage"in e&&"signature"in e))throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");t=e}if(!("signedMessage"in t&&"signature"in t&&("string"==typeof t.signedMessage||t.signedMessage instanceof Uint8Array)&&t.signature instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields");m="string"==typeof t.signedMessage?t.signedMessage:(new TextDecoder).decode(t.signedMessage),p=t.signature}else{if(!("signMessage"in g&&"function"==typeof g.signMessage&&"publicKey"in g&&"object"==typeof g&&g.publicKey&&"toBase58"in g.publicKey&&"function"==typeof g.publicKey.toBase58))throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");m=[`${v.host} wants you to sign in with your Solana account:`,g.publicKey.toBase58(),...f?["",f,""]:[""],"Version: 1",`URI: ${v.href}`,`Issued At: ${null!==(r=null===(s=null==x?void 0:x.signInWithSolana)||void 0===s?void 0:s.issuedAt)&&void 0!==r?r:(new Date).toISOString()}`,...(null===(a=null==x?void 0:x.signInWithSolana)||void 0===a?void 0:a.notBefore)?[`Not Before: ${x.signInWithSolana.notBefore}`]:[],...(null===(n=null==x?void 0:x.signInWithSolana)||void 0===n?void 0:n.expirationTime)?[`Expiration Time: ${x.signInWithSolana.expirationTime}`]:[],...(null===(i=null==x?void 0:x.signInWithSolana)||void 0===i?void 0:i.chainId)?[`Chain ID: ${x.signInWithSolana.chainId}`]:[],...(null===(o=null==x?void 0:x.signInWithSolana)||void 0===o?void 0:o.nonce)?[`Nonce: ${x.signInWithSolana.nonce}`]:[],...(null===(l=null==x?void 0:x.signInWithSolana)||void 0===l?void 0:l.requestId)?[`Request ID: ${x.signInWithSolana.requestId}`]:[],...(null===(d=null===(c=null==x?void 0:x.signInWithSolana)||void 0===c?void 0:c.resources)||void 0===d?void 0:d.length)?["Resources",...x.signInWithSolana.resources.map(e=>`- ${e}`)]:[]].join("\n");const e=await g.signMessage((new TextEncoder).encode(m),"utf8");if(!(e&&e instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");p=e}}try{const{data:t,error:s}=await uh(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:m,signature:Vu(p)},(null===(u=e.options)||void 0===u?void 0:u.captchaToken)?{gotrue_meta_security:{captcha_token:null===(h=e.options)||void 0===h?void 0:h.captchaToken}}:null),xform:hh});if(s)throw s;return t&&t.session&&t.user?(t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),{data:Object.assign({},t),error:s}):{data:{user:null,session:null},error:new Cu}}catch(f){if(wu(f))return{data:{user:null,session:null},error:f};throw f}}async _exchangeCodeForSession(e){const t=await Qu(this.storage,`${this.storageKey}-code-verifier`),[s,r]=(null!=t?t:"").split("/");try{const{data:t,error:a}=await uh(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:hh});if(await Ju(this.storage,`${this.storageKey}-code-verifier`),a)throw a;return t&&t.session&&t.user?(t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),{data:Object.assign(Object.assign({},t),{redirectType:null!=r?r:null}),error:a}):{data:{user:null,session:null,redirectType:null},error:new Cu}}catch(a){if(wu(a))return{data:{user:null,session:null,redirectType:null},error:a};throw a}}async signInWithIdToken(e){try{const{options:t,provider:s,token:r,access_token:a,nonce:n}=e,i=await uh(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:r,access_token:a,nonce:n,gotrue_meta_security:{captcha_token:null==t?void 0:t.captchaToken}},xform:hh}),{data:o,error:l}=i;return l?{data:{user:null,session:null},error:l}:o&&o.session&&o.user?(o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",o.session)),{data:o,error:l}):{data:{user:null,session:null},error:new Cu}}catch(t){if(wu(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,s,r,a,n;try{if("email"in e){const{email:r,options:a}=e;let n=null,i=null;"pkce"===this.flowType&&([n,i]=await sh(this.storage,this.storageKey));const{error:o}=await uh(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:r,data:null!==(t=null==a?void 0:a.data)&&void 0!==t?t:{},create_user:null===(s=null==a?void 0:a.shouldCreateUser)||void 0===s||s,gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken},code_challenge:n,code_challenge_method:i},redirectTo:null==a?void 0:a.emailRedirectTo});return{data:{user:null,session:null},error:o}}if("phone"in e){const{phone:t,options:s}=e,{data:i,error:o}=await uh(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:t,data:null!==(r=null==s?void 0:s.data)&&void 0!==r?r:{},create_user:null===(a=null==s?void 0:s.shouldCreateUser)||void 0===a||a,gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken},channel:null!==(n=null==s?void 0:s.channel)&&void 0!==n?n:"sms"}});return{data:{user:null,session:null,messageId:null==i?void 0:i.message_id},error:o}}throw new Eu("You must provide either an email or phone number.")}catch(i){if(wu(i))return{data:{user:null,session:null},error:i};throw i}}async verifyOtp(e){var t,s;try{let r,a;"options"in e&&(r=null===(t=e.options)||void 0===t?void 0:t.redirectTo,a=null===(s=e.options)||void 0===s?void 0:s.captchaToken);const{data:n,error:i}=await uh(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:a}}),redirectTo:r,xform:hh});if(i)throw i;if(!n)throw new Error("An error occurred on token verification.");const o=n.session,l=n.user;return(null==o?void 0:o.access_token)&&(await this._saveSession(o),await this._notifyAllSubscribers("recovery"==e.type?"PASSWORD_RECOVERY":"SIGNED_IN",o)),{data:{user:l,session:o},error:null}}catch(r){if(wu(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithSSO(e){var t,s,r;try{let a=null,n=null;return"pkce"===this.flowType&&([a,n]=await sh(this.storage,this.storageKey)),await uh(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:null!==(s=null===(t=e.options)||void 0===t?void 0:t.redirectTo)&&void 0!==s?s:void 0}),(null===(r=null==e?void 0:e.options)||void 0===r?void 0:r.captchaToken)?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:a,code_challenge_method:n}),headers:this.headers,xform:fh})}catch(a){if(wu(a))return{data:null,error:a};throw a}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new Su;const{error:r}=await uh(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:r}})}catch(e){if(wu(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:s,type:r,options:a}=e,{error:n}=await uh(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:r,gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken}},redirectTo:null==a?void 0:a.emailRedirectTo});return{data:{user:null,session:null},error:n}}if("phone"in e){const{phone:s,type:r,options:a}=e,{data:n,error:i}=await uh(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:r,gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken}}});return{data:{user:null,session:null,messageId:null==n?void 0:n.message_id},error:i}}throw new Eu("You must provide either an email or phone number and a type")}catch(t){if(wu(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){await this.initializePromise;return await this._acquireLock(-1,async()=>this._useSession(async e=>e))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const e=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await e,await t()))();return this.pendingInLock.push((async()=>{try{await s}catch(zw){}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const e=t();for(this.pendingInLock.push((async()=>{try{await e}catch(zw){}})()),await e;this.pendingInLock.length;){const e=[...this.pendingInLock];await Promise.all(e),this.pendingInLock.splice(0,e.length)}return await e}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",(new Error).stack);try{let e=null;const t=await Qu(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),null!==t&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const s=!!e.expires_at&&1e3*e.expires_at-Date.now()<xu;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.userStorage){const t=await Qu(this.userStorage,this.storageKey+"-user");(null==t?void 0:t.user)?e.user=t.user:e.user=ih()}if(this.storage.isServer&&e.user){let t=this.suppressGetSessionWarning;e=new Proxy(e,{get:(e,s,r)=>(t||"user"!==s||(t=!0,this.suppressGetSessionWarning=!0),Reflect.get(e,s,r))})}return{data:{session:e},error:null}}const{session:r,error:a}=await this._callRefreshToken(e.refresh_token);return a?{data:{session:null},error:a}:{data:{session:r},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;return await this._acquireLock(-1,async()=>await this._getUser())}async _getUser(e){try{return e?await uh(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:ph}):await this._useSession(async e=>{var t,s,r;const{data:a,error:n}=e;if(n)throw n;return(null===(t=a.session)||void 0===t?void 0:t.access_token)||this.hasCustomAuthorizationHeader?await uh(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:null!==(r=null===(s=a.session)||void 0===s?void 0:s.access_token)&&void 0!==r?r:void 0,xform:ph}):{data:{user:null},error:new Su}})}catch(t){if(wu(t))return function(e){return wu(e)&&"AuthSessionMissingError"===e.name}(t)&&(await this._removeSession(),await Ju(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async s=>{const{data:r,error:a}=s;if(a)throw a;if(!r.session)throw new Su;const n=r.session;let i=null,o=null;"pkce"===this.flowType&&null!=e.email&&([i,o]=await sh(this.storage,this.storageKey));const{data:l,error:c}=await uh(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:null==t?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:i,code_challenge_method:o}),jwt:n.access_token,xform:ph});if(c)throw c;return n.user=l.user,await this._saveSession(n),await this._notifyAllSubscribers("USER_UPDATED",n),{data:{user:n.user},error:null}})}catch(s){if(wu(s))return{data:{user:null},error:s};throw s}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Su;const t=Date.now()/1e3;let s=t,r=!0,a=null;const{payload:n}=Zu(e.access_token);if(n.exp&&(s=n.exp,r=s<=t),r){const{session:t,error:s}=await this._callRefreshToken(e.refresh_token);if(s)return{data:{user:null,session:null},error:s};if(!t)return{data:{user:null,session:null},error:null};a=t}else{const{data:r,error:n}=await this._getUser(e.access_token);if(n)throw n;a={access_token:e.access_token,refresh_token:e.refresh_token,user:r.user,token_type:"bearer",expires_in:s-t,expires_at:s},await this._saveSession(a),await this._notifyAllSubscribers("SIGNED_IN",a)}return{data:{user:a.user,session:a},error:null}}catch(t){if(wu(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var s;if(!e){const{data:r,error:a}=t;if(a)throw a;e=null!==(s=r.session)&&void 0!==s?s:void 0}if(!(null==e?void 0:e.refresh_token))throw new Su;const{session:r,error:a}=await this._callRefreshToken(e.refresh_token);return a?{data:{user:null,session:null},error:a}:r?{data:{user:r.user,session:r},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(wu(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!Bu())throw new Mu("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Mu(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if("pkce"===this.flowType)throw new Tu("Not a valid PKCE flow url.");break;case"pkce":if("implicit"===this.flowType)throw new Mu("Not a valid implicit grant flow url.")}if("pkce"===t){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Tu("No code detected.");const{data:t,error:s}=await this._exchangeCodeForSession(e.code);if(s)throw s;const r=new URL(window.location.href);return r.searchParams.delete("code"),window.history.replaceState(window.history.state,"",r.toString()),{data:{session:t.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:r,access_token:a,refresh_token:n,expires_in:i,expires_at:o,token_type:l}=e;if(!(a&&i&&n&&l))throw new Mu("No session defined in URL");const c=Math.round(Date.now()/1e3),d=parseInt(i);let u=c+d;o&&(u=parseInt(o));const{data:h,error:m}=await this._getUser(a);if(m)throw m;const p={provider_token:s,provider_refresh_token:r,access_token:a,expires_in:d,expires_at:u,refresh_token:n,token_type:l,user:h.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:p,redirectType:e.type},error:null}}catch(s){if(wu(s))return{data:{session:null,redirectType:null},error:s};throw s}}_isImplicitGrantCallback(e){return Boolean(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await Qu(this.storage,`${this.storageKey}-code-verifier`);return!(!e.code||!t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var s;const{data:r,error:a}=t;if(a)return{error:a};const n=null===(s=r.session)||void 0===s?void 0:s.access_token;if(n){const{error:t}=await this.admin.signOut(n,e);if(t&&(!function(e){return wu(e)&&"AuthApiError"===e.name}(t)||404!==t.status&&401!==t.status&&403!==t.status))return{error:t}}return"others"!==e&&(await this._removeSession(),await Ju(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(async()=>{await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})})(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession(async t=>{var s,r;try{const{data:{session:r},error:a}=t;if(a)throw a;await(null===(s=this.stateChangeEmitters.get(e))||void 0===s?void 0:s.callback("INITIAL_SESSION",r)),this._debug("INITIAL_SESSION","callback id",e,"session",r)}catch(a){await(null===(r=this.stateChangeEmitters.get(e))||void 0===r?void 0:r.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",a)}})}async resetPasswordForEmail(e,t={}){let s=null,r=null;"pkce"===this.flowType&&([s,r]=await sh(this.storage,this.storageKey,!0));try{return await uh(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:r,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(a){if(wu(a))return{data:null,error:a};throw a}}async getUserIdentities(){var e;try{const{data:t,error:s}=await this.getUser();if(s)throw s;return{data:{identities:null!==(e=t.user.identities)&&void 0!==e?e:[]},error:null}}catch(t){if(wu(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:s,error:r}=await this._useSession(async t=>{var s,r,a,n,i;const{data:o,error:l}=t;if(l)throw l;const c=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:null===(s=e.options)||void 0===s?void 0:s.redirectTo,scopes:null===(r=e.options)||void 0===r?void 0:r.scopes,queryParams:null===(a=e.options)||void 0===a?void 0:a.queryParams,skipBrowserRedirect:!0});return await uh(this.fetch,"GET",c,{headers:this.headers,jwt:null!==(i=null===(n=o.session)||void 0===n?void 0:n.access_token)&&void 0!==i?i:void 0})});if(r)throw r;return Bu()&&!(null===(t=e.options)||void 0===t?void 0:t.skipBrowserRedirect)&&window.location.assign(null==s?void 0:s.url),{data:{provider:e.provider,url:null==s?void 0:s.url},error:null}}catch(s){if(wu(s))return{data:{provider:e.provider,url:null},error:s};throw s}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var s,r;const{data:a,error:n}=t;if(n)throw n;return await uh(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:null!==(r=null===(s=a.session)||void 0===s?void 0:s.access_token)&&void 0!==r?r:void 0})})}catch(t){if(wu(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const a=Date.now();return await(s=async s=>(s>0&&await async function(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}(200*Math.pow(2,s-1)),this._debug(t,"refreshing attempt",s),await uh(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:hh})),r=(e,t)=>{const s=200*Math.pow(2,e);return t&&Pu(t)&&Date.now()+s-a<fu},new Promise((e,t)=>{(async()=>{for(let a=0;a<1/0;a++)try{const t=await s(a);if(!r(a,null,t))return void e(t)}catch(zw){if(!r(a,zw))return void t(zw)}})()}))}catch(a){if(this._debug(t,"error",a),wu(a))return{data:{session:null,user:null},error:a};throw a}finally{this._debug(t,"end")}var s,r}_isValidSession(e){return"object"==typeof e&&null!==e&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),Bu()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e,t;const s="#_recoverAndRefresh()";this._debug(s,"begin");try{const a=await Qu(this.storage,this.storageKey);if(a&&this.userStorage){let t=await Qu(this.userStorage,this.storageKey+"-user");this.storage.isServer||!Object.is(this.storage,this.userStorage)||t||(t={user:a.user},await Gu(this.userStorage,this.storageKey+"-user",t)),a.user=null!==(e=null==t?void 0:t.user)&&void 0!==e?e:ih()}else if(a&&!a.user&&!a.user){const e=await Qu(this.storage,this.storageKey+"-user");e&&(null==e?void 0:e.user)?(a.user=e.user,await Ju(this.storage,this.storageKey+"-user"),await Gu(this.storage,this.storageKey,a)):a.user=ih()}if(this._debug(s,"session from storage",a),!this._isValidSession(a))return this._debug(s,"session is not valid"),void(null!==a&&await this._removeSession());const n=1e3*(null!==(t=a.expires_at)&&void 0!==t?t:1/0)-Date.now()<xu;if(this._debug(s,`session has${n?"":" not"} expired with margin of 90000s`),n){if(this.autoRefreshToken&&a.refresh_token){const{error:e}=await this._callRefreshToken(a.refresh_token);e&&(Pu(e)||(this._debug(s,"refresh failed with a non-retryable error, removing the session",e),await this._removeSession()))}}else if(a.user&&!0===a.user.__isUserNotAvailableProxy)try{const{data:e,error:t}=await this._getUser(a.access_token);!t&&(null==e?void 0:e.user)?(a.user=e.user,await this._saveSession(a),await this._notifyAllSubscribers("SIGNED_IN",a)):this._debug(s,"could not get user data, skipping SIGNED_IN notification")}catch(r){this._debug(s,"error getting user data, skipping SIGNED_IN notification",r)}else await this._notifyAllSubscribers("SIGNED_IN",a)}catch(a){return void this._debug(s,"error",a)}finally{this._debug(s,"end")}}async _callRefreshToken(e){var t,s;if(!e)throw new Su;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const r=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(r,"begin");try{this.refreshingDeferred=new Xu;const{data:t,error:s}=await this._refreshAccessToken(e);if(s)throw s;if(!t.session)throw new Su;await this._saveSession(t.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",t.session);const r={session:t.session,error:null};return this.refreshingDeferred.resolve(r),r}catch(a){if(this._debug(r,"error",a),wu(a)){const e={session:null,error:a};return Pu(a)||await this._removeSession(),null===(t=this.refreshingDeferred)||void 0===t||t.resolve(e),e}throw null===(s=this.refreshingDeferred)||void 0===s||s.reject(a),a}finally{this.refreshingDeferred=null,this._debug(r,"end")}}async _notifyAllSubscribers(e,t,s=!0){const r=`#_notifyAllSubscribers(${e})`;this._debug(r,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});const r=[],a=Array.from(this.stateChangeEmitters.values()).map(async s=>{try{await s.callback(e,t)}catch(zw){r.push(zw)}});if(await Promise.all(a),r.length>0){for(let e=0;e<r.length;e+=1);throw r[0]}}finally{this._debug(r,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),s=t.user&&!0===t.user.__isUserNotAvailableProxy;if(this.userStorage){!s&&t.user&&await Gu(this.userStorage,this.storageKey+"-user",{user:t.user});const e=Object.assign({},t);delete e.user;const r=oh(e);await Gu(this.storage,this.storageKey,r)}else{const e=oh(t);await Gu(this.storage,this.storageKey,e)}}async _removeSession(){this._debug("#_removeSession()"),await Ju(this.storage,this.storageKey),await Ju(this.storage,this.storageKey+"-code-verifier"),await Ju(this.storage,this.storageKey+"-user"),this.userStorage&&await Ju(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Bu()&&(null===window||void 0===window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(zw){}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),fu);this.autoRefreshTicker=e,e&&"object"==typeof e&&"function"==typeof e.unref?e.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:s}}=t;if(!s||!s.refresh_token||!s.expires_at)return void this._debug("#_autoRefreshTokenTick()","no session");const r=Math.floor((1e3*s.expires_at-e)/fu);this._debug("#_autoRefreshTokenTick()",`access token expires in ${r} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),r<=3&&await this._callRefreshToken(s.refresh_token)})}catch(zw){}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(zw){if(!(zw.isAcquireTimeout||zw instanceof wh))throw zw;this._debug("auto refresh token tick lock not available")}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Bu()||!(null===window||void 0===window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),null===window||void 0===window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{"visible"===document.visibilityState?await this._recoverAndRefresh():this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting")}))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,s){const r=[`provider=${encodeURIComponent(t)}`];if((null==s?void 0:s.redirectTo)&&r.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),(null==s?void 0:s.scopes)&&r.push(`scopes=${encodeURIComponent(s.scopes)}`),"pkce"===this.flowType){const[e,t]=await sh(this.storage,this.storageKey),s=new URLSearchParams({code_challenge:`${encodeURIComponent(e)}`,code_challenge_method:`${encodeURIComponent(t)}`});r.push(s.toString())}if(null==s?void 0:s.queryParams){const e=new URLSearchParams(s.queryParams);r.push(e.toString())}return(null==s?void 0:s.skipBrowserRedirect)&&r.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${r.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var s;const{data:r,error:a}=t;return a?{data:null,error:a}:await uh(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:null===(s=null==r?void 0:r.session)||void 0===s?void 0:s.access_token})})}catch(t){if(wu(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var s,r;const{data:a,error:n}=t;if(n)return{data:null,error:n};const i=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},"phone"===e.factorType?{phone:e.phone}:{issuer:e.issuer}),{data:o,error:l}=await uh(this.fetch,"POST",`${this.url}/factors`,{body:i,headers:this.headers,jwt:null===(s=null==a?void 0:a.session)||void 0===s?void 0:s.access_token});return l?{data:null,error:l}:("totp"===e.factorType&&(null===(r=null==o?void 0:o.totp)||void 0===r?void 0:r.qr_code)&&(o.totp.qr_code=`data:image/svg+xml;utf-8,${o.totp.qr_code}`),{data:o,error:null})})}catch(t){if(wu(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:r,error:a}=t;if(a)return{data:null,error:a};const{data:n,error:i}=await uh(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:null===(s=null==r?void 0:r.session)||void 0===s?void 0:s.access_token});return i?{data:null,error:i}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+n.expires_in},n)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",n),{data:n,error:i})})}catch(t){if(wu(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:r,error:a}=t;return a?{data:null,error:a}:await uh(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:null===(s=null==r?void 0:r.session)||void 0===s?void 0:s.access_token})})}catch(t){if(wu(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:s}=await this._challenge({factorId:e.factorId});return s?{data:null,error:s}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const s=(null==e?void 0:e.factors)||[],r=s.filter(e=>"totp"===e.factor_type&&"verified"===e.status),a=s.filter(e=>"phone"===e.factor_type&&"verified"===e.status);return{data:{all:s,totp:r,phone:a},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,s;const{data:{session:r},error:a}=e;if(a)return{data:null,error:a};if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:n}=Zu(r.access_token);let i=null;n.aal&&(i=n.aal);let o=i;(null!==(s=null===(t=r.user.factors)||void 0===t?void 0:t.filter(e=>"verified"===e.status))&&void 0!==s?s:[]).length>0&&(o="aal2");return{data:{currentLevel:i,nextLevel:o,currentAuthenticationMethods:n.amr||[]},error:null}}))}async fetchJwk(e,t={keys:[]}){let s=t.keys.find(t=>t.kid===e);if(s)return s;const r=Date.now();if(s=this.jwks.keys.find(t=>t.kid===e),s&&this.jwks_cached_at+6e5>r)return s;const{data:a,error:n}=await uh(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(n)throw n;return a.keys&&0!==a.keys.length?(this.jwks=a,this.jwks_cached_at=r,s=a.keys.find(t=>t.kid===e),s||null):null}async getClaims(e,t={}){try{let s=e;if(!s){const{data:e,error:t}=await this.getSession();if(t||!e.session)return{data:null,error:t};s=e.session.access_token}const{header:r,payload:a,signature:n,raw:{header:i,payload:o}}=Zu(s);(null==t?void 0:t.allowExpired)||function(e){if(!e)throw new Error("Missing exp claim");if(e<=Math.floor(Date.now()/1e3))throw new Error("JWT has expired")}(a.exp);const l=r.alg&&!r.alg.startsWith("HS")&&r.kid&&"crypto"in globalThis&&"subtle"in globalThis.crypto?await this.fetchJwk(r.kid,(null==t?void 0:t.keys)?{keys:t.keys}:null==t?void 0:t.jwks):null;if(!l){const{error:e}=await this.getUser(s);if(e)throw e;return{data:{claims:a,header:r,signature:n},error:null}}const c=function(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}(r.alg),d=await crypto.subtle.importKey("jwk",l,c,!0,["verify"]);if(!(await crypto.subtle.verify(c,d,n,Wu(`${i}.${o}`))))throw new Ru("Invalid JWT signature");return{data:{claims:a,header:r,signature:n},error:null}}catch(s){if(wu(s))return{data:null,error:s};throw s}}}Eh.nextInstanceID=0;const Mh=Eh;class Th extends Mh{constructor(e){super(e)}}var Ah=function(e,t,s,r){return new(s||(s=Promise))(function(a,n){function i(e){try{l(r.next(e))}catch(zw){n(zw)}}function o(e){try{l(r.throw(e))}catch(zw){n(zw)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(i,o)}l((r=r.apply(e,t||[])).next())})};class Ph{constructor(e,t,s){var r,a,n;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const i=(o=e).endsWith("/")?o:o+"/";var o;const l=new URL(i);this.realtimeUrl=new URL("realtime/v1",l),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",l),this.storageUrl=new URL("storage/v1",l),this.functionsUrl=new URL("functions/v1",l);const c=`sb-${l.hostname.split(".")[0]}-auth-token`,d=function(e,t){var s,r;const{db:a,auth:n,realtime:i,global:o}=e,{db:l,auth:c,realtime:d,global:u}=t,h={db:Object.assign(Object.assign({},l),a),auth:Object.assign(Object.assign({},c),n),realtime:Object.assign(Object.assign({},d),i),storage:{},global:Object.assign(Object.assign(Object.assign({},u),o),{headers:Object.assign(Object.assign({},null!==(s=null==u?void 0:u.headers)&&void 0!==s?s:{}),null!==(r=null==o?void 0:o.headers)&&void 0!==r?r:{})}),accessToken:()=>mu(this,void 0,void 0,function*(){return""})};return e.accessToken?h.accessToken=e.accessToken:delete h.accessToken,h}(null!=s?s:{},{db:lu,realtime:du,auth:Object.assign(Object.assign({},cu),{storageKey:c}),global:ou});this.storageKey=null!==(r=d.auth.storageKey)&&void 0!==r?r:"",this.headers=null!==(a=d.global.headers)&&void 0!==a?a:{},d.accessToken?(this.accessToken=d.accessToken,this.auth=new Proxy({},{get:(e,t)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(t)} is not possible`)}})):this.auth=this._initSupabaseAuthClient(null!==(n=d.auth)&&void 0!==n?n:{},this.headers,d.global.fetch),this.fetch=hu(t,this._getAccessToken.bind(this),d.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},d.realtime)),this.rest=new Uc(new URL("rest/v1",l).href,{headers:this.headers,schema:d.db.schema,fetch:this.fetch}),this.storage=new nu(this.storageUrl.href,this.headers,this.fetch,null==s?void 0:s.storage),d.accessToken||this._listenForAuthEvents()}get functions(){return new Zl(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return Ah(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:s}=yield this.auth.getSession();return null!==(t=null===(e=s.session)||void 0===e?void 0:e.access_token)&&void 0!==t?t:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:r,storageKey:a,flowType:n,lock:i,debug:o},l,c){const d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Th({url:this.authUrl.href,headers:Object.assign(Object.assign({},d),l),storageKey:a,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:r,flowType:n,lock:i,debug:o,fetch:c,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new Od(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},null==e?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,"CLIENT",null==t?void 0:t.access_token)})}_handleTokenChanged(e,t,s){"TOKEN_REFRESHED"!==e&&"SIGNED_IN"!==e||this.changedAccessToken===s?"SIGNED_OUT"===e&&(this.realtime.setAuth(),"STORAGE"==t&&this.auth.signOut(),this.changedAccessToken=void 0):this.changedAccessToken=s}}!function(){if("undefined"!=typeof window)return!1;if("undefined"==typeof process)return!1;const e=process.version;if(null==e)return!1;const t=e.match(/^v(\d+)\./);!!t&&parseInt(t[1],10)}();const Dh=(Rh={auth:{storage:localStorage,persistSession:!0,autoRefreshToken:!0}},new Ph("https://nyhsodozcijlfkmveabi.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im55aHNvZG96Y2lqbGZrbXZlYWJpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ3MjM0ODQsImV4cCI6MjA3MDI5OTQ4NH0.s7lbiFh-lChmxE6qVbKMjYy_XmjBpqbMzdml0yT225I",Rh));var Rh;const Oh=Nt.createContext(void 0);function qh({children:e}){const[t,s]=Nt.useState(null),[r,a]=Nt.useState(null),[n,i]=Nt.useState(!0),[o,l]=Nt.useState(!1),c=pl(),d=async()=>{await Dh.auth.signOut(),a(null),c("/login",{replace:!0})};Nt.useEffect(()=>{Dh.auth.getSession().then(({data:{session:e}})=>{s((null==e?void 0:e.user)??null),(null==e?void 0:e.user)?u(e.user.id):i(!1)});const{data:{subscription:e}}=Dh.auth.onAuthStateChange((e,t)=>{s((null==t?void 0:t.user)??null),(null==t?void 0:t.user)?setTimeout(()=>{u(t.user.id)},0):(a(null),i(!1))});return()=>e.unsubscribe()},[]),Nt.useEffect(()=>{if(!n&&!o)if(t){const e=window.location.pathname;if(!r)return;switch(r.status){case"pending":"/pending"!==e&&c("/pending",{replace:!0});break;case"rejected":d();break;case"active":"/login"!==e&&"/pending"!==e||(["SuperAdmin","Admin"].includes(r.role)?c("/admin",{replace:!0}):c("/dashboard",{replace:!0}))}}else{"/login"!==window.location.pathname&&c("/login",{replace:!0})}},[t,r,n,o,c]),Nt.useEffect(()=>{!n&&t&&r&&"rejected"===r.status&&d()},[null==r?void 0:r.status,t,n,d]);const u=async e=>{var t,s;i(!0);try{const{data:r,error:n}=await Dh.from("users").select("*").eq("auth_id",e).maybeSingle();if(n)a(null);else if(r)a(r);else try{l(!0);const{data:r}=await Dh.auth.getUser(),n=null==r?void 0:r.user,i=(null==n?void 0:n.email)??"",o=(null==(t=null==n?void 0:n.user_metadata)?void 0:t.first_name)??"Utilisateur",c=(null==(s=null==n?void 0:n.user_metadata)?void 0:s.last_name)??"Nouveau",{data:d,error:u}=await Dh.from("users").insert({auth_id:e,email:i,first_name:o,last_name:c,role:"Vendeur",status:"pending"}).select("*").maybeSingle();a(u?null:d??null),l(!1)}catch(zw){a(null),l(!1)}}catch(r){a(null)}finally{i(!1)}},h={user:t,userProfile:r,loading:n,signIn:async(e,t)=>{const{error:s}=await Dh.auth.signInWithPassword({email:e,password:t});if(s)throw s},signUp:async(e,t,s,r)=>{const a=`${window.location.origin}/`,{error:n}=await Dh.auth.signUp({email:e,password:t,options:{emailRedirectTo:a,data:{first_name:s,last_name:r}}});if(n)throw n},signOut:d};return Ne.jsx(Oh.Provider,{value:h,children:e})}function Ih(){const e=Nt.useContext(Oh);if(void 0===e)throw new Error("useAuth must be used within an AuthProvider");return e}const Fh=[{key:"dashboard",label:"Tableau de bord",path:"/dashboard",allowedRoles:["Vendeur","Manager","Admin","SuperAdmin"],group:"Navigation"},{key:"products",label:"Produits",path:"/products",allowedRoles:["Vendeur","Manager","Admin","SuperAdmin"],group:"Navigation"},{key:"arrivals",label:"Arrivage",path:"/arrivals",allowedRoles:["Manager","Admin","SuperAdmin"],group:"Navigation"},{key:"purchases",label:"Achat",path:"/purchases",allowedRoles:["Admin","SuperAdmin"],group:"Navigation"},{key:"sales",label:"Ventes",path:"/sales",allowedRoles:["Vendeur","Manager","Admin","SuperAdmin"],group:"Navigation"},{key:"returns",label:"Retour & changes",path:"/returns",allowedRoles:["Vendeur","Manager","Admin","SuperAdmin"],group:"Navigation"},{key:"transfers",label:"Transferts",path:"/transfers",allowedRoles:["SuperAdmin"],group:"Navigation"},{key:"inventory",label:"Inventaire",path:"/inventory",allowedRoles:["Manager","Admin","SuperAdmin"],group:"Navigation"},{key:"users",label:"Utilisateurs",path:"/users",allowedRoles:["Admin","SuperAdmin"],group:"Administration"},{key:"stores",label:"Magasins",path:"/stores",allowedRoles:["Admin","SuperAdmin"],group:"Administration"},{key:"suppliers",label:"Fournisseurs",path:"/suppliers",allowedRoles:["Admin","SuperAdmin"],group:"Administration"},{key:"financial",label:"Finances",path:"/financial",allowedRoles:["Admin","SuperAdmin"],group:"Administration"},{key:"analytics",label:"Analytics",path:"/analytics",allowedRoles:["Admin","SuperAdmin"],group:"Administration"},{key:"reports",label:"Rapports",path:"/reports",allowedRoles:["Admin","SuperAdmin"],group:"Administration"},{key:"configuration",label:"Configuration",path:"/configuration",allowedRoles:["SuperAdmin"],group:"Administration"},{key:"profile",label:"Profil",path:"/profile",allowedRoles:["Vendeur","Manager","Admin","SuperAdmin"],group:"Utilisateur"},{key:"settings",label:"Paramtres",path:"/settings",allowedRoles:["Admin","SuperAdmin"],group:"Utilisateur"},{key:"gamification",label:"Gamification",path:"/gamification",allowedRoles:["Admin","SuperAdmin"],group:"Utilisateur"}];const Lh="security.pageAccess";function $h(){const[e,t]=Nt.useState(!0),[s,r]=Nt.useState({}),[a,n]=Nt.useState(null),[i,o]=Nt.useState(null),l=Nt.useCallback(async()=>{t(!0),o(null);try{const{data:e,error:t}=await Dh.from("system_settings").select("id, setting_value, setting_type").eq("setting_key",Lh).maybeSingle();if(t)throw t;if(n((null==e?void 0:e.id)??null),null==e?void 0:e.setting_value){const t=e.setting_value,s="string"==typeof t?JSON.parse(t):t;r(s||{})}else r({})}catch(zw){o((null==zw?void 0:zw.message)||"Erreur de chargement des accs"),r({})}finally{t(!1)}},[]);Nt.useEffect(()=>{l()},[l]);const c=Nt.useCallback(async e=>{const t={setting_key:Lh,setting_value:e,setting_type:"json",category:"security",updated_at:(new Date).toISOString()};if(a){const{error:e}=await Dh.from("system_settings").update(t).eq("id",a);if(e)throw e}else{const{data:e,error:s}=await Dh.from("system_settings").insert(t).select("id").single();if(s)throw s;n(e.id)}r(e)},[a]),d=Nt.useCallback(async(e,t,r)=>{const a={...s,[e]:{...s[e]||{},[t]:r}};await c(a)},[s,c]),u=Nt.useCallback(async(e,t)=>{const r={...s,[e]:{...s[e]||{},...t}};await c(r)},[s,c]),h=Nt.useCallback((e,t)=>{const r=function(e){const t={};for(const s of Fh)t[s.key]=s.allowedRoles.includes(e);return t}(t);return{...r,...s[e]||{}}},[s]);return{loading:e,error:i,store:s,fetchStore:l,setSingle:d,setMany:u,getEffectiveAccess:h}}function zh(e,t){const{loading:s,error:r,store:a,getEffectiveAccess:n}=$h();return{loading:s,error:r,access:Nt.useMemo(()=>e&&t?n(e,t):null,[a,e,t,n])}}function Uh({children:e,allowedRoles:t,pageKey:s}){const{user:r,userProfile:a,loading:n}=Ih(),{access:i}=zh(null==a?void 0:a.id,null==a?void 0:a.role);return n?Ne.jsx("div",{className:"min-h-screen flex items-center justify-center",children:Ne.jsxs("div",{className:"text-center",children:[Ne.jsx("div",{className:"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),Ne.jsx("p",{className:"text-muted-foreground",children:"Chargement..."})]})}):r&&a?"active"!==a.status?null:t&&!t.includes(a.role)?Ne.jsx("div",{className:"min-h-screen flex items-center justify-center",children:Ne.jsxs("div",{className:"text-center",children:[Ne.jsx("h1",{className:"text-2xl font-bold text-destructive mb-4",children:"Accs refus"}),Ne.jsx("p",{className:"text-muted-foreground",children:"Vous n'avez pas les permissions ncessaires pour accder  cette page."})]})}):s&&i&&!1===i[s]?Ne.jsx("div",{className:"min-h-screen flex items-center justify-center",children:Ne.jsxs("div",{className:"text-center",children:[Ne.jsx("h1",{className:"text-2xl font-bold text-destructive mb-4",children:"Page dsactive"}),Ne.jsx("p",{className:"text-muted-foreground",children:"Cette page est dsactive pour votre compte."})]})}):Ne.jsx(Ne.Fragment,{children:e}):null}const Wh=Xs("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-lg text-sm font-medium ring-offset-background transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-gradient-primary text-primary-foreground hover:shadow-elevated transform hover:scale-[1.02]",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",success:"bg-gradient-success text-success-foreground hover:shadow-elevated transform hover:scale-[1.02]",warning:"bg-warning text-warning-foreground hover:bg-warning/90"},size:{default:"h-12 px-6 py-3",sm:"h-10 rounded-lg px-4",lg:"h-14 rounded-xl px-8 text-base",icon:"h-12 w-12",touch:"h-14 px-6 text-base min-w-[120px]"}},defaultVariants:{variant:"default",size:"default"}}),Vh=Nt.forwardRef(({className:e,variant:t,size:s,asChild:r=!1,...a},n)=>{const i=r?Be:"button";return Ne.jsx(i,{className:un(Wh({variant:t,size:s,className:e})),ref:n,...a})});Vh.displayName="Button";const Bh=Nt.forwardRef(({className:e,type:t,...s},r)=>Ne.jsx("input",{type:t,className:un("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:r,...s}));Bh.displayName="Input";var Hh="horizontal",Kh=["horizontal","vertical"],Yh=Nt.forwardRef((e,t)=>{const{decorative:s,orientation:r=Hh,...a}=e,n=function(e){return Kh.includes(e)}(r)?r:Hh,i=s?{role:"none"}:{"aria-orientation":"vertical"===n?n:void 0,role:"separator"};return Ne.jsx(_e.div,{"data-orientation":n,...i,...a,ref:t})});Yh.displayName="Separator";var Gh=Yh;const Qh=Nt.forwardRef(({className:e,orientation:t="horizontal",decorative:s=!0,...r},a)=>Ne.jsx(Gh,{ref:a,decorative:s,orientation:t,className:un("shrink-0 bg-border","horizontal"===t?"h-[1px] w-full":"h-full w-[1px]",e),...r}));Qh.displayName=Gh.displayName;const Jh=Xe,Xh=Ke,Zh=Nt.forwardRef(({className:e,...t},s)=>Ne.jsx(He,{className:un("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:s}));Zh.displayName=He.displayName;const em=Xs("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),tm=Nt.forwardRef(({side:e="right",className:t,children:s,...r},a)=>Ne.jsxs(Xh,{children:[Ne.jsx(Zh,{}),Ne.jsxs(Ye,{ref:a,className:un(em({side:e}),t),...r,children:[s,Ne.jsxs(Ge,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[Ne.jsx(xa,{className:"h-4 w-4"}),Ne.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));tm.displayName=Ye.displayName;Nt.forwardRef(({className:e,...t},s)=>Ne.jsx(Qe,{ref:s,className:un("text-lg font-semibold text-foreground",e),...t})).displayName=Qe.displayName;function sm({className:e,...t}){return Ne.jsx("div",{className:un("animate-pulse rounded-md bg-muted",e),...t})}Nt.forwardRef(({className:e,...t},s)=>Ne.jsx(Je,{ref:s,className:un("text-sm text-muted-foreground",e),...t})).displayName=Je.displayName;const rm=Nt.createContext(null);function am(){const e=Nt.useContext(rm);if(!e)throw new Error("useSidebar must be used within a SidebarProvider.");return e}const nm=Nt.forwardRef(({defaultOpen:e=!0,open:t,onOpenChange:s,className:r,style:a,children:n,...i},o)=>{const l=function(){const[e,t]=Nt.useState(void 0);return Nt.useEffect(()=>{const e=window.matchMedia("(max-width: 767px)"),s=()=>{t(window.innerWidth<768)};return e.addEventListener("change",s),t(window.innerWidth<768),()=>e.removeEventListener("change",s)},[]),!!e}(),[c,d]=Nt.useState(!1),[u,h]=Nt.useState(e),m=t??u,p=Nt.useCallback(e=>{const t="function"==typeof e?e(m):e;s?s(t):h(t),document.cookie=`sidebar:state=${t}; path=/; max-age=604800`},[s,m]),f=Nt.useCallback(()=>l?d(e=>!e):p(e=>!e),[l,p,d]);Nt.useEffect(()=>{const e=e=>{"b"===e.key&&(e.metaKey||e.ctrlKey)&&(e.preventDefault(),f())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[f]);const x=m?"expanded":"collapsed",g=Nt.useMemo(()=>({state:x,open:m,setOpen:p,isMobile:l,openMobile:c,setOpenMobile:d,toggleSidebar:f}),[x,m,p,l,c,d,f]);return Ne.jsx(rm.Provider,{value:g,children:Ne.jsx(fi,{delayDuration:0,children:Ne.jsx("div",{style:{"--sidebar-width":"16rem","--sidebar-width-icon":"3rem",...a},className:un("group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar",r),ref:o,...i,children:n})})})});nm.displayName="SidebarProvider";const im=Nt.forwardRef(({side:e="left",variant:t="sidebar",collapsible:s="offcanvas",className:r,children:a,...n},i)=>{const{isMobile:o,state:l,openMobile:c,setOpenMobile:d}=am();return"none"===s?Ne.jsx("div",{className:un("flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground",r),ref:i,...n,children:a}):o?Ne.jsx(Jh,{open:c,onOpenChange:d,...n,children:Ne.jsx(tm,{"data-sidebar":"sidebar","data-mobile":"true",className:"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden",style:{"--sidebar-width":"18rem"},side:e,children:Ne.jsx("div",{className:"flex h-full w-full flex-col",children:a})})}):Ne.jsxs("div",{ref:i,className:"group peer hidden md:block text-sidebar-foreground","data-state":l,"data-collapsible":"collapsed"===l?s:"","data-variant":t,"data-side":e,children:[Ne.jsx("div",{className:un("duration-200 relative h-svh w-[--sidebar-width] bg-transparent transition-[width] ease-linear","group-data-[collapsible=offcanvas]:w-0","group-data-[side=right]:rotate-180","floating"===t||"inset"===t?"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon]")}),Ne.jsx("div",{className:un("duration-200 fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] ease-linear md:flex","left"===e?"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]":"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]","floating"===t||"inset"===t?"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l",r),...n,children:Ne.jsx("div",{"data-sidebar":"sidebar",className:"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow",children:a})})]})});im.displayName="Sidebar";Nt.forwardRef(({className:e,onClick:t,...s},r)=>{const{toggleSidebar:a}=am();return Ne.jsxs(Vh,{ref:r,"data-sidebar":"trigger",variant:"ghost",size:"icon",className:un("h-7 w-7",e),onClick:e=>{null==t||t(e),a()},...s,children:[Ne.jsx(Vr,{}),Ne.jsx("span",{className:"sr-only",children:"Toggle Sidebar"})]})}).displayName="SidebarTrigger";Nt.forwardRef(({className:e,...t},s)=>{const{toggleSidebar:r}=am();return Ne.jsx("button",{ref:s,"data-sidebar":"rail","aria-label":"Toggle Sidebar",tabIndex:-1,onClick:r,title:"Toggle Sidebar",className:un("absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex","[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize","[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize","group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar","[[data-side=left][data-collapsible=offcanvas]_&]:-right-2","[[data-side=right][data-collapsible=offcanvas]_&]:-left-2",e),...t})}).displayName="SidebarRail";Nt.forwardRef(({className:e,...t},s)=>Ne.jsx("main",{ref:s,className:un("relative flex min-h-svh flex-1 flex-col bg-background","peer-data-[variant=inset]:min-h-[calc(100svh-theme(spacing.4))] md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow",e),...t})).displayName="SidebarInset";Nt.forwardRef(({className:e,...t},s)=>Ne.jsx(Bh,{ref:s,"data-sidebar":"input",className:un("h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring",e),...t})).displayName="SidebarInput";const om=Nt.forwardRef(({className:e,...t},s)=>Ne.jsx("div",{ref:s,"data-sidebar":"header",className:un("flex flex-col gap-2 p-2",e),...t}));om.displayName="SidebarHeader";Nt.forwardRef(({className:e,...t},s)=>Ne.jsx("div",{ref:s,"data-sidebar":"footer",className:un("flex flex-col gap-2 p-2",e),...t})).displayName="SidebarFooter";Nt.forwardRef(({className:e,...t},s)=>Ne.jsx(Qh,{ref:s,"data-sidebar":"separator",className:un("mx-2 w-auto bg-sidebar-border",e),...t})).displayName="SidebarSeparator";const lm=Nt.forwardRef(({className:e,...t},s)=>Ne.jsx("div",{ref:s,"data-sidebar":"content",className:un("flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden",e),...t}));lm.displayName="SidebarContent";const cm=Nt.forwardRef(({className:e,...t},s)=>Ne.jsx("div",{ref:s,"data-sidebar":"group",className:un("relative flex w-full min-w-0 flex-col p-2",e),...t}));cm.displayName="SidebarGroup";const dm=Nt.forwardRef(({className:e,asChild:t=!1,...s},r)=>{const a=t?Be:"div";return Ne.jsx(a,{ref:r,"data-sidebar":"group-label",className:un("duration-200 flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opa] ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0",e),...s})});dm.displayName="SidebarGroupLabel";Nt.forwardRef(({className:e,asChild:t=!1,...s},r)=>{const a=t?Be:"button";return Ne.jsx(a,{ref:r,"data-sidebar":"group-action",className:un("absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","group-data-[collapsible=icon]:hidden",e),...s})}).displayName="SidebarGroupAction";const um=Nt.forwardRef(({className:e,...t},s)=>Ne.jsx("div",{ref:s,"data-sidebar":"group-content",className:un("w-full text-sm",e),...t}));um.displayName="SidebarGroupContent";const hm=Nt.forwardRef(({className:e,...t},s)=>Ne.jsx("ul",{ref:s,"data-sidebar":"menu",className:un("flex w-full min-w-0 flex-col gap-1",e),...t}));hm.displayName="SidebarMenu";const mm=Nt.forwardRef(({className:e,...t},s)=>Ne.jsx("li",{ref:s,"data-sidebar":"menu-item",className:un("group/menu-item relative",e),...t}));mm.displayName="SidebarMenuItem";const pm=Xs("peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",{variants:{variant:{default:"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",outline:"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]"},size:{default:"h-8 text-sm",sm:"h-7 text-xs",lg:"h-12 text-sm group-data-[collapsible=icon]:!p-0"}},defaultVariants:{variant:"default",size:"default"}}),fm=Nt.forwardRef(({asChild:e=!1,isActive:t=!1,variant:s="default",size:r="default",tooltip:a,className:n,...i},o)=>{const l=e?Be:"button",{isMobile:c,state:d}=am(),u=Ne.jsx(l,{ref:o,"data-sidebar":"menu-button","data-size":r,"data-active":t,className:un(pm({variant:s,size:r}),n),...i});return a?("string"==typeof a&&(a={children:a}),Ne.jsxs(xi,{children:[Ne.jsx(gi,{asChild:!0,children:u}),Ne.jsx(vi,{side:"right",align:"center",hidden:"collapsed"!==d||c,...a})]})):u});fm.displayName="SidebarMenuButton";Nt.forwardRef(({className:e,asChild:t=!1,showOnHover:s=!1,...r},a)=>{const n=t?Be:"button";return Ne.jsx(n,{ref:a,"data-sidebar":"menu-action",className:un("absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",s&&"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0",e),...r})}).displayName="SidebarMenuAction";Nt.forwardRef(({className:e,...t},s)=>Ne.jsx("div",{ref:s,"data-sidebar":"menu-badge",className:un("absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground select-none pointer-events-none","peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",e),...t})).displayName="SidebarMenuBadge";Nt.forwardRef(({className:e,showIcon:t=!1,...s},r)=>{const a=Nt.useMemo(()=>`${Math.floor(40*Math.random())+50}%`,[]);return Ne.jsxs("div",{ref:r,"data-sidebar":"menu-skeleton",className:un("rounded-md h-8 flex gap-2 px-2 items-center",e),...s,children:[t&&Ne.jsx(sm,{className:"size-4 rounded-md","data-sidebar":"menu-skeleton-icon"}),Ne.jsx(sm,{className:"h-4 flex-1 max-w-[--skeleton-width]","data-sidebar":"menu-skeleton-text",style:{"--skeleton-width":a}})]})}).displayName="SidebarMenuSkeleton";Nt.forwardRef(({className:e,...t},s)=>Ne.jsx("ul",{ref:s,"data-sidebar":"menu-sub",className:un("mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5","group-data-[collapsible=icon]:hidden",e),...t})).displayName="SidebarMenuSub";Nt.forwardRef(({...e},t)=>Ne.jsx("li",{ref:t,...e})).displayName="SidebarMenuSubItem";Nt.forwardRef(({asChild:e=!1,size:t="md",isActive:s,className:r,...a},n)=>{const i=e?Be:"a";return Ne.jsx(i,{ref:n,"data-sidebar":"menu-sub-button","data-size":t,"data-active":s,className:un("flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground","data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground","sm"===t&&"text-xs","md"===t&&"text-sm","group-data-[collapsible=icon]:hidden",r),...a})}).displayName="SidebarMenuSubButton";var xm="Collapsible",[gm,vm]=ke(xm),[jm,ym]=gm(xm),bm=Nt.forwardRef((e,t)=>{const{__scopeCollapsible:s,open:r,defaultOpen:a,disabled:n,onOpenChange:i,...o}=e,[l,c]=Me({prop:r,defaultProp:a??!1,onChange:i,caller:xm});return Ne.jsx(jm,{scope:s,disabled:n,contentId:ze(),open:l,onOpenToggle:Nt.useCallback(()=>c(e=>!e),[c]),children:Ne.jsx(_e.div,{"data-state":Cm(l),"data-disabled":n?"":void 0,...o,ref:t})})});bm.displayName=xm;var wm="CollapsibleTrigger",Nm=Nt.forwardRef((e,t)=>{const{__scopeCollapsible:s,...r}=e,a=ym(wm,s);return Ne.jsx(_e.button,{type:"button","aria-controls":a.contentId,"aria-expanded":a.open||!1,"data-state":Cm(a.open),"data-disabled":a.disabled?"":void 0,disabled:a.disabled,...r,ref:t,onClick:Ae(e.onClick,a.onOpenToggle)})});Nm.displayName=wm;var _m="CollapsibleContent",km=Nt.forwardRef((e,t)=>{const{forceMount:s,...r}=e,a=ym(_m,e.__scopeCollapsible);return Ne.jsx(Te,{present:s||a.open,children:({present:e})=>Ne.jsx(Sm,{...r,ref:t,present:e})})});km.displayName=_m;var Sm=Nt.forwardRef((e,t)=>{const{__scopeCollapsible:s,present:r,children:a,...n}=e,i=ym(_m,s),[o,l]=Nt.useState(r),c=Nt.useRef(null),d=Ce(t,c),u=Nt.useRef(0),h=u.current,m=Nt.useRef(0),p=m.current,f=i.open||o,x=Nt.useRef(f),g=Nt.useRef(void 0);return Nt.useEffect(()=>{const e=requestAnimationFrame(()=>x.current=!1);return()=>cancelAnimationFrame(e)},[]),Oe(()=>{const e=c.current;if(e){g.current=g.current||{transitionDuration:e.style.transitionDuration,animationName:e.style.animationName},e.style.transitionDuration="0s",e.style.animationName="none";const t=e.getBoundingClientRect();u.current=t.height,m.current=t.width,x.current||(e.style.transitionDuration=g.current.transitionDuration,e.style.animationName=g.current.animationName),l(r)}},[i.open,r]),Ne.jsx(_e.div,{"data-state":Cm(i.open),"data-disabled":i.disabled?"":void 0,id:i.contentId,hidden:!f,...n,ref:d,style:{"--radix-collapsible-content-height":h?`${h}px`:void 0,"--radix-collapsible-content-width":p?`${p}px`:void 0,...e.style},children:f&&a})});function Cm(e){return e?"open":"closed"}const Em=bm,Mm=Nm,Tm=km,Am=[{title:"Tableau de bord",url:"/dashboard",icon:Dr,key:"dashboard",roles:["Vendeur","Manager","Admin","SuperAdmin"]},{title:"Produits",url:"/products",icon:Ur,key:"products",roles:["Vendeur","Manager","Admin","SuperAdmin"]},{title:"Arrivage",url:"/arrivals",icon:la,key:"arrivals",roles:["Manager","Admin","SuperAdmin"]},{title:"Achat",url:"/purchases",icon:ta,key:"purchases",roles:["Admin","SuperAdmin"]},{title:"Ventes",url:"/sales",icon:ia,key:"sales",roles:["Vendeur","Manager","Admin","SuperAdmin"]},{title:"Retour & changes",url:"/returns",icon:Gr,key:"returns",roles:["Vendeur","Manager","Admin","SuperAdmin"]},{title:"Transferts",url:"/transfers",icon:la,key:"transfers",roles:["SuperAdmin"]},{title:"Inventaire",url:"/inventory",icon:pa,key:"inventory",roles:["Manager","Admin","SuperAdmin"]}],Pm=[{title:"Utilisateurs",url:"/users",icon:ma,key:"users",roles:["Admin","SuperAdmin"]},{title:"Magasins",url:"/stores",icon:ra,key:"stores",roles:["Admin","SuperAdmin"]},{title:"Fournisseurs",url:"/suppliers",icon:cr,key:"suppliers",roles:["Admin","SuperAdmin"]},{title:"Finances",url:"/financial",icon:_r,key:"financial",roles:["Admin","SuperAdmin"]},{title:"Analytics",url:"/analytics",icon:or,key:"analytics",roles:["Admin","SuperAdmin"]},{title:"Rapports",url:"/reports",icon:Kr,key:"reports",roles:["Admin","SuperAdmin"]},{title:"Configuration",url:"/configuration",icon:Zr,key:"configuration",roles:["Admin","SuperAdmin"]}],Dm=[{title:"Profil",url:"/profile",icon:ha,key:"profile",roles:["Vendeur","Manager","Admin","SuperAdmin"]},{title:"Paramtres",url:"/settings",icon:Zr,key:"settings",roles:["Vendeur","Manager","Admin","SuperAdmin"]},{title:"Gamification",url:"/gamification",icon:oa,key:"gamification",roles:["Vendeur","Manager","Admin","SuperAdmin"]}];function Rm({userRole:e,isMobileOpen:t,onMobileToggle:s}){const{state:r}=am(),a=hl(),n=a.pathname,i="collapsed"===r,{userProfile:o}=Ih(),{access:l}=zh(null==o?void 0:o.id,e),[c,d]=Nt.useState(!1),[u,h]=Nt.useState({main:!0,admin:!0,user:!0});Nt.useEffect(()=>{const e=()=>{const e=window.innerWidth<1024;e!==c&&d(e)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[c]),Nt.useEffect(()=>{},[t,c,n]);const m=({isActive:e})=>e?"bg-primary/10 text-primary font-medium border-r-2 border-primary":"hover:bg-accent/50 text-muted-foreground hover:text-foreground",p=e=>!e||!l||!1!==l[e],f=Am.filter(t=>t.roles.includes(e)&&p(t.key)),x=Pm.filter(t=>t.roles.includes(e)&&p(t.key)),g=Dm.filter(t=>t.roles.includes(e)&&p(t.key)),v=e=>{h(t=>({...t,[e]:!t[e]}))},j=()=>{t&&s()};Nt.useEffect(()=>{if(c&&t){const e=setTimeout(()=>{s()},300);return()=>clearTimeout(e)}},[a.pathname]);const y=()=>Ne.jsxs("div",{className:"lg:hidden",children:[Ne.jsx("div",{className:"fixed inset-0 z-50 bg-black/50",onClick:j}),Ne.jsxs("div",{className:"fixed left-0 top-0 h-full w-80 bg-background border-r shadow-xl z-50 transform transition-transform duration-300 ease-in-out",children:[Ne.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[Ne.jsxs("div",{className:"flex items-center gap-3",children:[Ne.jsx("img",{src:"/logo.png",alt:"Logo",className:"w-8 h-8 rounded"}),Ne.jsxs("div",{children:[Ne.jsx("h1",{className:"text-xl font-bold text-primary",children:"GesFlex"}),Ne.jsx("p",{className:"text-xs text-muted-foreground",children:"Gestion de vente"})]})]}),Ne.jsx(Vh,{variant:"ghost",size:"icon",onClick:j,className:"h-8 w-8",children:Ne.jsx(xa,{className:"h-4 w-4"})})]}),Ne.jsxs("div",{className:"p-4 space-y-6 overflow-y-auto h-[calc(100vh-80px)]",children:[Ne.jsx("div",{children:Ne.jsxs(Em,{open:u.main,onOpenChange:()=>v("main"),children:[Ne.jsx(Mm,{asChild:!0,children:Ne.jsxs(Vh,{variant:"ghost",className:"w-full justify-between h-10 px-3",children:[Ne.jsx("span",{className:"font-medium",children:"Navigation principale"}),u.main?Ne.jsx(pr,{className:"h-4 w-4"}):Ne.jsx(xr,{className:"h-4 w-4"})]})}),Ne.jsx(Tm,{className:"space-y-1 mt-2",children:f.map(e=>Ne.jsxs(Ll,{to:e.url,className:({isActive:e})=>"flex items-center gap-3 px-3 py-2 rounded-lg text-sm transition-colors "+(e?"bg-primary/10 text-primary font-medium":"text-muted-foreground hover:text-foreground hover:bg-accent/50"),onClick:j,children:[Ne.jsx(e.icon,{className:"w-4 h-4 shrink-0"}),Ne.jsx("span",{children:e.title})]},e.title))})]})}),x.length>0&&Ne.jsx("div",{children:Ne.jsxs(Em,{open:u.admin,onOpenChange:()=>v("admin"),children:[Ne.jsx(Mm,{asChild:!0,children:Ne.jsxs(Vh,{variant:"ghost",className:"w-full justify-between h-10 px-3",children:[Ne.jsx("span",{className:"font-medium",children:"Administration"}),u.admin?Ne.jsx(pr,{className:"h-4 w-4"}):Ne.jsx(xr,{className:"h-4 w-4"})]})}),Ne.jsx(Tm,{className:"space-y-1 mt-2",children:x.map(e=>Ne.jsxs(Ll,{to:e.url,className:({isActive:e})=>"flex items-center gap-3 px-3 py-2 rounded-lg text-sm transition-colors "+(e?"bg-primary/10 text-primary font-medium":"text-muted-foreground hover:text-foreground hover:bg-accent/50"),onClick:j,children:[Ne.jsx(e.icon,{className:"w-4 h-4 shrink-0"}),Ne.jsx("span",{children:e.title})]},e.title))})]})}),g.length>0&&Ne.jsx("div",{children:Ne.jsxs(Em,{open:u.user,onOpenChange:()=>v("user"),children:[Ne.jsx(Mm,{asChild:!0,children:Ne.jsxs(Vh,{variant:"ghost",className:"w-full justify-between h-10 px-3",children:[Ne.jsx("span",{className:"font-medium",children:"Utilisateur"}),u.user?Ne.jsx(pr,{className:"h-4 w-4"}):Ne.jsx(xr,{className:"h-4 w-4"})]})}),Ne.jsx(Tm,{className:"space-y-1 mt-2",children:g.map(e=>Ne.jsxs(Ll,{to:e.url,className:({isActive:e})=>"flex items-center gap-3 px-3 py-2 rounded-lg text-sm transition-colors "+(e?"bg-primary/10 text-primary font-medium":"text-muted-foreground hover:text-foreground hover:bg-accent/50"),onClick:j,children:[Ne.jsx(e.icon,{className:"w-4 h-4 shrink-0"}),Ne.jsx("span",{children:e.title})]},e.title))})]})})]})]})]});return Ne.jsxs(Ne.Fragment,{children:[Ne.jsxs(im,{className:(i?"w-16":"w-64")+" border-r bg-gradient-to-b from-primary/5 to-background transition-all duration-300 hidden lg:block",children:[Ne.jsx(om,{className:"p-4",children:Ne.jsxs("div",{className:"flex items-center gap-3",children:[Ne.jsx("img",{src:"/logo.png",alt:"Logo",className:"w-8 h-8 rounded"}),!i&&Ne.jsxs("div",{children:[Ne.jsx("h1",{className:"text-xl font-bold text-primary",children:"GesFlex"}),Ne.jsx("p",{className:"text-xs text-muted-foreground",children:"Gestion de vente"})]})]})}),Ne.jsxs(lm,{className:"px-2",children:[Ne.jsxs(cm,{children:[Ne.jsx(dm,{className:i?"sr-only":"",children:"Navigation principale"}),Ne.jsx(um,{children:Ne.jsx(hm,{children:f.map(e=>Ne.jsx(mm,{children:Ne.jsx(fm,{asChild:!0,className:"h-12",children:Ne.jsxs(Ll,{to:e.url,className:m,children:[Ne.jsx(e.icon,{className:"w-5 h-5 shrink-0"}),!i&&Ne.jsx("span",{className:"text-sm",children:e.title})]})})},e.title))})})]}),x.length>0&&Ne.jsxs(cm,{children:[Ne.jsx(dm,{className:i?"sr-only":"",children:"Administration"}),Ne.jsx(um,{children:Ne.jsx(hm,{children:x.map(e=>Ne.jsx(mm,{children:Ne.jsx(fm,{asChild:!0,className:"h-12",children:Ne.jsxs(Ll,{to:e.url,className:m,children:[Ne.jsx(e.icon,{className:"w-5 h-5 shrink-0"}),!i&&Ne.jsx("span",{className:"text-sm",children:e.title})]})})},e.title))})})]}),g.length>0&&Ne.jsxs(cm,{children:[Ne.jsx(dm,{className:i?"sr-only":"",children:"Utilisateur"}),Ne.jsx(um,{children:Ne.jsx(hm,{children:g.map(e=>Ne.jsx(mm,{children:Ne.jsx(fm,{asChild:!0,className:"h-12",children:Ne.jsxs(Ll,{to:e.url,className:m,children:[Ne.jsx(e.icon,{className:"w-5 h-5 shrink-0"}),!i&&Ne.jsx("span",{className:"text-sm",children:e.title})]})})},e.title))})})]})]})]}),t&&Ne.jsx(y,{})]})}const Om=ct,qm=dt;Nt.forwardRef(({className:e,inset:t,children:s,...r},a)=>Ne.jsxs(Ze,{ref:a,className:un("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",t&&"pl-8",e),...r,children:[s,Ne.jsx(xr,{className:"ml-auto h-4 w-4"})]})).displayName=Ze.displayName;Nt.forwardRef(({className:e,...t},s)=>Ne.jsx(et,{ref:s,className:un("z-[9997] min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...t})).displayName=et.displayName;const Im=Nt.forwardRef(({className:e,sideOffset:t=4,...s},r)=>Ne.jsx(tt,{children:Ne.jsx(st,{ref:r,sideOffset:t,className:un("z-[9997] min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...s})}));Im.displayName=st.displayName;const Fm=Nt.forwardRef(({className:e,inset:t,...s},r)=>Ne.jsx(rt,{ref:r,className:un("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t&&"pl-8",e),...s}));Fm.displayName=rt.displayName;Nt.forwardRef(({className:e,children:t,checked:s,...r},a)=>Ne.jsxs(at,{ref:a,className:un("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),checked:s,...r,children:[Ne.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:Ne.jsx(nt,{children:Ne.jsx(mr,{className:"h-4 w-4"})})}),t]})).displayName=at.displayName;Nt.forwardRef(({className:e,children:t,...s},r)=>Ne.jsxs(it,{ref:r,className:un("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...s,children:[Ne.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:Ne.jsx(nt,{children:Ne.jsx(vr,{className:"h-2 w-2 fill-current"})})}),t]})).displayName=it.displayName;const Lm=Nt.forwardRef(({className:e,inset:t,...s},r)=>Ne.jsx(ot,{ref:r,className:un("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",e),...s}));Lm.displayName=ot.displayName;const $m=Nt.forwardRef(({className:e,...t},s)=>Ne.jsx(lt,{ref:s,className:un("-mx-1 my-1 h-px bg-muted",e),...t}));function zm({children:e}){const{signOut:t,userProfile:s}=Ih(),[r,a]=Nt.useState(!1),n=()=>{a(!r)};return Ne.jsx(nm,{children:Ne.jsxs("div",{className:"min-h-screen flex w-full bg-background",children:[Ne.jsx(Rm,{userRole:(null==s?void 0:s.role)||"Vendeur",isMobileOpen:r,onMobileToggle:n}),Ne.jsxs("div",{className:"flex-1 flex flex-col",children:[Ne.jsx("header",{className:"h-16 border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 sticky top-0 z-40",children:Ne.jsxs("div",{className:"flex items-center justify-between h-full px-4",children:[Ne.jsxs("div",{className:"flex items-center gap-4",children:[Ne.jsx(Vh,{variant:"ghost",size:"icon",onClick:n,className:"lg:hidden h-10 w-10",children:Ne.jsx(Lr,{className:"h-5 w-5"})}),Ne.jsxs("div",{className:"hidden lg:block",children:[Ne.jsx("h1",{className:"text-lg font-semibold text-foreground",children:"GesFlex Pro"}),Ne.jsx("p",{className:"text-sm text-muted-foreground",children:"Gestion d'entreprise de vente"})]})]}),Ne.jsxs("div",{className:"flex items-center gap-2",children:[Ne.jsxs(Vh,{variant:"ghost",size:"icon",className:"relative",children:[Ne.jsx(lr,{className:"h-5 w-5"}),Ne.jsx("span",{className:"absolute -top-1 -right-1 h-4 w-4 bg-destructive rounded-full text-xs text-white flex items-center justify-center",children:"3"})]}),Ne.jsxs(Om,{children:[Ne.jsx(qm,{asChild:!0,children:Ne.jsxs(Vh,{variant:"ghost",className:"flex items-center gap-2 h-10",children:[Ne.jsx("div",{className:"w-8 h-8 bg-gradient-primary rounded-full flex items-center justify-center",children:Ne.jsx(ha,{className:"w-4 h-4 text-white"})}),Ne.jsxs("div",{className:"hidden md:block text-left",children:[Ne.jsxs("p",{className:"text-sm font-medium",children:[null==s?void 0:s.first_name," ",null==s?void 0:s.last_name]}),Ne.jsx("p",{className:"text-xs text-muted-foreground",children:null==s?void 0:s.role})]})]})}),Ne.jsxs(Im,{align:"end",className:"w-56",children:[Ne.jsx(Lm,{children:"Mon compte"}),Ne.jsx($m,{}),Ne.jsxs(Fm,{children:[Ne.jsx(ha,{className:"mr-2 h-4 w-4"}),"Profil"]}),Ne.jsxs(Fm,{children:[Ne.jsx(lr,{className:"mr-2 h-4 w-4"}),"Notifications"]}),Ne.jsx($m,{}),Ne.jsxs(Fm,{onClick:()=>{t()},className:"text-destructive",children:[Ne.jsx(Or,{className:"mr-2 h-4 w-4"}),"Se dconnecter"]})]})]})]})]})}),Ne.jsx("main",{className:"flex-1 p-4 md:p-6 space-y-6",children:e})]})]})})}$m.displayName=lt.displayName;const Um=Nt.forwardRef(({className:e,...t},s)=>Ne.jsx("div",{ref:s,className:un("rounded-lg border bg-card text-card-foreground shadow-sm",e),...t}));Um.displayName="Card";const Wm=Nt.forwardRef(({className:e,...t},s)=>Ne.jsx("div",{ref:s,className:un("flex flex-col space-y-1.5 p-6",e),...t}));Wm.displayName="CardHeader";const Vm=Nt.forwardRef(({className:e,...t},s)=>Ne.jsx("h3",{ref:s,className:un("text-2xl font-semibold leading-none tracking-tight",e),...t}));Vm.displayName="CardTitle";const Bm=Nt.forwardRef(({className:e,...t},s)=>Ne.jsx("p",{ref:s,className:un("text-sm text-muted-foreground",e),...t}));Bm.displayName="CardDescription";const Hm=Nt.forwardRef(({className:e,...t},s)=>Ne.jsx("div",{ref:s,className:un("p-6 pt-0",e),...t}));Hm.displayName="CardContent";Nt.forwardRef(({className:e,...t},s)=>Ne.jsx("div",{ref:s,className:un("flex items-center p-6 pt-0",e),...t})).displayName="CardFooter";class Km extends Nt.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){this.setState({error:e,errorInfo:t})}render(){return this.state.hasError?this.props.fallback?this.props.fallback:Ne.jsx(Ym,{error:this.state.error,errorInfo:this.state.errorInfo}):this.props.children}}function Ym({error:e,errorInfo:t}){return Ne.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:Ne.jsxs(Um,{className:"w-full max-w-md",children:[Ne.jsxs(Wm,{className:"text-center",children:[Ne.jsx("div",{className:"w-16 h-16 bg-destructive/10 rounded-full flex items-center justify-center mx-auto mb-4",children:Ne.jsx(rr,{className:"w-8 h-8 text-destructive"})}),Ne.jsx(Vm,{className:"text-xl text-destructive",children:"Oups ! Quelque chose s'est mal pass"}),Ne.jsx(Bm,{children:"Une erreur inattendue s'est produite dans l'application"})]}),Ne.jsxs(Hm,{className:"space-y-4",children:[e&&Ne.jsxs("div",{className:"bg-muted/50 rounded-lg p-3",children:[Ne.jsx("p",{className:"text-sm font-medium text-foreground mb-2",children:"Dtails de l'erreur :"}),Ne.jsx("p",{className:"text-xs text-muted-foreground font-mono break-all",children:e.message})]}),Ne.jsxs("div",{className:"flex flex-col gap-2",children:[Ne.jsxs(Vh,{onClick:()=>{window.location.reload()},className:"gap-2",children:[Ne.jsx(Gr,{className:"w-4 h-4"}),"Ressayer"]}),Ne.jsxs(Vh,{variant:"outline",onClick:()=>{window.location.href="/dashboard"},className:"gap-2",children:[Ne.jsx(Pr,{className:"w-4 h-4"}),"Retour au tableau de bord"]})]}),!1]})]})})}const Gm=()=>{const e=pl();return Nt.useEffect(()=>{e("/login")},[e]),Ne.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:Ne.jsxs("div",{className:"text-center",children:[Ne.jsx("h1",{className:"text-4xl font-bold mb-4",children:"GesFlex Pro"}),Ne.jsx("p",{className:"text-xl text-muted-foreground",children:"Chargement..."})]})})};var Qm=Nt.forwardRef((e,t)=>Ne.jsx(_e.label,{...e,ref:t,onMouseDown:t=>{var s;t.target.closest("button, input, select, textarea")||(null==(s=e.onMouseDown)||s.call(e,t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));Qm.displayName="Label";var Jm=Qm;const Xm=Xs("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Zm=Nt.forwardRef(({className:e,...t},s)=>Ne.jsx(Jm,{ref:s,className:un(Xm(),e),...t}));Zm.displayName=Jm.displayName;const ep=Xs("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),tp=Nt.forwardRef(({className:e,variant:t,...s},r)=>Ne.jsx("div",{ref:r,role:"alert",className:un(ep({variant:t}),e),...s}));tp.displayName="Alert";Nt.forwardRef(({className:e,...t},s)=>Ne.jsx("h5",{ref:s,className:un("mb-1 font-medium leading-none tracking-tight",e),...t})).displayName="AlertTitle";const sp=Nt.forwardRef(({className:e,...t},s)=>Ne.jsx("div",{ref:s,className:un("text-sm [&_p]:leading-relaxed",e),...t}));sp.displayName="AlertDescription";var rp="Tabs",[ap,np]=ke(rp,[ut]),ip=ut(),[op,lp]=ap(rp),cp=Nt.forwardRef((e,t)=>{const{__scopeTabs:s,value:r,onValueChange:a,defaultValue:n,orientation:i="horizontal",dir:o,activationMode:l="automatic",...c}=e,d=pt(o),[u,h]=Me({prop:r,onChange:a,defaultProp:n??"",caller:rp});return Ne.jsx(op,{scope:s,baseId:ze(),value:u,onValueChange:h,orientation:i,dir:d,activationMode:l,children:Ne.jsx(_e.div,{dir:d,"data-orientation":i,...c,ref:t})})});cp.displayName=rp;var dp="TabsList",up=Nt.forwardRef((e,t)=>{const{__scopeTabs:s,loop:r=!0,...a}=e,n=lp(dp,s),i=ip(s);return Ne.jsx(ht,{asChild:!0,...i,orientation:n.orientation,dir:n.dir,loop:r,children:Ne.jsx(_e.div,{role:"tablist","aria-orientation":n.orientation,...a,ref:t})})});up.displayName=dp;var hp="TabsTrigger",mp=Nt.forwardRef((e,t)=>{const{__scopeTabs:s,value:r,disabled:a=!1,...n}=e,i=lp(hp,s),o=ip(s),l=xp(i.baseId,r),c=gp(i.baseId,r),d=r===i.value;return Ne.jsx(mt,{asChild:!0,...o,focusable:!a,active:d,children:Ne.jsx(_e.button,{type:"button",role:"tab","aria-selected":d,"aria-controls":c,"data-state":d?"active":"inactive","data-disabled":a?"":void 0,disabled:a,id:l,...n,ref:t,onMouseDown:Ae(e.onMouseDown,e=>{a||0!==e.button||!1!==e.ctrlKey?e.preventDefault():i.onValueChange(r)}),onKeyDown:Ae(e.onKeyDown,e=>{[" ","Enter"].includes(e.key)&&i.onValueChange(r)}),onFocus:Ae(e.onFocus,()=>{const e="manual"!==i.activationMode;d||a||!e||i.onValueChange(r)})})})});mp.displayName=hp;var pp="TabsContent",fp=Nt.forwardRef((e,t)=>{const{__scopeTabs:s,value:r,forceMount:a,children:n,...i}=e,o=lp(pp,s),l=xp(o.baseId,r),c=gp(o.baseId,r),d=r===o.value,u=Nt.useRef(d);return Nt.useEffect(()=>{const e=requestAnimationFrame(()=>u.current=!1);return()=>cancelAnimationFrame(e)},[]),Ne.jsx(Te,{present:a||d,children:({present:s})=>Ne.jsx(_e.div,{"data-state":d?"active":"inactive","data-orientation":o.orientation,role:"tabpanel","aria-labelledby":l,hidden:!s,id:c,tabIndex:0,...i,ref:t,style:{...e.style,animationDuration:u.current?"0s":void 0},children:s&&n})})});function xp(e,t){return`${e}-trigger-${t}`}function gp(e,t){return`${e}-content-${t}`}fp.displayName=pp;var vp=up,jp=mp,yp=fp;const bp=cp,wp=Nt.forwardRef(({className:e,...t},s)=>Ne.jsx(vp,{ref:s,className:un("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...t}));wp.displayName=vp.displayName;const Np=Nt.forwardRef(({className:e,...t},s)=>Ne.jsx(jp,{ref:s,className:un("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",e),...t}));Np.displayName=jp.displayName;const _p=Nt.forwardRef(({className:e,...t},s)=>Ne.jsx(yp,{ref:s,className:un("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...t}));function kp(){const[e,t]=Nt.useState(!1),[s,r]=Nt.useState(!0),[a,n]=Nt.useState(!1),[i,o]=Nt.useState(""),[l,c]=Nt.useState(""),{signIn:d,signUp:u}=Ih();return Ne.jsx("div",{className:"min-h-screen flex items-center justify-center bg-[linear-gradient(180deg,#eef5ff_0%,#ffffff_100%)] p-4",children:Ne.jsxs(Um,{className:"w-full max-w-md shadow-elevated",children:[Ne.jsxs(Wm,{className:"space-y-4 text-center",children:[Ne.jsx("div",{className:"mx-auto -mt-2 mb-1",children:Ne.jsx("img",{src:"/logo.png",alt:"GesFlex",className:"w-12 h-12 mx-auto"})}),Ne.jsxs("div",{className:"space-y-1",children:[Ne.jsx(Vm,{className:"text-3xl font-extrabold text-[#1e40af]",children:"GesFlex"}),Ne.jsx(Bm,{className:"text-sm",children:"Votre Systme de gestion d'entreprise de vente professionnel"})]}),Ne.jsx("div",{className:"mt-2",children:Ne.jsx(bp,{value:s?"login":"signup",onValueChange:e=>{r("login"===e),o(""),c("")},children:Ne.jsxs(wp,{className:"w-full grid grid-cols-2 bg-transparent p-0 h-10",children:[Ne.jsx(Np,{value:"login",className:"rounded-none border-b-2 data-[state=active]:border-[#3b82f6] data-[state=inactive]:border-transparent",children:"Connexion"}),Ne.jsx(Np,{value:"signup",className:"rounded-none border-b-2 data-[state=active]:border-[#3b82f6] data-[state=inactive]:border-transparent",children:"Inscription"})]})})})]}),Ne.jsxs(Hm,{children:[i&&Ne.jsxs(tp,{variant:"destructive",className:"mb-4",children:[Ne.jsx(sr,{className:"h-4 w-4"}),Ne.jsx(sp,{children:i})]}),l&&Ne.jsx(tp,{className:"mb-4 border-success text-success",children:Ne.jsx(sp,{children:l})}),Ne.jsxs("form",{onSubmit:async e=>{e.preventDefault(),n(!0),o(""),c("");const t=new FormData(e.target),a=t.get("email"),i=t.get("password"),l=t.get("firstName"),h=t.get("lastName");try{s?await d(a,i):(await u(a,i,l,h),c("Compte cr avec succs ! Vous pouvez maintenant vous connecter."),r(!0))}catch(m){o(m.message||"Une erreur est survenue")}finally{n(!1)}},className:"space-y-4",children:[!s&&Ne.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{htmlFor:"firstName",children:"Prnom"}),Ne.jsx(Bh,{id:"firstName",name:"firstName",placeholder:"Votre prnom",required:!0,className:"h-12"})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{htmlFor:"lastName",children:"Nom"}),Ne.jsx(Bh,{id:"lastName",name:"lastName",placeholder:"Votre nom",required:!0,className:"h-12"})]})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{htmlFor:"email",children:"Email"}),Ne.jsx(Bh,{id:"email",name:"email",type:"email",placeholder:"votre.email@exemple.com",required:!0,className:"h-12"})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{htmlFor:"password",children:"Mot de passe"}),Ne.jsxs("div",{className:"relative",children:[Ne.jsx(Bh,{id:"password",name:"password",type:e?"text":"password",placeholder:"Votre mot de passe",required:!0,className:"h-12 pr-12"}),Ne.jsx(Vh,{type:"button",variant:"ghost",size:"icon",className:"absolute right-2 top-1/2 -translate-y-1/2 h-8 w-8",onClick:()=>t(!e),children:e?Ne.jsx(Sr,{className:"h-4 w-4"}):Ne.jsx(Cr,{className:"h-4 w-4"})})]})]}),Ne.jsx(Vh,{type:"submit",className:"w-full",size:"lg",disabled:a,children:a?"Chargement...":s?"Se connecter":"S'inscrire"})]}),Ne.jsxs("div",{className:"mt-6 text-center space-y-2",children:[Ne.jsx("div",{children:Ne.jsx("span",{className:"text-xs text-muted-foreground",children:"Besoin d'assistance ?"})}),Ne.jsxs("div",{className:"text-xs text-muted-foreground",children:["Email : ",Ne.jsx("a",{href:"mailto:jasmesdiamond@gmail.com",className:"text-primary",children:"jasmesdiamond@gmail.com"})]}),Ne.jsxs("div",{className:"text-xs text-muted-foreground",children:["WhatsApp : ",Ne.jsx("a",{href:"tel:+2290197212185",className:"text-primary",children:"+229 01 97 21 21 85"})]}),Ne.jsx("div",{className:"text-[11px] text-muted-foreground",children:"Pour toute assistance (problmes de connexion, cration de compte)"})]})]})]})})}_p.displayName=yp.displayName;const Sp=Xs("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",success:"border-transparent bg-success text-success-foreground hover:bg-success/80",warning:"border-transparent bg-warning text-warning-foreground hover:bg-warning/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function Cp({className:e,variant:t,...s}){return Ne.jsx("div",{className:un(Sp({variant:t}),e),...s})}function Ep(){const{userProfile:e}=Ih(),[t,s]=Nt.useState(null),[r,a]=Nt.useState([]),[n,i]=Nt.useState(!0),[o,l]=Nt.useState("overview");Nt.useEffect(()=>{"Admin"!==(null==e?void 0:e.role)&&"SuperAdmin"!==(null==e?void 0:e.role)||(c(),d())},[e]);const c=async()=>{try{const[{count:e},{count:t},{count:r},{count:a}]=await Promise.all([Dh.from("users").select("*",{count:"exact",head:!0}),Dh.from("stores").select("*",{count:"exact",head:!0}),Dh.from("products").select("*",{count:"exact",head:!0}),Dh.from("sales").select("*",{count:"exact",head:!0})]);s({totalUsers:e||0,activeUsers:e||0,totalStores:t||0,totalProducts:r||0,totalSales:a||0,systemHealth:e>0&&t>0?"excellent":"warning",lastBackup:(new Date).toLocaleDateString("fr-FR"),databaseSize:"2.4 MB"})}catch(e){}},d=async()=>{try{const{data:e}=await Dh.from("users").select("role, status");if(e){const t=e.reduce((e,t)=>{const s=e.find(e=>e.role===t.role);return s?s.count++:e.push({role:t.role,count:1,status:t.status}),e},[]);a(t)}}catch(e){}finally{i(!1)}};return n?Ne.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:Ne.jsxs("div",{className:"text-center",children:[Ne.jsx(tr,{className:"w-8 h-8 animate-spin mx-auto mb-4 text-primary"}),Ne.jsx("p",{className:"text-muted-foreground",children:"Chargement des statistiques..."})]})}):Ne.jsxs("div",{className:"space-y-6 p-4 md:p-6",children:[Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Administration"}),Ne.jsx("p",{className:"text-muted-foreground",children:"Panneau d'administration pour la gestion du systme GesFlex Pro"})]}),Ne.jsxs(bp,{value:o,onValueChange:l,className:"space-y-6",children:[Ne.jsxs(wp,{className:"grid w-full grid-cols-2 md:grid-cols-4 lg:w-auto",children:[Ne.jsx(Np,{value:"overview",children:"Vue d'ensemble"}),Ne.jsx(Np,{value:"users",children:"Utilisateurs"}),Ne.jsx(Np,{value:"stores",children:"Magasins"}),Ne.jsx(Np,{value:"system",children:"Systme"})]}),Ne.jsxs(_p,{value:"overview",className:"space-y-6",children:[Ne.jsxs(Um,{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200",children:[Ne.jsxs(Wm,{children:[Ne.jsxs(Vm,{className:"flex items-center gap-2",children:[(e=>{switch(e){case"excellent":return Ne.jsx(hr,{className:"w-5 h-5 text-success"});case"good":return Ne.jsx(hr,{className:"w-5 h-5 text-primary"});case"warning":return Ne.jsx(rr,{className:"w-5 h-5 text-warning"});case"critical":return Ne.jsx(rr,{className:"w-5 h-5 text-destructive"});default:return Ne.jsx(tr,{className:"w-5 h-5 text-muted-foreground"})}})((null==t?void 0:t.systemHealth)||"warning"),"Statut du Systme"]}),Ne.jsx(Bm,{children:"Vue d'ensemble de l'tat du systme"})]}),Ne.jsx(Hm,{children:Ne.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[Ne.jsxs("div",{className:"text-center p-4 bg-white rounded-lg shadow-sm",children:[Ne.jsx("div",{className:"text-2xl font-bold text-success",children:(null==t?void 0:t.totalUsers)||0}),Ne.jsx("div",{className:"text-sm text-muted-foreground",children:"Utilisateurs"})]}),Ne.jsxs("div",{className:"text-center p-4 bg-white rounded-lg shadow-sm",children:[Ne.jsx("div",{className:"text-2xl font-bold text-primary",children:(null==t?void 0:t.totalStores)||0}),Ne.jsx("div",{className:"text-sm text-muted-foreground",children:"Magasins"})]}),Ne.jsxs("div",{className:"text-center p-4 bg-white rounded-lg shadow-sm",children:[Ne.jsx("div",{className:"text-2xl font-bold text-warning",children:(null==t?void 0:t.totalProducts)||0}),Ne.jsx("div",{className:"text-sm text-muted-foreground",children:"Produits"})]}),Ne.jsxs("div",{className:"text-center p-4 bg-white rounded-lg shadow-sm",children:[Ne.jsx("div",{className:"text-2xl font-bold text-accent",children:(null==t?void 0:t.totalSales)||0}),Ne.jsx("div",{className:"text-sm text-muted-foreground",children:"Ventes"})]})]})})]}),Ne.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[Ne.jsxs(Um,{className:"hover:shadow-md transition-shadow cursor-pointer",children:[Ne.jsx(Wm,{className:"pb-3",children:Ne.jsxs("div",{className:"flex items-center gap-3",children:[Ne.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center",children:Ne.jsx(ma,{className:"w-5 h-5 text-primary"})}),Ne.jsxs("div",{children:[Ne.jsx(Vm,{className:"text-lg",children:"Gestion Utilisateurs"}),Ne.jsx(Bm,{children:"Grer les comptes et permissions"})]})]})}),Ne.jsx(Hm,{children:Ne.jsx(Vh,{className:"w-full",variant:"outline",children:"Accder"})})]}),Ne.jsxs(Um,{className:"hover:shadow-md transition-shadow cursor-pointer",children:[Ne.jsx(Wm,{className:"pb-3",children:Ne.jsxs("div",{className:"flex items-center gap-3",children:[Ne.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center",children:Ne.jsx(ra,{className:"w-5 h-5 text-primary"})}),Ne.jsxs("div",{children:[Ne.jsx(Vm,{className:"text-lg",children:"Gestion Magasins"}),Ne.jsx(Bm,{children:"Configurer les points de vente"})]})]})}),Ne.jsx(Hm,{children:Ne.jsx(Vh,{className:"w-full",variant:"outline",children:"Accder"})})]}),Ne.jsxs(Um,{className:"hover:shadow-md transition-shadow cursor-pointer",children:[Ne.jsx(Wm,{className:"pb-3",children:Ne.jsxs("div",{className:"flex items-center gap-3",children:[Ne.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center",children:Ne.jsx(or,{className:"w-5 h-5 text-primary"})}),Ne.jsxs("div",{children:[Ne.jsx(Vm,{className:"text-lg",children:"Rapports"}),Ne.jsx(Bm,{children:"Analyser les performances"})]})]})}),Ne.jsx(Hm,{children:Ne.jsx(Vh,{className:"w-full",variant:"outline",children:"Accder"})})]}),Ne.jsxs(Um,{className:"hover:shadow-md transition-shadow cursor-pointer",children:[Ne.jsx(Wm,{className:"pb-3",children:Ne.jsxs("div",{className:"flex items-center gap-3",children:[Ne.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center",children:Ne.jsx(Zr,{className:"w-5 h-5 text-primary"})}),Ne.jsxs("div",{children:[Ne.jsx(Vm,{className:"text-lg",children:"Configuration"}),Ne.jsx(Bm,{children:"Paramtres systme"})]})]})}),Ne.jsx(Hm,{children:Ne.jsx(Vh,{className:"w-full",variant:"outline",children:"Accder"})})]})]})]}),Ne.jsx(_p,{value:"users",className:"space-y-6",children:Ne.jsxs(Um,{children:[Ne.jsxs(Wm,{children:[Ne.jsxs(Vm,{className:"flex items-center gap-2",children:[Ne.jsx(ma,{className:"w-5 h-5"}),"Statistiques des Utilisateurs"]}),Ne.jsx(Bm,{children:"Vue d'ensemble des utilisateurs par rle et statut"})]}),Ne.jsx(Hm,{children:Ne.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:r.map(e=>Ne.jsxs("div",{className:"p-4 border rounded-lg",children:[Ne.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[Ne.jsx(da,{className:"w-4 h-4 text-primary"}),Ne.jsx("span",{className:"font-medium",children:e.role})]}),Ne.jsx("div",{className:"text-2xl font-bold text-primary",children:e.count}),Ne.jsxs("div",{className:"text-sm text-muted-foreground",children:["Statut: ",e.status]})]},e.role))})})]})}),Ne.jsx(_p,{value:"stores",className:"space-y-6",children:Ne.jsxs(Um,{children:[Ne.jsxs(Wm,{children:[Ne.jsxs(Vm,{className:"flex items-center gap-2",children:[Ne.jsx(ra,{className:"w-5 h-5"}),"Gestion des Magasins"]}),Ne.jsx(Bm,{children:"Configuration et suivi des points de vente"})]}),Ne.jsx(Hm,{children:Ne.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[Ne.jsxs("div",{className:"p-4 border rounded-lg",children:[Ne.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[Ne.jsx(ra,{className:"w-4 h-4 text-primary"}),Ne.jsx("span",{className:"font-medium",children:"Total Magasins"})]}),Ne.jsx("div",{className:"text-2xl font-bold text-primary",children:(null==t?void 0:t.totalStores)||0})]}),Ne.jsxs("div",{className:"p-4 border rounded-lg",children:[Ne.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[Ne.jsx(Ur,{className:"w-4 h-4 text-warning"}),Ne.jsx("span",{className:"font-medium",children:"Produits en Stock"})]}),Ne.jsx("div",{className:"text-2xl font-bold text-warning",children:(null==t?void 0:t.totalProducts)||0})]}),Ne.jsxs("div",{className:"p-4 border rounded-lg",children:[Ne.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[Ne.jsx(_r,{className:"w-4 h-4 text-success"}),Ne.jsx("span",{className:"font-medium",children:"Ventes Total"})]}),Ne.jsx("div",{className:"text-2xl font-bold text-success",children:(null==t?void 0:t.totalSales)||0})]})]})})]})}),Ne.jsx(_p,{value:"system",className:"space-y-6",children:Ne.jsxs(Um,{children:[Ne.jsxs(Wm,{children:[Ne.jsxs(Vm,{className:"flex items-center gap-2",children:[Ne.jsx(wr,{className:"w-5 h-5"}),"Informations Systme"]}),Ne.jsx(Bm,{children:"Dtails techniques et maintenance"})]}),Ne.jsx(Hm,{children:Ne.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[Ne.jsxs("div",{className:"space-y-4",children:[Ne.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted rounded-lg",children:[Ne.jsx("span",{className:"font-medium",children:"Sant du Systme"}),Ne.jsx(Cp,{variant:"excellent"===(null==t?void 0:t.systemHealth)?"default":"secondary",children:(null==t?void 0:t.systemHealth)||"warning"})]}),Ne.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted rounded-lg",children:[Ne.jsx("span",{className:"font-medium",children:"Dernire Sauvegarde"}),Ne.jsx("span",{className:"text-sm text-muted-foreground",children:(null==t?void 0:t.lastBackup)||"N/A"})]}),Ne.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted rounded-lg",children:[Ne.jsx("span",{className:"font-medium",children:"Taille Base de Donnes"}),Ne.jsx("span",{className:"text-sm text-muted-foreground",children:(null==t?void 0:t.databaseSize)||"N/A"})]})]}),Ne.jsxs("div",{className:"space-y-4",children:[Ne.jsxs("div",{className:"p-4 border rounded-lg",children:[Ne.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[Ne.jsx(ea,{className:"w-4 h-4 text-success"}),Ne.jsx("span",{className:"font-medium",children:"Scurit"})]}),Ne.jsx("p",{className:"text-sm text-muted-foreground",children:"RLS activ, authentification scurise, permissions granulaires"})]}),Ne.jsxs("div",{className:"p-4 border rounded-lg",children:[Ne.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[Ne.jsx(ia,{className:"w-4 h-4 text-primary"}),Ne.jsx("span",{className:"font-medium",children:"Performance"})]}),Ne.jsx("p",{className:"text-sm text-muted-foreground",children:"Requtes optimises, cache intelligent, monitoring actif"})]})]})]})})]})})]})]})}function Mp(e,[t,s]){return Math.min(s,Math.max(t,e))}function Tp(e){const t=Nt.useRef({value:e,previous:e});return Nt.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}var Ap=[" ","Enter","ArrowUp","ArrowDown"],Pp=[" ","Enter"],Dp="Select",[Rp,Op,qp]=Se(Dp),[Ip,Fp]=ke(Dp,[qp,Ie]),Lp=Ie(),[$p,zp]=Ip(Dp),[Up,Wp]=Ip(Dp),Vp=e=>{const{__scopeSelect:t,children:s,open:r,defaultOpen:a,onOpenChange:n,value:i,defaultValue:o,onValueChange:l,dir:c,name:d,autoComplete:u,disabled:h,required:m,form:p}=e,f=Lp(t),[x,g]=Nt.useState(null),[v,j]=Nt.useState(null),[y,b]=Nt.useState(!1),w=pt(c),[N,_]=Me({prop:r,defaultProp:a??!1,onChange:n,caller:Dp}),[k,S]=Me({prop:i,defaultProp:o,onChange:l,caller:Dp}),C=Nt.useRef(null),E=!x||(p||!!x.closest("form")),[M,T]=Nt.useState(new Set),A=Array.from(M).map(e=>e.props.value).join(";");return Ne.jsx(Ue,{...f,children:Ne.jsxs($p,{required:m,scope:t,trigger:x,onTriggerChange:g,valueNode:v,onValueNodeChange:j,valueNodeHasChildren:y,onValueNodeHasChildrenChange:b,contentId:ze(),value:k,onValueChange:S,open:N,onOpenChange:_,dir:w,triggerPointerDownPosRef:C,disabled:h,children:[Ne.jsx(Rp.Provider,{scope:t,children:Ne.jsx(Up,{scope:e.__scopeSelect,onNativeOptionAdd:Nt.useCallback(e=>{T(t=>new Set(t).add(e))},[]),onNativeOptionRemove:Nt.useCallback(e=>{T(t=>{const s=new Set(t);return s.delete(e),s})},[]),children:s})}),E?Ne.jsxs(Af,{"aria-hidden":!0,required:m,tabIndex:-1,name:d,autoComplete:u,value:k,onChange:e=>S(e.target.value),disabled:h,form:p,children:[void 0===k?Ne.jsx("option",{value:""}):null,Array.from(M)]},A):null]})})};Vp.displayName=Dp;var Bp="SelectTrigger",Hp=Nt.forwardRef((e,t)=>{const{__scopeSelect:s,disabled:r=!1,...a}=e,n=Lp(s),i=zp(Bp,s),o=i.disabled||r,l=Ce(t,i.onTriggerChange),c=Op(s),d=Nt.useRef("touch"),[u,h,m]=Df(e=>{const t=c().filter(e=>!e.disabled),s=t.find(e=>e.value===i.value),r=Rf(t,e,s);void 0!==r&&i.onValueChange(r.value)}),p=e=>{o||(i.onOpenChange(!0),m()),e&&(i.triggerPointerDownPosRef.current={x:Math.round(e.pageX),y:Math.round(e.pageY)})};return Ne.jsx(We,{asChild:!0,...n,children:Ne.jsx(_e.button,{type:"button",role:"combobox","aria-controls":i.contentId,"aria-expanded":i.open,"aria-required":i.required,"aria-autocomplete":"none",dir:i.dir,"data-state":i.open?"open":"closed",disabled:o,"data-disabled":o?"":void 0,"data-placeholder":Pf(i.value)?"":void 0,...a,ref:l,onClick:Ae(a.onClick,e=>{e.currentTarget.focus(),"mouse"!==d.current&&p(e)}),onPointerDown:Ae(a.onPointerDown,e=>{d.current=e.pointerType;const t=e.target;t.hasPointerCapture(e.pointerId)&&t.releasePointerCapture(e.pointerId),0===e.button&&!1===e.ctrlKey&&"mouse"===e.pointerType&&(p(e),e.preventDefault())}),onKeyDown:Ae(a.onKeyDown,e=>{const t=""!==u.current;e.ctrlKey||e.altKey||e.metaKey||1!==e.key.length||h(e.key),t&&" "===e.key||Ap.includes(e.key)&&(p(),e.preventDefault())})})})});Hp.displayName=Bp;var Kp="SelectValue",Yp=Nt.forwardRef((e,t)=>{const{__scopeSelect:s,className:r,style:a,children:n,placeholder:i="",...o}=e,l=zp(Kp,s),{onValueNodeHasChildrenChange:c}=l,d=void 0!==n,u=Ce(t,l.onValueNodeChange);return Oe(()=>{c(d)},[c,d]),Ne.jsx(_e.span,{...o,ref:u,style:{pointerEvents:"none"},children:Pf(l.value)?Ne.jsx(Ne.Fragment,{children:i}):n})});Yp.displayName=Kp;var Gp=Nt.forwardRef((e,t)=>{const{__scopeSelect:s,children:r,...a}=e;return Ne.jsx(_e.span,{"aria-hidden":!0,...a,ref:t,children:r||""})});Gp.displayName="SelectIcon";var Qp=e=>Ne.jsx(Re,{asChild:!0,...e});Qp.displayName="SelectPortal";var Jp="SelectContent",Xp=Nt.forwardRef((e,t)=>{const s=zp(Jp,e.__scopeSelect),[r,a]=Nt.useState();if(Oe(()=>{a(new DocumentFragment)},[]),!s.open){const t=r;return t?wt.createPortal(Ne.jsx(ef,{scope:e.__scopeSelect,children:Ne.jsx(Rp.Slot,{scope:e.__scopeSelect,children:Ne.jsx("div",{children:e.children})})}),t):null}return Ne.jsx(rf,{...e,ref:t})});Xp.displayName=Jp;var Zp=10,[ef,tf]=Ip(Jp),sf=vt("SelectContent.RemoveScroll"),rf=Nt.forwardRef((e,t)=>{const{__scopeSelect:s,position:r="item-aligned",onCloseAutoFocus:a,onEscapeKeyDown:n,onPointerDownOutside:i,side:o,sideOffset:l,align:c,alignOffset:d,arrowPadding:u,collisionBoundary:h,collisionPadding:m,sticky:p,hideWhenDetached:f,avoidCollisions:x,...g}=e,v=zp(Jp,s),[j,y]=Nt.useState(null),[b,w]=Nt.useState(null),N=Ce(t,e=>y(e)),[_,k]=Nt.useState(null),[S,C]=Nt.useState(null),E=Op(s),[M,T]=Nt.useState(!1),A=Nt.useRef(!1);Nt.useEffect(()=>{if(j)return ft(j)},[j]),xt();const P=Nt.useCallback(e=>{const[t,...s]=E().map(e=>e.ref.current),[r]=s.slice(-1),a=document.activeElement;for(const n of e){if(n===a)return;if(null==n||n.scrollIntoView({block:"nearest"}),n===t&&b&&(b.scrollTop=0),n===r&&b&&(b.scrollTop=b.scrollHeight),null==n||n.focus(),document.activeElement!==a)return}},[E,b]),D=Nt.useCallback(()=>P([_,j]),[P,_,j]);Nt.useEffect(()=>{M&&D()},[M,D]);const{onOpenChange:R,triggerPointerDownPosRef:O}=v;Nt.useEffect(()=>{if(j){let e={x:0,y:0};const t=t=>{var s,r;e={x:Math.abs(Math.round(t.pageX)-((null==(s=O.current)?void 0:s.x)??0)),y:Math.abs(Math.round(t.pageY)-((null==(r=O.current)?void 0:r.y)??0))}},s=s=>{e.x<=10&&e.y<=10?s.preventDefault():j.contains(s.target)||R(!1),document.removeEventListener("pointermove",t),O.current=null};return null!==O.current&&(document.addEventListener("pointermove",t),document.addEventListener("pointerup",s,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",t),document.removeEventListener("pointerup",s,{capture:!0})}}},[j,R,O]),Nt.useEffect(()=>{const e=()=>R(!1);return window.addEventListener("blur",e),window.addEventListener("resize",e),()=>{window.removeEventListener("blur",e),window.removeEventListener("resize",e)}},[R]);const[q,I]=Df(e=>{const t=E().filter(e=>!e.disabled),s=t.find(e=>e.ref.current===document.activeElement),r=Rf(t,e,s);r&&setTimeout(()=>r.ref.current.focus())}),F=Nt.useCallback((e,t,s)=>{const r=!A.current&&!s;(void 0!==v.value&&v.value===t||r)&&(k(e),r&&(A.current=!0))},[v.value]),L=Nt.useCallback(()=>null==j?void 0:j.focus(),[j]),$=Nt.useCallback((e,t,s)=>{const r=!A.current&&!s;(void 0!==v.value&&v.value===t||r)&&C(e)},[v.value]),z="popper"===r?nf:af,U=z===nf?{side:o,sideOffset:l,align:c,alignOffset:d,arrowPadding:u,collisionBoundary:h,collisionPadding:m,sticky:p,hideWhenDetached:f,avoidCollisions:x}:{};return Ne.jsx(ef,{scope:s,content:j,viewport:b,onViewportChange:w,itemRefCallback:F,selectedItem:_,onItemLeave:L,itemTextRefCallback:$,focusSelectedItem:D,selectedItemText:S,position:r,isPositioned:M,searchRef:q,children:Ne.jsx(gt,{as:sf,allowPinchZoom:!0,children:Ne.jsx(jt,{asChild:!0,trapped:v.open,onMountAutoFocus:e=>{e.preventDefault()},onUnmountAutoFocus:Ae(a,e=>{var t;null==(t=v.trigger)||t.focus({preventScroll:!0}),e.preventDefault()}),children:Ne.jsx(Fe,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:n,onPointerDownOutside:i,onFocusOutside:e=>e.preventDefault(),onDismiss:()=>v.onOpenChange(!1),children:Ne.jsx(z,{role:"listbox",id:v.contentId,"data-state":v.open?"open":"closed",dir:v.dir,onContextMenu:e=>e.preventDefault(),...g,...U,onPlaced:()=>T(!0),ref:N,style:{display:"flex",flexDirection:"column",outline:"none",...g.style},onKeyDown:Ae(g.onKeyDown,e=>{const t=e.ctrlKey||e.altKey||e.metaKey;if("Tab"===e.key&&e.preventDefault(),t||1!==e.key.length||I(e.key),["ArrowUp","ArrowDown","Home","End"].includes(e.key)){let t=E().filter(e=>!e.disabled).map(e=>e.ref.current);if(["ArrowUp","End"].includes(e.key)&&(t=t.slice().reverse()),["ArrowUp","ArrowDown"].includes(e.key)){const s=e.target,r=t.indexOf(s);t=t.slice(r+1)}setTimeout(()=>P(t)),e.preventDefault()}})})})})})})});rf.displayName="SelectContentImpl";var af=Nt.forwardRef((e,t)=>{const{__scopeSelect:s,onPlaced:r,...a}=e,n=zp(Jp,s),i=tf(Jp,s),[o,l]=Nt.useState(null),[c,d]=Nt.useState(null),u=Ce(t,e=>d(e)),h=Op(s),m=Nt.useRef(!1),p=Nt.useRef(!0),{viewport:f,selectedItem:x,selectedItemText:g,focusSelectedItem:v}=i,j=Nt.useCallback(()=>{if(n.trigger&&n.valueNode&&o&&c&&f&&x&&g){const e=n.trigger.getBoundingClientRect(),t=c.getBoundingClientRect(),s=n.valueNode.getBoundingClientRect(),a=g.getBoundingClientRect();if("rtl"!==n.dir){const r=a.left-t.left,n=s.left-r,i=e.left-n,l=e.width+i,c=Math.max(l,t.width),d=window.innerWidth-Zp,u=Mp(n,[Zp,Math.max(Zp,d-c)]);o.style.minWidth=l+"px",o.style.left=u+"px"}else{const r=t.right-a.right,n=window.innerWidth-s.right-r,i=window.innerWidth-e.right-n,l=e.width+i,c=Math.max(l,t.width),d=window.innerWidth-Zp,u=Mp(n,[Zp,Math.max(Zp,d-c)]);o.style.minWidth=l+"px",o.style.right=u+"px"}const i=h(),l=window.innerHeight-2*Zp,d=f.scrollHeight,u=window.getComputedStyle(c),p=parseInt(u.borderTopWidth,10),v=parseInt(u.paddingTop,10),j=parseInt(u.borderBottomWidth,10),y=p+v+d+parseInt(u.paddingBottom,10)+j,b=Math.min(5*x.offsetHeight,y),w=window.getComputedStyle(f),N=parseInt(w.paddingTop,10),_=parseInt(w.paddingBottom,10),k=e.top+e.height/2-Zp,S=l-k,C=x.offsetHeight/2,E=p+v+(x.offsetTop+C),M=y-E;if(E<=k){const e=i.length>0&&x===i[i.length-1].ref.current;o.style.bottom="0px";const t=c.clientHeight-f.offsetTop-f.offsetHeight,s=E+Math.max(S,C+(e?_:0)+t+j);o.style.height=s+"px"}else{const e=i.length>0&&x===i[0].ref.current;o.style.top="0px";const t=Math.max(k,p+f.offsetTop+(e?N:0)+C)+M;o.style.height=t+"px",f.scrollTop=E-k+f.offsetTop}o.style.margin=`${Zp}px 0`,o.style.minHeight=b+"px",o.style.maxHeight=l+"px",null==r||r(),requestAnimationFrame(()=>m.current=!0)}},[h,n.trigger,n.valueNode,o,c,f,x,g,n.dir,r]);Oe(()=>j(),[j]);const[y,b]=Nt.useState();Oe(()=>{c&&b(window.getComputedStyle(c).zIndex)},[c]);const w=Nt.useCallback(e=>{e&&!0===p.current&&(j(),null==v||v(),p.current=!1)},[j,v]);return Ne.jsx(of,{scope:s,contentWrapper:o,shouldExpandOnScrollRef:m,onScrollButtonChange:w,children:Ne.jsx("div",{ref:l,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:y},children:Ne.jsx(_e.div,{...a,ref:u,style:{boxSizing:"border-box",maxHeight:"100%",...a.style}})})})});af.displayName="SelectItemAlignedPosition";var nf=Nt.forwardRef((e,t)=>{const{__scopeSelect:s,align:r="start",collisionPadding:a=Zp,...n}=e,i=Lp(s);return Ne.jsx(Le,{...i,...n,ref:t,align:r,collisionPadding:a,style:{boxSizing:"border-box",...n.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});nf.displayName="SelectPopperPosition";var[of,lf]=Ip(Jp,{}),cf="SelectViewport",df=Nt.forwardRef((e,t)=>{const{__scopeSelect:s,nonce:r,...a}=e,n=tf(cf,s),i=lf(cf,s),o=Ce(t,n.onViewportChange),l=Nt.useRef(0);return Ne.jsxs(Ne.Fragment,{children:[Ne.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:r}),Ne.jsx(Rp.Slot,{scope:s,children:Ne.jsx(_e.div,{"data-radix-select-viewport":"",role:"presentation",...a,ref:o,style:{position:"relative",flex:1,overflow:"hidden auto",...a.style},onScroll:Ae(a.onScroll,e=>{const t=e.currentTarget,{contentWrapper:s,shouldExpandOnScrollRef:r}=i;if((null==r?void 0:r.current)&&s){const e=Math.abs(l.current-t.scrollTop);if(e>0){const r=window.innerHeight-2*Zp,a=parseFloat(s.style.minHeight),n=parseFloat(s.style.height),i=Math.max(a,n);if(i<r){const a=i+e,n=Math.min(r,a),o=a-n;s.style.height=n+"px","0px"===s.style.bottom&&(t.scrollTop=o>0?o:0,s.style.justifyContent="flex-end")}}}l.current=t.scrollTop})})})]})});df.displayName=cf;var uf="SelectGroup",[hf,mf]=Ip(uf);Nt.forwardRef((e,t)=>{const{__scopeSelect:s,...r}=e,a=ze();return Ne.jsx(hf,{scope:s,id:a,children:Ne.jsx(_e.div,{role:"group","aria-labelledby":a,...r,ref:t})})}).displayName=uf;var pf="SelectLabel",ff=Nt.forwardRef((e,t)=>{const{__scopeSelect:s,...r}=e,a=mf(pf,s);return Ne.jsx(_e.div,{id:a.id,...r,ref:t})});ff.displayName=pf;var xf="SelectItem",[gf,vf]=Ip(xf),jf=Nt.forwardRef((e,t)=>{const{__scopeSelect:s,value:r,disabled:a=!1,textValue:n,...i}=e,o=zp(xf,s),l=tf(xf,s),c=o.value===r,[d,u]=Nt.useState(n??""),[h,m]=Nt.useState(!1),p=Ce(t,e=>{var t;return null==(t=l.itemRefCallback)?void 0:t.call(l,e,r,a)}),f=ze(),x=Nt.useRef("touch"),g=()=>{a||(o.onValueChange(r),o.onOpenChange(!1))};if(""===r)throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return Ne.jsx(gf,{scope:s,value:r,disabled:a,textId:f,isSelected:c,onItemTextChange:Nt.useCallback(e=>{u(t=>t||((null==e?void 0:e.textContent)??"").trim())},[]),children:Ne.jsx(Rp.ItemSlot,{scope:s,value:r,disabled:a,textValue:d,children:Ne.jsx(_e.div,{role:"option","aria-labelledby":f,"data-highlighted":h?"":void 0,"aria-selected":c&&h,"data-state":c?"checked":"unchecked","aria-disabled":a||void 0,"data-disabled":a?"":void 0,tabIndex:a?void 0:-1,...i,ref:p,onFocus:Ae(i.onFocus,()=>m(!0)),onBlur:Ae(i.onBlur,()=>m(!1)),onClick:Ae(i.onClick,()=>{"mouse"!==x.current&&g()}),onPointerUp:Ae(i.onPointerUp,()=>{"mouse"===x.current&&g()}),onPointerDown:Ae(i.onPointerDown,e=>{x.current=e.pointerType}),onPointerMove:Ae(i.onPointerMove,e=>{var t;x.current=e.pointerType,a?null==(t=l.onItemLeave)||t.call(l):"mouse"===x.current&&e.currentTarget.focus({preventScroll:!0})}),onPointerLeave:Ae(i.onPointerLeave,e=>{var t;e.currentTarget===document.activeElement&&(null==(t=l.onItemLeave)||t.call(l))}),onKeyDown:Ae(i.onKeyDown,e=>{var t;""!==(null==(t=l.searchRef)?void 0:t.current)&&" "===e.key||(Pp.includes(e.key)&&g()," "===e.key&&e.preventDefault())})})})})});jf.displayName=xf;var yf="SelectItemText",bf=Nt.forwardRef((e,t)=>{const{__scopeSelect:s,className:r,style:a,...n}=e,i=zp(yf,s),o=tf(yf,s),l=vf(yf,s),c=Wp(yf,s),[d,u]=Nt.useState(null),h=Ce(t,e=>u(e),l.onItemTextChange,e=>{var t;return null==(t=o.itemTextRefCallback)?void 0:t.call(o,e,l.value,l.disabled)}),m=null==d?void 0:d.textContent,p=Nt.useMemo(()=>Ne.jsx("option",{value:l.value,disabled:l.disabled,children:m},l.value),[l.disabled,l.value,m]),{onNativeOptionAdd:f,onNativeOptionRemove:x}=c;return Oe(()=>(f(p),()=>x(p)),[f,x,p]),Ne.jsxs(Ne.Fragment,{children:[Ne.jsx(_e.span,{id:l.textId,...n,ref:h}),l.isSelected&&i.valueNode&&!i.valueNodeHasChildren?wt.createPortal(n.children,i.valueNode):null]})});bf.displayName=yf;var wf="SelectItemIndicator",Nf=Nt.forwardRef((e,t)=>{const{__scopeSelect:s,...r}=e;return vf(wf,s).isSelected?Ne.jsx(_e.span,{"aria-hidden":!0,...r,ref:t}):null});Nf.displayName=wf;var _f="SelectScrollUpButton",kf=Nt.forwardRef((e,t)=>{const s=tf(_f,e.__scopeSelect),r=lf(_f,e.__scopeSelect),[a,n]=Nt.useState(!1),i=Ce(t,r.onScrollButtonChange);return Oe(()=>{if(s.viewport&&s.isPositioned){let e=function(){const e=t.scrollTop>0;n(e)};const t=s.viewport;return e(),t.addEventListener("scroll",e),()=>t.removeEventListener("scroll",e)}},[s.viewport,s.isPositioned]),a?Ne.jsx(Ef,{...e,ref:i,onAutoScroll:()=>{const{viewport:e,selectedItem:t}=s;e&&t&&(e.scrollTop=e.scrollTop-t.offsetHeight)}}):null});kf.displayName=_f;var Sf="SelectScrollDownButton",Cf=Nt.forwardRef((e,t)=>{const s=tf(Sf,e.__scopeSelect),r=lf(Sf,e.__scopeSelect),[a,n]=Nt.useState(!1),i=Ce(t,r.onScrollButtonChange);return Oe(()=>{if(s.viewport&&s.isPositioned){let e=function(){const e=t.scrollHeight-t.clientHeight,s=Math.ceil(t.scrollTop)<e;n(s)};const t=s.viewport;return e(),t.addEventListener("scroll",e),()=>t.removeEventListener("scroll",e)}},[s.viewport,s.isPositioned]),a?Ne.jsx(Ef,{...e,ref:i,onAutoScroll:()=>{const{viewport:e,selectedItem:t}=s;e&&t&&(e.scrollTop=e.scrollTop+t.offsetHeight)}}):null});Cf.displayName=Sf;var Ef=Nt.forwardRef((e,t)=>{const{__scopeSelect:s,onAutoScroll:r,...a}=e,n=tf("SelectScrollButton",s),i=Nt.useRef(null),o=Op(s),l=Nt.useCallback(()=>{null!==i.current&&(window.clearInterval(i.current),i.current=null)},[]);return Nt.useEffect(()=>()=>l(),[l]),Oe(()=>{var e;const t=o().find(e=>e.ref.current===document.activeElement);null==(e=null==t?void 0:t.ref.current)||e.scrollIntoView({block:"nearest"})},[o]),Ne.jsx(_e.div,{"aria-hidden":!0,...a,ref:t,style:{flexShrink:0,...a.style},onPointerDown:Ae(a.onPointerDown,()=>{null===i.current&&(i.current=window.setInterval(r,50))}),onPointerMove:Ae(a.onPointerMove,()=>{var e;null==(e=n.onItemLeave)||e.call(n),null===i.current&&(i.current=window.setInterval(r,50))}),onPointerLeave:Ae(a.onPointerLeave,()=>{l()})})}),Mf=Nt.forwardRef((e,t)=>{const{__scopeSelect:s,...r}=e;return Ne.jsx(_e.div,{"aria-hidden":!0,...r,ref:t})});Mf.displayName="SelectSeparator";var Tf="SelectArrow";Nt.forwardRef((e,t)=>{const{__scopeSelect:s,...r}=e,a=Lp(s),n=zp(Tf,s),i=tf(Tf,s);return n.open&&"popper"===i.position?Ne.jsx(Ve,{...a,...r,ref:t}):null}).displayName=Tf;var Af=Nt.forwardRef(({__scopeSelect:e,value:t,...s},r)=>{const a=Nt.useRef(null),n=Ce(r,a),i=Tp(t);return Nt.useEffect(()=>{const e=a.current;if(!e)return;const s=window.HTMLSelectElement.prototype,r=Object.getOwnPropertyDescriptor(s,"value").set;if(i!==t&&r){const s=new Event("change",{bubbles:!0});r.call(e,t),e.dispatchEvent(s)}},[i,t]),Ne.jsx(_e.select,{...s,style:{...os,...s.style},ref:n,defaultValue:t})});function Pf(e){return""===e||void 0===e}function Df(e){const t=Pe(e),s=Nt.useRef(""),r=Nt.useRef(0),a=Nt.useCallback(e=>{const a=s.current+e;t(a),function e(t){s.current=t,window.clearTimeout(r.current),""!==t&&(r.current=window.setTimeout(()=>e(""),1e3))}(a)},[t]),n=Nt.useCallback(()=>{s.current="",window.clearTimeout(r.current)},[]);return Nt.useEffect(()=>()=>window.clearTimeout(r.current),[]),[s,a,n]}function Rf(e,t,s){const r=t.length>1&&Array.from(t).every(e=>e===t[0])?t[0]:t,a=s?e.indexOf(s):-1;let n=(i=e,o=Math.max(a,0),i.map((e,t)=>i[(o+t)%i.length]));var i,o;1===r.length&&(n=n.filter(e=>e!==s));const l=n.find(e=>e.textValue.toLowerCase().startsWith(r.toLowerCase()));return l!==s?l:void 0}Af.displayName="SelectBubbleInput";var Of=Hp,qf=Gp,If=Qp,Ff=Xp,Lf=df,$f=ff,zf=jf,Uf=bf,Wf=Nf,Vf=kf,Bf=Cf,Hf=Mf;const Kf=Vp,Yf=Yp,Gf=Nt.forwardRef(({className:e,children:t,...s},r)=>Ne.jsxs(Of,{ref:r,className:un("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...s,children:[t,Ne.jsx(qf,{asChild:!0,children:Ne.jsx(pr,{className:"h-4 w-4 opacity-50"})})]}));Gf.displayName=Of.displayName;const Qf=Nt.forwardRef(({className:e,...t},s)=>Ne.jsx(Vf,{ref:s,className:un("flex cursor-default items-center justify-center py-1",e),...t,children:Ne.jsx(gr,{className:"h-4 w-4"})}));Qf.displayName=Vf.displayName;const Jf=Nt.forwardRef(({className:e,...t},s)=>Ne.jsx(Bf,{ref:s,className:un("flex cursor-default items-center justify-center py-1",e),...t,children:Ne.jsx(pr,{className:"h-4 w-4"})}));Jf.displayName=Bf.displayName;const Xf=Nt.forwardRef(({className:e,children:t,position:s="popper",...r},a)=>Ne.jsx(If,{children:Ne.jsxs(Ff,{ref:a,className:un("relative z-[9999] max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===s&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:s,...r,children:[Ne.jsx(Qf,{}),Ne.jsx(Lf,{className:un("p-1","popper"===s&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),Ne.jsx(Jf,{})]})}));Xf.displayName=Ff.displayName;Nt.forwardRef(({className:e,...t},s)=>Ne.jsx($f,{ref:s,className:un("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...t})).displayName=$f.displayName;const Zf=Nt.forwardRef(({className:e,children:t,...s},r)=>Ne.jsxs(zf,{ref:r,className:un("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...s,children:[Ne.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:Ne.jsx(Wf,{children:Ne.jsx(mr,{className:"h-4 w-4"})})}),Ne.jsx(Uf,{children:t})]}));Zf.displayName=zf.displayName;function ex(e,t,s){const{userProfile:r}=Ih();return wo({queryKey:["store-sales-stats",e,t,s],queryFn:async()=>{if(!e||"all"===e){const{data:e,error:r}=await Dh.from("sales").select("total_amount, created_at, customer_name, sold_by").gte("created_at",(t??new Date(Date.now()-2592e6)).toISOString()).lte("created_at",(s??new Date).toISOString());if(r)throw r;const a=(null==e?void 0:e.reduce((e,t)=>e+(t.total_amount||0),0))||0,n=(null==e?void 0:e.length)||0;return{total_sales:n,total_revenue:a,average_sale_amount:n>0?a/n:0,unique_customers:new Set(null==e?void 0:e.map(e=>e.customer_name).filter(Boolean)).size,unique_sellers:0,top_selling_product:"N/A",top_selling_product_quantity:0}}return async function(e,t,s){try{let r=Dh.from("sales").select("\n        id,\n        total_amount,\n        customer_name,\n        sold_by,\n        created_at\n      ");e&&"all"!==e&&(r=r.eq("store_id",e)),t&&(r=r.gte("created_at",t.toISOString())),s&&(r=r.lte("created_at",s.toISOString()));const{data:a,error:n}=await r;if(n)throw new Error(`Erreur lors de la rcupration des statistiques: ${n.message}`);if(!a||0===a.length)return{total_sales:0,total_revenue:0,average_sale_amount:0,unique_customers:0,unique_sellers:0,top_selling_product:"Aucun",top_selling_product_quantity:0};const i=a.length,o=a.reduce((e,t)=>e+(t.total_amount||0),0),l=i>0?o/i:0,c=new Set(a.map(e=>e.customer_name).filter(Boolean)).size;return{total_sales:i,total_revenue:o,average_sale_amount:l,unique_customers:c,unique_sellers:new Set(a.map(e=>e.sold_by).filter(Boolean)).size,top_selling_product:"Calcul en cours...",top_selling_product_quantity:0}}catch(r){throw new Error(r.message||"Erreur lors de la rcupration des statistiques")}}(e,t,s)},enabled:!!r,staleTime:12e4,gcTime:3e5,refetchOnWindowFocus:!1,retry:3})}function tx(e,t,s,r){const{userProfile:a}=Ih(),{start:n,end:i}=Nt.useMemo(()=>(()=>{const e=new Date;switch(t){case"day":return{start:new Date(e.getFullYear(),e.getMonth(),e.getDate()),end:e};case"yesterday":{const t=new Date(e.getFullYear(),e.getMonth(),e.getDate()-1),s=new Date(e.getFullYear(),e.getMonth(),e.getDate());return s.setMilliseconds(s.getMilliseconds()-1),{start:t,end:s}}case"day_before_yesterday":{const t=new Date(e.getFullYear(),e.getMonth(),e.getDate()-2),s=new Date(e.getFullYear(),e.getMonth(),e.getDate()-1);return s.setMilliseconds(s.getMilliseconds()-1),{start:t,end:s}}case"week":const t=new Date(e);return t.setDate(e.getDate()-e.getDay()),{start:t,end:e};case"month":case"custom":default:return{start:new Date(e.getFullYear(),e.getMonth(),1),end:e};case"last3months":return{start:new Date(e.getFullYear(),e.getMonth()-2,1),end:e};case"year":return{start:new Date(e.getFullYear(),0,1),end:e}}})(),[t,s,r]),o=Nt.useMemo(()=>n.toISOString(),[n]),l=Nt.useMemo(()=>i.toISOString(),[i]);return wo({queryKey:["period-sales-stats",e,t,o,l],queryFn:async()=>{let t=null,s=null;const r="total_amount, customer_name, created_at, sold_at, sold_by, store_id";{let n=Dh.from("sales").select(r).eq("sold_by",a.id).gte("sold_at",o).lte("sold_at",l);e&&"all"!==e&&(n=n.eq("store_id",e));const i=await n;i.error?s=i.error:t=i.data||[]}if(!t||0===t.length){let n=Dh.from("sales").select(r).eq("sold_by",a.id).gte("created_at",o).lte("created_at",l);e&&"all"!==e&&(n=n.eq("store_id",e));const i=await n;i.error?s=s||i.error:t=i.data||[]}if(!t&&s)throw s;const n=(t||[]).reduce((e,t)=>e+(t.total_amount||0),0)||0,i=(null==t?void 0:t.length)||0;return{total_sales:i,total_revenue:n,average_sale_amount:i>0?n/i:0,unique_customers:new Set(null==t?void 0:t.map(e=>e.customer_name).filter(Boolean)).size}},enabled:!!a,staleTime:12e4,gcTime:3e5,refetchOnWindowFocus:!1,retry:3})}function sx(e,t={}){const{userProfile:s}=Ih();return wo({queryKey:["store-inventory",e,t],queryFn:async()=>{if(!e||"all"===e){const{data:e,error:t}=await Dh.from("products").select("*").eq("is_active",!0);if(t)throw t;return(null==e?void 0:e.map(e=>({product_id:e.id,product_name:e.name,sku:e.sku,current_stock:e.current_stock||0,min_stock:e.min_stock||0,max_stock:e.max_stock||0,category_name:e.category_name||"Sans catgorie",unit_symbol:e.unit_symbol||"unit",stock_status:e.current_stock<=(e.min_stock||0)?"low_stock":"normal_stock",alert_stock:e.min_stock||0})))||[]}return async function(e,t={}){try{let s=Dh.from("product_stores").select("\n        product_id,\n        current_stock,\n        min_stock,\n        max_stock,\n        products!inner(\n          id,\n          name,\n          sku,\n          is_active,\n          categories(name)\n        )\n      ").eq("products.is_active",!0);if(e&&"all"!==e&&(s=s.eq("store_id",e)),t.category_id&&(s=s.eq("products.categories.id",t.category_id)),t.stock_status)switch(t.stock_status){case"low_stock":case"alert_stock":s=s.lte("current_stock","min_stock");break;case"out_of_stock":s=s.eq("current_stock",0)}t.search_term&&(s=s.or(`products.name.ilike.%${t.search_term}%,products.sku.ilike.%${t.search_term}%`));const{data:r,error:a}=await s;if(a)throw new Error(`Erreur lors de la rcupration de l'inventaire: ${a.message}`);return(r||[]).map(e=>{var t,s,r,a;return{product_id:e.product_id,product_name:(null==(t=e.products)?void 0:t.name)||"Produit inconnu",sku:(null==(s=e.products)?void 0:s.sku)||"SKU inconnu",current_stock:e.current_stock||0,min_stock:e.min_stock||0,max_stock:e.max_stock||0,category_name:(null==(a=null==(r=e.products)?void 0:r.categories)?void 0:a.name)||"Sans catgorie",unit_symbol:"unit",stock_status:(e.current_stock||0)<=(e.min_stock||0)?"low_stock":"normal_stock",alert_stock:e.min_stock||0}})}catch(s){throw new Error(s.message||"Erreur lors de la rcupration de l'inventaire")}}(e,t)},enabled:!!s,staleTime:12e4,gcTime:3e5,refetchOnWindowFocus:!1,retry:3,retryDelay:e=>Math.min(1e3*2**e,3e4)})}function rx(){const[e,t]=Nt.useState({code:"XOF",symbol:"CFA",position:"after",decimal_places:0,thousands_separator:" ",decimal_separator:","}),[s,r]=Nt.useState(!0),a=async()=>{try{r(!0);const{data:e,error:s}=await Dh.from("system_settings").select("setting_key, setting_value, setting_type").in("setting_key",["currency.default","currency.symbol","currency.position","currency.decimal_places","currency.thousands_separator","currency.decimal_separator"]);if(s)t({code:"XOF",symbol:"CFA",position:"after",decimal_places:0,thousands_separator:" ",decimal_separator:","});else if(e&&e.length>0){const s={code:"XOF",symbol:"CFA",position:"after",decimal_places:0,thousands_separator:" ",decimal_separator:","};e.forEach(e=>{let t=e.setting_value;if("number"===e.setting_type)t=parseInt(t)||0;else if("boolean"===e.setting_type)t="true"===t||!0===t;else if("json"===e.setting_type)try{t=JSON.parse(t)}catch{t=e.setting_value}switch(e.setting_key){case"currency.default":t&&(s.code=String(t));break;case"currency.symbol":t&&(s.symbol=String(t));break;case"currency.position":!t||"before"!==t&&"after"!==t||(s.position=t);break;case"currency.decimal_places":null!=t&&(s.decimal_places=parseInt(String(t))||0);break;case"currency.thousands_separator":t&&(s.thousands_separator=String(t));break;case"currency.decimal_separator":t&&(s.decimal_separator=String(t))}}),t(s)}else t({code:"XOF",symbol:"CFA",position:"after",decimal_places:0,thousands_separator:" ",decimal_separator:","})}catch(e){t({code:"XOF",symbol:"CFA",position:"after",decimal_places:0,thousands_separator:" ",decimal_separator:","})}finally{r(!1)}};return Nt.useEffect(()=>{a()},[]),{currency:e,loading:s,formatAmount:t=>{if(null==t)return"0";const s=t.toFixed(e.decimal_places).replace(".",e.decimal_separator).replace(/\B(?=(\d{3})+(?!\d))/g,e.thousands_separator);return"before"===e.position?`${e.symbol} ${s}`:`${s} ${e.symbol}`},formatPercentage:e=>`${e>=0?"+":""}${e.toFixed(1)}%`,refreshCurrency:a}}function ax(){return Ne.jsxs(Um,{className:"bg-gradient-card border shadow-card",children:[Ne.jsxs(Wm,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Ne.jsx(sm,{className:"h-5 w-24"}),Ne.jsx(sm,{className:"h-5 w-5"})]}),Ne.jsxs(Hm,{children:[Ne.jsx(sm,{className:"h-8 w-20 mb-2"}),Ne.jsx(sm,{className:"h-3 w-32"})]})]})}function nx({count:e=4}){return Ne.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:Array.from({length:e}).map((e,t)=>Ne.jsx(ax,{},t))})}function ix(){return Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{children:[Ne.jsx(sm,{className:"h-6 w-48 mb-2"}),Ne.jsx(sm,{className:"h-4 w-64"})]}),Ne.jsx(Hm,{className:"space-y-4",children:Array.from({length:3}).map((e,t)=>Ne.jsxs("div",{className:"flex items-center justify-between p-3 bg-background rounded-lg",children:[Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(sm,{className:"h-4 w-32"}),Ne.jsx(sm,{className:"h-3 w-24"})]}),Ne.jsx(sm,{className:"h-4 w-16"})]},t))})]})}function ox({count:e=2}){return Ne.jsx("div",{className:"grid gap-6 md:grid-cols-2",children:Array.from({length:e}).map((e,t)=>Ne.jsx(ix,{},t))})}function lx(){return Ne.jsxs("div",{className:"space-y-6",children:[Ne.jsx(nx,{}),Ne.jsx(Um,{className:"bg-gradient-card shadow-card",children:Ne.jsxs(Wm,{className:"text-center",children:[Ne.jsx(sm,{className:"h-16 w-16 rounded-full mx-auto mb-4"}),Ne.jsx(sm,{className:"h-6 w-48 mx-auto mb-2"}),Ne.jsx(sm,{className:"h-4 w-64 mx-auto"})]})}),Ne.jsx(ox,{})]})}Nt.forwardRef(({className:e,...t},s)=>Ne.jsx(Hf,{ref:s,className:un("-mx-1 my-1 h-px bg-muted",e),...t})).displayName=Hf.displayName;class cx extends Nt.Component{constructor(e){super(e),xe(this,"handleRetry",()=>{this.setState({hasError:!1,error:null,errorInfo:null})}),xe(this,"handleGoHome",()=>{window.location.href="/"}),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e,errorInfo:null}}componentDidCatch(e,t){this.setState({error:e,errorInfo:t})}render(){return this.state.hasError?this.props.fallback?this.props.fallback:Ne.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:Ne.jsxs(Um,{className:"w-full max-w-md shadow-lg border-0",children:[Ne.jsxs(Wm,{className:"text-center pb-4",children:[Ne.jsx("div",{className:"mx-auto w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4",children:Ne.jsx(rr,{className:"w-8 h-8 text-red-600"})}),Ne.jsx(Vm,{className:"text-xl text-gray-800",children:"Erreur du Tableau de Bord"})]}),Ne.jsxs(Hm,{className:"space-y-4",children:[Ne.jsxs("div",{className:"text-center text-gray-600",children:[Ne.jsx("p",{className:"mb-2",children:"Une erreur s'est produite lors du chargement du tableau de bord."}),Ne.jsx("p",{className:"text-sm text-gray-500",children:"L'erreur a t enregistre et sera corrige prochainement."})]}),!1,Ne.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-2",children:[Ne.jsxs(Vh,{onClick:this.handleRetry,className:"flex-1 bg-blue-600 hover:bg-blue-700",children:[Ne.jsx(Gr,{className:"w-4 h-4 mr-2"}),"Ressayer"]}),Ne.jsxs(Vh,{onClick:this.handleGoHome,variant:"outline",className:"flex-1",children:[Ne.jsx(Pr,{className:"w-4 h-4 mr-2"}),"Accueil"]})]})]})]})}):this.props.children}}function dx(e){return(dx="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ux(e){if(null===e||!0===e||!1===e)return NaN;var t=Number(e);return isNaN(t)?t:t<0?Math.ceil(t):Math.floor(t)}function hx(e,t){if(t.length<e)throw new TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+t.length+" present")}function mx(e){hx(1,arguments);var t=Object.prototype.toString.call(e);return e instanceof Date||"object"===dx(e)&&"[object Date]"===t?new Date(e.getTime()):"number"==typeof e||"[object Number]"===t?new Date(e):new Date(NaN)}var px={};function fx(){return px}function xx(e){if(hx(1,arguments),!function(e){return hx(1,arguments),e instanceof Date||"object"===dx(e)&&"[object Date]"===Object.prototype.toString.call(e)}(e)&&"number"!=typeof e)return!1;var t=mx(e);return!isNaN(Number(t))}function gx(e,t){return hx(2,arguments),function(e,t){hx(2,arguments);var s=mx(e).getTime(),r=ux(t);return new Date(s+r)}(e,-ux(t))}function vx(e){hx(1,arguments);var t=mx(e),s=t.getUTCDay(),r=(s<1?7:0)+s-1;return t.setUTCDate(t.getUTCDate()-r),t.setUTCHours(0,0,0,0),t}function jx(e){hx(1,arguments);var t=mx(e),s=t.getUTCFullYear(),r=new Date(0);r.setUTCFullYear(s+1,0,4),r.setUTCHours(0,0,0,0);var a=vx(r),n=new Date(0);n.setUTCFullYear(s,0,4),n.setUTCHours(0,0,0,0);var i=vx(n);return t.getTime()>=a.getTime()?s+1:t.getTime()>=i.getTime()?s:s-1}function yx(e){hx(1,arguments);var t=mx(e),s=vx(t).getTime()-function(e){hx(1,arguments);var t=jx(e),s=new Date(0);return s.setUTCFullYear(t,0,4),s.setUTCHours(0,0,0,0),vx(s)}(t).getTime();return Math.round(s/6048e5)+1}function bx(e,t){var s,r,a,n,i,o,l,c;hx(1,arguments);var d=fx(),u=ux(null!==(s=null!==(r=null!==(a=null!==(n=null==t?void 0:t.weekStartsOn)&&void 0!==n?n:null==t||null===(i=t.locale)||void 0===i||null===(o=i.options)||void 0===o?void 0:o.weekStartsOn)&&void 0!==a?a:d.weekStartsOn)&&void 0!==r?r:null===(l=d.locale)||void 0===l||null===(c=l.options)||void 0===c?void 0:c.weekStartsOn)&&void 0!==s?s:0);if(!(u>=0&&u<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var h=mx(e),m=h.getUTCDay(),p=(m<u?7:0)+m-u;return h.setUTCDate(h.getUTCDate()-p),h.setUTCHours(0,0,0,0),h}function wx(e,t){var s,r,a,n,i,o,l,c;hx(1,arguments);var d=mx(e),u=d.getUTCFullYear(),h=fx(),m=ux(null!==(s=null!==(r=null!==(a=null!==(n=null==t?void 0:t.firstWeekContainsDate)&&void 0!==n?n:null==t||null===(i=t.locale)||void 0===i||null===(o=i.options)||void 0===o?void 0:o.firstWeekContainsDate)&&void 0!==a?a:h.firstWeekContainsDate)&&void 0!==r?r:null===(l=h.locale)||void 0===l||null===(c=l.options)||void 0===c?void 0:c.firstWeekContainsDate)&&void 0!==s?s:1);if(!(m>=1&&m<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var p=new Date(0);p.setUTCFullYear(u+1,0,m),p.setUTCHours(0,0,0,0);var f=bx(p,t),x=new Date(0);x.setUTCFullYear(u,0,m),x.setUTCHours(0,0,0,0);var g=bx(x,t);return d.getTime()>=f.getTime()?u+1:d.getTime()>=g.getTime()?u:u-1}function Nx(e,t){hx(1,arguments);var s=mx(e),r=bx(s,t).getTime()-function(e,t){var s,r,a,n,i,o,l,c;hx(1,arguments);var d=fx(),u=ux(null!==(s=null!==(r=null!==(a=null!==(n=null==t?void 0:t.firstWeekContainsDate)&&void 0!==n?n:null==t||null===(i=t.locale)||void 0===i||null===(o=i.options)||void 0===o?void 0:o.firstWeekContainsDate)&&void 0!==a?a:d.firstWeekContainsDate)&&void 0!==r?r:null===(l=d.locale)||void 0===l||null===(c=l.options)||void 0===c?void 0:c.firstWeekContainsDate)&&void 0!==s?s:1),h=wx(e,t),m=new Date(0);return m.setUTCFullYear(h,0,u),m.setUTCHours(0,0,0,0),bx(m,t)}(s,t).getTime();return Math.round(r/6048e5)+1}function _x(e,t){for(var s=e<0?"-":"",r=Math.abs(e).toString();r.length<t;)r="0"+r;return s+r}var kx=function(e,t){var s=e.getUTCFullYear(),r=s>0?s:1-s;return _x("yy"===t?r%100:r,t.length)},Sx=function(e,t){var s=e.getUTCMonth();return"M"===t?String(s+1):_x(s+1,2)},Cx=function(e,t){return _x(e.getUTCDate(),t.length)},Ex=function(e,t){return _x(e.getUTCHours()%12||12,t.length)},Mx=function(e,t){return _x(e.getUTCHours(),t.length)},Tx=function(e,t){return _x(e.getUTCMinutes(),t.length)},Ax=function(e,t){return _x(e.getUTCSeconds(),t.length)},Px=function(e,t){var s=t.length,r=e.getUTCMilliseconds();return _x(Math.floor(r*Math.pow(10,s-3)),t.length)},Dx="midnight",Rx="noon",Ox="morning",qx="afternoon",Ix="evening",Fx="night",Lx={G:function(e,t,s){var r=e.getUTCFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return s.era(r,{width:"abbreviated"});case"GGGGG":return s.era(r,{width:"narrow"});default:return s.era(r,{width:"wide"})}},y:function(e,t,s){if("yo"===t){var r=e.getUTCFullYear(),a=r>0?r:1-r;return s.ordinalNumber(a,{unit:"year"})}return kx(e,t)},Y:function(e,t,s,r){var a=wx(e,r),n=a>0?a:1-a;return"YY"===t?_x(n%100,2):"Yo"===t?s.ordinalNumber(n,{unit:"year"}):_x(n,t.length)},R:function(e,t){return _x(jx(e),t.length)},u:function(e,t){return _x(e.getUTCFullYear(),t.length)},Q:function(e,t,s){var r=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"Q":return String(r);case"QQ":return _x(r,2);case"Qo":return s.ordinalNumber(r,{unit:"quarter"});case"QQQ":return s.quarter(r,{width:"abbreviated",context:"formatting"});case"QQQQQ":return s.quarter(r,{width:"narrow",context:"formatting"});default:return s.quarter(r,{width:"wide",context:"formatting"})}},q:function(e,t,s){var r=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"q":return String(r);case"qq":return _x(r,2);case"qo":return s.ordinalNumber(r,{unit:"quarter"});case"qqq":return s.quarter(r,{width:"abbreviated",context:"standalone"});case"qqqqq":return s.quarter(r,{width:"narrow",context:"standalone"});default:return s.quarter(r,{width:"wide",context:"standalone"})}},M:function(e,t,s){var r=e.getUTCMonth();switch(t){case"M":case"MM":return Sx(e,t);case"Mo":return s.ordinalNumber(r+1,{unit:"month"});case"MMM":return s.month(r,{width:"abbreviated",context:"formatting"});case"MMMMM":return s.month(r,{width:"narrow",context:"formatting"});default:return s.month(r,{width:"wide",context:"formatting"})}},L:function(e,t,s){var r=e.getUTCMonth();switch(t){case"L":return String(r+1);case"LL":return _x(r+1,2);case"Lo":return s.ordinalNumber(r+1,{unit:"month"});case"LLL":return s.month(r,{width:"abbreviated",context:"standalone"});case"LLLLL":return s.month(r,{width:"narrow",context:"standalone"});default:return s.month(r,{width:"wide",context:"standalone"})}},w:function(e,t,s,r){var a=Nx(e,r);return"wo"===t?s.ordinalNumber(a,{unit:"week"}):_x(a,t.length)},I:function(e,t,s){var r=yx(e);return"Io"===t?s.ordinalNumber(r,{unit:"week"}):_x(r,t.length)},d:function(e,t,s){return"do"===t?s.ordinalNumber(e.getUTCDate(),{unit:"date"}):Cx(e,t)},D:function(e,t,s){var r=function(e){hx(1,arguments);var t=mx(e),s=t.getTime();t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0);var r=s-t.getTime();return Math.floor(r/864e5)+1}(e);return"Do"===t?s.ordinalNumber(r,{unit:"dayOfYear"}):_x(r,t.length)},E:function(e,t,s){var r=e.getUTCDay();switch(t){case"E":case"EE":case"EEE":return s.day(r,{width:"abbreviated",context:"formatting"});case"EEEEE":return s.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return s.day(r,{width:"short",context:"formatting"});default:return s.day(r,{width:"wide",context:"formatting"})}},e:function(e,t,s,r){var a=e.getUTCDay(),n=(a-r.weekStartsOn+8)%7||7;switch(t){case"e":return String(n);case"ee":return _x(n,2);case"eo":return s.ordinalNumber(n,{unit:"day"});case"eee":return s.day(a,{width:"abbreviated",context:"formatting"});case"eeeee":return s.day(a,{width:"narrow",context:"formatting"});case"eeeeee":return s.day(a,{width:"short",context:"formatting"});default:return s.day(a,{width:"wide",context:"formatting"})}},c:function(e,t,s,r){var a=e.getUTCDay(),n=(a-r.weekStartsOn+8)%7||7;switch(t){case"c":return String(n);case"cc":return _x(n,t.length);case"co":return s.ordinalNumber(n,{unit:"day"});case"ccc":return s.day(a,{width:"abbreviated",context:"standalone"});case"ccccc":return s.day(a,{width:"narrow",context:"standalone"});case"cccccc":return s.day(a,{width:"short",context:"standalone"});default:return s.day(a,{width:"wide",context:"standalone"})}},i:function(e,t,s){var r=e.getUTCDay(),a=0===r?7:r;switch(t){case"i":return String(a);case"ii":return _x(a,t.length);case"io":return s.ordinalNumber(a,{unit:"day"});case"iii":return s.day(r,{width:"abbreviated",context:"formatting"});case"iiiii":return s.day(r,{width:"narrow",context:"formatting"});case"iiiiii":return s.day(r,{width:"short",context:"formatting"});default:return s.day(r,{width:"wide",context:"formatting"})}},a:function(e,t,s){var r=e.getUTCHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return s.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"aaa":return s.dayPeriod(r,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return s.dayPeriod(r,{width:"narrow",context:"formatting"});default:return s.dayPeriod(r,{width:"wide",context:"formatting"})}},b:function(e,t,s){var r,a=e.getUTCHours();switch(r=12===a?Rx:0===a?Dx:a/12>=1?"pm":"am",t){case"b":case"bb":return s.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"bbb":return s.dayPeriod(r,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return s.dayPeriod(r,{width:"narrow",context:"formatting"});default:return s.dayPeriod(r,{width:"wide",context:"formatting"})}},B:function(e,t,s){var r,a=e.getUTCHours();switch(r=a>=17?Ix:a>=12?qx:a>=4?Ox:Fx,t){case"B":case"BB":case"BBB":return s.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"BBBBB":return s.dayPeriod(r,{width:"narrow",context:"formatting"});default:return s.dayPeriod(r,{width:"wide",context:"formatting"})}},h:function(e,t,s){if("ho"===t){var r=e.getUTCHours()%12;return 0===r&&(r=12),s.ordinalNumber(r,{unit:"hour"})}return Ex(e,t)},H:function(e,t,s){return"Ho"===t?s.ordinalNumber(e.getUTCHours(),{unit:"hour"}):Mx(e,t)},K:function(e,t,s){var r=e.getUTCHours()%12;return"Ko"===t?s.ordinalNumber(r,{unit:"hour"}):_x(r,t.length)},k:function(e,t,s){var r=e.getUTCHours();return 0===r&&(r=24),"ko"===t?s.ordinalNumber(r,{unit:"hour"}):_x(r,t.length)},m:function(e,t,s){return"mo"===t?s.ordinalNumber(e.getUTCMinutes(),{unit:"minute"}):Tx(e,t)},s:function(e,t,s){return"so"===t?s.ordinalNumber(e.getUTCSeconds(),{unit:"second"}):Ax(e,t)},S:function(e,t){return Px(e,t)},X:function(e,t,s,r){var a=(r._originalDate||e).getTimezoneOffset();if(0===a)return"Z";switch(t){case"X":return zx(a);case"XXXX":case"XX":return Ux(a);default:return Ux(a,":")}},x:function(e,t,s,r){var a=(r._originalDate||e).getTimezoneOffset();switch(t){case"x":return zx(a);case"xxxx":case"xx":return Ux(a);default:return Ux(a,":")}},O:function(e,t,s,r){var a=(r._originalDate||e).getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+$x(a,":");default:return"GMT"+Ux(a,":")}},z:function(e,t,s,r){var a=(r._originalDate||e).getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+$x(a,":");default:return"GMT"+Ux(a,":")}},t:function(e,t,s,r){var a=r._originalDate||e;return _x(Math.floor(a.getTime()/1e3),t.length)},T:function(e,t,s,r){return _x((r._originalDate||e).getTime(),t.length)}};function $x(e,t){var s=e>0?"-":"+",r=Math.abs(e),a=Math.floor(r/60),n=r%60;if(0===n)return s+String(a);var i=t;return s+String(a)+i+_x(n,2)}function zx(e,t){return e%60==0?(e>0?"-":"+")+_x(Math.abs(e)/60,2):Ux(e,t)}function Ux(e,t){var s=t||"",r=e>0?"-":"+",a=Math.abs(e);return r+_x(Math.floor(a/60),2)+s+_x(a%60,2)}var Wx=function(e,t){switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});default:return t.date({width:"full"})}},Vx=function(e,t){switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});default:return t.time({width:"full"})}},Bx={p:Vx,P:function(e,t){var s,r=e.match(/(P+)(p+)?/)||[],a=r[1],n=r[2];if(!n)return Wx(e,t);switch(a){case"P":s=t.dateTime({width:"short"});break;case"PP":s=t.dateTime({width:"medium"});break;case"PPP":s=t.dateTime({width:"long"});break;default:s=t.dateTime({width:"full"})}return s.replace("{{date}}",Wx(a,t)).replace("{{time}}",Vx(n,t))}},Hx=["D","DD"],Kx=["YY","YYYY"];function Yx(e,t,s){if("YYYY"===e)throw new RangeError("Use `yyyy` instead of `YYYY` (in `".concat(t,"`) for formatting years to the input `").concat(s,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if("YY"===e)throw new RangeError("Use `yy` instead of `YY` (in `".concat(t,"`) for formatting years to the input `").concat(s,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if("D"===e)throw new RangeError("Use `d` instead of `D` (in `".concat(t,"`) for formatting days of the month to the input `").concat(s,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if("DD"===e)throw new RangeError("Use `dd` instead of `DD` (in `".concat(t,"`) for formatting days of the month to the input `").concat(s,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"))}var Gx={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};function Qx(e){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=t.width?String(t.width):e.defaultWidth;return e.formats[s]||e.formats[e.defaultWidth]}}var Jx={date:Qx({formats:{full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},defaultWidth:"full"}),time:Qx({formats:{full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},defaultWidth:"full"}),dateTime:Qx({formats:{full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})},Xx={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"};function Zx(e){return function(t,s){var r;if("formatting"===(null!=s&&s.context?String(s.context):"standalone")&&e.formattingValues){var a=e.defaultFormattingWidth||e.defaultWidth,n=null!=s&&s.width?String(s.width):a;r=e.formattingValues[n]||e.formattingValues[a]}else{var i=e.defaultWidth,o=null!=s&&s.width?String(s.width):e.defaultWidth;r=e.values[o]||e.values[i]}return r[e.argumentCallback?e.argumentCallback(t):t]}}function eg(e){return function(t){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=s.width,a=r&&e.matchPatterns[r]||e.matchPatterns[e.defaultMatchWidth],n=t.match(a);if(!n)return null;var i,o=n[0],l=r&&e.parsePatterns[r]||e.parsePatterns[e.defaultParseWidth],c=Array.isArray(l)?function(e,t){for(var s=0;s<e.length;s++)if(t(e[s]))return s;return}(l,function(e){return e.test(o)}):function(e,t){for(var s in e)if(e.hasOwnProperty(s)&&t(e[s]))return s;return}(l,function(e){return e.test(o)});return i=e.valueCallback?e.valueCallback(c):c,{value:i=s.valueCallback?s.valueCallback(i):i,rest:t.slice(o.length)}}}function tg(e){return function(t){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.match(e.matchPattern);if(!r)return null;var a=r[0],n=t.match(e.parsePattern);if(!n)return null;var i=e.valueCallback?e.valueCallback(n[0]):n[0];return{value:i=s.valueCallback?s.valueCallback(i):i,rest:t.slice(a.length)}}}var sg={code:"en-US",formatDistance:function(e,t,s){var r,a=Gx[e];return r="string"==typeof a?a:1===t?a.one:a.other.replace("{{count}}",t.toString()),null!=s&&s.addSuffix?s.comparison&&s.comparison>0?"in "+r:r+" ago":r},formatLong:Jx,formatRelative:function(e,t,s,r){return Xx[e]},localize:{ordinalNumber:function(e,t){var s=Number(e),r=s%100;if(r>20||r<10)switch(r%10){case 1:return s+"st";case 2:return s+"nd";case 3:return s+"rd"}return s+"th"},era:Zx({values:{narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},defaultWidth:"wide"}),quarter:Zx({values:{narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},defaultWidth:"wide",argumentCallback:function(e){return e-1}}),month:Zx({values:{narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},defaultWidth:"wide"}),day:Zx({values:{narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},defaultWidth:"wide"}),dayPeriod:Zx({values:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},defaultWidth:"wide",formattingValues:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},defaultFormattingWidth:"wide"})},match:{ordinalNumber:tg({matchPattern:/^(\d+)(th|st|nd|rd)?/i,parsePattern:/\d+/i,valueCallback:function(e){return parseInt(e,10)}}),era:eg({matchPatterns:{narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^b/i,/^(a|c)/i]},defaultParseWidth:"any"}),quarter:eg({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:function(e){return e+1}}),month:eg({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:eg({matchPatterns:{narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},defaultParseWidth:"any"}),dayPeriod:eg({matchPatterns:{narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},defaultParseWidth:"any"})},options:{weekStartsOn:0,firstWeekContainsDate:1}},rg=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,ag=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,ng=/^'([^]*?)'?$/,ig=/''/g,og=/[a-zA-Z]/;function lg(e,t,s){var r,a,n,i,o,l,c,d,u,h,m,p,f,x,g,v,j,y;hx(2,arguments);var b=String(t),w=fx(),N=null!==(r=null!==(a=null==s?void 0:s.locale)&&void 0!==a?a:w.locale)&&void 0!==r?r:sg,_=ux(null!==(n=null!==(i=null!==(o=null!==(l=null==s?void 0:s.firstWeekContainsDate)&&void 0!==l?l:null==s||null===(c=s.locale)||void 0===c||null===(d=c.options)||void 0===d?void 0:d.firstWeekContainsDate)&&void 0!==o?o:w.firstWeekContainsDate)&&void 0!==i?i:null===(u=w.locale)||void 0===u||null===(h=u.options)||void 0===h?void 0:h.firstWeekContainsDate)&&void 0!==n?n:1);if(!(_>=1&&_<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var k=ux(null!==(m=null!==(p=null!==(f=null!==(x=null==s?void 0:s.weekStartsOn)&&void 0!==x?x:null==s||null===(g=s.locale)||void 0===g||null===(v=g.options)||void 0===v?void 0:v.weekStartsOn)&&void 0!==f?f:w.weekStartsOn)&&void 0!==p?p:null===(j=w.locale)||void 0===j||null===(y=j.options)||void 0===y?void 0:y.weekStartsOn)&&void 0!==m?m:0);if(!(k>=0&&k<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(!N.localize)throw new RangeError("locale must contain localize property");if(!N.formatLong)throw new RangeError("locale must contain formatLong property");var S=mx(e);if(!xx(S))throw new RangeError("Invalid time value");var C=function(e){var t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),e.getTime()-t.getTime()}(S),E=gx(S,C),M={firstWeekContainsDate:_,weekStartsOn:k,locale:N,_originalDate:S};return b.match(ag).map(function(e){var t=e[0];return"p"===t||"P"===t?(0,Bx[t])(e,N.formatLong):e}).join("").match(rg).map(function(r){if("''"===r)return"'";var a=r[0];if("'"===a)return function(e){var t=e.match(ng);if(!t)return e;return t[1].replace(ig,"'")}(r);var n,i=Lx[a];if(i)return null!=s&&s.useAdditionalWeekYearTokens||(n=r,-1===Kx.indexOf(n))||Yx(r,t,String(e)),null!=s&&s.useAdditionalDayOfYearTokens||!function(e){return-1!==Hx.indexOf(e)}(r)||Yx(r,t,String(e)),i(E,r,N.localize,M);if(a.match(og))throw new RangeError("Format string contains an unescaped latin alphabet character `"+a+"`");return r}).join("")}var cg={lessThanXSeconds:{one:"moins dune seconde",other:"moins de {{count}} secondes"},xSeconds:{one:"1 seconde",other:"{{count}} secondes"},halfAMinute:"30 secondes",lessThanXMinutes:{one:"moins dune minute",other:"moins de {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"environ 1 heure",other:"environ {{count}} heures"},xHours:{one:"1 heure",other:"{{count}} heures"},xDays:{one:"1 jour",other:"{{count}} jours"},aboutXWeeks:{one:"environ 1 semaine",other:"environ {{count}} semaines"},xWeeks:{one:"1 semaine",other:"{{count}} semaines"},aboutXMonths:{one:"environ 1 mois",other:"environ {{count}} mois"},xMonths:{one:"1 mois",other:"{{count}} mois"},aboutXYears:{one:"environ 1 an",other:"environ {{count}} ans"},xYears:{one:"1 an",other:"{{count}} ans"},overXYears:{one:"plus dun an",other:"plus de {{count}} ans"},almostXYears:{one:"presquun an",other:"presque {{count}} ans"}},dg={date:Qx({formats:{full:"EEEE d MMMM y",long:"d MMMM y",medium:"d MMM y",short:"dd/MM/y"},defaultWidth:"full"}),time:Qx({formats:{full:"HH:mm:ss zzzz",long:"HH:mm:ss z",medium:"HH:mm:ss",short:"HH:mm"},defaultWidth:"full"}),dateTime:Qx({formats:{full:"{{date}} '' {{time}}",long:"{{date}} '' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})},ug={lastWeek:"eeee 'dernier ' p",yesterday:"'hier ' p",today:"'aujourdhui ' p",tomorrow:"'demain ' p'",nextWeek:"eeee 'prochain ' p",other:"P"},hg={ordinalNumber:function(e,t){var s=Number(e),r=null==t?void 0:t.unit;if(0===s)return"0";return s+(1===s?r&&["year","week","hour","minute","second"].includes(r)?"re":"er":"me")},era:Zx({values:{narrow:["av. J.-C","ap. J.-C"],abbreviated:["av. J.-C","ap. J.-C"],wide:["avant Jsus-Christ","aprs Jsus-Christ"]},defaultWidth:"wide"}),quarter:Zx({values:{narrow:["T1","T2","T3","T4"],abbreviated:["1er trim.","2me trim.","3me trim.","4me trim."],wide:["1er trimestre","2me trimestre","3me trimestre","4me trimestre"]},defaultWidth:"wide",argumentCallback:function(e){return e-1}}),month:Zx({values:{narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["janv.","fvr.","mars","avr.","mai","juin","juil.","aot","sept.","oct.","nov.","dc."],wide:["janvier","fvrier","mars","avril","mai","juin","juillet","aot","septembre","octobre","novembre","dcembre"]},defaultWidth:"wide"}),day:Zx({values:{narrow:["D","L","M","M","J","V","S"],short:["di","lu","ma","me","je","ve","sa"],abbreviated:["dim.","lun.","mar.","mer.","jeu.","ven.","sam."],wide:["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"]},defaultWidth:"wide"}),dayPeriod:Zx({values:{narrow:{am:"AM",pm:"PM",midnight:"minuit",noon:"midi",morning:"mat.",afternoon:"ap.m.",evening:"soir",night:"mat."},abbreviated:{am:"AM",pm:"PM",midnight:"minuit",noon:"midi",morning:"matin",afternoon:"aprs-midi",evening:"soir",night:"matin"},wide:{am:"AM",pm:"PM",midnight:"minuit",noon:"midi",morning:"du matin",afternoon:"de laprs-midi",evening:"du soir",night:"du matin"}},defaultWidth:"wide"})},mg={code:"fr",formatDistance:function(e,t,s){var r,a=cg[e];return r="string"==typeof a?a:1===t?a.one:a.other.replace("{{count}}",String(t)),null!=s&&s.addSuffix?s.comparison&&s.comparison>0?"dans "+r:"il y a "+r:r},formatLong:dg,formatRelative:function(e,t,s,r){return ug[e]},localize:hg,match:{ordinalNumber:tg({matchPattern:/^(\d+)(ime|re|me|er|e)?/i,parsePattern:/\d+/i,valueCallback:function(e){return parseInt(e)}}),era:eg({matchPatterns:{narrow:/^(av\.J\.C|ap\.J\.C|ap\.J\.-C)/i,abbreviated:/^(av\.J\.-C|av\.J-C|apr\.J\.-C|apr\.J-C|ap\.J-C)/i,wide:/^(avant Jsus-Christ|aprs Jsus-Christ)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^av/i,/^ap/i]},defaultParseWidth:"any"}),quarter:eg({matchPatterns:{narrow:/^T?[1234]/i,abbreviated:/^[1234](er|me|e)? trim\.?/i,wide:/^[1234](er|me|e)? trimestre/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:function(e){return e+1}}),month:eg({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(janv|fvr|mars|avr|mai|juin|juill|juil|aot|sept|oct|nov|dc)\.?/i,wide:/^(janvier|fvrier|mars|avril|mai|juin|juillet|aot|septembre|octobre|novembre|dcembre)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^av/i,/^ma/i,/^juin/i,/^juil/i,/^ao/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:eg({matchPatterns:{narrow:/^[lmjvsd]/i,short:/^(di|lu|ma|me|je|ve|sa)/i,abbreviated:/^(dim|lun|mar|mer|jeu|ven|sam)\.?/i,wide:/^(dimanche|lundi|mardi|mercredi|jeudi|vendredi|samedi)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^d/i,/^l/i,/^m/i,/^m/i,/^j/i,/^v/i,/^s/i],any:[/^di/i,/^lu/i,/^ma/i,/^me/i,/^je/i,/^ve/i,/^sa/i]},defaultParseWidth:"any"}),dayPeriod:eg({matchPatterns:{narrow:/^(a|p|minuit|midi|mat\.?|ap\.?m\.?|soir|nuit)/i,any:/^([ap]\.?\s?m\.?|du matin|de l'aprs[-\s]midi|du soir|de la nuit)/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^min/i,noon:/^mid/i,morning:/mat/i,afternoon:/ap/i,evening:/soir/i,night:/nuit/i}},defaultParseWidth:"any"})},options:{weekStartsOn:1,firstWeekContainsDate:4}};function pg(){var e;const{userProfile:t}=Ih(),{recentSales:s,lowStockProducts:r,loading:a,error:n,refetch:i}=function(){const[e,t]=Nt.useState({dailySales:{amount:0,count:0,percentageChange:0},totalSales:{amount:0,count:0,productsSold:0},totalProducts:{count:0,lowStockCount:0},lowStockProducts:[],recentSales:[],loading:!0,error:null}),{userProfile:s}=Ih(),r=Nt.useCallback(async()=>{var e;try{if(t(e=>({...e,loading:!0,error:null})),!(null==s?void 0:s.id))return void t(e=>({...e,loading:!1}));const{data:r,error:a}=await Dh.from("user_stores").select("store_id").eq("user_id",s.id);if(a)throw new Error(`Erreur lors de la rcupration des magasins: ${a.message}`);const n=(null==r?void 0:r.map(e=>e.store_id))||[],[h,m,p,f,x,g]=await Promise.all([i(s.id),o(s.id),l(s.id,n),c(n),d(n),u(s.id)]);if(h.error)throw new Error(`Erreur ventes du jour: ${h.error.message}`);if(m.error)throw new Error(`Erreur ventes hier: ${m.error.message}`);if(p.error)throw new Error(`Erreur ventes mensuelles: ${p.error.message}`);if(f.error)throw new Error(`Erreur comptage produits: ${f.error.message}`);if(x.error)throw new Error(`Erreur stock faible: ${x.error.message}`);if(g.error)throw new Error(`Erreur ventes rcentes: ${g.error.message}`);const v=h.data||[],j=m.data||[],y=p.data||[],b=v.reduce((e,t)=>e+(t.total_amount||0),0),w=v.length,N=j.reduce((e,t)=>e+(t.total_amount||0),0),_=N>0?(b-N)/N*100:0,k=y.reduce((e,t)=>{var s;return e+((null==(s=t.sale_items)?void 0:s.reduce((e,t)=>e+(t.quantity||0),0))||0)},0),S=y.reduce((e,t)=>e+(t.total_amount||0),0),C=y.length;t({dailySales:{amount:b,count:w,percentageChange:_},totalSales:{amount:S,count:C,productsSold:k},totalProducts:{count:f.data||0,lowStockCount:(null==(e=x.data)?void 0:e.length)||0},lowStockProducts:x.data||[],recentSales:g.data||[],loading:!1,error:null})}catch(n){t(t=>({...t,loading:!1,error:n instanceof Error?n.message:"Erreur inconnue"}))}},[s]),a=Nt.useCallback(()=>{r()},[r]);Nt.useEffect(()=>{s&&r()},[s,r]);const i=async e=>{const t=new Date;t.setHours(0,0,0,0);const s=new Date(t);return s.setDate(s.getDate()+1),await Dh.from("sales").select("total_amount, created_at").eq("sold_by",e).gte("created_at",t.toISOString()).lt("created_at",s.toISOString())},o=async e=>{const t=new Date;t.setHours(0,0,0,0);const s=new Date(t);return s.setDate(s.getDate()-1),await Dh.from("sales").select("total_amount").eq("sold_by",e).gte("created_at",s.toISOString()).lt("created_at",t.toISOString())},l=async(e,t)=>{const s=new Date,r=new Date(s.getFullYear(),s.getMonth(),1),a=new Date(s);a.setDate(a.getDate()+1);let n=Dh.from("sales").select("\n        total_amount,\n        sale_items (quantity)\n      ").eq("sold_by",e).gte("created_at",r.toISOString()).lt("created_at",a.toISOString());return t.length>0&&(n=n.in("store_id",t)),await n},c=async e=>{if(0===e.length)return{data:0};const{data:t,error:s}=await Dh.from("product_stores").select("product_id").in("store_id",e);if(s)throw s;return{data:[...new Set((null==t?void 0:t.map(e=>e.product_id))||[])].length,error:null}},d=async e=>{if(0===e.length)return{data:[]};try{const{data:t,error:s}=await Dh.from("low_stock_products_view").select("*").in("store_id",e);if(s)throw s;return{data:(null==t?void 0:t.map(e=>({id:e.product_id,name:e.product_name,sku:e.product_sku,current_stock:e.current_stock,alert_stock:e.alert_stock,store_name:e.store_name})))||[],error:null}}catch(n){const{data:s,error:r}=await Dh.from("product_stores").select("\n          products (\n            id, name, sku, alert_stock\n          ),\n          stores (name),\n          current_stock\n        ").in("store_id",e);if(r)throw r;return{data:(null==s?void 0:s.filter(e=>{const t=Array.isArray(e.products)?e.products[0]:e.products;return t&&e.current_stock<(t.alert_stock||0)}).map(e=>{const t=Array.isArray(e.products)?e.products[0]:e.products,s=Array.isArray(e.stores)?e.stores[0]:e.stores;return{id:null==t?void 0:t.id,name:null==t?void 0:t.name,sku:null==t?void 0:t.sku,current_stock:e.current_stock,alert_stock:null==t?void 0:t.alert_stock,store_name:null==s?void 0:s.name}}).filter(e=>e.id))||[],error:null}}},u=async e=>{const{data:t,error:s}=await Dh.from("sales").select("\n        id, sale_code, total_amount, customer_name, created_at,\n        stores (name)\n      ").eq("sold_by",e).order("created_at",{ascending:!1}).limit(5);if(s)throw s;return{data:(null==t?void 0:t.map(e=>{const t=Array.isArray(e.stores)?e.stores[0]:e.stores;return{id:e.id,sale_code:e.sale_code,total_amount:e.total_amount,customer_name:e.customer_name,created_at:e.created_at,store_name:null==t?void 0:t.name}}))||[],error:null}};return{...e,refetch:a}}(),{formatAmount:o}=rx(),l=pl(),[c,d]=Nt.useState("day"),[u,h]=Nt.useState("day"),[m,p]=Nt.useState("all"),[f,x]=Nt.useState(!1),g="Vendeur"===(null==t?void 0:t.role);Nt.useEffect(()=>{if(!t)return;"Admin"===t.role||"SuperAdmin"===t.role||"year"!==c&&"last3months"!==c||d("day")},[t,c]);const[v,j]=Nt.useState([]),y=Nt.useMemo(()=>"all"===m?"all":"current"===m?null==t?void 0:t.store_id:m,[m,null==t?void 0:t.store_id]);Nt.useMemo(()=>v.map(e=>e.id),[v]);const b=Nt.useMemo(()=>{const e=new Date;switch(c){case"day":return{start:new Date(e.getFullYear(),e.getMonth(),e.getDate()),end:e};case"yesterday":{const t=new Date(e.getFullYear(),e.getMonth(),e.getDate()-1),s=new Date(e.getFullYear(),e.getMonth(),e.getDate());return s.setMilliseconds(s.getMilliseconds()-1),{start:t,end:s}}case"day_before_yesterday":{const t=new Date(e.getFullYear(),e.getMonth(),e.getDate()-2),s=new Date(e.getFullYear(),e.getMonth(),e.getDate()-1);return s.setMilliseconds(s.getMilliseconds()-1),{start:t,end:s}}case"week":{const t=new Date(e);return t.setDate(e.getDate()-e.getDay()),{start:t,end:e}}case"last3months":return{start:new Date(e.getFullYear(),e.getMonth()-2,1),end:e};case"year":return{start:new Date(e.getFullYear(),0,1),end:e};default:return{start:new Date(e.getFullYear(),e.getMonth(),1),end:e}}},[c]),{data:w,isLoading:N}=ex(y,b.start,b.end),{data:_,isLoading:k}=tx(y,u),S=Nt.useMemo(()=>{if(!s||0===s.length)return[];let e=s;if(c){const t=new Date;let s;switch(c){case"day":s=new Date(t.getFullYear(),t.getMonth(),t.getDate());break;case"yesterday":s=new Date(t.getFullYear(),t.getMonth(),t.getDate()-1);break;case"day_before_yesterday":s=new Date(t.getFullYear(),t.getMonth(),t.getDate()-2);break;case"week":s=new Date(t),s.setDate(t.getDate()-t.getDay());break;case"last3months":s=new Date(t.getFullYear(),t.getMonth()-2,1);break;case"year":s=new Date(t.getFullYear(),0,1);break;default:return e}e=e.filter(e=>{const r=new Date(e.created_at);return r>=s&&r<=t})}return e},[s,c]),{data:C,isLoading:E}=function(e,t=10,s,r){const{userProfile:a}=Ih();return wo({queryKey:["top-selling-products",e,t,null==s?void 0:s.toISOString(),null==r?void 0:r.toISOString()],queryFn:async()=>{if(!e||"all"===e){const{data:e,error:a}=await Dh.from("sale_items").select("\n            product_id,\n            product_name,\n            product_sku,\n            quantity,\n            total_price\n          ").gte("created_at",(s??new Date(Date.now()-2592e6)).toISOString()).lte("created_at",(r??new Date).toISOString()).order("quantity",{ascending:!1}).limit(t);if(a)throw new Error(`Erreur lors de la rcupration des meilleures ventes: ${a.message}`);return((null==e?void 0:e.reduce((e,t)=>{const s=e.find(e=>e.product_id===t.product_id);return s?(s.total_quantity+=t.quantity,s.total_revenue+=t.total_price):e.push({product_id:t.product_id,product_name:t.product_name,product_sku:t.product_sku,total_quantity:t.quantity,total_revenue:t.total_price}),e},[]))||[]).sort((e,t)=>t.total_quantity-e.total_quantity)}const{data:a,error:n}=await Dh.from("sale_items").select("\n          product_id,\n          product_name,\n          product_sku,\n          quantity,\n          total_price,\n          sales!inner(store_id, sold_at)\n        ").eq("sales.store_id",e).gte("sales.sold_at",(s??new Date(Date.now()-2592e6)).toISOString()).lte("sales.sold_at",(r??new Date).toISOString()).order("quantity",{ascending:!1}).limit(t);if(n)throw new Error(`Erreur lors de la rcupration des meilleures ventes: ${n.message}`);return((null==a?void 0:a.reduce((e,t)=>{const s=e.find(e=>e.product_id===t.product_id);return s?(s.total_quantity+=t.quantity,s.total_revenue+=t.total_price):e.push({product_id:t.product_id,product_name:t.product_name,product_sku:t.product_sku,total_quantity:t.quantity,total_revenue:t.total_price}),e},[]))||[]).sort((e,t)=>t.total_quantity-e.total_quantity)},enabled:!!a,staleTime:3e5,gcTime:6e5,refetchOnWindowFocus:!1,retry:3})}(y,5,b.start,b.end),{data:M,isLoading:T}=sx(y),A=N||k||E||T;Nt.useEffect(()=>{(async()=>{if(null==t?void 0:t.id)try{if("Admin"===t.role||"SuperAdmin"===t.role){const{data:e,error:t}=await Dh.from("stores").select("id, name").order("name",{ascending:!0});if(t)return;j((e||[]).map(e=>({id:e.id,name:e.name})))}else{const{data:e,error:s}=await Dh.from("user_stores").select("\n              store_id,\n              stores (name)\n            ").eq("user_id",t.id);if(s)return;const r=(null==e?void 0:e.map(e=>{var t;return{id:e.store_id,name:(null==(t=e.stores)?void 0:t.name)||`Magasin ${e.store_id}`}}))||[];j(r)}}catch(e){}})()},[null==t?void 0:t.id,null==t?void 0:t.role]);const P=!a&&!n&&s&&r,D=Nt.useMemo(()=>r&&0!==r.length?r:[],[r]);return n?Ne.jsxs("div",{className:"space-y-6",children:[Ne.jsx("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:Ne.jsxs("div",{children:[Ne.jsxs("h1",{className:"text-2xl md:text-3xl font-bold flex items-center gap-2",children:["Bonjour ",(null==t?void 0:t.first_name)||"Utilisateur"," ! ",""]}),Ne.jsx("p",{className:"text-muted-foreground",children:"Aperu de votre activit aujourd'hui"})]})}),Ne.jsxs("div",{className:"bg-destructive/10 border border-destructive/20 rounded-lg p-6 text-center",children:[Ne.jsx(rr,{className:"w-12 h-12 text-destructive mx-auto mb-4"}),Ne.jsx("h3",{className:"text-lg font-semibold text-destructive mb-2",children:"Erreur de chargement"}),Ne.jsx("p",{className:"text-destructive/80 mb-4",children:"Impossible de charger les donnes du tableau de bord"}),Ne.jsxs(Vh,{variant:"outline",onClick:()=>window.location.reload(),className:"gap-2",children:[Ne.jsx(Gr,{className:"w-4 h-4"}),"Ressayer"]})]})]}):Ne.jsx(cx,{children:Ne.jsxs("div",{className:"space-y-4 p-4 sm:space-y-6 sm:p-6",children:[Ne.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[Ne.jsxs("div",{children:[Ne.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Tableau de Bord"}),Ne.jsxs("p",{className:"text-gray-600 mt-1",children:["Bienvenue, ",null==t?void 0:t.first_name," ",null==t?void 0:t.last_name]})]}),("Manager"===(null==t?void 0:t.role)||"SuperAdmin"===(null==t?void 0:t.role))&&Ne.jsxs("div",{className:"flex flex-wrap gap-2",children:[Ne.jsxs(Vh,{onClick:()=>l("/sales"),className:"bg-green-600 hover:bg-green-700 transition-all duration-200 shadow-lg hover:shadow-xl",title:"Crer une nouvelle vente - Accs direct  la page des ventes",children:[Ne.jsx(Yr,{className:"w-4 h-4 mr-2"}),"Nouvelle vente"]}),"SuperAdmin"===(null==t?void 0:t.role)&&Ne.jsxs(Vh,{onClick:()=>l("/transfers"),variant:"outline",className:"border-blue-300 text-blue-700 hover:bg-blue-50 transition-all duration-200",title:"Crer un nouveau transfert - Accs direct  la page des transferts",children:[Ne.jsx(Ur,{className:"w-4 h-4 mr-2"}),"Nouveau transfert"]})]}),"Vendeur"===(null==t?void 0:t.role)&&Ne.jsxs(Vh,{onClick:()=>l("/sales"),className:"bg-green-600 hover:bg-green-700 transition-all duration-200 shadow-lg hover:shadow-xl",title:"Crer une nouvelle vente - Accs direct  la page des ventes",children:[Ne.jsx(Yr,{className:"w-4 h-4 mr-2"}),"Nouvelle vente"]})]}),Ne.jsxs(Um,{children:[Ne.jsx(Wm,{className:"pb-3 sm:pb-4",children:Ne.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 sm:gap-4",children:[Ne.jsxs("div",{children:[Ne.jsx(Vm,{className:"text-xl",children:"Statistiques avances"}),Ne.jsx(Bm,{children:"Synthse personnelle et performances du magasin slectionn"})]}),Ne.jsxs("div",{className:"flex flex-wrap gap-2 w-full sm:w-auto",children:[Ne.jsxs(Kf,{value:u,onValueChange:e=>h(e),children:[Ne.jsx(Gf,{className:"w-full sm:w-32",children:Ne.jsx(Yf,{})}),Ne.jsxs(Xf,{children:[Ne.jsx(Zf,{value:"day",children:"Aujourd'hui"}),Ne.jsx(Zf,{value:"yesterday",children:"Hier"}),Ne.jsx(Zf,{value:"day_before_yesterday",children:"Avant-hier"}),Ne.jsx(Zf,{value:"week",children:"Cette semaine"}),Ne.jsx(Zf,{value:"month",children:"Ce mois"}),("Admin"===(null==t?void 0:t.role)||"SuperAdmin"===(null==t?void 0:t.role))&&Ne.jsxs(Ne.Fragment,{children:[Ne.jsx(Zf,{value:"last3months",children:"3 mois derniers"}),Ne.jsx(Zf,{value:"year",children:"Cette anne"})]})]})]}),Ne.jsxs(Vh,{onClick:async()=>{x(!0);try{await i()}catch(e){}finally{x(!1)}},variant:"outline",size:"sm",disabled:a||f,children:[Ne.jsx(Gr,{className:"w-4 h-4 mr-2 "+(a||f?"animate-spin":"")}),"Actualiser"]})]})]})}),Ne.jsxs(Hm,{className:"space-y-4 sm:space-y-6",children:[k?Ne.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 mb-4 sm:mb-6",children:Array.from({length:4}).map((e,t)=>Ne.jsx("div",{className:"h-20 sm:h-24 bg-muted animate-pulse rounded-lg"},t))}):Ne.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 mb-4 sm:mb-6",children:[Ne.jsx(Um,{className:"bg-gradient-to-r from-blue-50 to-blue-100 border-blue-200",children:Ne.jsxs(Hm,{className:"p-4 text-center",children:[Ne.jsx(_r,{className:"w-8 h-8 text-blue-600 mx-auto mb-2"}),Ne.jsx("div",{className:"text-2xl font-bold text-blue-900",children:(null==_?void 0:_.total_revenue)?o(_.total_revenue):"0"}),Ne.jsx("p",{className:"text-sm text-blue-700 font-medium",children:"Mon chiffre d'affaires"}),Ne.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"Donnes personnelles (filtres par Priode)"})]})}),Ne.jsx(Um,{className:"bg-gradient-to-r from-green-50 to-green-100 border-green-200",children:Ne.jsxs(Hm,{className:"p-4 text-center",children:[Ne.jsx(ta,{className:"w-8 h-8 text-green-600 mx-auto mb-2"}),Ne.jsx("div",{className:"text-2xl font-bold text-green-900",children:(null==_?void 0:_.total_sales)||0}),Ne.jsx("p",{className:"text-sm text-green-700 font-medium",children:"Mes ventes"}),Ne.jsx("p",{className:"text-xs text-green-600 mt-1",children:"Donnes personnelles (filtres par Priode)"})]})}),Ne.jsx(Um,{className:"bg-gradient-to-r from-orange-50 to-orange-100 border-orange-200",children:Ne.jsxs(Hm,{className:"p-4 text-center",children:[Ne.jsx(rr,{className:"w-8 h-8 text-orange-600 mx-auto mb-2"}),Ne.jsx("div",{className:"text-2xl font-bold text-orange-900",children:(null==r?void 0:r.length)||0}),Ne.jsx("p",{className:"text-sm text-orange-700 font-medium",children:"Stock faible"})]})}),Ne.jsx(Um,{className:"bg-gradient-to-r from-purple-50 to-purple-100 border-purple-200",children:Ne.jsxs(Hm,{className:"p-4 text-center",children:[Ne.jsx(ra,{className:"w-8 h-8 text-purple-600 mx-auto mb-2"}),Ne.jsx("div",{className:"text-2xl font-bold text-purple-900",children:(null==v?void 0:v.length)||0}),Ne.jsx("p",{className:"text-sm text-purple-700 font-medium",children:"Magasins actifs"})]})})]}),!g&&Ne.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4",children:[Ne.jsxs("div",{className:"flex-1",children:[Ne.jsxs("label",{className:"text-sm font-medium mb-2 block",children:["Priode",!("Admin"===(null==t?void 0:t.role)||"SuperAdmin"===(null==t?void 0:t.role))&&Ne.jsx("span",{className:"ml-2 text-xs text-muted-foreground",children:"(Anne rserve aux admins)"})]}),Ne.jsxs(Kf,{value:c,onValueChange:e=>d(e),children:[Ne.jsx(Gf,{className:"w-full",children:Ne.jsx(Yf,{placeholder:"Slectionner une priode"})}),Ne.jsxs(Xf,{children:[Ne.jsx(Zf,{value:"day",children:"Aujourd'hui"}),Ne.jsx(Zf,{value:"yesterday",children:"Hier"}),Ne.jsx(Zf,{value:"day_before_yesterday",children:"Avant-hier"}),Ne.jsx(Zf,{value:"week",children:"Cette semaine"}),Ne.jsx(Zf,{value:"month",children:"Ce mois"}),("Admin"===(null==t?void 0:t.role)||"SuperAdmin"===(null==t?void 0:t.role))&&Ne.jsxs(Ne.Fragment,{children:[Ne.jsx(Zf,{value:"last3months",children:"3 mois derniers"}),Ne.jsx(Zf,{value:"year",children:"Cette anne"})]})]})]})]}),Ne.jsxs("div",{className:"flex-1",children:[Ne.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Magasin"}),Ne.jsxs(Kf,{value:m,onValueChange:p,children:[Ne.jsx(Gf,{className:"w-full",children:Ne.jsx(Yf,{placeholder:"Tous les magasins"})}),Ne.jsxs(Xf,{children:[Ne.jsx(Zf,{value:"all",children:"Tous les magasins"}),v.map(e=>Ne.jsx(Zf,{value:e.id,children:e.name},e.id))]})]})]})]}),!g&&Ne.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[Ne.jsxs(Cp,{variant:"outline",className:"text-xs",children:[" Priode: ","day"===c?"Aujourd'hui":"yesterday"===c?"Hier":"day_before_yesterday"===c?"Avant-hier":"week"===c?"Cette semaine":"month"===c?"Ce mois":"last3months"===c?"3 mois derniers":"Cette anne"]}),Ne.jsxs(Cp,{variant:"outline",className:"text-xs",children:[" Magasin: ","all"===m?"Tous":(null==(e=v.find(e=>e.id===m))?void 0:e.name)||m]})]}),g?null:k||N?Ne.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-4 gap-3 sm:gap-4",children:Array.from({length:4}).map((e,t)=>Ne.jsx("div",{className:"h-20 bg-muted animate-pulse rounded-lg"},t))}):w&&Object.keys(w).length>0?Ne.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-4 gap-3 sm:gap-4",children:[Ne.jsx(Um,{className:"bg-background/50",children:Ne.jsxs(Hm,{className:"p-4 text-center",children:[Ne.jsx(_r,{className:"w-6 h-6 text-green-600 mx-auto mb-2"}),Ne.jsx("div",{className:"text-2xl font-bold",children:o(w.total_revenue||0)}),Ne.jsx("div",{className:"text-xs text-muted-foreground",children:"Chiffre d'affaires du magasin"})]})}),Ne.jsx(Um,{className:"bg-background/50",children:Ne.jsxs(Hm,{className:"p-4 text-center",children:[Ne.jsx(ta,{className:"w-6 h-6 text-blue-600 mx-auto mb-2"}),Ne.jsx("div",{className:"text-2xl font-bold",children:w.total_sales||0}),Ne.jsx("div",{className:"text-xs text-muted-foreground",children:"Ventes du magasin"})]})}),Ne.jsx(Um,{className:"bg-background/50",children:Ne.jsxs(Hm,{className:"p-4 text-center",children:[Ne.jsx(ma,{className:"w-6 h-6 text-purple-600 mx-auto mb-2"}),Ne.jsx("div",{className:"text-2xl font-bold",children:w.unique_customers||0}),Ne.jsx("div",{className:"text-xs text-muted-foreground",children:"Clients uniques"})]})}),Ne.jsx(Um,{className:"bg-background/50",children:Ne.jsxs(Hm,{className:"p-4 text-center",children:[Ne.jsx(ia,{className:"w-6 h-6 text-orange-600 mx-auto mb-2"}),Ne.jsx("div",{className:"text-2xl font-bold",children:o(w.average_sale_amount||0)}),Ne.jsx("div",{className:"text-xs text-muted-foreground",children:"Panier moyen"})]})})]}):Ne.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Aucune donne disponible pour cette priode"}),g?null:A?Ne.jsx("div",{className:"space-y-2 sm:space-y-3",children:Array.from({length:3}).map((e,t)=>Ne.jsx("div",{className:"h-10 sm:h-12 bg-muted animate-pulse rounded-lg"},t))}):C&&Array.isArray(C)&&C.length>0?Ne.jsxs("div",{className:"space-y-2 sm:space-y-3",children:[Ne.jsx("h4",{className:"font-semibold text-sm text-muted-foreground",children:"Produits les plus vendus (magasin)"}),C.slice(0,3).map((e,t)=>Ne.jsxs("div",{className:"flex items-center justify-between p-3 bg-background/50 rounded-lg",children:[Ne.jsxs("div",{className:"flex items-center gap-3",children:[Ne.jsxs(Cp,{variant:"outline",className:"text-xs",children:["#",t+1]}),Ne.jsxs("div",{children:[Ne.jsx("div",{className:"font-medium text-sm",children:e.product_name}),Ne.jsx("div",{className:"text-xs text-muted-foreground",children:e.product_sku})]})]}),Ne.jsxs("div",{className:"text-right",children:[Ne.jsxs("div",{className:"font-semibold text-sm",children:[e.total_quantity," units"]}),Ne.jsx("div",{className:"text-xs text-muted-foreground",children:o(e.total_revenue)})]})]},e.product_id))]}):Ne.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Aucun produit vendu pour cette priode"})]})]}),a?Ne.jsx(lx,{}):P?Ne.jsxs(Ne.Fragment,{children:[Ne.jsx(Um,{className:"bg-gradient-to-r from-blue-50 to-blue-100 border-blue-200",children:Ne.jsxs(Wm,{className:"text-center",children:[Ne.jsx("div",{className:"w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4 "+(0===r.length?"bg-green-100":"bg-orange-100"),children:0===r.length?Ne.jsx(hr,{className:"w-8 h-8 text-green-600"}):Ne.jsx(rr,{className:"w-8 h-8 text-orange-600"})}),Ne.jsx(Vm,{className:"text-xl",children:0===D.length?"Stock optimal":"Attention au stock"}),Ne.jsx(Bm,{children:0===D.length?"Stock suffisant pour tous les produits":`${D.length} produit${D.length>1?"s":""} en alerte`})]})}),Ne.jsxs("div",{className:"grid gap-4 sm:gap-6 md:grid-cols-2",children:[Ne.jsxs(Um,{className:"bg-gradient-to-r from-green-50 to-green-100 border-green-200",children:[Ne.jsxs(Wm,{children:[Ne.jsxs(Vm,{className:"flex items-center gap-2",children:[Ne.jsx(ta,{className:"w-5 h-5 text-green-600"}),"Ventes rcentes"]}),Ne.jsx(Bm,{children:"Dernires transactions effectues"})]}),Ne.jsx(Hm,{children:0===s.length?Ne.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[Ne.jsx(ta,{className:"w-16 h-16 text-muted-foreground/20 mb-4"}),Ne.jsx("p",{className:"text-muted-foreground",children:"Aucune vente rcente"}),(null==t?void 0:t.role)&&["Vendeur","Manager","Admin","SuperAdmin"].includes(t.role)&&Ne.jsx(Vh,{variant:"outline",className:"mt-4",onClick:()=>{(null==t?void 0:t.role)&&["Vendeur","Manager","Admin","SuperAdmin"].includes(t.role)&&l("/sales")},children:"Voir toutes les ventes"})]}):Ne.jsx("div",{className:"space-y-2 sm:space-y-3",children:S.slice(0,5).map(e=>Ne.jsx("div",{className:"p-3 bg-white rounded-lg border border-green-200",children:Ne.jsxs("div",{className:"flex items-start justify-between gap-3",children:[Ne.jsxs("div",{className:"min-w-0 flex-1",children:[Ne.jsx("p",{className:"font-medium text-sm truncate",children:e.sale_code}),Ne.jsxs("p",{className:"text-xs text-muted-foreground truncate",children:[e.customer_name,"  ",lg(new Date(e.created_at),"dd/MM/yyyy",{locale:mg})]})]}),Ne.jsxs("div",{className:"text-right shrink-0",children:[Ne.jsx("p",{className:"font-semibold text-sm",children:o(e.total_amount)}),Ne.jsx("p",{className:"text-xs text-muted-foreground",children:e.store_name})]})]})},e.id))})})]}),Ne.jsxs(Um,{className:"bg-gradient-to-r from-orange-50 to-orange-100 border-orange-200",children:[Ne.jsxs(Wm,{children:[Ne.jsxs(Vm,{className:"flex items-center gap-2",children:[Ne.jsx(rr,{className:"w-5 h-5 text-orange-600"}),"Produits en alerte stock"]}),Ne.jsx(Bm,{children:"Produits ncessitant un rapprovisionnement"})]}),Ne.jsx(Hm,{children:0===r.length?Ne.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[Ne.jsx(hr,{className:"w-16 h-16 text-green-500/20 mb-4"}),Ne.jsx("p",{className:"text-green-600 font-medium",children:"Stock optimal"}),Ne.jsx("p",{className:"text-xs text-muted-foreground",children:"Tous les produits ont un stock suffisant"})]}):Ne.jsx("div",{className:"space-y-2 sm:space-y-3",children:D.slice(0,5).map(e=>Ne.jsx("div",{className:"p-3 bg-white rounded-lg border border-orange-200",children:Ne.jsxs("div",{className:"flex items-start justify-between gap-3",children:[Ne.jsxs("div",{className:"min-w-0 flex-1",children:[Ne.jsx("p",{className:"font-medium text-sm truncate",children:e.name}),Ne.jsxs("p",{className:"text-xs text-muted-foreground truncate",children:[e.sku,"  ",e.store_name]})]}),Ne.jsxs("div",{className:"text-right shrink-0",children:[Ne.jsxs(Cp,{variant:"destructive",className:"text-xs",children:["Stock: ",e.current_stock]}),Ne.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Alerte: ",e.alert_stock]})]})]})},e.id))})})]})]})]}):Ne.jsx("div",{className:"text-center py-8",children:Ne.jsx("p",{className:"text-muted-foreground",children:"Aucune donne disponible pour le moment"})})]})})}const fg=Nt.forwardRef(({className:e,...t},s)=>Ne.jsx("div",{className:"relative w-full overflow-auto",children:Ne.jsx("table",{ref:s,className:un("w-full caption-bottom text-sm",e),...t})}));fg.displayName="Table";const xg=Nt.forwardRef(({className:e,...t},s)=>Ne.jsx("thead",{ref:s,className:un("[&_tr]:border-b",e),...t}));xg.displayName="TableHeader";const gg=Nt.forwardRef(({className:e,...t},s)=>Ne.jsx("tbody",{ref:s,className:un("[&_tr:last-child]:border-0",e),...t}));gg.displayName="TableBody";Nt.forwardRef(({className:e,...t},s)=>Ne.jsx("tfoot",{ref:s,className:un("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...t})).displayName="TableFooter";const vg=Nt.forwardRef(({className:e,...t},s)=>Ne.jsx("tr",{ref:s,className:un("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...t}));vg.displayName="TableRow";const jg=Nt.forwardRef(({className:e,...t},s)=>Ne.jsx("th",{ref:s,className:un("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...t}));jg.displayName="TableHead";const yg=Nt.forwardRef(({className:e,...t},s)=>Ne.jsx("td",{ref:s,className:un("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...t}));yg.displayName="TableCell";Nt.forwardRef(({className:e,...t},s)=>Ne.jsx("caption",{ref:s,className:un("mt-4 text-sm text-muted-foreground",e),...t})).displayName="TableCaption";const bg=Xe,wg=yt,Ng=Ke,_g=Nt.forwardRef(({className:e,...t},s)=>Ne.jsx(He,{ref:s,className:un("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t}));_g.displayName=He.displayName;const kg=Nt.forwardRef(({className:e,children:t,...s},r)=>Ne.jsxs(Ng,{children:[Ne.jsx(_g,{}),Ne.jsxs(Ye,{ref:r,className:un("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...s,children:[t,Ne.jsxs(Ge,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[Ne.jsx(xa,{className:"h-4 w-4"}),Ne.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));kg.displayName=Ye.displayName;const Sg=({className:e,...t})=>Ne.jsx("div",{className:un("flex flex-col space-y-1.5 text-center sm:text-left",e),...t});Sg.displayName="DialogHeader";const Cg=({className:e,...t})=>Ne.jsx("div",{className:un("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});Cg.displayName="DialogFooter";const Eg=Nt.forwardRef(({className:e,...t},s)=>Ne.jsx(Qe,{ref:s,className:un("text-lg font-semibold leading-none tracking-tight",e),...t}));Eg.displayName=Qe.displayName;const Mg=Nt.forwardRef(({className:e,...t},s)=>Ne.jsx(Je,{ref:s,className:un("text-sm text-muted-foreground",e),...t}));Mg.displayName=Je.displayName;const Tg=Nt.forwardRef(({className:e,...t},s)=>Ne.jsx("textarea",{className:un("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:s,...t}));Tg.displayName="Textarea";var Ag="Popover",[Pg,Dg]=ke(Ag,[Ie]),Rg=Ie(),[Og,qg]=Pg(Ag),Ig=e=>{const{__scopePopover:t,children:s,open:r,defaultOpen:a,onOpenChange:n,modal:i=!1}=e,o=Rg(t),l=Nt.useRef(null),[c,d]=Nt.useState(!1),[u,h]=Me({prop:r,defaultProp:a??!1,onChange:n,caller:Ag});return Ne.jsx(Ue,{...o,children:Ne.jsx(Og,{scope:t,contentId:ze(),triggerRef:l,open:u,onOpenChange:h,onOpenToggle:Nt.useCallback(()=>h(e=>!e),[h]),hasCustomAnchor:c,onCustomAnchorAdd:Nt.useCallback(()=>d(!0),[]),onCustomAnchorRemove:Nt.useCallback(()=>d(!1),[]),modal:i,children:s})})};Ig.displayName=Ag;var Fg="PopoverAnchor";Nt.forwardRef((e,t)=>{const{__scopePopover:s,...r}=e,a=qg(Fg,s),n=Rg(s),{onCustomAnchorAdd:i,onCustomAnchorRemove:o}=a;return Nt.useEffect(()=>(i(),()=>o()),[i,o]),Ne.jsx(We,{...n,...r,ref:t})}).displayName=Fg;var Lg="PopoverTrigger",$g=Nt.forwardRef((e,t)=>{const{__scopePopover:s,...r}=e,a=qg(Lg,s),n=Rg(s),i=Ce(t,a.triggerRef),o=Ne.jsx(_e.button,{type:"button","aria-haspopup":"dialog","aria-expanded":a.open,"aria-controls":a.contentId,"data-state":Xg(a.open),...r,ref:i,onClick:Ae(e.onClick,a.onOpenToggle)});return a.hasCustomAnchor?o:Ne.jsx(We,{asChild:!0,...n,children:o})});$g.displayName=Lg;var zg="PopoverPortal",[Ug,Wg]=Pg(zg,{forceMount:void 0}),Vg=e=>{const{__scopePopover:t,forceMount:s,children:r,container:a}=e,n=qg(zg,t);return Ne.jsx(Ug,{scope:t,forceMount:s,children:Ne.jsx(Te,{present:s||n.open,children:Ne.jsx(Re,{asChild:!0,container:a,children:r})})})};Vg.displayName=zg;var Bg="PopoverContent",Hg=Nt.forwardRef((e,t)=>{const s=Wg(Bg,e.__scopePopover),{forceMount:r=s.forceMount,...a}=e,n=qg(Bg,e.__scopePopover);return Ne.jsx(Te,{present:r||n.open,children:n.modal?Ne.jsx(Yg,{...a,ref:t}):Ne.jsx(Gg,{...a,ref:t})})});Hg.displayName=Bg;var Kg=vt("PopoverContent.RemoveScroll"),Yg=Nt.forwardRef((e,t)=>{const s=qg(Bg,e.__scopePopover),r=Nt.useRef(null),a=Ce(t,r),n=Nt.useRef(!1);return Nt.useEffect(()=>{const e=r.current;if(e)return ft(e)},[]),Ne.jsx(gt,{as:Kg,allowPinchZoom:!0,children:Ne.jsx(Qg,{...e,ref:a,trapFocus:s.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Ae(e.onCloseAutoFocus,e=>{var t;e.preventDefault(),n.current||null==(t=s.triggerRef.current)||t.focus()}),onPointerDownOutside:Ae(e.onPointerDownOutside,e=>{const t=e.detail.originalEvent,s=0===t.button&&!0===t.ctrlKey,r=2===t.button||s;n.current=r},{checkForDefaultPrevented:!1}),onFocusOutside:Ae(e.onFocusOutside,e=>e.preventDefault(),{checkForDefaultPrevented:!1})})})}),Gg=Nt.forwardRef((e,t)=>{const s=qg(Bg,e.__scopePopover),r=Nt.useRef(!1),a=Nt.useRef(!1);return Ne.jsx(Qg,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:t=>{var n,i;null==(n=e.onCloseAutoFocus)||n.call(e,t),t.defaultPrevented||(r.current||null==(i=s.triggerRef.current)||i.focus(),t.preventDefault()),r.current=!1,a.current=!1},onInteractOutside:t=>{var n,i;null==(n=e.onInteractOutside)||n.call(e,t),t.defaultPrevented||(r.current=!0,"pointerdown"===t.detail.originalEvent.type&&(a.current=!0));const o=t.target;(null==(i=s.triggerRef.current)?void 0:i.contains(o))&&t.preventDefault(),"focusin"===t.detail.originalEvent.type&&a.current&&t.preventDefault()}})}),Qg=Nt.forwardRef((e,t)=>{const{__scopePopover:s,trapFocus:r,onOpenAutoFocus:a,onCloseAutoFocus:n,disableOutsidePointerEvents:i,onEscapeKeyDown:o,onPointerDownOutside:l,onFocusOutside:c,onInteractOutside:d,...u}=e,h=qg(Bg,s),m=Rg(s);return xt(),Ne.jsx(jt,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:a,onUnmountAutoFocus:n,children:Ne.jsx(Fe,{asChild:!0,disableOutsidePointerEvents:i,onInteractOutside:d,onEscapeKeyDown:o,onPointerDownOutside:l,onFocusOutside:c,onDismiss:()=>h.onOpenChange(!1),children:Ne.jsx(Le,{"data-state":Xg(h.open),role:"dialog",id:h.contentId,...m,...u,ref:t,style:{...u.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),Jg="PopoverClose";Nt.forwardRef((e,t)=>{const{__scopePopover:s,...r}=e,a=qg(Jg,s);return Ne.jsx(_e.button,{type:"button",...r,ref:t,onClick:Ae(e.onClick,()=>a.onOpenChange(!1))})}).displayName=Jg;function Xg(e){return e?"open":"closed"}Nt.forwardRef((e,t)=>{const{__scopePopover:s,...r}=e,a=Rg(s);return Ne.jsx(Ve,{...a,...r,ref:t})}).displayName="PopoverArrow";var Zg=Vg,ev=Hg;const tv=Ig,sv=$g,rv=Nt.forwardRef(({className:e,align:t="center",sideOffset:s=4,...r},a)=>Ne.jsx(Zg,{children:Ne.jsx(ev,{ref:a,align:t,sideOffset:s,className:un("z-[9998] w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...r})}));function av({value:e,onValueChange:t,options:s,placeholder:r,triggerClassName:a,disabled:n,emptyText:i="Aucun rsultat"}){const[o,l]=Nt.useState(!1),[c,d]=Nt.useState(""),[u,h]=Nt.useState(-1),m=Nt.useRef(null),p=Nt.useMemo(()=>{const t=s.find(t=>t.value===e);return t?t.label:""},[s,e]),f=e=>e.normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase(),x=Nt.useMemo(()=>{const e=f(c.trim());return e?s.filter(t=>f(`${t.label} ${t.hintText??""}`).includes(e)):s},[s,c]);Nt.useEffect(()=>{o||(d(p),h(-1))},[o,p]),Nt.useEffect(()=>{o||d(p)},[e,p,o]);const g=e=>{t(e.value),l(!1),requestAnimationFrame(()=>{m.current&&m.current.blur()})},v=o?c:p;return Ne.jsxs(tv,{open:o,onOpenChange:e=>!n&&l(e),children:[Ne.jsx(sv,{asChild:!0,children:Ne.jsx(Bh,{ref:m,value:v,onChange:e=>{o||l(!0),d(e.target.value)},onFocus:()=>{n||(l(!0),d(e=>""===e?p:e),requestAnimationFrame(()=>{var e,t,s;const r=((null==(e=m.current)?void 0:e.value)||"").length;null==(s=null==(t=m.current)?void 0:t.setSelectionRange)||s.call(t,0,r)}))},onClick:()=>{n||l(!0)},onKeyDown:e=>{if(o||1!==e.key.length&&"ArrowDown"!==e.key&&"Enter"!==e.key||l(!0),o)if("ArrowDown"===e.key)e.preventDefault(),h(e=>{const t=e+1;return t>=x.length?0:t});else if("ArrowUp"===e.key)e.preventDefault(),h(e=>{const t=e-1;return t<0?Math.max(0,x.length-1):t});else if("Enter"===e.key){e.preventDefault();const t=x[u]||x[0];t&&g(t)}else if("Tab"===e.key){const e=x[u]||x[0];e&&g(e)}else"Escape"===e.key&&(e.preventDefault(),l(!1))},placeholder:r,disabled:n,className:a||"h-10 sm:h-12",readOnly:!1,type:"text",autoComplete:"off",autoCorrect:"off",spellCheck:!1})}),Ne.jsx(rv,{className:"p-0 min-w-[var(--radix-popover-trigger-width)] max-w-[90vw] max-h-64 overflow-auto z-[9998]",align:"start",sideOffset:4,onOpenAutoFocus:e=>e.preventDefault(),onCloseAutoFocus:e=>e.preventDefault(),children:0===x.length?Ne.jsx("div",{className:"px-3 py-2 text-sm text-muted-foreground",children:i}):Ne.jsx("ul",{role:"listbox",className:"py-1",children:x.map((t,s)=>Ne.jsxs("li",{role:"option","aria-selected":e===t.value,className:"px-3 py-2 text-sm cursor-pointer hover:bg-accent "+(s===u?"bg-accent":""),onMouseEnter:()=>h(s),onMouseDown:e=>e.preventDefault(),onClick:()=>g(t),children:[Ne.jsx("div",{className:"whitespace-normal break-words",title:t.label,children:t.label}),t.hintText&&Ne.jsx("div",{className:"text-xs text-muted-foreground whitespace-normal break-words",title:t.hintText,children:t.hintText})]},t.value))})})]})}rv.displayName=ev.displayName;const nv=(e,t)=>{let s="Une erreur inattendue s'est produite";return(null==e?void 0:e.message)?s=e.message:(null==e?void 0:e.details)?s=e.details:"string"==typeof e&&(s=e),{success:!1,error:s,originalError:e}},iv=(e,t,s=100)=>{if(e<=0||t<=0)return 0;return((e,t)=>e<=0||t>=e?0:Math.round((e-t)/e*100))(e,t*s)},ov=(e,t)=>t<=0?0:Math.round(e/t),lv=e=>!isNaN(e)&&e>=0&&isFinite(e);const cv={},dv={};function uv(e,t){try{const s=(cv[e]||(cv[e]=new Intl.DateTimeFormat("en-US",{timeZone:e,timeZoneName:"longOffset"}).format))(t).split("GMT")[1];return s in dv?dv[s]:mv(s,s.split(":"))}catch{if(e in dv)return dv[e];const t=null==e?void 0:e.match(hv);return t?mv(e,t.slice(1)):NaN}}const hv=/([+-]\d\d):?(\d\d)?/;function mv(e,t){const s=+(t[0]||0),r=+(t[1]||0),a=+(t[2]||0)/60;return dv[e]=60*s+r>0?60*s+r+a:60*s-r-a}class pv extends Date{constructor(...e){super(),e.length>1&&"string"==typeof e[e.length-1]&&(this.timeZone=e.pop()),this.internal=new Date,isNaN(uv(this.timeZone,this))?this.setTime(NaN):e.length?"number"==typeof e[0]&&(1===e.length||2===e.length&&"number"!=typeof e[1])?this.setTime(e[0]):"string"==typeof e[0]?this.setTime(+new Date(e[0])):e[0]instanceof Date?this.setTime(+e[0]):(this.setTime(+new Date(...e)),gv(this),xv(this)):this.setTime(Date.now())}static tz(e,...t){return t.length?new pv(...t,e):new pv(Date.now(),e)}withTimeZone(e){return new pv(+this,e)}getTimezoneOffset(){const e=-uv(this.timeZone,this);return e>0?Math.floor(e):Math.ceil(e)}setTime(e){return Date.prototype.setTime.apply(this,arguments),xv(this),+this}[Symbol.for("constructDateFrom")](e){return new pv(+new Date(e),this.timeZone)}}const fv=/^(get|set)(?!UTC)/;function xv(e){e.internal.setTime(+e),e.internal.setUTCSeconds(e.internal.getUTCSeconds()-Math.round(60*-uv(e.timeZone,e)))}function gv(e){const t=uv(e.timeZone,e),s=t>0?Math.floor(t):Math.ceil(t),r=new Date(+e);r.setUTCHours(r.getUTCHours()-1);const a=-new Date(+e).getTimezoneOffset(),n=a- -new Date(+r).getTimezoneOffset(),i=Date.prototype.getHours.apply(e)!==e.internal.getUTCHours();n&&i&&e.internal.setUTCMinutes(e.internal.getUTCMinutes()+n);const o=a-s;o&&Date.prototype.setUTCMinutes.call(e,Date.prototype.getUTCMinutes.call(e)+o);const l=new Date(+e);l.setUTCSeconds(0);const c=a>0?l.getSeconds():(l.getSeconds()-60)%60,d=Math.round(-60*uv(e.timeZone,e))%60;(d||c)&&(e.internal.setUTCSeconds(e.internal.getUTCSeconds()+d),Date.prototype.setUTCSeconds.call(e,Date.prototype.getUTCSeconds.call(e)+d+c));const u=uv(e.timeZone,e),h=u>0?Math.floor(u):Math.ceil(u),m=-new Date(+e).getTimezoneOffset()-h-o;if(h!==s&&m){Date.prototype.setUTCMinutes.call(e,Date.prototype.getUTCMinutes.call(e)+m);const t=uv(e.timeZone,e),s=h-(t>0?Math.floor(t):Math.ceil(t));s&&(e.internal.setUTCMinutes(e.internal.getUTCMinutes()+s),Date.prototype.setUTCMinutes.call(e,Date.prototype.getUTCMinutes.call(e)+s))}}Object.getOwnPropertyNames(Date.prototype).forEach(e=>{if(!fv.test(e))return;const t=e.replace(fv,"$1UTC");pv.prototype[t]&&(e.startsWith("get")?pv.prototype[e]=function(){return this.internal[t]()}:(pv.prototype[e]=function(){var e;return Date.prototype[t].apply(this.internal,arguments),e=this,Date.prototype.setFullYear.call(e,e.internal.getUTCFullYear(),e.internal.getUTCMonth(),e.internal.getUTCDate()),Date.prototype.setHours.call(e,e.internal.getUTCHours(),e.internal.getUTCMinutes(),e.internal.getUTCSeconds(),e.internal.getUTCMilliseconds()),gv(e),+this},pv.prototype[t]=function(){return Date.prototype[t].apply(this,arguments),xv(this),+this}))});class vv extends pv{static tz(e,...t){return t.length?new vv(...t,e):new vv(Date.now(),e)}toISOString(){const[e,t,s]=this.tzComponents(),r=`${e}${t}:${s}`;return this.internal.toISOString().slice(0,-1)+r}toString(){return`${this.toDateString()} ${this.toTimeString()}`}toDateString(){const[e,t,s,r]=this.internal.toUTCString().split(" ");return`${null==e?void 0:e.slice(0,-1)} ${s} ${t} ${r}`}toTimeString(){const e=this.internal.toUTCString().split(" ")[4],[t,s,r]=this.tzComponents();return`${e} GMT${t}${s}${r} (${function(e,t,s="long"){return new Intl.DateTimeFormat("en-US",{hour:"numeric",timeZone:e,timeZoneName:s}).format(t).split(/\s/g).slice(2).join(" ")}(this.timeZone,this)})`}toLocaleString(e,t){return Date.prototype.toLocaleString.call(this,e,{...t,timeZone:(null==t?void 0:t.timeZone)||this.timeZone})}toLocaleDateString(e,t){return Date.prototype.toLocaleDateString.call(this,e,{...t,timeZone:(null==t?void 0:t.timeZone)||this.timeZone})}toLocaleTimeString(e,t){return Date.prototype.toLocaleTimeString.call(this,e,{...t,timeZone:(null==t?void 0:t.timeZone)||this.timeZone})}tzComponents(){const e=this.getTimezoneOffset();return[e>0?"-":"+",String(Math.floor(Math.abs(e)/60)).padStart(2,"0"),String(Math.abs(e)%60).padStart(2,"0")]}withTimeZone(e){return new vv(+this,e)}[Symbol.for("constructDateFrom")](e){return new vv(+new Date(e),this.timeZone)}}var jv,yv,bv,wv,Nv,_v,kv,Sv;(yv=jv||(jv={})).Root="root",yv.Chevron="chevron",yv.Day="day",yv.DayButton="day_button",yv.CaptionLabel="caption_label",yv.Dropdowns="dropdowns",yv.Dropdown="dropdown",yv.DropdownRoot="dropdown_root",yv.Footer="footer",yv.MonthGrid="month_grid",yv.MonthCaption="month_caption",yv.MonthsDropdown="months_dropdown",yv.Month="month",yv.Months="months",yv.Nav="nav",yv.NextMonthButton="button_next",yv.PreviousMonthButton="button_previous",yv.Week="week",yv.Weeks="weeks",yv.Weekday="weekday",yv.Weekdays="weekdays",yv.WeekNumber="week_number",yv.WeekNumberHeader="week_number_header",yv.YearsDropdown="years_dropdown",(wv=bv||(bv={})).disabled="disabled",wv.hidden="hidden",wv.outside="outside",wv.focused="focused",wv.today="today",(_v=Nv||(Nv={})).range_end="range_end",_v.range_middle="range_middle",_v.range_start="range_start",_v.selected="selected",(Sv=kv||(kv={})).weeks_before_enter="weeks_before_enter",Sv.weeks_before_exit="weeks_before_exit",Sv.weeks_after_enter="weeks_after_enter",Sv.weeks_after_exit="weeks_after_exit",Sv.caption_after_enter="caption_after_enter",Sv.caption_after_exit="caption_after_exit",Sv.caption_before_enter="caption_before_enter",Sv.caption_before_exit="caption_before_exit";const Cv=6048e5,Ev=Symbol.for("constructDateFrom");function Mv(e,t){return"function"==typeof e?e(t):e&&"object"==typeof e&&Ev in e?e[Ev](t):e instanceof Date?new e.constructor(t):new Date(t)}function Tv(e,t){return Mv(t||e,e)}function Av(e,t,s){const r=Tv(e,null==s?void 0:s.in);return isNaN(t)?Mv(e,NaN):t?(r.setDate(r.getDate()+t),r):r}function Pv(e,t,s){const r=Tv(e,null==s?void 0:s.in);if(isNaN(t))return Mv(e,NaN);if(!t)return r;const a=r.getDate(),n=Mv(e,r.getTime());n.setMonth(r.getMonth()+t+1,0);return a>=n.getDate()?n:(r.setFullYear(n.getFullYear(),n.getMonth(),a),r)}let Dv={};function Rv(){return Dv}function Ov(e,t){var s,r,a,n;const i=Rv(),o=(null==t?void 0:t.weekStartsOn)??(null==(r=null==(s=null==t?void 0:t.locale)?void 0:s.options)?void 0:r.weekStartsOn)??i.weekStartsOn??(null==(n=null==(a=i.locale)?void 0:a.options)?void 0:n.weekStartsOn)??0,l=Tv(e,null==t?void 0:t.in),c=l.getDay(),d=(c<o?7:0)+c-o;return l.setDate(l.getDate()-d),l.setHours(0,0,0,0),l}function qv(e,t){return Ov(e,{...t,weekStartsOn:1})}function Iv(e,t){const s=Tv(e,null==t?void 0:t.in),r=s.getFullYear(),a=Mv(s,0);a.setFullYear(r+1,0,4),a.setHours(0,0,0,0);const n=qv(a),i=Mv(s,0);i.setFullYear(r,0,4),i.setHours(0,0,0,0);const o=qv(i);return s.getTime()>=n.getTime()?r+1:s.getTime()>=o.getTime()?r:r-1}function Fv(e){const t=Tv(e),s=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return s.setUTCFullYear(t.getFullYear()),+e-+s}function Lv(e,...t){const s=Mv.bind(null,t.find(e=>"object"==typeof e));return t.map(s)}function $v(e,t){const s=Tv(e,null==t?void 0:t.in);return s.setHours(0,0,0,0),s}function zv(e,t,s){const[r,a]=Lv(null==s||s.in,e,t),n=$v(r),i=$v(a),o=+n-Fv(n),l=+i-Fv(i);return Math.round((o-l)/864e5)}function Uv(e){return e instanceof Date||"object"==typeof e&&"[object Date]"===Object.prototype.toString.call(e)}function Wv(e,t){const{start:s,end:r}=function(e,t){const[s,r]=Lv(0,t.start,t.end);return{start:s,end:r}}(null==t||t.in,e);let a=+s>+r;const n=a?+s:+r,i=a?r:s;i.setHours(0,0,0,0),i.setDate(1);const o=[];for(;+i<=n;)o.push(Mv(s,i)),i.setMonth(i.getMonth()+1);return a?o.reverse():o}function Vv(e,t){const s=Tv(e,null==t?void 0:t.in);return s.setFullYear(s.getFullYear(),0,1),s.setHours(0,0,0,0),s}function Bv(e,t){var s,r,a,n;const i=Rv(),o=(null==t?void 0:t.weekStartsOn)??(null==(r=null==(s=null==t?void 0:t.locale)?void 0:s.options)?void 0:r.weekStartsOn)??i.weekStartsOn??(null==(n=null==(a=i.locale)?void 0:a.options)?void 0:n.weekStartsOn)??0,l=Tv(e,null==t?void 0:t.in),c=l.getDay(),d=6+(c<o?-7:0)-(c-o);return l.setDate(l.getDate()+d),l.setHours(23,59,59,999),l}const Hv={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};function Kv(e){return(t={})=>{const s=t.width?String(t.width):e.defaultWidth;return e.formats[s]||e.formats[e.defaultWidth]}}const Yv={date:Kv({formats:{full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},defaultWidth:"full"}),time:Kv({formats:{full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},defaultWidth:"full"}),dateTime:Kv({formats:{full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})},Gv={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"};function Qv(e){return(t,s)=>{let r;if("formatting"===((null==s?void 0:s.context)?String(s.context):"standalone")&&e.formattingValues){const t=e.defaultFormattingWidth||e.defaultWidth,a=(null==s?void 0:s.width)?String(s.width):t;r=e.formattingValues[a]||e.formattingValues[t]}else{const t=e.defaultWidth,a=(null==s?void 0:s.width)?String(s.width):e.defaultWidth;r=e.values[a]||e.values[t]}return r[e.argumentCallback?e.argumentCallback(t):t]}}const Jv={ordinalNumber:(e,t)=>{const s=Number(e),r=s%100;if(r>20||r<10)switch(r%10){case 1:return s+"st";case 2:return s+"nd";case 3:return s+"rd"}return s+"th"},era:Qv({values:{narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},defaultWidth:"wide"}),quarter:Qv({values:{narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},defaultWidth:"wide",argumentCallback:e=>e-1}),month:Qv({values:{narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},defaultWidth:"wide"}),day:Qv({values:{narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},defaultWidth:"wide"}),dayPeriod:Qv({values:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},defaultWidth:"wide",formattingValues:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},defaultFormattingWidth:"wide"})};function Xv(e){return(t,s={})=>{const r=s.width,a=r&&e.matchPatterns[r]||e.matchPatterns[e.defaultMatchWidth],n=t.match(a);if(!n)return null;const i=n[0],o=r&&e.parsePatterns[r]||e.parsePatterns[e.defaultParseWidth],l=Array.isArray(o)?function(e,t){for(let s=0;s<e.length;s++)if(t(e[s]))return s;return}(o,e=>e.test(i)):function(e,t){for(const s in e)if(Object.prototype.hasOwnProperty.call(e,s)&&t(e[s]))return s;return}(o,e=>e.test(i));let c;c=e.valueCallback?e.valueCallback(l):l,c=s.valueCallback?s.valueCallback(c):c;return{value:c,rest:t.slice(i.length)}}}const Zv={ordinalNumber:(ej={matchPattern:/^(\d+)(th|st|nd|rd)?/i,parsePattern:/\d+/i,valueCallback:e=>parseInt(e,10)},(e,t={})=>{const s=e.match(ej.matchPattern);if(!s)return null;const r=s[0],a=e.match(ej.parsePattern);if(!a)return null;let n=ej.valueCallback?ej.valueCallback(a[0]):a[0];return n=t.valueCallback?t.valueCallback(n):n,{value:n,rest:e.slice(r.length)}}),era:Xv({matchPatterns:{narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^b/i,/^(a|c)/i]},defaultParseWidth:"any"}),quarter:Xv({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:e=>e+1}),month:Xv({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:Xv({matchPatterns:{narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},defaultParseWidth:"any"}),dayPeriod:Xv({matchPatterns:{narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},defaultParseWidth:"any"})};var ej;const tj={code:"en-US",formatDistance:(e,t,s)=>{let r;const a=Hv[e];return r="string"==typeof a?a:1===t?a.one:a.other.replace("{{count}}",t.toString()),(null==s?void 0:s.addSuffix)?s.comparison&&s.comparison>0?"in "+r:r+" ago":r},formatLong:Yv,formatRelative:(e,t,s,r)=>Gv[e],localize:Jv,match:Zv,options:{weekStartsOn:0,firstWeekContainsDate:1}};function sj(e,t){const s=Tv(e,null==t?void 0:t.in),r=+qv(s)-+function(e,t){const s=Iv(e,t),r=Mv(e,0);return r.setFullYear(s,0,4),r.setHours(0,0,0,0),qv(r)}(s);return Math.round(r/Cv)+1}function rj(e,t){var s,r,a,n;const i=Tv(e,null==t?void 0:t.in),o=i.getFullYear(),l=Rv(),c=(null==t?void 0:t.firstWeekContainsDate)??(null==(r=null==(s=null==t?void 0:t.locale)?void 0:s.options)?void 0:r.firstWeekContainsDate)??l.firstWeekContainsDate??(null==(n=null==(a=l.locale)?void 0:a.options)?void 0:n.firstWeekContainsDate)??1,d=Mv((null==t?void 0:t.in)||e,0);d.setFullYear(o+1,0,c),d.setHours(0,0,0,0);const u=Ov(d,t),h=Mv((null==t?void 0:t.in)||e,0);h.setFullYear(o,0,c),h.setHours(0,0,0,0);const m=Ov(h,t);return+i>=+u?o+1:+i>=+m?o:o-1}function aj(e,t){const s=Tv(e,null==t?void 0:t.in),r=+Ov(s,t)-+function(e,t){var s,r,a,n;const i=Rv(),o=(null==t?void 0:t.firstWeekContainsDate)??(null==(r=null==(s=null==t?void 0:t.locale)?void 0:s.options)?void 0:r.firstWeekContainsDate)??i.firstWeekContainsDate??(null==(n=null==(a=i.locale)?void 0:a.options)?void 0:n.firstWeekContainsDate)??1,l=rj(e,t),c=Mv((null==t?void 0:t.in)||e,0);return c.setFullYear(l,0,o),c.setHours(0,0,0,0),Ov(c,t)}(s,t);return Math.round(r/Cv)+1}function nj(e,t){return(e<0?"-":"")+Math.abs(e).toString().padStart(t,"0")}const ij={y(e,t){const s=e.getFullYear(),r=s>0?s:1-s;return nj("yy"===t?r%100:r,t.length)},M(e,t){const s=e.getMonth();return"M"===t?String(s+1):nj(s+1,2)},d:(e,t)=>nj(e.getDate(),t.length),a(e,t){const s=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return s.toUpperCase();case"aaa":return s;case"aaaaa":return s[0];default:return"am"===s?"a.m.":"p.m."}},h:(e,t)=>nj(e.getHours()%12||12,t.length),H:(e,t)=>nj(e.getHours(),t.length),m:(e,t)=>nj(e.getMinutes(),t.length),s:(e,t)=>nj(e.getSeconds(),t.length),S(e,t){const s=t.length,r=e.getMilliseconds();return nj(Math.trunc(r*Math.pow(10,s-3)),t.length)}},oj="midnight",lj="noon",cj="morning",dj="afternoon",uj="evening",hj="night",mj={G:function(e,t,s){const r=e.getFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return s.era(r,{width:"abbreviated"});case"GGGGG":return s.era(r,{width:"narrow"});default:return s.era(r,{width:"wide"})}},y:function(e,t,s){if("yo"===t){const t=e.getFullYear(),r=t>0?t:1-t;return s.ordinalNumber(r,{unit:"year"})}return ij.y(e,t)},Y:function(e,t,s,r){const a=rj(e,r),n=a>0?a:1-a;if("YY"===t){return nj(n%100,2)}return"Yo"===t?s.ordinalNumber(n,{unit:"year"}):nj(n,t.length)},R:function(e,t){return nj(Iv(e),t.length)},u:function(e,t){return nj(e.getFullYear(),t.length)},Q:function(e,t,s){const r=Math.ceil((e.getMonth()+1)/3);switch(t){case"Q":return String(r);case"QQ":return nj(r,2);case"Qo":return s.ordinalNumber(r,{unit:"quarter"});case"QQQ":return s.quarter(r,{width:"abbreviated",context:"formatting"});case"QQQQQ":return s.quarter(r,{width:"narrow",context:"formatting"});default:return s.quarter(r,{width:"wide",context:"formatting"})}},q:function(e,t,s){const r=Math.ceil((e.getMonth()+1)/3);switch(t){case"q":return String(r);case"qq":return nj(r,2);case"qo":return s.ordinalNumber(r,{unit:"quarter"});case"qqq":return s.quarter(r,{width:"abbreviated",context:"standalone"});case"qqqqq":return s.quarter(r,{width:"narrow",context:"standalone"});default:return s.quarter(r,{width:"wide",context:"standalone"})}},M:function(e,t,s){const r=e.getMonth();switch(t){case"M":case"MM":return ij.M(e,t);case"Mo":return s.ordinalNumber(r+1,{unit:"month"});case"MMM":return s.month(r,{width:"abbreviated",context:"formatting"});case"MMMMM":return s.month(r,{width:"narrow",context:"formatting"});default:return s.month(r,{width:"wide",context:"formatting"})}},L:function(e,t,s){const r=e.getMonth();switch(t){case"L":return String(r+1);case"LL":return nj(r+1,2);case"Lo":return s.ordinalNumber(r+1,{unit:"month"});case"LLL":return s.month(r,{width:"abbreviated",context:"standalone"});case"LLLLL":return s.month(r,{width:"narrow",context:"standalone"});default:return s.month(r,{width:"wide",context:"standalone"})}},w:function(e,t,s,r){const a=aj(e,r);return"wo"===t?s.ordinalNumber(a,{unit:"week"}):nj(a,t.length)},I:function(e,t,s){const r=sj(e);return"Io"===t?s.ordinalNumber(r,{unit:"week"}):nj(r,t.length)},d:function(e,t,s){return"do"===t?s.ordinalNumber(e.getDate(),{unit:"date"}):ij.d(e,t)},D:function(e,t,s){const r=function(e,t){const s=Tv(e,null==t?void 0:t.in);return zv(s,Vv(s))+1}(e);return"Do"===t?s.ordinalNumber(r,{unit:"dayOfYear"}):nj(r,t.length)},E:function(e,t,s){const r=e.getDay();switch(t){case"E":case"EE":case"EEE":return s.day(r,{width:"abbreviated",context:"formatting"});case"EEEEE":return s.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return s.day(r,{width:"short",context:"formatting"});default:return s.day(r,{width:"wide",context:"formatting"})}},e:function(e,t,s,r){const a=e.getDay(),n=(a-r.weekStartsOn+8)%7||7;switch(t){case"e":return String(n);case"ee":return nj(n,2);case"eo":return s.ordinalNumber(n,{unit:"day"});case"eee":return s.day(a,{width:"abbreviated",context:"formatting"});case"eeeee":return s.day(a,{width:"narrow",context:"formatting"});case"eeeeee":return s.day(a,{width:"short",context:"formatting"});default:return s.day(a,{width:"wide",context:"formatting"})}},c:function(e,t,s,r){const a=e.getDay(),n=(a-r.weekStartsOn+8)%7||7;switch(t){case"c":return String(n);case"cc":return nj(n,t.length);case"co":return s.ordinalNumber(n,{unit:"day"});case"ccc":return s.day(a,{width:"abbreviated",context:"standalone"});case"ccccc":return s.day(a,{width:"narrow",context:"standalone"});case"cccccc":return s.day(a,{width:"short",context:"standalone"});default:return s.day(a,{width:"wide",context:"standalone"})}},i:function(e,t,s){const r=e.getDay(),a=0===r?7:r;switch(t){case"i":return String(a);case"ii":return nj(a,t.length);case"io":return s.ordinalNumber(a,{unit:"day"});case"iii":return s.day(r,{width:"abbreviated",context:"formatting"});case"iiiii":return s.day(r,{width:"narrow",context:"formatting"});case"iiiiii":return s.day(r,{width:"short",context:"formatting"});default:return s.day(r,{width:"wide",context:"formatting"})}},a:function(e,t,s){const r=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return s.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"aaa":return s.dayPeriod(r,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return s.dayPeriod(r,{width:"narrow",context:"formatting"});default:return s.dayPeriod(r,{width:"wide",context:"formatting"})}},b:function(e,t,s){const r=e.getHours();let a;switch(a=12===r?lj:0===r?oj:r/12>=1?"pm":"am",t){case"b":case"bb":return s.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"bbb":return s.dayPeriod(a,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return s.dayPeriod(a,{width:"narrow",context:"formatting"});default:return s.dayPeriod(a,{width:"wide",context:"formatting"})}},B:function(e,t,s){const r=e.getHours();let a;switch(a=r>=17?uj:r>=12?dj:r>=4?cj:hj,t){case"B":case"BB":case"BBB":return s.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"BBBBB":return s.dayPeriod(a,{width:"narrow",context:"formatting"});default:return s.dayPeriod(a,{width:"wide",context:"formatting"})}},h:function(e,t,s){if("ho"===t){let t=e.getHours()%12;return 0===t&&(t=12),s.ordinalNumber(t,{unit:"hour"})}return ij.h(e,t)},H:function(e,t,s){return"Ho"===t?s.ordinalNumber(e.getHours(),{unit:"hour"}):ij.H(e,t)},K:function(e,t,s){const r=e.getHours()%12;return"Ko"===t?s.ordinalNumber(r,{unit:"hour"}):nj(r,t.length)},k:function(e,t,s){let r=e.getHours();return 0===r&&(r=24),"ko"===t?s.ordinalNumber(r,{unit:"hour"}):nj(r,t.length)},m:function(e,t,s){return"mo"===t?s.ordinalNumber(e.getMinutes(),{unit:"minute"}):ij.m(e,t)},s:function(e,t,s){return"so"===t?s.ordinalNumber(e.getSeconds(),{unit:"second"}):ij.s(e,t)},S:function(e,t){return ij.S(e,t)},X:function(e,t,s){const r=e.getTimezoneOffset();if(0===r)return"Z";switch(t){case"X":return fj(r);case"XXXX":case"XX":return xj(r);default:return xj(r,":")}},x:function(e,t,s){const r=e.getTimezoneOffset();switch(t){case"x":return fj(r);case"xxxx":case"xx":return xj(r);default:return xj(r,":")}},O:function(e,t,s){const r=e.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+pj(r,":");default:return"GMT"+xj(r,":")}},z:function(e,t,s){const r=e.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+pj(r,":");default:return"GMT"+xj(r,":")}},t:function(e,t,s){return nj(Math.trunc(+e/1e3),t.length)},T:function(e,t,s){return nj(+e,t.length)}};function pj(e,t=""){const s=e>0?"-":"+",r=Math.abs(e),a=Math.trunc(r/60),n=r%60;return 0===n?s+String(a):s+String(a)+t+nj(n,2)}function fj(e,t){if(e%60==0){return(e>0?"-":"+")+nj(Math.abs(e)/60,2)}return xj(e,t)}function xj(e,t=""){const s=e>0?"-":"+",r=Math.abs(e);return s+nj(Math.trunc(r/60),2)+t+nj(r%60,2)}const gj=(e,t)=>{switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});default:return t.date({width:"full"})}},vj=(e,t)=>{switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});default:return t.time({width:"full"})}},jj={p:vj,P:(e,t)=>{const s=e.match(/(P+)(p+)?/)||[],r=s[1],a=s[2];if(!a)return gj(e,t);let n;switch(r){case"P":n=t.dateTime({width:"short"});break;case"PP":n=t.dateTime({width:"medium"});break;case"PPP":n=t.dateTime({width:"long"});break;default:n=t.dateTime({width:"full"})}return n.replace("{{date}}",gj(r,t)).replace("{{time}}",vj(a,t))}},yj=/^D+$/,bj=/^Y+$/,wj=["D","DD","YY","YYYY"];const Nj=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,_j=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,kj=/^'([^]*?)'?$/,Sj=/''/g,Cj=/[a-zA-Z]/;function Ej(e,t,s){var r,a,n,i,o,l,c,d;const u=Rv(),h=(null==s?void 0:s.locale)??u.locale??tj,m=(null==s?void 0:s.firstWeekContainsDate)??(null==(a=null==(r=null==s?void 0:s.locale)?void 0:r.options)?void 0:a.firstWeekContainsDate)??u.firstWeekContainsDate??(null==(i=null==(n=u.locale)?void 0:n.options)?void 0:i.firstWeekContainsDate)??1,p=(null==s?void 0:s.weekStartsOn)??(null==(l=null==(o=null==s?void 0:s.locale)?void 0:o.options)?void 0:l.weekStartsOn)??u.weekStartsOn??(null==(d=null==(c=u.locale)?void 0:c.options)?void 0:d.weekStartsOn)??0,f=Tv(e,null==s?void 0:s.in);if(!function(e){return!(!Uv(e)&&"number"!=typeof e||isNaN(+Tv(e)))}(f))throw new RangeError("Invalid time value");let x=t.match(_j).map(e=>{const t=e[0];if("p"===t||"P"===t){return(0,jj[t])(e,h.formatLong)}return e}).join("").match(Nj).map(e=>{if("''"===e)return{isToken:!1,value:"'"};const t=e[0];if("'"===t)return{isToken:!1,value:Mj(e)};if(mj[t])return{isToken:!0,value:e};if(t.match(Cj))throw new RangeError("Format string contains an unescaped latin alphabet character `"+t+"`");return{isToken:!1,value:e}});h.localize.preprocessor&&(x=h.localize.preprocessor(f,x));const g={firstWeekContainsDate:m,weekStartsOn:p,locale:h};return x.map(r=>{if(!r.isToken)return r.value;const a=r.value;(!(null==s?void 0:s.useAdditionalWeekYearTokens)&&function(e){return bj.test(e)}(a)||!(null==s?void 0:s.useAdditionalDayOfYearTokens)&&function(e){return yj.test(e)}(a))&&function(e,t,s){const r=function(e,t,s){const r="Y"===e[0]?"years":"days of the month";return`Use \`${e.toLowerCase()}\` instead of \`${e}\` (in \`${t}\`) for formatting ${r} to the input \`${s}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}(e,t,s);if(wj.includes(e))throw new RangeError(r)}(a,t,String(e));return(0,mj[a[0]])(f,a,h.localize,g)}).join("")}function Mj(e){const t=e.match(kj);return t?t[1].replace(Sj,"'"):e}function Tj(e,t,s){const r=Tv(e,null==s?void 0:s.in),a=r.getFullYear(),n=r.getDate(),i=Mv(e,0);i.setFullYear(a,t,15),i.setHours(0,0,0,0);const o=function(e,t){const s=Tv(e,null==t?void 0:t.in),r=s.getFullYear(),a=s.getMonth(),n=Mv(s,0);return n.setFullYear(r,a+1,0),n.setHours(0,0,0,0),n.getDate()}(i);return r.setMonth(t,Math.min(n,o)),r}function Aj(e,t){const s=t.startOfMonth(e),r=s.getDay();return 1===r?s:0===r?t.addDays(s,-6):t.addDays(s,-1*(r-1))}class Pj{constructor(e,t){this.Date=Date,this.today=()=>{var e;return(null==(e=this.overrides)?void 0:e.today)?this.overrides.today():this.options.timeZone?vv.tz(this.options.timeZone):new this.Date},this.newDate=(e,t,s)=>{var r;return(null==(r=this.overrides)?void 0:r.newDate)?this.overrides.newDate(e,t,s):this.options.timeZone?new vv(e,t,s,this.options.timeZone):new Date(e,t,s)},this.addDays=(e,t)=>{var s;return(null==(s=this.overrides)?void 0:s.addDays)?this.overrides.addDays(e,t):Av(e,t)},this.addMonths=(e,t)=>{var s;return(null==(s=this.overrides)?void 0:s.addMonths)?this.overrides.addMonths(e,t):Pv(e,t)},this.addWeeks=(e,t)=>{var s;return(null==(s=this.overrides)?void 0:s.addWeeks)?this.overrides.addWeeks(e,t):function(e,t,s){return Av(e,7*t,s)}(e,t)},this.addYears=(e,t)=>{var s;return(null==(s=this.overrides)?void 0:s.addYears)?this.overrides.addYears(e,t):function(e,t,s){return Pv(e,12*t,s)}(e,t)},this.differenceInCalendarDays=(e,t)=>{var s;return(null==(s=this.overrides)?void 0:s.differenceInCalendarDays)?this.overrides.differenceInCalendarDays(e,t):zv(e,t)},this.differenceInCalendarMonths=(e,t)=>{var s;return(null==(s=this.overrides)?void 0:s.differenceInCalendarMonths)?this.overrides.differenceInCalendarMonths(e,t):function(e,t,s){const[r,a]=Lv(null==s||s.in,e,t);return 12*(r.getFullYear()-a.getFullYear())+(r.getMonth()-a.getMonth())}(e,t)},this.eachMonthOfInterval=e=>{var t;return(null==(t=this.overrides)?void 0:t.eachMonthOfInterval)?this.overrides.eachMonthOfInterval(e):Wv(e)},this.endOfBroadcastWeek=e=>{var t;return(null==(t=this.overrides)?void 0:t.endOfBroadcastWeek)?this.overrides.endOfBroadcastWeek(e):function(e,t){const s=Aj(e,t),r=function(e,t){const s=t.startOfMonth(e),r=s.getDay()>0?s.getDay():7,a=t.addDays(e,1-r),n=t.addDays(a,34);return t.getMonth(e)===t.getMonth(n)?5:4}(e,t);return t.addDays(s,7*r-1)}(e,this)},this.endOfISOWeek=e=>{var t;return(null==(t=this.overrides)?void 0:t.endOfISOWeek)?this.overrides.endOfISOWeek(e):function(e,t){return Bv(e,{...t,weekStartsOn:1})}(e)},this.endOfMonth=e=>{var t;return(null==(t=this.overrides)?void 0:t.endOfMonth)?this.overrides.endOfMonth(e):function(e,t){const s=Tv(e,null==t?void 0:t.in),r=s.getMonth();return s.setFullYear(s.getFullYear(),r+1,0),s.setHours(23,59,59,999),s}(e)},this.endOfWeek=(e,t)=>{var s;return(null==(s=this.overrides)?void 0:s.endOfWeek)?this.overrides.endOfWeek(e,t):Bv(e,this.options)},this.endOfYear=e=>{var t;return(null==(t=this.overrides)?void 0:t.endOfYear)?this.overrides.endOfYear(e):function(e,t){const s=Tv(e,null==t?void 0:t.in),r=s.getFullYear();return s.setFullYear(r+1,0,0),s.setHours(23,59,59,999),s}(e)},this.format=(e,t,s)=>{var r;const a=(null==(r=this.overrides)?void 0:r.format)?this.overrides.format(e,t,this.options):Ej(e,t,this.options);return this.options.numerals&&"latn"!==this.options.numerals?this.replaceDigits(a):a},this.getISOWeek=e=>{var t;return(null==(t=this.overrides)?void 0:t.getISOWeek)?this.overrides.getISOWeek(e):sj(e)},this.getMonth=(e,t)=>{var s;return(null==(s=this.overrides)?void 0:s.getMonth)?this.overrides.getMonth(e,this.options):function(e,t){return Tv(e,null==t?void 0:t.in).getMonth()}(e,this.options)},this.getYear=(e,t)=>{var s;return(null==(s=this.overrides)?void 0:s.getYear)?this.overrides.getYear(e,this.options):function(e,t){return Tv(e,null==t?void 0:t.in).getFullYear()}(e,this.options)},this.getWeek=(e,t)=>{var s;return(null==(s=this.overrides)?void 0:s.getWeek)?this.overrides.getWeek(e,this.options):aj(e,this.options)},this.isAfter=(e,t)=>{var s;return(null==(s=this.overrides)?void 0:s.isAfter)?this.overrides.isAfter(e,t):function(e,t){return+Tv(e)>+Tv(t)}(e,t)},this.isBefore=(e,t)=>{var s;return(null==(s=this.overrides)?void 0:s.isBefore)?this.overrides.isBefore(e,t):function(e,t){return+Tv(e)<+Tv(t)}(e,t)},this.isDate=e=>{var t;return(null==(t=this.overrides)?void 0:t.isDate)?this.overrides.isDate(e):Uv(e)},this.isSameDay=(e,t)=>{var s;return(null==(s=this.overrides)?void 0:s.isSameDay)?this.overrides.isSameDay(e,t):function(e,t,s){const[r,a]=Lv(null==s||s.in,e,t);return+$v(r)===+$v(a)}(e,t)},this.isSameMonth=(e,t)=>{var s;return(null==(s=this.overrides)?void 0:s.isSameMonth)?this.overrides.isSameMonth(e,t):function(e,t,s){const[r,a]=Lv(null==s||s.in,e,t);return r.getFullYear()===a.getFullYear()&&r.getMonth()===a.getMonth()}(e,t)},this.isSameYear=(e,t)=>{var s;return(null==(s=this.overrides)?void 0:s.isSameYear)?this.overrides.isSameYear(e,t):function(e,t,s){const[r,a]=Lv(null==s||s.in,e,t);return r.getFullYear()===a.getFullYear()}(e,t)},this.max=e=>{var t;return(null==(t=this.overrides)?void 0:t.max)?this.overrides.max(e):function(e,t){let s,r=null==t?void 0:t.in;return e.forEach(e=>{r||"object"!=typeof e||(r=Mv.bind(null,e));const t=Tv(e,r);(!s||s<t||isNaN(+t))&&(s=t)}),Mv(r,s||NaN)}(e)},this.min=e=>{var t;return(null==(t=this.overrides)?void 0:t.min)?this.overrides.min(e):function(e,t){let s,r=null==t?void 0:t.in;return e.forEach(e=>{r||"object"!=typeof e||(r=Mv.bind(null,e));const t=Tv(e,r);(!s||s>t||isNaN(+t))&&(s=t)}),Mv(r,s||NaN)}(e)},this.setMonth=(e,t)=>{var s;return(null==(s=this.overrides)?void 0:s.setMonth)?this.overrides.setMonth(e,t):Tj(e,t)},this.setYear=(e,t)=>{var s;return(null==(s=this.overrides)?void 0:s.setYear)?this.overrides.setYear(e,t):function(e,t,s){const r=Tv(e,null==s?void 0:s.in);return isNaN(+r)?Mv(e,NaN):(r.setFullYear(t),r)}(e,t)},this.startOfBroadcastWeek=(e,t)=>{var s;return(null==(s=this.overrides)?void 0:s.startOfBroadcastWeek)?this.overrides.startOfBroadcastWeek(e,this):Aj(e,this)},this.startOfDay=e=>{var t;return(null==(t=this.overrides)?void 0:t.startOfDay)?this.overrides.startOfDay(e):$v(e)},this.startOfISOWeek=e=>{var t;return(null==(t=this.overrides)?void 0:t.startOfISOWeek)?this.overrides.startOfISOWeek(e):qv(e)},this.startOfMonth=e=>{var t;return(null==(t=this.overrides)?void 0:t.startOfMonth)?this.overrides.startOfMonth(e):function(e,t){const s=Tv(e,null==t?void 0:t.in);return s.setDate(1),s.setHours(0,0,0,0),s}(e)},this.startOfWeek=(e,t)=>{var s;return(null==(s=this.overrides)?void 0:s.startOfWeek)?this.overrides.startOfWeek(e,this.options):Ov(e,this.options)},this.startOfYear=e=>{var t;return(null==(t=this.overrides)?void 0:t.startOfYear)?this.overrides.startOfYear(e):Vv(e)},this.options={locale:tj,...e},this.overrides=t}getDigitMap(){const{numerals:e="latn"}=this.options,t=new Intl.NumberFormat("en-US",{numberingSystem:e}),s={};for(let r=0;r<10;r++)s[r.toString()]=t.format(r);return s}replaceDigits(e){const t=this.getDigitMap();return e.replace(/\d/g,e=>t[e]||e)}formatNumber(e){return this.replaceDigits(e.toString())}}const Dj=new Pj;class Rj{constructor(e,t,s=Dj){this.date=e,this.displayMonth=t,this.outside=Boolean(t&&!s.isSameMonth(e,t)),this.dateLib=s}isEqualTo(e){return this.dateLib.isSameDay(e.date,this.date)&&this.dateLib.isSameMonth(e.displayMonth,this.displayMonth)}}class Oj{constructor(e,t){this.date=e,this.weeks=t}}class qj{constructor(e,t){this.days=t,this.weekNumber=e}}function Ij(e,t,s=!1,r=Dj){let{from:a,to:n}=e;const{differenceInCalendarDays:i,isSameDay:o}=r;if(a&&n){i(n,a)<0&&([a,n]=[n,a]);return i(t,a)>=(s?1:0)&&i(n,t)>=(s?1:0)}return!s&&n?o(n,t):!(s||!a)&&o(a,t)}function Fj(e){return Boolean(e&&"object"==typeof e&&"before"in e&&"after"in e)}function Lj(e){return Boolean(e&&"object"==typeof e&&"from"in e)}function $j(e){return Boolean(e&&"object"==typeof e&&"after"in e)}function zj(e){return Boolean(e&&"object"==typeof e&&"before"in e)}function Uj(e){return Boolean(e&&"object"==typeof e&&"dayOfWeek"in e)}function Wj(e,t){return Array.isArray(e)&&e.every(t.isDate)}function Vj(e,t,s=Dj){const r=Array.isArray(t)?t:[t],{isSameDay:a,differenceInCalendarDays:n,isAfter:i}=s;return r.some(t=>{if("boolean"==typeof t)return t;if(s.isDate(t))return a(e,t);if(Wj(t,s))return t.includes(e);if(Lj(t))return Ij(t,e,!1,s);if(Uj(t))return Array.isArray(t.dayOfWeek)?t.dayOfWeek.includes(e.getDay()):t.dayOfWeek===e.getDay();if(Fj(t)){const s=n(t.before,e)>0,r=n(t.after,e)<0;return i(t.before,t.after)?r&&s:s||r}return $j(t)?n(e,t.after)>0:zj(t)?n(t.before,e)>0:"function"==typeof t&&t(e)})}const Bj=Nt.createContext(void 0);function Hj(){const e=Nt.useContext(Bj);if(void 0===e)throw new Error("useDayPicker() must be used within a custom component.");return e}const Kj=Object.freeze(Object.defineProperty({__proto__:null,Button:function(e){return _t.createElement("button",{...e})},CaptionLabel:function(e){return _t.createElement("span",{...e})},Chevron:function(e){const{size:t=24,orientation:s="left",className:r}=e;return _t.createElement("svg",{className:r,width:t,height:t,viewBox:"0 0 24 24"},"up"===s&&_t.createElement("polygon",{points:"6.77 17 12.5 11.43 18.24 17 20 15.28 12.5 8 5 15.28"}),"down"===s&&_t.createElement("polygon",{points:"6.77 8 12.5 13.57 18.24 8 20 9.72 12.5 17 5 9.72"}),"left"===s&&_t.createElement("polygon",{points:"16 18.112 9.81111111 12 16 5.87733333 14.0888889 4 6 12 14.0888889 20"}),"right"===s&&_t.createElement("polygon",{points:"8 18.112 14.18888889 12 8 5.87733333 9.91111111 4 18 12 9.91111111 20"}))},Day:function(e){const{day:t,modifiers:s,...r}=e;return _t.createElement("td",{...r})},DayButton:function(e){const{day:t,modifiers:s,...r}=e,a=_t.useRef(null);return _t.useEffect(()=>{var e;s.focused&&(null==(e=a.current)||e.focus())},[s.focused]),_t.createElement("button",{ref:a,...r})},Dropdown:function(e){const{options:t,className:s,components:r,classNames:a,...n}=e,i=[a[jv.Dropdown],s].join(" "),o=null==t?void 0:t.find(({value:e})=>e===n.value);return _t.createElement("span",{"data-disabled":n.disabled,className:a[jv.DropdownRoot]},_t.createElement(r.Select,{className:i,...n},null==t?void 0:t.map(({value:e,label:t,disabled:s})=>_t.createElement(r.Option,{key:e,value:e,disabled:s},t))),_t.createElement("span",{className:a[jv.CaptionLabel],"aria-hidden":!0},null==o?void 0:o.label,_t.createElement(r.Chevron,{orientation:"down",size:18,className:a[jv.Chevron]})))},DropdownNav:function(e){return _t.createElement("div",{...e})},Footer:function(e){return _t.createElement("div",{...e})},Month:function(e){const{calendarMonth:t,displayIndex:s,...r}=e;return _t.createElement("div",{...r},e.children)},MonthCaption:function(e){const{calendarMonth:t,displayIndex:s,...r}=e;return _t.createElement("div",{...r})},MonthGrid:function(e){return _t.createElement("table",{...e})},Months:function(e){return _t.createElement("div",{...e})},MonthsDropdown:function(e){const{components:t}=Hj();return _t.createElement(t.Dropdown,{...e})},Nav:function(e){const{onPreviousClick:t,onNextClick:s,previousMonth:r,nextMonth:a,...n}=e,{components:i,classNames:o,labels:{labelPrevious:l,labelNext:c}}=Hj(),d=Nt.useCallback(e=>{a&&(null==s||s(e))},[a,s]),u=Nt.useCallback(e=>{r&&(null==t||t(e))},[r,t]);return _t.createElement("nav",{...n},_t.createElement(i.PreviousMonthButton,{type:"button",className:o[jv.PreviousMonthButton],tabIndex:r?void 0:-1,"aria-disabled":!r||void 0,"aria-label":l(r),onClick:u},_t.createElement(i.Chevron,{disabled:!r||void 0,className:o[jv.Chevron],orientation:"left"})),_t.createElement(i.NextMonthButton,{type:"button",className:o[jv.NextMonthButton],tabIndex:a?void 0:-1,"aria-disabled":!a||void 0,"aria-label":c(a),onClick:d},_t.createElement(i.Chevron,{disabled:!a||void 0,orientation:"right",className:o[jv.Chevron]})))},NextMonthButton:function(e){const{components:t}=Hj();return _t.createElement(t.Button,{...e})},Option:function(e){return _t.createElement("option",{...e})},PreviousMonthButton:function(e){const{components:t}=Hj();return _t.createElement(t.Button,{...e})},Root:function(e){const{rootRef:t,...s}=e;return _t.createElement("div",{...s,ref:t})},Select:function(e){return _t.createElement("select",{...e})},Week:function(e){const{week:t,...s}=e;return _t.createElement("tr",{...s})},WeekNumber:function(e){const{week:t,...s}=e;return _t.createElement("th",{...s})},WeekNumberHeader:function(e){return _t.createElement("th",{...e})},Weekday:function(e){return _t.createElement("th",{...e})},Weekdays:function(e){return _t.createElement("thead",{"aria-hidden":!0},_t.createElement("tr",{...e}))},Weeks:function(e){return _t.createElement("tbody",{...e})},YearsDropdown:function(e){const{components:t}=Hj();return _t.createElement(t.Dropdown,{...e})}},Symbol.toStringTag,{value:"Module"}));function Yj(){const e={};for(const t in jv)e[jv[t]]=`rdp-${jv[t]}`;for(const t in bv)e[bv[t]]=`rdp-${bv[t]}`;for(const t in Nv)e[Nv[t]]=`rdp-${Nv[t]}`;for(const t in kv)e[kv[t]]=`rdp-${kv[t]}`;return e}function Gj(e,t,s){return(s??new Pj(t)).format(e,"LLLL y")}const Qj=Gj;function Jj(e,t=Dj){return t.format(e,"yyyy")}const Xj=Jj,Zj=Object.freeze(Object.defineProperty({__proto__:null,formatCaption:Gj,formatDay:function(e,t,s){return(s??new Pj(t)).format(e,"d")},formatMonthCaption:Qj,formatMonthDropdown:function(e,t=Dj){return t.format(e,"LLLL")},formatWeekNumber:function(e,t=Dj){return e<10?t.formatNumber(`0${e.toLocaleString()}`):t.formatNumber(`${e.toLocaleString()}`)},formatWeekNumberHeader:function(){return""},formatWeekdayName:function(e,t,s){return(s??new Pj(t)).format(e,"cccccc")},formatYearCaption:Xj,formatYearDropdown:Jj},Symbol.toStringTag,{value:"Module"}));function ey(e,t,s){return(s??new Pj(t)).format(e,"LLLL y")}const ty=ey;function sy(e,t,s,r){let a=(r??new Pj(s)).format(e,"PPPP");return t.today&&(a=`Today, ${a}`),t.selected&&(a=`${a}, selected`),a}const ry=sy;const ay=Object.freeze(Object.defineProperty({__proto__:null,labelCaption:ty,labelDay:ry,labelDayButton:sy,labelGrid:ey,labelGridcell:function(e,t,s,r){let a=(r??new Pj(s)).format(e,"PPPP");return(null==t?void 0:t.today)&&(a=`Today, ${a}`),a},labelMonthDropdown:function(e){return"Choose the Month"},labelNav:function(){return""},labelNext:function(e){return"Go to the Next Month"},labelPrevious:function(e){return"Go to the Previous Month"},labelWeekNumber:function(e,t){return`Week ${e}`},labelWeekNumberHeader:function(e){return"Week Number"},labelWeekday:function(e,t,s){return(s??new Pj(t)).format(e,"cccc")},labelYearDropdown:function(e){return"Choose the Year"}},Symbol.toStringTag,{value:"Module"})),ny=e=>e instanceof HTMLElement?e:null,iy=e=>[...e.querySelectorAll("[data-animated-month]")??[]],oy=e=>ny(e.querySelector("[data-animated-caption]")),ly=e=>ny(e.querySelector("[data-animated-weeks]"));function cy(e,t,{classNames:s,months:r,focused:a,dateLib:n}){const i=Nt.useRef(null),o=Nt.useRef(r),l=Nt.useRef(!1);Nt.useLayoutEffect(()=>{const c=o.current;if(o.current=r,!(t&&e.current&&e.current instanceof HTMLElement&&0!==r.length&&0!==c.length&&r.length===c.length))return;const d=n.isSameMonth(r[0].date,c[0].date),u=n.isAfter(r[0].date,c[0].date),h=u?s[kv.caption_after_enter]:s[kv.caption_before_enter],m=u?s[kv.weeks_after_enter]:s[kv.weeks_before_enter],p=i.current,f=e.current.cloneNode(!0);if(f instanceof HTMLElement){iy(f).forEach(e=>{if(!(e instanceof HTMLElement))return;const t=ny(e.querySelector("[data-animated-month]"));t&&e.contains(t)&&e.removeChild(t);const s=oy(e);s&&s.classList.remove(h);const r=ly(e);r&&r.classList.remove(m)}),i.current=f}else i.current=null;if(l.current||d||a)return;const x=p instanceof HTMLElement?iy(p):[],g=iy(e.current);if(g&&g.every(e=>e instanceof HTMLElement)&&x&&x.every(e=>e instanceof HTMLElement)){l.current=!0,e.current.style.isolation="isolate";const t=(v=e.current,ny(v.querySelector("[data-animated-nav]")));t&&(t.style.zIndex="1"),g.forEach((r,a)=>{const n=x[a];if(!n)return;r.style.position="relative",r.style.overflow="hidden";const i=oy(r);i&&i.classList.add(h);const o=ly(r);o&&o.classList.add(m);const c=()=>{l.current=!1,e.current&&(e.current.style.isolation=""),t&&(t.style.zIndex=""),i&&i.classList.remove(h),o&&o.classList.remove(m),r.style.position="",r.style.overflow="",r.contains(n)&&r.removeChild(n)};n.style.pointerEvents="none",n.style.position="absolute",n.style.overflow="hidden",n.setAttribute("aria-hidden","true");const d=(e=>ny(e.querySelector("[data-animated-weekdays]")))(n);d&&(d.style.opacity="0");const p=oy(n);p&&(p.classList.add(u?s[kv.caption_before_exit]:s[kv.caption_after_exit]),p.addEventListener("animationend",c));const f=ly(n);f&&f.classList.add(u?s[kv.weeks_before_exit]:s[kv.weeks_after_exit]),r.insertBefore(n,r.firstChild)})}var v})}function dy(e,t,s,r){const{month:a,defaultMonth:n,today:i=r.today(),numberOfMonths:o=1}=e;let l=a||n||i;const{differenceInCalendarMonths:c,addMonths:d,startOfMonth:u}=r;if(s&&c(s,l)<o-1){l=d(s,-1*(o-1))}return t&&c(l,t)<0&&(l=t),u(l)}function uy(e,t){const[s,r]=Nt.useState(e);return[void 0===t?s:t,r]}function hy(e,t){const[s,r]=function(e,t){let{startMonth:s,endMonth:r}=e;const{startOfYear:a,startOfDay:n,startOfMonth:i,endOfMonth:o,addYears:l,endOfYear:c,newDate:d,today:u}=t,{fromYear:h,toYear:m,fromMonth:p,toMonth:f}=e;!s&&p&&(s=p),!s&&h&&(s=t.newDate(h,0,1)),!r&&f&&(r=f),!r&&m&&(r=d(m,11,31));const x="dropdown"===e.captionLayout||"dropdown-years"===e.captionLayout;return s?s=i(s):h?s=d(h,0,1):!s&&x&&(s=a(l(e.today??u(),-100))),r?r=o(r):m?r=d(m,11,31):!r&&x&&(r=c(e.today??u())),[s?n(s):s,r?n(r):r]}(e,t),{startOfMonth:a,endOfMonth:n}=t,i=dy(e,s,r,t),[o,l]=uy(i,e.month?i:void 0);Nt.useEffect(()=>{const a=dy(e,s,r,t);l(a)},[e.timeZone]);const c=function(e,t,s,r){const{numberOfMonths:a=1}=s,n=[];for(let i=0;i<a;i++){const s=r.addMonths(e,i);if(t&&s>t)break;n.push(s)}return n}(o,r,e,t),d=function(e,t,s,r){const a=e[0],n=e[e.length-1],{ISOWeek:i,fixedWeeks:o,broadcastCalendar:l}=s??{},{addDays:c,differenceInCalendarDays:d,differenceInCalendarMonths:u,endOfBroadcastWeek:h,endOfISOWeek:m,endOfMonth:p,endOfWeek:f,isAfter:x,startOfBroadcastWeek:g,startOfISOWeek:v,startOfWeek:j}=r,y=l?g(a,r):i?v(a):j(a),b=d(l?h(n):i?m(p(n)):f(p(n)),y),w=u(n,a)+1,N=[];for(let k=0;k<=b;k++){const e=c(y,k);if(t&&x(e,t))break;N.push(e)}const _=(l?35:42)*w;if(o&&N.length<_){const e=_-N.length;for(let t=0;t<e;t++){const e=c(N[N.length-1],1);N.push(e)}}return N}(c,e.endMonth?n(e.endMonth):void 0,e,t),u=function(e,t,s,r){const{addDays:a,endOfBroadcastWeek:n,endOfISOWeek:i,endOfMonth:o,endOfWeek:l,getISOWeek:c,getWeek:d,startOfBroadcastWeek:u,startOfISOWeek:h,startOfWeek:m}=r,p=e.reduce((e,p)=>{const f=s.broadcastCalendar?u(p,r):s.ISOWeek?h(p):m(p),x=s.broadcastCalendar?n(p):s.ISOWeek?i(o(p)):l(o(p)),g=t.filter(e=>e>=f&&e<=x),v=s.broadcastCalendar?35:42;if(s.fixedWeeks&&g.length<v){const e=t.filter(e=>{const t=v-g.length;return e>x&&e<=a(x,t)});g.push(...e)}const j=g.reduce((e,t)=>{const a=s.ISOWeek?c(t):d(t),n=e.find(e=>e.weekNumber===a),i=new Rj(t,p,r);return n?n.days.push(i):e.push(new qj(a,[i])),e},[]),y=new Oj(p,j);return e.push(y),e},[]);return s.reverseMonths?p.reverse():p}(c,d,e,t),h=function(e){return e.reduce((e,t)=>[...e,...t.weeks],[])}(u),m=function(e){const t=[];return e.reduce((e,s)=>[...e,...s.weeks.reduce((e,t)=>[...e,...t.days],t)],t)}(u),p=function(e,t,s,r){if(s.disableNavigation)return;const{pagedNavigation:a,numberOfMonths:n}=s,{startOfMonth:i,addMonths:o,differenceInCalendarMonths:l}=r,c=a?n??1:1,d=i(e);return t&&l(d,t)<=0?void 0:o(d,-c)}(o,s,e,t),f=function(e,t,s,r){if(s.disableNavigation)return;const{pagedNavigation:a,numberOfMonths:n=1}=s,{startOfMonth:i,addMonths:o,differenceInCalendarMonths:l}=r,c=a?n:1,d=i(e);return t&&l(t,e)<n?void 0:o(d,c)}(o,r,e,t),{disableNavigation:x,onMonthChange:g}=e,v=e=>{if(x)return;let t=a(e);s&&t<a(s)&&(t=a(s)),r&&t>a(r)&&(t=a(r)),l(t),null==g||g(t)};return{months:u,weeks:h,days:m,navStart:s,navEnd:r,previousMonth:p,nextMonth:f,goToMonth:v,goToDay:e=>{(e=>h.some(t=>t.days.some(t=>t.isEqualTo(e))))(e)||v(e.date)}}}var my,py;function fy(e){return!e[bv.disabled]&&!e[bv.hidden]&&!e[bv.outside]}function xy(e,t,s,r,a,n,i,o=0){if(o>365)return;const l=function(e,t,s,r,a,n,i){const{ISOWeek:o,broadcastCalendar:l}=n,{addDays:c,addMonths:d,addWeeks:u,addYears:h,endOfBroadcastWeek:m,endOfISOWeek:p,endOfWeek:f,max:x,min:g,startOfBroadcastWeek:v,startOfISOWeek:j,startOfWeek:y}=i;let b={day:c,week:u,month:d,year:h,startOfWeek:e=>l?v(e,i):o?j(e):y(e),endOfWeek:e=>l?m(e):o?p(e):f(e)}[e](s,"after"===t?1:-1);return"before"===t&&r?b=x([r,b]):"after"===t&&a&&(b=g([a,b])),b}(e,t,s.date,r,a,n,i),c=Boolean(n.disabled&&Vj(l,n.disabled,i)),d=Boolean(n.hidden&&Vj(l,n.hidden,i)),u=new Rj(l,l,i);return c||d?xy(e,t,u,r,a,n,i,o+1):u}function gy(e,t,s,r,a){const{autoFocus:n}=e,[i,o]=Nt.useState(),l=function(e,t,s,r){let a,n=-1;for(const i of e){const e=t(i);fy(e)&&(e[bv.focused]&&n<my.FocusedModifier?(a=i,n=my.FocusedModifier):(null==r?void 0:r.isEqualTo(i))&&n<my.LastFocused?(a=i,n=my.LastFocused):s(i.date)&&n<my.Selected?(a=i,n=my.Selected):e[bv.today]&&n<my.Today&&(a=i,n=my.Today))}return a||(a=e.find(e=>fy(t(e)))),a}(t.days,s,r||(()=>!1),i),[c,d]=Nt.useState(n?l:void 0);return{isFocusTarget:e=>Boolean(null==l?void 0:l.isEqualTo(e)),setFocused:d,focused:c,blur:()=>{o(c),d(void 0)},moveFocus:(s,r)=>{if(!c)return;const n=xy(s,r,c,t.navStart,t.navEnd,e,a);n&&(t.goToDay(n),d(n))}}}function vy(e,t,s=Dj){return Ij(e,t.from,!1,s)||Ij(e,t.to,!1,s)||Ij(t,e.from,!1,s)||Ij(t,e.to,!1,s)}function jy(e,t,s=Dj){const r=Array.isArray(t)?t:[t];if(r.filter(e=>"function"!=typeof e).some(t=>{if("boolean"==typeof t)return t;if(s.isDate(t))return Ij(e,t,!1,s);if(Wj(t,s))return t.some(t=>Ij(e,t,!1,s));if(Lj(t))return!(!t.from||!t.to)&&vy(e,{from:t.from,to:t.to},s);if(Uj(t))return function(e,t,s=Dj){const r=Array.isArray(t)?t:[t];let a=e.from;const n=s.differenceInCalendarDays(e.to,e.from),i=Math.min(n,6);for(let o=0;o<=i;o++){if(r.includes(a.getDay()))return!0;a=s.addDays(a,1)}return!1}(e,t.dayOfWeek,s);if(Fj(t)){return s.isAfter(t.before,t.after)?vy(e,{from:s.addDays(t.after,1),to:s.addDays(t.before,-1)},s):Vj(e.from,t,s)||Vj(e.to,t,s)}return!(!$j(t)&&!zj(t))&&(Vj(e.from,t,s)||Vj(e.to,t,s))}))return!0;const a=r.filter(e=>"function"==typeof e);if(a.length){let t=e.from;const r=s.differenceInCalendarDays(e.to,e.from);for(let e=0;e<=r;e++){if(a.some(e=>e(t)))return!0;t=s.addDays(t,1)}}return!1}function yy(e,t){const{disabled:s,excludeDisabled:r,selected:a,required:n,onSelect:i}=e,[o,l]=uy(a,i?a:void 0),c=i?a:o;return{selected:c,select:(a,o,d)=>{const{min:u,max:h}=e,m=a?function(e,t,s=0,r=0,a=!1,n=Dj){const{from:i,to:o}=t||{},{isSameDay:l,isAfter:c,isBefore:d}=n;let u;if(i||o){if(i&&!o)u=l(i,e)?a?{from:i,to:void 0}:void 0:d(e,i)?{from:e,to:i}:{from:i,to:e};else if(i&&o)if(l(i,e)&&l(o,e))u=a?{from:i,to:o}:void 0;else if(l(i,e))u={from:i,to:s>0?void 0:e};else if(l(o,e))u={from:e,to:s>0?void 0:e};else if(d(e,i))u={from:e,to:o};else if(c(e,i))u={from:i,to:e};else{if(!c(e,o))throw new Error("Invalid range");u={from:i,to:e}}}else u={from:e,to:s>0?void 0:e};if((null==u?void 0:u.from)&&(null==u?void 0:u.to)){const t=n.differenceInCalendarDays(u.to,u.from);(r>0&&t>r||s>1&&t<s)&&(u={from:e,to:void 0})}return u}(a,c,u,h,n,t):void 0;return r&&s&&(null==m?void 0:m.from)&&m.to&&jy({from:m.from,to:m.to},s,t)&&(m.from=a,m.to=void 0),i||l(m),null==i||i(m,a,o,d),m},isSelected:e=>c&&Ij(c,e,!1,t)}}function by(e,t){const s=function(e,t){const{selected:s,required:r,onSelect:a}=e,[n,i]=uy(s,a?s:void 0),o=a?s:n,{isSameDay:l}=t;return{selected:o,select:(e,t,s)=>{let n=e;return!r&&o&&o&&l(e,o)&&(n=void 0),a||i(n),null==a||a(n,e,t,s),n},isSelected:e=>!!o&&l(o,e)}}(e,t),r=function(e,t){const{selected:s,required:r,onSelect:a}=e,[n,i]=uy(s,a?s:void 0),o=a?s:n,{isSameDay:l}=t,c=e=>(null==o?void 0:o.some(t=>l(t,e)))??!1,{min:d,max:u}=e;return{selected:o,select:(e,t,s)=>{let n=[...o??[]];if(c(e)){if((null==o?void 0:o.length)===d)return;if(r&&1===(null==o?void 0:o.length))return;n=null==o?void 0:o.filter(t=>!l(t,e))}else n=(null==o?void 0:o.length)===u?[e]:[...n,e];return a||i(n),null==a||a(n,e,t,s),n},isSelected:c}}(e,t),a=yy(e,t);switch(e.mode){case"single":return s;case"multiple":return r;case"range":return a;default:return}}function wy(e){var t;let s=e;s.timeZone&&(s={...e},s.today&&(s.today=new vv(s.today,s.timeZone)),s.month&&(s.month=new vv(s.month,s.timeZone)),s.defaultMonth&&(s.defaultMonth=new vv(s.defaultMonth,s.timeZone)),s.startMonth&&(s.startMonth=new vv(s.startMonth,s.timeZone)),s.endMonth&&(s.endMonth=new vv(s.endMonth,s.timeZone)),"single"===s.mode&&s.selected?s.selected=new vv(s.selected,s.timeZone):"multiple"===s.mode&&s.selected?s.selected=null==(t=s.selected)?void 0:t.map(e=>new vv(e,s.timeZone)):"range"===s.mode&&s.selected&&(s.selected={from:s.selected.from?new vv(s.selected.from,s.timeZone):void 0,to:s.selected.to?new vv(s.selected.to,s.timeZone):void 0}));const{components:r,formatters:a,labels:n,dateLib:i,locale:o,classNames:l}=Nt.useMemo(()=>{const e={...tj,...s.locale};return{dateLib:new Pj({locale:e,weekStartsOn:s.broadcastCalendar?1:s.weekStartsOn,firstWeekContainsDate:s.firstWeekContainsDate,useAdditionalWeekYearTokens:s.useAdditionalWeekYearTokens,useAdditionalDayOfYearTokens:s.useAdditionalDayOfYearTokens,timeZone:s.timeZone,numerals:s.numerals},s.dateLib),components:(r=s.components,{...Kj,...r}),formatters:(t=s.formatters,(null==t?void 0:t.formatMonthCaption)&&!t.formatCaption&&(t.formatCaption=t.formatMonthCaption),(null==t?void 0:t.formatYearCaption)&&!t.formatYearDropdown&&(t.formatYearDropdown=t.formatYearCaption),{...Zj,...t}),labels:{...ay,...s.labels},locale:e,classNames:{...Yj(),...s.classNames}};var t,r},[s.locale,s.broadcastCalendar,s.weekStartsOn,s.firstWeekContainsDate,s.useAdditionalWeekYearTokens,s.useAdditionalDayOfYearTokens,s.timeZone,s.numerals,s.dateLib,s.components,s.formatters,s.labels,s.classNames]),{captionLayout:c,mode:d,navLayout:u,numberOfMonths:h=1,onDayBlur:m,onDayClick:p,onDayFocus:f,onDayKeyDown:x,onDayMouseEnter:g,onDayMouseLeave:v,onNextClick:j,onPrevClick:y,showWeekNumber:b,styles:w}=s,{formatCaption:N,formatDay:_,formatMonthDropdown:k,formatWeekNumber:S,formatWeekNumberHeader:C,formatWeekdayName:E,formatYearDropdown:M}=a,T=hy(s,i),{days:A,months:P,navStart:D,navEnd:R,previousMonth:O,nextMonth:q,goToMonth:I}=T,F=function(e,t,s,r,a){const{disabled:n,hidden:i,modifiers:o,showOutsideDays:l,broadcastCalendar:c,today:d}=t,{isSameDay:u,isSameMonth:h,startOfMonth:m,isBefore:p,endOfMonth:f,isAfter:x}=a,g=s&&m(s),v=r&&f(r),j={[bv.focused]:[],[bv.outside]:[],[bv.disabled]:[],[bv.hidden]:[],[bv.today]:[]},y={};for(const b of e){const{date:e,displayMonth:t}=b,s=Boolean(t&&!h(e,t)),r=Boolean(g&&p(e,g)),m=Boolean(v&&x(e,v)),f=Boolean(n&&Vj(e,n,a)),w=Boolean(i&&Vj(e,i,a))||r||m||!c&&!l&&s||c&&!1===l&&s,N=u(e,d??a.today());s&&j.outside.push(b),f&&j.disabled.push(b),w&&j.hidden.push(b),N&&j.today.push(b),o&&Object.keys(o).forEach(t=>{const s=null==o?void 0:o[t];s&&Vj(e,s,a)&&(y[t]?y[t].push(b):y[t]=[b])})}return e=>{const t={[bv.focused]:!1,[bv.disabled]:!1,[bv.hidden]:!1,[bv.outside]:!1,[bv.today]:!1},s={};for(const r in j){const s=j[r];t[r]=s.some(t=>t===e)}for(const r in y)s[r]=y[r].some(t=>t===e);return{...t,...s}}}(A,s,D,R,i),{isSelected:L,select:$,selected:z}=by(s,i)??{},{blur:U,focused:W,isFocusTarget:V,moveFocus:B,setFocused:H}=gy(s,T,F,L??(()=>!1),i),{labelDayButton:K,labelGridcell:Y,labelGrid:G,labelMonthDropdown:Q,labelNav:J,labelPrevious:X,labelNext:Z,labelWeekday:ee,labelWeekNumber:te,labelWeekNumberHeader:se,labelYearDropdown:re}=n,ae=Nt.useMemo(()=>function(e,t){const s=e.today(),r=t?e.startOfISOWeek(s):e.startOfWeek(s),a=[];for(let n=0;n<7;n++){const t=e.addDays(r,n);a.push(t)}return a}(i,s.ISOWeek),[i,s.ISOWeek]),ne=void 0!==d||void 0!==p,ie=Nt.useCallback(()=>{O&&(I(O),null==y||y(O))},[O,I,y]),oe=Nt.useCallback(()=>{q&&(I(q),null==j||j(q))},[I,q,j]),le=Nt.useCallback((e,t)=>s=>{s.preventDefault(),s.stopPropagation(),H(e),null==$||$(e.date,t,s),null==p||p(e.date,t,s)},[$,p,H]),ce=Nt.useCallback((e,t)=>s=>{H(e),null==f||f(e.date,t,s)},[f,H]),de=Nt.useCallback((e,t)=>s=>{U(),null==m||m(e.date,t,s)},[U,m]),ue=Nt.useCallback((e,t)=>r=>{const a={ArrowLeft:[r.shiftKey?"month":"day","rtl"===s.dir?"after":"before"],ArrowRight:[r.shiftKey?"month":"day","rtl"===s.dir?"before":"after"],ArrowDown:[r.shiftKey?"year":"week","after"],ArrowUp:[r.shiftKey?"year":"week","before"],PageUp:[r.shiftKey?"year":"month","before"],PageDown:[r.shiftKey?"year":"month","after"],Home:["startOfWeek","before"],End:["endOfWeek","after"]};if(a[r.key]){r.preventDefault(),r.stopPropagation();const[e,t]=a[r.key];B(e,t)}null==x||x(e.date,t,r)},[B,x,s.dir]),he=Nt.useCallback((e,t)=>s=>{null==g||g(e.date,t,s)},[g]),me=Nt.useCallback((e,t)=>s=>{null==v||v(e.date,t,s)},[v]),pe=Nt.useCallback(e=>t=>{const s=Number(t.target.value),r=i.setMonth(i.startOfMonth(e),s);I(r)},[i,I]),fe=Nt.useCallback(e=>t=>{const s=Number(t.target.value),r=i.setYear(i.startOfMonth(e),s);I(r)},[i,I]),{className:xe,style:ge}=Nt.useMemo(()=>({className:[l[jv.Root],s.className].filter(Boolean).join(" "),style:{...null==w?void 0:w[jv.Root],...s.style}}),[l,s.className,s.style,w]),ve=function(e){const t={"data-mode":e.mode??void 0,"data-required":"required"in e?e.required:void 0,"data-multiple-months":e.numberOfMonths&&e.numberOfMonths>1||void 0,"data-week-numbers":e.showWeekNumber||void 0,"data-broadcast-calendar":e.broadcastCalendar||void 0,"data-nav-layout":e.navLayout||void 0};return Object.entries(e).forEach(([e,s])=>{e.startsWith("data-")&&(t[e]=s)}),t}(s),je=Nt.useRef(null);cy(je,Boolean(s.animate),{classNames:l,months:P,focused:W,dateLib:i});const ye={dayPickerProps:s,selected:z,select:$,isSelected:L,months:P,nextMonth:q,previousMonth:O,goToMonth:I,getModifiers:F,components:r,classNames:l,styles:w,labels:n,formatters:a};return _t.createElement(Bj.Provider,{value:ye},_t.createElement(r.Root,{rootRef:s.animate?je:void 0,className:xe,style:ge,dir:s.dir,id:s.id,lang:s.lang,nonce:s.nonce,title:s.title,role:s.role,"aria-label":s["aria-label"],...ve},_t.createElement(r.Months,{className:l[jv.Months],style:null==w?void 0:w[jv.Months]},!s.hideNavigation&&!u&&_t.createElement(r.Nav,{"data-animated-nav":s.animate?"true":void 0,className:l[jv.Nav],style:null==w?void 0:w[jv.Nav],"aria-label":J(),onPreviousClick:ie,onNextClick:oe,previousMonth:O,nextMonth:q}),P.map((e,t)=>{const n=function(e,t,s,r,a){const{startOfMonth:n,startOfYear:i,endOfYear:o,eachMonthOfInterval:l,getMonth:c}=a;return l({start:i(e),end:o(e)}).map(e=>{const i=r.formatMonthDropdown(e,a);return{value:c(e),label:i,disabled:t&&e<n(t)||s&&e>n(s)||!1}})}(e.date,D,R,a,i),m=function(e,t,s,r){if(!e)return;if(!t)return;const{startOfYear:a,endOfYear:n,addYears:i,getYear:o,isBefore:l,isSameYear:c}=r,d=a(e),u=n(t),h=[];let m=d;for(;l(m,u)||c(m,u);)h.push(m),m=i(m,1);return h.map(e=>{const t=s.formatYearDropdown(e,r);return{value:o(e),label:t,disabled:!1}})}(D,R,a,i);return _t.createElement(r.Month,{"data-animated-month":s.animate?"true":void 0,className:l[jv.Month],style:null==w?void 0:w[jv.Month],key:t,displayIndex:t,calendarMonth:e},"around"===u&&!s.hideNavigation&&0===t&&_t.createElement(r.PreviousMonthButton,{type:"button",className:l[jv.PreviousMonthButton],tabIndex:O?void 0:-1,"aria-disabled":!O||void 0,"aria-label":X(O),onClick:ie,"data-animated-button":s.animate?"true":void 0},_t.createElement(r.Chevron,{disabled:!O||void 0,className:l[jv.Chevron],orientation:"rtl"===s.dir?"right":"left"})),_t.createElement(r.MonthCaption,{"data-animated-caption":s.animate?"true":void 0,className:l[jv.MonthCaption],style:null==w?void 0:w[jv.MonthCaption],calendarMonth:e,displayIndex:t},(null==c?void 0:c.startsWith("dropdown"))?_t.createElement(r.DropdownNav,{className:l[jv.Dropdowns],style:null==w?void 0:w[jv.Dropdowns]},"dropdown"===c||"dropdown-months"===c?_t.createElement(r.MonthsDropdown,{className:l[jv.MonthsDropdown],"aria-label":Q(),classNames:l,components:r,disabled:Boolean(s.disableNavigation),onChange:pe(e.date),options:n,style:null==w?void 0:w[jv.Dropdown],value:i.getMonth(e.date)}):_t.createElement("span",null,k(e.date,i)),"dropdown"===c||"dropdown-years"===c?_t.createElement(r.YearsDropdown,{className:l[jv.YearsDropdown],"aria-label":re(i.options),classNames:l,components:r,disabled:Boolean(s.disableNavigation),onChange:fe(e.date),options:m,style:null==w?void 0:w[jv.Dropdown],value:i.getYear(e.date)}):_t.createElement("span",null,M(e.date,i)),_t.createElement("span",{role:"status","aria-live":"polite",style:{border:0,clip:"rect(0 0 0 0)",height:"1px",margin:"-1px",overflow:"hidden",padding:0,position:"absolute",width:"1px",whiteSpace:"nowrap",wordWrap:"normal"}},N(e.date,i.options,i))):_t.createElement(r.CaptionLabel,{className:l[jv.CaptionLabel],role:"status","aria-live":"polite"},N(e.date,i.options,i))),"around"===u&&!s.hideNavigation&&t===h-1&&_t.createElement(r.NextMonthButton,{type:"button",className:l[jv.NextMonthButton],tabIndex:q?void 0:-1,"aria-disabled":!q||void 0,"aria-label":Z(q),onClick:oe,"data-animated-button":s.animate?"true":void 0},_t.createElement(r.Chevron,{disabled:!q||void 0,className:l[jv.Chevron],orientation:"rtl"===s.dir?"left":"right"})),t===h-1&&"after"===u&&!s.hideNavigation&&_t.createElement(r.Nav,{"data-animated-nav":s.animate?"true":void 0,className:l[jv.Nav],style:null==w?void 0:w[jv.Nav],"aria-label":J(),onPreviousClick:ie,onNextClick:oe,previousMonth:O,nextMonth:q}),_t.createElement(r.MonthGrid,{role:"grid","aria-multiselectable":"multiple"===d||"range"===d,"aria-label":G(e.date,i.options,i)||void 0,className:l[jv.MonthGrid],style:null==w?void 0:w[jv.MonthGrid]},!s.hideWeekdays&&_t.createElement(r.Weekdays,{"data-animated-weekdays":s.animate?"true":void 0,className:l[jv.Weekdays],style:null==w?void 0:w[jv.Weekdays]},b&&_t.createElement(r.WeekNumberHeader,{"aria-label":se(i.options),className:l[jv.WeekNumberHeader],style:null==w?void 0:w[jv.WeekNumberHeader],scope:"col"},C()),ae.map((e,t)=>_t.createElement(r.Weekday,{"aria-label":ee(e,i.options,i),className:l[jv.Weekday],key:t,style:null==w?void 0:w[jv.Weekday],scope:"col"},E(e,i.options,i)))),_t.createElement(r.Weeks,{"data-animated-weeks":s.animate?"true":void 0,className:l[jv.Weeks],style:null==w?void 0:w[jv.Weeks]},e.weeks.map((e,t)=>_t.createElement(r.Week,{className:l[jv.Week],key:e.weekNumber,style:null==w?void 0:w[jv.Week],week:e},b&&_t.createElement(r.WeekNumber,{week:e,style:null==w?void 0:w[jv.WeekNumber],"aria-label":te(e.weekNumber,{locale:o}),className:l[jv.WeekNumber],scope:"row",role:"rowheader"},S(e.weekNumber,i)),e.days.map(e=>{const{date:t}=e,a=F(e);if(a[bv.focused]=!a.hidden&&Boolean(null==W?void 0:W.isEqualTo(e)),a[Nv.selected]=(null==L?void 0:L(t))||a.selected,Lj(z)){const{from:e,to:s}=z;a[Nv.range_start]=Boolean(e&&s&&i.isSameDay(t,e)),a[Nv.range_end]=Boolean(e&&s&&i.isSameDay(t,s)),a[Nv.range_middle]=Ij(z,t,!0,i)}const n=function(e,t={},s={}){let r={...null==t?void 0:t[jv.Day]};return Object.entries(e).filter(([,e])=>!0===e).forEach(([e])=>{r={...r,...null==s?void 0:s[e]}}),r}(a,w,s.modifiersStyles),o=function(e,t,s={}){return Object.entries(e).filter(([,e])=>!0===e).reduce((e,[r])=>(s[r]?e.push(s[r]):t[bv[r]]?e.push(t[bv[r]]):t[Nv[r]]&&e.push(t[Nv[r]]),e),[t[jv.Day]])}(a,l,s.modifiersClassNames),c=ne||a.hidden?void 0:Y(t,a,i.options,i);return _t.createElement(r.Day,{key:`${i.format(t,"yyyy-MM-dd")}_${i.format(e.displayMonth,"yyyy-MM")}`,day:e,modifiers:a,className:o.join(" "),style:n,role:"gridcell","aria-selected":a.selected||void 0,"aria-label":c,"data-day":i.format(t,"yyyy-MM-dd"),"data-month":e.outside?i.format(t,"yyyy-MM"):void 0,"data-selected":a.selected||void 0,"data-disabled":a.disabled||void 0,"data-hidden":a.hidden||void 0,"data-outside":e.outside||void 0,"data-focused":a.focused||void 0,"data-today":a.today||void 0},!a.hidden&&ne?_t.createElement(r.DayButton,{className:l[jv.DayButton],style:null==w?void 0:w[jv.DayButton],type:"button",day:e,modifiers:a,disabled:a.disabled||void 0,tabIndex:V(e)?0:-1,"aria-label":K(t,a,i.options,i),onClick:le(e,a),onBlur:de(e,a),onFocus:ce(e,a),onKeyDown:ue(e,a),onMouseEnter:he(e,a),onMouseLeave:me(e,a)},_(t,i.options,i)):!a.hidden&&_(e.date,i.options,i))}))))))})),s.footer&&_t.createElement(r.Footer,{className:l[jv.Footer],style:null==w?void 0:w[jv.Footer],role:"status","aria-live":"polite"},s.footer)))}function Ny({className:e,classNames:t,showOutsideDays:s=!0,...r}){return Ne.jsx(wy,{showOutsideDays:s,className:un("p-3",e),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:un(Wh({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:un(Wh({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...t},components:{IconLeft:({...e})=>Ne.jsx(fr,{className:"h-4 w-4"}),IconRight:({...e})=>Ne.jsx(xr,{className:"h-4 w-4"})},...r})}function _y({isOpen:e,onClose:t,onSuccess:s,product:r}){const{toast:a}=is(),[n,i]=Nt.useState(!1),[o,l]=Nt.useState([]),[c,d]=Nt.useState([]),[u,h]=Nt.useState(),[m,p]=Nt.useState({}),[f,x]=Nt.useState({name:"",description:"",sku:"",category_id:"",unit_id:"",current_sale_price:"",min_sale_price:"",alert_stock:"10",tax_rate:"0",expiration_date:""});Nt.useEffect(()=>{var t,s,a,n;e&&(v(),j(),g(),r?(x({name:r.name||"",description:r.description||"",sku:r.sku||"",category_id:r.category_id||"",unit_id:r.unit_id||"",current_sale_price:(null==(t=r.current_sale_price)?void 0:t.toString())||"",min_sale_price:(null==(s=r.min_sale_price)?void 0:s.toString())||"",alert_stock:(null==(a=r.alert_stock)?void 0:a.toString())||"10",tax_rate:(null==(n=r.tax_rate)?void 0:n.toString())||"0",expiration_date:r.expiry_date||""}),r.expiry_date&&h(new Date(r.expiry_date))):y())},[e,r]);const g=()=>{x({name:"",description:"",sku:"",category_id:"",unit_id:"",current_sale_price:"",min_sale_price:"",alert_stock:"10",tax_rate:"0",expiration_date:""}),h(void 0),p({})},v=async()=>{try{const{data:e,error:t}=await Dh.from("categories").select("*").eq("is_active",!0).order("name");if(t)throw t;l(e||[])}catch(e){a({title:"Erreur",description:"Impossible de charger les catgories",variant:"destructive"})}},j=async()=>{try{const{data:e,error:t}=await Dh.from("units").select("*").eq("is_active",!0).order("name");if(t)throw t;d(e||[])}catch(e){a({title:"Erreur",description:"Impossible de charger les units",variant:"destructive"})}},y=()=>{const e=Date.now().toString().slice(-6),t=Math.floor(1e3*Math.random()).toString().padStart(3,"0");x(s=>({...s,sku:`PRD-${e}${t}`}))},b=()=>{g(),t()};return Ne.jsx(bg,{open:e,onOpenChange:b,children:Ne.jsxs(kg,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[Ne.jsxs(Sg,{children:[Ne.jsx(Eg,{children:r?"Modifier le produit":"Nouveau produit"}),Ne.jsx(Mg,{children:r?"Modifiez les informations du produit":"Ajoutez un nouveau produit  votre catalogue"})]}),Ne.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{const e={};f.name.trim()?f.name.trim().length<2&&(e.name="Le nom doit contenir au moins 2 caractres"):e.name="Le nom du produit est obligatoire",f.sku.trim()?f.sku.trim().length<3&&(e.sku="Le SKU doit contenir au moins 3 caractres"):e.sku="Le SKU est obligatoire",f.category_id||(e.category_id="La catgorie est obligatoire"),f.unit_id||(e.unit_id="L'unit est obligatoire");const t=parseFloat(f.current_sale_price),s=parseFloat(f.min_sale_price);(!lv(t)||t<=0)&&(e.current_sale_price="Le prix actuel doit tre suprieur  0"),(!lv(s)||s<=0)&&(e.min_sale_price="Le prix minimum doit tre suprieur  0"),t<s&&(e.current_sale_price="Le prix actuel ne peut pas tre infrieur au prix minimum"),t>3*s&&(e.current_sale_price="Le prix actuel ne peut pas dpasser 3x le prix minimum"),parseInt(f.alert_stock)<0&&(e.alert_stock="Le stock d'alerte ne peut pas tre ngatif");const r=parseFloat(f.tax_rate);return(r<0||r>100)&&(e.tax_rate="Le taux de taxe doit tre entre 0 et 100"),u&&u<new Date&&(e.expiration_date="La date d'expiration ne peut pas tre dans le pass"),p(e),0===Object.keys(e).length})()){i(!0);try{if(!(await(async(e,t)=>{try{let s=Dh.from("products").select("id").eq("sku",e);t&&(s=s.neq("id",t));const{data:r,error:a}=await s;if(a)throw a;return 0===(r||[]).length}catch(s){return!1}})(f.sku,null==r?void 0:r.id)))return p(e=>({...e,sku:"Ce SKU existe dj"})),void a({title:"Erreur",description:"Ce SKU existe dj, veuillez en choisir un autre",variant:"destructive"});const e=parseFloat(f.current_sale_price),n=parseFloat(f.min_sale_price),i=parseInt(f.alert_stock),o=parseFloat(f.tax_rate),l=(e=>{const t={...e};return Object.keys(t).forEach(e=>{void 0!==t[e]&&null!==t[e]||delete t[e]}),t})({...f,current_sale_price:e,min_sale_price:n,alert_stock:i,tax_rate:o,expiration_date:u?lg(u,"yyyy-MM-dd"):null,category_id:f.category_id||null,unit_id:f.unit_id||null});if(r){const{error:e}=await Dh.from("products").update(l).eq("id",r.id);if(e){const t=nv(e);throw new Error(t.error)}a({title:"Succs",description:"Produit modifi avec succs"})}else{const{error:e}=await Dh.from("products").insert([l]);if(e){const t=nv(e);throw new Error(t.error)}a({title:"Succs",description:"Produit cr avec succs"})}s(),t(),g()}catch(n){a({title:"Erreur",description:n instanceof Error?n.message:"Une erreur est survenue lors de l'enregistrement",variant:"destructive"})}finally{i(!1)}}else a({title:"Erreur de validation",description:"Veuillez corriger les erreurs dans le formulaire",variant:"destructive"})},className:"space-y-4",children:[Ne.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{htmlFor:"name",children:"Nom du produit *"}),Ne.jsx(Bh,{id:"name",value:f.name,onChange:e=>x(t=>({...t,name:e.target.value})),className:m.name?"border-destructive":""}),m.name&&Ne.jsxs("p",{className:"text-sm text-destructive flex items-center gap-1",children:[Ne.jsx(rr,{className:"w-3 h-3"}),m.name]})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{htmlFor:"category",children:"Catgorie *"}),Ne.jsx(av,{value:f.category_id,onValueChange:e=>x(t=>({...t,category_id:e})),options:o.map(e=>({value:e.id,label:e.name})),placeholder:"Slectionner une catgorie",triggerClassName:m.category_id?"border-destructive":""}),m.category_id&&Ne.jsxs("p",{className:"text-sm text-destructive flex items-center gap-1",children:[Ne.jsx(rr,{className:"w-3 h-3"}),m.category_id]})]})]}),Ne.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{htmlFor:"sku",children:"SKU *"}),Ne.jsxs("div",{className:"flex gap-2",children:[Ne.jsx(Bh,{id:"sku",value:f.sku,onChange:e=>x(t=>({...t,sku:e.target.value})),className:m.sku?"border-destructive":""}),Ne.jsx(Vh,{type:"button",variant:"outline",size:"icon",onClick:y,children:Ne.jsx(Nr,{className:"w-4 h-4"})})]}),m.sku&&Ne.jsxs("p",{className:"text-sm text-destructive flex items-center gap-1",children:[Ne.jsx(rr,{className:"w-3 h-3"}),m.sku]})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{htmlFor:"unit",children:"Unit *"}),Ne.jsx(av,{value:f.unit_id,onValueChange:e=>x(t=>({...t,unit_id:e})),options:c.map(e=>({value:e.id,label:`${e.name} (${e.symbol})`})),placeholder:"Slectionner une unit",triggerClassName:m.unit_id?"border-destructive":""}),m.unit_id&&Ne.jsxs("p",{className:"text-sm text-destructive flex items-center gap-1",children:[Ne.jsx(rr,{className:"w-3 h-3"}),m.unit_id]})]})]}),Ne.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{htmlFor:"current_price",children:"Prix actuel (XOF) *"}),Ne.jsx(Bh,{id:"current_price",type:"number",step:"0.01",value:f.current_sale_price,onChange:e=>x(t=>({...t,current_sale_price:e.target.value})),className:m.current_sale_price?"border-destructive":""}),m.current_sale_price&&Ne.jsxs("p",{className:"text-sm text-destructive flex items-center gap-1",children:[Ne.jsx(rr,{className:"w-3 h-3"}),m.current_sale_price]})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{htmlFor:"min_price",children:"Prix minimum (XOF) *"}),Ne.jsx(Bh,{id:"min_price",type:"number",step:"0.01",value:f.min_sale_price,onChange:e=>x(t=>({...t,min_sale_price:e.target.value})),className:m.min_sale_price?"border-destructive":""}),m.min_sale_price&&Ne.jsxs("p",{className:"text-sm text-destructive flex items-center gap-1",children:[Ne.jsx(rr,{className:"w-3 h-3"}),m.min_sale_price]})]})]}),Ne.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{htmlFor:"alert_stock",children:"Stock d'alerte"}),Ne.jsx(Bh,{id:"alert_stock",type:"number",value:f.alert_stock,onChange:e=>x(t=>({...t,alert_stock:e.target.value})),className:m.alert_stock?"border-destructive":""}),m.alert_stock&&Ne.jsxs("p",{className:"text-sm text-destructive flex items-center gap-1",children:[Ne.jsx(rr,{className:"w-3 h-3"}),m.alert_stock]})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{htmlFor:"tax_rate",children:"Taux de taxe (%)"}),Ne.jsx(Bh,{id:"tax_rate",type:"number",step:"0.01",value:f.tax_rate,onChange:e=>x(t=>({...t,tax_rate:e.target.value})),className:m.tax_rate?"border-destructive":""}),m.tax_rate&&Ne.jsxs("p",{className:"text-sm text-destructive flex items-center gap-1",children:[Ne.jsx(rr,{className:"w-3 h-3"}),m.tax_rate]})]})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{children:"Date d'expiration (optionnelle)"}),Ne.jsxs(tv,{children:[Ne.jsx(sv,{asChild:!0,children:Ne.jsxs(Vh,{variant:"outline",className:"w-full justify-start text-left font-normal "+(m.expiration_date?"border-destructive":""),children:[Ne.jsx(dr,{className:"mr-2 h-4 w-4"}),u?lg(u,"dd/MM/yyyy"):"Slectionner une date"]})}),Ne.jsx(rv,{className:"w-auto p-0",children:Ne.jsx(Ny,{mode:"single",selected:u,onSelect:h,initialFocus:!0})})]}),m.expiration_date&&Ne.jsxs("p",{className:"text-sm text-destructive flex items-center gap-1",children:[Ne.jsx(rr,{className:"w-3 h-3"}),m.expiration_date]})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{htmlFor:"description",children:"Description"}),Ne.jsx(Tg,{id:"description",value:f.description,onChange:e=>x(t=>({...t,description:e.target.value})),rows:3})]}),Ne.jsxs(Cg,{children:[Ne.jsx(Vh,{type:"button",variant:"outline",onClick:b,children:"Annuler"}),Ne.jsx(Vh,{type:"submit",disabled:n,children:n?"Enregistrement...":r?"Modifier":"Crer"})]})]})]})})}function ky({isOpen:e,onClose:t,onSuccess:s,category:r}){const{toast:a}=is(),[n,i]=Nt.useState(!1),[o,l]=Nt.useState({}),[c,d]=Nt.useState({name:"",description:""});Nt.useEffect(()=>{e&&r?d({name:r.name||"",description:r.description||""}):e&&d({name:"",description:""}),l({})},[e,r]);const u=()=>{l({}),t()};return Ne.jsx(bg,{open:e,onOpenChange:u,children:Ne.jsxs(kg,{className:"max-w-md",children:[Ne.jsxs(Sg,{children:[Ne.jsx(Eg,{children:r?"Modifier la catgorie":"Nouvelle catgorie"}),Ne.jsx(Mg,{children:r?"Modifiez les informations de la catgorie":"Ajoutez une nouvelle catgorie de produits"})]}),Ne.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{const e={};return c.name.trim()?c.name.trim().length<2?e.name="Le nom doit contenir au moins 2 caractres":c.name.trim().length>50&&(e.name="Le nom ne peut pas dpasser 50 caractres"):e.name="Le nom de la catgorie est obligatoire",c.description&&c.description.length>200&&(e.description="La description ne peut pas dpasser 200 caractres"),l(e),0===Object.keys(e).length})()){i(!0);try{if(!(await(async(e,t)=>{try{let s=Dh.from("categories").select("id").eq("name",e.trim());t&&(s=s.neq("id",t));const{data:r,error:a}=await s;if(a)throw a;return 0===(r||[]).length}catch(s){return!1}})(c.name,null==r?void 0:r.id)))return l(e=>({...e,name:"Ce nom de catgorie existe dj"})),void a({title:"Erreur",description:"Ce nom de catgorie existe dj, veuillez en choisir un autre",variant:"destructive"});const e={name:c.name.trim(),description:c.description.trim()||null};if(r){const{error:t}=await Dh.from("categories").update(e).eq("id",r.id);if(t)throw t;a({title:"Succs",description:"Catgorie modifie avec succs"})}else{const{error:t}=await Dh.from("categories").insert([e]);if(t)throw t;a({title:"Succs",description:"Catgorie cre avec succs"})}s(),t()}catch(n){a({title:"Erreur",description:n instanceof Error?n.message:"Une erreur est survenue lors de l'enregistrement",variant:"destructive"})}finally{i(!1)}}else a({title:"Erreur de validation",description:"Veuillez corriger les erreurs dans le formulaire",variant:"destructive"})},className:"space-y-4",children:[Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{htmlFor:"name",children:"Nom de la catgorie *"}),Ne.jsx(Bh,{id:"name",value:c.name,onChange:e=>d(t=>({...t,name:e.target.value})),className:o.name?"border-destructive":"",placeholder:"Ex: lectronique, Vtements..."}),o.name&&Ne.jsxs("p",{className:"text-sm text-destructive flex items-center gap-1",children:[Ne.jsx(rr,{className:"w-3 h-3"}),o.name]})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{htmlFor:"description",children:"Description"}),Ne.jsx(Tg,{id:"description",value:c.description,onChange:e=>d(t=>({...t,description:e.target.value})),rows:3,className:o.description?"border-destructive":"",placeholder:"Description optionnelle de la catgorie..."}),o.description&&Ne.jsxs("p",{className:"text-sm text-destructive flex items-center gap-1",children:[Ne.jsx(rr,{className:"w-3 h-3"}),o.description]}),Ne.jsxs("p",{className:"text-xs text-muted-foreground",children:[c.description.length,"/200 caractres"]})]}),Ne.jsxs(Cg,{children:[Ne.jsx(Vh,{type:"button",variant:"outline",onClick:u,children:"Annuler"}),Ne.jsx(Vh,{type:"submit",disabled:n,children:n?"Enregistrement...":r?"Modifier":"Crer"})]})]})]})})}function Sy({items:e,className:t=""}){const s=pl();return Ne.jsxs("nav",{className:`flex items-center space-x-1 text-sm text-muted-foreground ${t}`,children:[Ne.jsx(Vh,{variant:"ghost",size:"sm",onClick:()=>s("/dashboard"),className:"h-6 px-2 text-muted-foreground hover:text-foreground",children:Ne.jsx(Pr,{className:"h-3 w-3"})}),e.map((e,t)=>Ne.jsxs(_t.Fragment,{children:[Ne.jsx(xr,{className:"h-4 w-4"}),e.path?Ne.jsxs(Vh,{variant:"ghost",size:"sm",onClick:()=>{return t=e.path,void s(t);var t},className:"h-6 px-2 text-muted-foreground hover:text-foreground",children:[e.icon&&Ne.jsx(e.icon,{className:"h-3 w-3 mr-1"}),e.label]}):Ne.jsxs("span",{className:"px-2 text-foreground font-medium",children:[e.icon&&Ne.jsx(e.icon,{className:"h-3 w-3 mr-1 inline"}),e.label]})]},t))]})}function Cy(){const{formatAmount:e}=rx(),{toast:t}=is(),{userProfile:s}=Ih(),[r,a]=Nt.useState(""),[n,i]=Nt.useState(""),[o,l]=Nt.useState([]),[c,d]=Nt.useState([]),[u,h]=Nt.useState(!0),[m,p]=Nt.useState(!0),[f,x]=Nt.useState(!1),[g,v]=Nt.useState(!1),[j,y]=Nt.useState(null),[b,w]=Nt.useState("products"),[N,_]=Nt.useState(null),[k,S]=Nt.useState(1),[C,E]=Nt.useState(20),M=(null==s?void 0:s.role)&&["Admin","SuperAdmin"].includes(s.role),T=(null==s?void 0:s.role)&&["Admin","SuperAdmin"].includes(s.role),A=(null==s?void 0:s.role)&&["Admin","SuperAdmin"].includes(s.role),P=(null==s?void 0:s.role)&&["Admin","SuperAdmin"].includes(s.role),D=(null==s?void 0:s.role)&&["Vendeur","Manager","Admin","SuperAdmin"].includes(s.role);Nt.useEffect(()=>{D&&R(),O()},[D]);const R=async()=>{try{h(!0),_(null);const{data:e,error:s}=await Dh.from("products").select("\n          *,\n          categories(name),\n          units(name, symbol),\n          product_stores(\n            current_stock,\n            min_stock,\n            max_stock,\n            stores(name)\n          )\n        ").order("created_at",{ascending:!1});if(s){if("42501"!==s.code)throw s;return _("Vous n'avez pas les permissions pour voir les produits"),void t({title:"Permission refuse",description:"Vous n'avez pas les permissions pour voir les produits",variant:"destructive"})}l(e||[])}catch(e){_("Impossible de charger les produits"),t({title:"Erreur",description:"Impossible de charger les produits",variant:"destructive"})}finally{h(!1)}},O=async()=>{try{p(!0);const{data:e,error:t}=await Dh.from("categories").select("id, name, description").order("name",{ascending:!0});if(t)throw t;d(e||[])}catch(e){t({title:"Erreur",description:"Impossible de charger les catgories",variant:"destructive"})}finally{p(!1)}},q=async e=>{if(!P)return;if((W[e]||0)>0)t({title:"Suppression impossible",description:"Cette catgorie contient encore des produits. Dplacez ou supprimez-les avant.",variant:"destructive"});else if(confirm("Supprimer cette catgorie ? Cette action est irrversible."))try{const{count:s,error:r}=await Dh.from("products").select("id",{count:"exact",head:!0}).eq("category_id",e);if(r)throw r;if((s||0)>0)return void t({title:"Suppression refuse",description:"Des produits sont encore rattachs  cette catgorie.",variant:"destructive"});const{error:a}=await Dh.from("categories").delete().eq("id",e);if(a)throw a;t({title:"Catgorie supprime"}),await O()}catch(s){t({title:"Erreur",description:"Impossible de supprimer la catgorie",variant:"destructive"})}},I=()=>{M?(y(null),x(!0)):t({title:"Permission refuse",description:"Vous n'avez pas les permissions pour ajouter des produits",variant:"destructive"})},F=()=>{M?v(!0):t({title:"Permission refuse",description:"Vous n'avez pas les permissions pour ajouter des catgories",variant:"destructive"})},L=Nt.useMemo(()=>{const e=e=>e?String(e).normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase():"",t=e(r).split(/\s+/).filter(Boolean);return 0===t.length?o:o.filter(s=>{var r,a,n;const i=Array.isArray(s.product_stores)?s.product_stores.map(e=>{var t;return null==(t=e.stores)?void 0:t.name}):[],o=[s.name,s.sku,null==(r=s.categories)?void 0:r.name,null==(a=s.units)?void 0:a.name,null==(n=s.units)?void 0:n.symbol,...i],l=e(o.filter(Boolean).join(" "));return t.every(e=>l.includes(e))})},[o,r]),$="all"===C?1:Math.max(1,Math.ceil(L.length/C)),z=Math.min(k,$),U="all"===C?L:L.slice((z-1)*C,z*C);Nt.useEffect(()=>{S(1)},[C,r]);const W=o.reduce((e,t)=>(t.category_id&&(e[t.category_id]=(e[t.category_id]||0)+1),e),{}),V=Nt.useMemo(()=>{const e=e=>e?String(e).normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase():"",t=e(n).split(/\s+/).filter(Boolean);return 0===t.length?c:c.filter(s=>t.every(t=>e(s.name).includes(t)))},[c,n]);return N&&!D?Ne.jsxs("div",{className:"space-y-6",children:[Ne.jsx("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx("h1",{className:"text-xl sm:text-2xl md:text-3xl font-bold",children:"Produits"}),Ne.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:"Grez vos produits et catgories"})]})}),Ne.jsxs("div",{className:"bg-destructive/10 border border-destructive/20 rounded-lg p-6 text-center",children:[Ne.jsx(rr,{className:"w-12 h-12 text-destructive mx-auto mb-4"}),Ne.jsx("h3",{className:"text-lg font-semibold text-destructive mb-2",children:"Accs refus"}),Ne.jsx("p",{className:"text-destructive/80 mb-4",children:"Vous n'avez pas les permissions pour accder  cette page"})]})]}):Ne.jsxs("div",{className:"space-y-6",children:[Ne.jsx(Sy,{items:[{label:"Produits",icon:void 0}]}),Ne.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[Ne.jsxs("div",{children:[Ne.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:"Produits"}),Ne.jsx("p",{className:"text-muted-foreground",children:"Grez vos produits et catgories"})]}),Ne.jsx("div",{className:"flex flex-col gap-2 sm:flex-row sm:gap-3",children:("Admin"===(null==s?void 0:s.role)||"SuperAdmin"===(null==s?void 0:s.role))&&Ne.jsxs(Ne.Fragment,{children:[Ne.jsxs(Vh,{variant:"outline",size:"sm",onClick:F,className:"gap-2 w-full sm:w-auto justify-center",children:[Ne.jsx(Yr,{className:"w-4 h-4"}),Ne.jsx("span",{className:"hidden sm:inline",children:"Nouvelle catgorie"}),Ne.jsx("span",{className:"sm:hidden",children:"Catgorie"})]}),Ne.jsxs(Vh,{variant:"default",size:"sm",onClick:I,className:"gap-2 w-full sm:w-auto justify-center",children:[Ne.jsx(Yr,{className:"w-4 h-4"}),Ne.jsx("span",{className:"hidden sm:inline",children:"Nouveau produit"}),Ne.jsx("span",{className:"sm:hidden",children:"Produit"})]})]})})]}),Ne.jsxs(bp,{value:b,onValueChange:e=>w(e),className:"space-y-4",children:[Ne.jsxs(wp,{children:[Ne.jsx(Np,{value:"products",children:"Produits"}),Ne.jsx(Np,{value:"categories",children:"Catgories"})]}),Ne.jsx(_p,{value:"products",className:"space-y-4",children:N?Ne.jsx(Um,{className:"bg-destructive/10 border border-destructive/20",children:Ne.jsxs(Hm,{className:"p-6 text-center",children:[Ne.jsx(rr,{className:"w-12 h-12 text-destructive mx-auto mb-4"}),Ne.jsx("h3",{className:"text-lg font-semibold text-destructive mb-2",children:"Erreur de chargement"}),Ne.jsx("p",{className:"text-destructive/80 mb-4",children:N}),Ne.jsxs(Vh,{onClick:R,variant:"outline",className:"gap-2",children:[Ne.jsx(Gr,{className:"w-4 h-4"}),"Ressayer"]})]})}):Ne.jsxs(Ne.Fragment,{children:[Ne.jsx(Um,{className:"bg-gradient-to-r from-blue-50 to-blue-100 border-blue-200",children:Ne.jsx(Hm,{className:"p-4",children:Ne.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center",children:[Ne.jsxs("div",{className:"relative w-full sm:flex-1",children:[Ne.jsx(Xr,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),Ne.jsx(Bh,{value:r,onChange:e=>a(e.target.value),placeholder:"Rechercher (nom, SKU, catgorie, unit, magasin)",className:"pl-9"})]}),Ne.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:gap-2",children:[Ne.jsxs(Vh,{variant:"outline",size:"sm",onClick:R,disabled:u,className:"gap-2 w-full sm:w-auto justify-center",children:[Ne.jsx(Gr,{className:"w-4 h-4 "+(u?"animate-spin":"")}),Ne.jsx("span",{className:"hidden sm:inline",children:"Actualiser"}),Ne.jsx("span",{className:"sm:hidden",children:""})]}),("Admin"===(null==s?void 0:s.role)||"SuperAdmin"===(null==s?void 0:s.role))&&Ne.jsxs(Vh,{onClick:I,size:"sm",className:"gap-2 w-full sm:w-auto justify-center",children:[Ne.jsx(Yr,{className:"w-4 h-4"}),Ne.jsx("span",{className:"hidden sm:inline",children:"Nouveau produit"}),Ne.jsx("span",{className:"sm:hidden",children:"Ajouter"})]})]})]})})}),Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{children:[Ne.jsxs(Vm,{className:"flex items-center gap-2",children:[Ne.jsx(Ur,{className:"w-5 h-5 text-primary"}),"Liste des produits"]}),Ne.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[Ne.jsx(Bm,{children:u?"Chargement...":`${L.length} produit(s) trouv(s)`}),Ne.jsxs("div",{className:"flex items-center gap-2",children:[Ne.jsx("span",{className:"text-sm text-muted-foreground",children:"Par page"}),Ne.jsxs(Kf,{value:String(C),onValueChange:e=>E("all"===e?"all":parseInt(e)),children:[Ne.jsx(Gf,{className:"h-8 w-[92px]",children:Ne.jsx(Yf,{placeholder:"20"})}),Ne.jsxs(Xf,{children:[Ne.jsx(Zf,{value:"all",children:"All"}),Ne.jsx(Zf,{value:"10",children:"10"}),Ne.jsx(Zf,{value:"20",children:"20"}),Ne.jsx(Zf,{value:"50",children:"50"})]})]})]})]})]}),Ne.jsxs(Hm,{children:[u?Ne.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:Array.from({length:8}).map((e,t)=>Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{className:"pb-3",children:[Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-6 w-3/4 rounded mb-2"}),Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-4 w-1/2 rounded"})]}),Ne.jsxs(Hm,{className:"space-y-3",children:[Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-4 w-1/3 rounded"}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-4 w-full rounded"}),Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-4 w-2/3 rounded"})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-4 w-1/2 rounded"}),Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-4 w-3/4 rounded"})]})]})]},t))}):0===L.length?Ne.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[Ne.jsx(Ur,{className:"w-16 h-16 text-muted-foreground/20 mb-4"}),Ne.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Aucun produit"}),Ne.jsx("p",{className:"text-muted-foreground mb-6",children:r?"Aucun produit ne correspond  votre recherche":"Commencez par ajouter votre premier produit"}),M&&Ne.jsxs(Vh,{onClick:I,className:"gap-2",children:[Ne.jsx(Yr,{className:"w-4 h-4"}),"Ajouter un produit"]})]}):Ne.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3 sm:gap-4",children:U.map(s=>{var r,a,n,i;return Ne.jsxs(Um,{className:"bg-gradient-card shadow-card hover:shadow-elevated transition-all duration-200 transform hover:scale-[1.02]",children:[Ne.jsx(Wm,{className:"pb-3",children:Ne.jsxs("div",{className:"flex items-start justify-between",children:[Ne.jsxs("div",{className:"flex-1",children:[Ne.jsx(Vm,{className:"text-lg font-semibold line-clamp-2",children:s.name}),Ne.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["SKU: ",s.sku]})]}),Ne.jsxs(Om,{children:[Ne.jsx(qm,{asChild:!0,children:Ne.jsx(Vh,{variant:"ghost",size:"icon",className:"h-8 w-8",children:Ne.jsx(zr,{className:"w-4 h-4"})})}),Ne.jsxs(Im,{align:"end",children:[Ne.jsx(Lm,{children:"Actions"}),Ne.jsx($m,{}),Ne.jsx(Fm,{children:"Voir dtails"}),T&&Ne.jsx(Fm,{onClick:()=>(e=>{T?(y(e),x(!0)):t({title:"Permission refuse",description:"Vous n'avez pas les permissions pour modifier des produits",variant:"destructive"})})(s),children:"Modifier"}),A&&Ne.jsxs(Ne.Fragment,{children:[Ne.jsx($m,{}),Ne.jsx(Fm,{className:"text-destructive",onClick:()=>(async e=>{if(A){if(confirm("tes-vous sr de vouloir supprimer ce produit ?"))try{const{error:s}=await Dh.from("products").delete().eq("id",e);if(s)throw s;t({title:"Succs",description:"Produit supprim avec succs"}),R()}catch(s){t({title:"Erreur",description:"Impossible de supprimer le produit",variant:"destructive"})}}else t({title:"Permission refuse",description:"Vous n'avez pas les permissions pour supprimer des produits",variant:"destructive"})})(s.id),children:"Supprimer"})]})]})]})]})}),Ne.jsxs(Hm,{className:"space-y-3",children:[Ne.jsx("div",{className:"flex items-center gap-2",children:Ne.jsx(Cp,{variant:"outline",className:"text-xs",children:(null==(r=s.categories)?void 0:r.name)||"Non catgoris"})}),Ne.jsxs("div",{className:"space-y-1",children:[Ne.jsxs("div",{className:"flex items-center justify-between",children:[Ne.jsx("span",{className:"text-sm text-muted-foreground",children:"Prix actuel"}),Ne.jsx("span",{className:"font-semibold text-lg",children:e(s.current_sale_price)})]}),Ne.jsxs("div",{className:"flex items-center justify-between",children:[Ne.jsx("span",{className:"text-sm text-muted-foreground",children:"Prix minimum"}),Ne.jsx("span",{className:"text-sm",children:e(s.min_sale_price)})]})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsxs("div",{className:"flex items-center justify-between",children:[Ne.jsx("span",{className:"text-sm text-muted-foreground",children:"Stock"}),Ne.jsxs("span",{className:"text-sm font-medium",children:[null==(a=s.units)?void 0:a.name," (",null==(n=s.units)?void 0:n.symbol,")"]})]}),s.product_stores&&s.product_stores.length>0?Ne.jsx("div",{className:"space-y-1",children:s.product_stores.map((e,t)=>{var s;return Ne.jsxs("div",{className:"flex items-center justify-between text-xs",children:[Ne.jsxs("span",{className:"text-muted-foreground",children:[null==(s=e.stores)?void 0:s.name,":"]}),Ne.jsx("span",{className:"font-medium "+(e.current_stock<=e.min_stock?"text-red-500":"text-green-600"),children:e.current_stock})]},t)})}):Ne.jsx("div",{className:"text-center py-2",children:Ne.jsx("span",{className:"text-xs text-muted-foreground",children:"Aucun stock"})})]}),Ne.jsxs("div",{className:"flex items-center gap-2 pt-2",children:[(null==(i=s.product_stores)?void 0:i.some(e=>e.current_stock<=e.min_stock))&&Ne.jsx(Cp,{variant:"destructive",className:"text-xs",children:"Stock faible"}),s.expiry_date&&new Date(s.expiry_date)<new Date&&Ne.jsx(Cp,{variant:"destructive",className:"text-xs",children:"Expir"}),s.expiry_date&&new Date(s.expiry_date)>new Date&&new Date(s.expiry_date)<new Date(Date.now()+2592e6)&&Ne.jsx(Cp,{variant:"secondary",className:"text-xs",children:"Expire bientt"})]})]})]},s.id)})}),Ne.jsxs("div",{className:"mt-4 flex items-center justify-center gap-2",children:[Ne.jsx(Vh,{variant:"outline",size:"sm",disabled:z<=1||"all"===C,onClick:()=>S(e=>Math.max(1,e-1)),children:"Prcdent"}),Ne.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",z," / ",$]}),Ne.jsx(Vh,{variant:"outline",size:"sm",disabled:z>=$||"all"===C,onClick:()=>S(e=>Math.min($,e+1)),children:"Suivant"})]})]})]})]})}),Ne.jsxs(_p,{value:"categories",className:"space-y-4",children:[Ne.jsx(Um,{className:"bg-gradient-card shadow-card",children:Ne.jsx(Hm,{className:"p-4",children:Ne.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center",children:[Ne.jsxs("div",{className:"relative w-full sm:flex-1",children:[Ne.jsx(Xr,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),Ne.jsx(Bh,{value:n,onChange:e=>i(e.target.value),placeholder:"Rechercher une catgorie",className:"pl-9"})]}),("Admin"===(null==s?void 0:s.role)||"SuperAdmin"===(null==s?void 0:s.role))&&Ne.jsxs(Vh,{variant:"outline",size:"sm",onClick:F,className:"gap-2 w-full sm:w-auto justify-center",children:[Ne.jsx(Yr,{className:"w-4 h-4"}),Ne.jsx("span",{className:"hidden sm:inline",children:"Nouvelle catgorie"}),Ne.jsx("span",{className:"sm:hidden",children:"Catgorie"})]})]})})}),Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{children:[Ne.jsx(Vm,{children:"Liste des catgories"}),Ne.jsx(Bm,{children:m?"Chargement...":`${V.length} catgorie(s)`})]}),Ne.jsx(Hm,{children:m?Ne.jsx("div",{className:"space-y-3",children:Array.from({length:5}).map((e,t)=>Ne.jsxs("div",{className:"flex items-center space-x-4 p-4 border rounded-lg",children:[Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-4 w-32 rounded"}),Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-4 w-48 rounded"}),Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-6 w-16 rounded"}),Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-8 w-20 rounded"})]},t))}):Ne.jsxs(Ne.Fragment,{children:[Ne.jsx("div",{className:"block sm:hidden",children:Ne.jsx("div",{className:"space-y-3",children:V.map(e=>Ne.jsx(Um,{className:"p-4",children:Ne.jsxs("div",{className:"flex items-center justify-between",children:[Ne.jsxs("div",{className:"flex-1",children:[Ne.jsx("h3",{className:"font-medium text-sm",children:e.name}),Ne.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:e.description||"Aucune description"}),Ne.jsx("div",{className:"mt-2",children:Ne.jsxs(Cp,{variant:"outline",className:"text-xs",children:[W[e.id]||0," produit(s)"]})})]}),Ne.jsx("div",{className:"ml-3",children:P?Ne.jsx(Vh,{variant:"outline",size:"sm",onClick:()=>q(e.id),disabled:(W[e.id]||0)>0,title:(W[e.id]||0)>0?"Supprimez/dplacez d'abord les produits":"",className:"text-xs",children:"Supprimer"}):Ne.jsx("span",{className:"text-muted-foreground text-xs",children:""})})]})},e.id))})}),Ne.jsx("div",{className:"hidden sm:block",children:Ne.jsxs(fg,{children:[Ne.jsx(xg,{children:Ne.jsxs(vg,{children:[Ne.jsx(jg,{children:"Catgorie"}),Ne.jsx(jg,{children:"Description"}),Ne.jsx(jg,{className:"text-right",children:"Nombre de produits"}),Ne.jsx(jg,{className:"text-right",children:"Actions"})]})}),Ne.jsx(gg,{children:V.map(e=>Ne.jsxs(vg,{children:[Ne.jsx(yg,{className:"font-medium",children:e.name}),Ne.jsx(yg,{className:"text-muted-foreground",children:e.description||""}),Ne.jsx(yg,{className:"text-right",children:Ne.jsx(Cp,{variant:"outline",children:W[e.id]||0})}),Ne.jsx(yg,{className:"text-right",children:P?Ne.jsx(Vh,{variant:"outline",size:"sm",onClick:()=>q(e.id),disabled:(W[e.id]||0)>0,title:(W[e.id]||0)>0?"Supprimez/dplacez d'abord les produits":"",children:"Supprimer"}):Ne.jsx("span",{className:"text-muted-foreground text-sm",children:""})})]},e.id))})]})})]})})]})]})]}),Ne.jsx(_y,{isOpen:f,onClose:()=>x(!1),onSuccess:R,product:j}),Ne.jsx(ky,{isOpen:g,onClose:()=>v(!1),onSuccess:()=>{O()}})]})}function Ey({isOpen:e,onClose:t,onSuccess:s,purchase:r}){var a,n,i;const{user:o,userProfile:l}=Ih(),{toast:c}=is(),[d,u]=Nt.useState(!1),[h,m]=Nt.useState(""),p="Manager"===(null==l?void 0:l.role);Nt.useEffect(()=>{e&&r&&m("")},[e,r]);return r?Ne.jsx(bg,{open:e,onOpenChange:t,children:Ne.jsxs(kg,{className:"w-[92vw] sm:max-w-md p-4 sm:p-6",children:[Ne.jsxs(Sg,{children:[Ne.jsx(Eg,{className:"text-base sm:text-lg",children:"Validation d'arrivage"}),Ne.jsx(Mg,{className:"text-xs sm:text-sm",children:"Vrifiez et validez les quantits reues pour cet achat"})]}),Ne.jsxs("div",{className:"space-y-4",children:[Ne.jsxs("div",{className:"bg-muted p-3 sm:p-4 rounded-md grid grid-cols-1 gap-2",children:[Ne.jsxs("div",{className:"flex items-center justify-between gap-3",children:[Ne.jsx("span",{className:"text-xs sm:text-sm font-medium",children:"Produit"}),Ne.jsx("span",{className:"text-xs sm:text-sm text-right line-clamp-2",children:null==(a=r.products)?void 0:a.name})]}),Ne.jsxs("div",{className:"flex items-center justify-between gap-3",children:[Ne.jsx("span",{className:"text-xs sm:text-sm font-medium",children:"SKU"}),Ne.jsx("span",{className:"text-xs sm:text-sm",children:null==(n=r.products)?void 0:n.sku})]}),!p&&Ne.jsxs("div",{className:"flex items-center justify-between gap-3",children:[Ne.jsx("span",{className:"text-xs sm:text-sm font-medium",children:"Fournisseur"}),Ne.jsx("span",{className:"text-xs sm:text-sm",children:null==(i=r.suppliers)?void 0:i.name})]})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{htmlFor:"received_quantity",className:"text-xs sm:text-sm",children:"Quantit reue *"}),Ne.jsx(Bh,{id:"received_quantity",type:"number",value:h,onChange:e=>m(e.target.value),required:!0,min:"0",className:"h-10 sm:h-11 text-sm",inputMode:"numeric"}),Ne.jsx("p",{className:"text-[11px] sm:text-xs text-muted-foreground",children:"Le nombre command n'est pas affich pour viter d'influencer la saisie."})]})]}),Ne.jsxs(Cg,{className:"flex flex-col-reverse sm:flex-row gap-2 sm:gap-3",children:[Ne.jsx(Vh,{type:"button",variant:"outline",onClick:t,className:"w-full sm:w-auto",children:"Annuler"}),Ne.jsx(Vh,{onClick:async()=>{if(o&&l)if(l.id&&""!==l.id){if(h&&!(parseInt(h)<=0)||(c({title:"Erreur",description:"La quantit reue doit tre suprieure  0",variant:"destructive"}),0)){u(!0);try{const e=parseInt(h),a=r.quantity,{error:n}=await Dh.from("arrivals").insert({purchase_id:r.id,received_quantity:e,validated_by:l.id,notes:null});if(n){const e="Quantit reue incorrecte. Veuillez vrifier le colis ou contacter l'expditeur.";return void c({title:"Validation impossible",description:!0?e:n.message||e,variant:"destructive"})}c({title:"Arrivage enregistr",description:e===a?"Quantit conforme. Stock mis  jour.":`Quantit reue (${e}) diffrente de la commande (${a}). Vrifiez et recommencez.`,variant:e===a?"default":"destructive"}),s(),t()}catch(e){c({title:"Erreur",description:(null==e?void 0:e.message)||"Une erreur est survenue lors de la validation",variant:"destructive"})}finally{u(!1)}}}else c({title:"Erreur",description:"Profil utilisateur invalide. Veuillez vous reconnecter.",variant:"destructive"});else c({title:"Erreur",description:"Vous devez tre connect pour valider un arrivage",variant:"destructive"})},disabled:d||!h,className:"w-full sm:w-auto",children:d?"Validation...":"Valider l'arrivage"})]})]})}):null}function My({isOpen:e,onClose:t,onSuccess:s,transfer:r}){var a;const{userProfile:n}=Ih(),{toast:i}=is(),[o,l]=Nt.useState(!1),[c,d]=Nt.useState("");Nt.useEffect(()=>{e&&r&&d("")},[e,r]);return r?Ne.jsx(bg,{open:e,onOpenChange:t,children:Ne.jsxs(kg,{className:"max-w-md",children:[Ne.jsxs(Sg,{children:[Ne.jsx(Eg,{children:"Rception de transfert"}),Ne.jsx(Mg,{children:"Renseignez la quantit reue pour ce transfert"})]}),Ne.jsxs("div",{className:"space-y-4",children:[Ne.jsxs("div",{className:"bg-muted p-4 rounded-md space-y-2",children:[Ne.jsxs("div",{className:"flex justify-between",children:[Ne.jsx("span",{className:"text-sm font-medium",children:"Code:"}),Ne.jsx("span",{className:"text-sm",children:r.transfer_code})]}),Ne.jsxs("div",{className:"flex justify-between",children:[Ne.jsx("span",{className:"text-sm font-medium",children:"Produit:"}),Ne.jsx("span",{className:"text-sm",children:(null==(a=r.products)?void 0:a.name)||r.product_name})]})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{htmlFor:"received_qty",children:"Quantit reue *"}),Ne.jsx(Bh,{id:"received_qty",type:"number",value:c,onChange:e=>d(e.target.value),min:"0"})]})]}),Ne.jsxs(Cg,{children:[Ne.jsx(Vh,{variant:"outline",onClick:t,children:"Annuler"}),Ne.jsx(Vh,{onClick:async()=>{if(!(null==n?void 0:n.id))return void i({title:"Erreur",description:"Profil invalide",variant:"destructive"});const e=parseInt(c);if(!e||e<=0)i({title:"Erreur",description:"Quantit invalide",variant:"destructive"});else{l(!0);try{const{error:a}=await Dh.from("transfer_receptions").insert({transfer_id:r.id,received_quantity:e,received_by:n.id,notes:null});if(a){return void i({title:"Validation impossible",description:"Quantit reue incorrecte. Veuillez vrifier le colis ou contacter l'expditeur.",variant:"destructive"})}i({title:"Transfert valid",description:"Stock mis  jour pour le magasin destination."}),s(),t()}catch(zw){i({title:"Erreur",description:(null==zw?void 0:zw.message)||"chec de la validation",variant:"destructive"})}finally{l(!1)}}},disabled:o||!c,children:o?"Validation...":"Valider"})]})]})}):null}function Ty(){var e,t;const{toast:s}=is(),{userProfile:r}=Ih(),a="Manager"===(null==r?void 0:r.role),[n,i]=Nt.useState(""),[o,l]=Nt.useState([]),[c,d]=Nt.useState([]),[u,h]=Nt.useState(!0),[m,p]=Nt.useState(!0),[f,x]=Nt.useState(!1),[g,v]=Nt.useState(null),[j,y]=Nt.useState(!1),[b,w]=Nt.useState(null),[N,_]=Nt.useState(null),[k,S]=Nt.useState({supplier:"all",store:"all",dateRange:null,status:"all",type:"all"}),[C,E]=Nt.useState(!1),[M,T]=Nt.useState(1),[A,P]=Nt.useState(20),[D,R]=Nt.useState("date_desc"),O=(null==r?void 0:r.role)&&["Vendeur","Manager","Admin","SuperAdmin"].includes(r.role),q=(null==r?void 0:r.role)&&["Manager","Admin","SuperAdmin"].includes(r.role);Nt.useEffect(()=>{O&&I()},[O]);const I=async()=>{try{_(null),h(!0),p(!0);const[{data:e,error:t},{data:s,error:r},{data:a,error:n},{data:i,error:o}]=await Promise.all([Dh.from("purchases").select("*, suppliers(name), products(name, sku), stores(name)").eq("status","pending").order("created_at",{ascending:!1}),Dh.from("store_transfers").select("*, product:products(name, sku)").eq("status","pending").order("created_at",{ascending:!1}),Dh.from("arrivals").select("purchase_id"),Dh.from("transfer_receptions").select("transfer_id")]);if(t)throw t;if(r)throw r;if(n)throw n;if(o)throw o;const c=new Set((a||[]).map(e=>e.purchase_id)),u=new Set((i||[]).map(e=>e.transfer_id)),m=(e||[]).filter(e=>!c.has(e.id)),f=(s||[]).filter(e=>!u.has(e.id)),x=[...m.map(e=>({type:"Achat",...e})),...f.map(e=>({type:"Transfert",...e}))];l(x),h(!1);const[{data:g,error:v},{data:j,error:y}]=await Promise.all([Dh.from("arrivals").select("*, purchases(*, suppliers(name), products(name, sku), stores(name))").order("created_at",{ascending:!1}).limit(100),Dh.from("transfer_receptions").select("*, store_transfers(*, product:products(name, sku))").order("received_at",{ascending:!1}).limit(100)]);if(v)throw v;if(y)throw y;const b=[...(g||[]).map(e=>({type:"Achat",...e})),...(j||[]).map(e=>({type:"Transfert",...e}))];d(b),p(!1)}catch(e){_("Impossible de charger les arrivages"),s({title:"Erreur",description:"Impossible de charger les arrivages",variant:"destructive"}),h(!1),p(!1)}},F=(e,t)=>Ne.jsxs(Cp,{variant:"default",className:"gap-1 bg-success text-success-foreground",children:[Ne.jsx(hr,{className:"w-3 h-3"}),"Valid"]}),L=e=>{q?(v(e),x(!0)):s({title:"Permission refuse",description:"Vous n'avez pas les permissions pour valider les arrivages",variant:"destructive"})},$=()=>{S({supplier:"all",store:"all",dateRange:null,status:"all",type:"all"})},z=e=>{var t,s;const r=e=>e?String(e).normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase():"",a=r(n).split(/\s+/).filter(Boolean);let i=e.filter(e=>{var t,s,n,i,o,l,c,d,u;if(0===a.length)return!0;if("Achat"===e.type){const h=e,m=r([null==(s=null==(t=h.purchases)?void 0:t.suppliers)?void 0:s.name,null==(i=null==(n=h.purchases)?void 0:n.products)?void 0:i.name,null==(l=null==(o=h.purchases)?void 0:o.products)?void 0:l.sku,null==(c=h.suppliers)?void 0:c.name,null==(d=h.products)?void 0:d.name,null==(u=h.products)?void 0:u.sku].filter(Boolean).join(" "));return a.every(e=>m.includes(e))}{const t=e,s=r([t.transfer_code,t.product_name].filter(Boolean).join(" "));return a.every(e=>s.includes(e))}});return k.type&&"all"!==k.type&&(i=i.filter(e=>e.type===k.type)),k.supplier&&"all"!==k.supplier&&(i=i.filter(e=>{var t,s,r;return"Achat"===e.type&&((null==(t=e.suppliers)?void 0:t.name)===k.supplier||(null==(r=null==(s=e.purchases)?void 0:s.suppliers)?void 0:r.name)===k.supplier)})),k.store&&"all"!==k.store&&(i=i.filter(e=>{var t,s,r;return"Achat"===e.type&&((null==(t=e.stores)?void 0:t.name)===k.store||(null==(r=null==(s=e.purchases)?void 0:s.stores)?void 0:r.name)===k.store)})),(null==(t=k.dateRange)?void 0:t.from)&&(i=i.filter(e=>new Date(e.created_at||e.received_at)>=k.dateRange.from)),(null==(s=k.dateRange)?void 0:s.to)&&(i=i.filter(e=>new Date(e.created_at||e.received_at)<=k.dateRange.to)),k.status&&"all"!==k.status&&(i=i.filter(e=>{var t,s;if("Achat"===e.type){const r=(e.received_quantity??(null==(t=e.purchases)?void 0:t.quantity)??e.quantity)!==((null==(s=e.purchases)?void 0:s.quantity)??e.quantity);return"discrepancy"===k.status?r:"perfect"!==k.status||!r}return!0})),i},U=z(o),W=z(c),V=[...W].sort((e,t)=>{const s=new Date(e.received_at||e.created_at).getTime(),r=new Date(t.received_at||t.created_at).getTime();return"date_desc"===D?r-s:s-r}),B="all"===A?1:Math.max(1,Math.ceil(V.length/A)),H=Math.min(M,B),K="all"===A?V:V.slice((H-1)*A,H*A);Nt.useEffect(()=>{T(1)},[A,k]);const Y=[...new Set(o.filter(e=>"Achat"===e.type).map(e=>{var t,s,r;return(null==(t=e.suppliers)?void 0:t.name)||(null==(r=null==(s=e.purchases)?void 0:s.suppliers)?void 0:r.name)}).filter(Boolean))],G=[...new Set(o.filter(e=>"Achat"===e.type).map(e=>{var t,s,r;return(null==(t=e.stores)?void 0:t.name)||(null==(r=null==(s=e.purchases)?void 0:s.stores)?void 0:r.name)}).filter(Boolean))];return N&&!O?Ne.jsxs("div",{className:"space-y-6",children:[Ne.jsx("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:Ne.jsxs("div",{children:[Ne.jsxs("h1",{className:"text-2xl md:text-3xl font-bold flex items-center gap-2",children:[Ne.jsx(Ur,{className:"w-7 h-7 text-primary"}),"Arrivages"]}),Ne.jsx("p",{className:"text-muted-foreground",children:"Grez les arrivages de marchandises en magasin"})]})}),Ne.jsxs("div",{className:"bg-destructive/10 border border-destructive/20 rounded-lg p-6 text-center",children:[Ne.jsx(rr,{className:"w-12 h-12 text-destructive mx-auto mb-4"}),Ne.jsx("h3",{className:"text-lg font-semibold text-destructive mb-2",children:"Accs refus"}),Ne.jsx("p",{className:"text-destructive/80 mb-4",children:"Vous n'avez pas les permissions pour accder  cette page"})]})]}):Ne.jsxs("div",{className:"space-y-6",children:[Ne.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[Ne.jsxs("div",{children:[Ne.jsxs("h1",{className:"text-2xl md:text-3xl font-bold flex items-center gap-2",children:[Ne.jsx(Ur,{className:"w-7 h-7 text-primary"}),"Arrivages"]}),Ne.jsx("p",{className:"text-muted-foreground",children:"Grez les arrivages de marchandises en magasin"})]}),Ne.jsxs("div",{className:"flex gap-2",children:[Ne.jsxs(Cp,{variant:"outline",className:"gap-1",children:[Ne.jsx(jr,{className:"w-3 h-3"}),o.length," en attente"]}),Ne.jsxs(Cp,{variant:"outline",className:"gap-1 bg-success/10 text-success",children:[Ne.jsx(hr,{className:"w-3 h-3"}),c.length," valids"]})]})]}),N?Ne.jsx(Um,{className:"bg-destructive/10 border border-destructive/20",children:Ne.jsxs(Hm,{className:"p-6 text-center",children:[Ne.jsx(rr,{className:"w-12 h-12 text-destructive mx-auto mb-4"}),Ne.jsx("h3",{className:"text-lg font-semibold text-destructive mb-2",children:"Erreur de chargement"}),Ne.jsx("p",{className:"text-destructive/80 mb-4",children:N}),Ne.jsxs(Vh,{onClick:()=>{_(null),I()},variant:"outline",className:"gap-2",children:[Ne.jsx(Gr,{className:"w-4 h-4"}),"Ressayer"]})]})}):Ne.jsxs(Ne.Fragment,{children:[Ne.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[Ne.jsxs("div",{className:"relative sm:col-span-2",children:[Ne.jsx(Xr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),Ne.jsx(Bh,{placeholder:"Rechercher un arrivage...",value:n,onChange:e=>i(e.target.value),className:"pl-10 h-10 sm:h-12 text-sm sm:text-base"})]}),Ne.jsxs(tv,{open:C,onOpenChange:E,children:[Ne.jsx(sv,{asChild:!0,children:Ne.jsxs(Vh,{variant:"outline",size:"touch",className:"gap-2 w-full sm:w-auto",children:[Ne.jsx(Mr,{className:"w-4 h-4"}),"Filtres",("all"!==k.supplier||"all"!==k.store||k.dateRange||"all"!==k.status)&&Ne.jsx(Cp,{variant:"secondary",className:"ml-1 h-5 w-5 p-0 text-xs",children:("all"!==k.supplier?1:0)+("all"!==k.store?1:0)+(k.dateRange?1:0)+("all"!==k.status?1:0)})]})}),Ne.jsx(rv,{className:"w-[92vw] sm:w-80 max-h-[70vh] overflow-auto",align:"end",children:Ne.jsxs("div",{className:"space-y-4",children:[Ne.jsxs("div",{className:"flex items-center justify-between",children:[Ne.jsx("h4",{className:"font-medium",children:"Filtres"}),Ne.jsxs(Vh,{variant:"ghost",size:"sm",onClick:$,className:"h-6 px-2 text-xs",children:[Ne.jsx(xa,{className:"w-3 h-3 mr-1"}),"Rinitialiser"]})]}),Ne.jsxs("div",{className:"space-y-3",children:[Ne.jsxs("div",{children:[Ne.jsx("label",{className:"text-sm font-medium",children:"Type"}),Ne.jsxs(Kf,{value:k.type,onValueChange:e=>S(t=>({...t,type:e})),children:[Ne.jsx(Gf,{className:"mt-1 w-full",children:Ne.jsx(Yf,{placeholder:"Tous les types"})}),Ne.jsxs(Xf,{children:[Ne.jsx(Zf,{value:"all",children:"Tous les types"}),Ne.jsx(Zf,{value:"Achat",children:"Achat"}),Ne.jsx(Zf,{value:"Transfert",children:"Transfert"})]})]})]}),!a&&Ne.jsxs("div",{children:[Ne.jsx("label",{className:"text-sm font-medium",children:"Fournisseur"}),Ne.jsxs(Kf,{value:k.supplier,onValueChange:e=>S(t=>({...t,supplier:e})),children:[Ne.jsx(Gf,{className:"mt-1 w-full",children:Ne.jsx(Yf,{placeholder:"Tous les fournisseurs"})}),Ne.jsxs(Xf,{children:[Ne.jsx(Zf,{value:"all",children:"Tous les fournisseurs"}),Y.map(e=>Ne.jsx(Zf,{value:e,children:e},e))]})]})]}),Ne.jsxs("div",{children:[Ne.jsx("label",{className:"text-sm font-medium",children:"Magasin"}),Ne.jsxs(Kf,{value:k.store,onValueChange:e=>S(t=>({...t,store:e})),children:[Ne.jsx(Gf,{className:"mt-1 w-full",children:Ne.jsx(Yf,{placeholder:"Tous les magasins"})}),Ne.jsxs(Xf,{children:[Ne.jsx(Zf,{value:"all",children:"Tous les magasins"}),G.map(e=>Ne.jsx(Zf,{value:e,children:e},e))]})]})]}),Ne.jsxs("div",{children:[Ne.jsx("label",{className:"text-sm font-medium",children:"Priode"}),Ne.jsxs(tv,{children:[Ne.jsx(sv,{asChild:!0,children:Ne.jsxs(Vh,{variant:"outline",className:"mt-1 w-full justify-start text-left font-normal",children:[Ne.jsx(dr,{className:"mr-2 h-4 w-4"}),(null==(e=k.dateRange)?void 0:e.from)?k.dateRange.to?Ne.jsxs(Ne.Fragment,{children:[lg(k.dateRange.from,"LLL dd, y",{locale:mg})," -"," ",lg(k.dateRange.to,"LLL dd, y",{locale:mg})]}):lg(k.dateRange.from,"LLL dd, y",{locale:mg}):Ne.jsx("span",{children:"Priode"})]})}),Ne.jsx(rv,{className:"w-auto p-0",align:"start",children:Ne.jsx(Ny,{initialFocus:!0,mode:"range",defaultMonth:null==(t=k.dateRange)?void 0:t.from,selected:k.dateRange,onSelect:e=>S(t=>({...t,dateRange:e})),numberOfMonths:2,locale:mg})})]})]}),Ne.jsxs("div",{children:[Ne.jsx("label",{className:"text-sm font-medium",children:"Statut (historique)"}),Ne.jsxs(Kf,{value:k.status,onValueChange:e=>S(t=>({...t,status:e})),children:[Ne.jsx(Gf,{className:"mt-1 w-full",children:Ne.jsx(Yf,{placeholder:"Tous les statuts"})}),Ne.jsxs(Xf,{children:[Ne.jsx(Zf,{value:"all",children:"Tous les statuts"}),Ne.jsx(Zf,{value:"perfect",children:"Sans cart"}),Ne.jsx(Zf,{value:"discrepancy",children:"Avec cart"})]})]})]})]}),Ne.jsxs("div",{className:"flex gap-2 w-full",children:[Ne.jsx(Vh,{variant:"outline",size:"sm",onClick:$,className:"flex-1",children:"Effacer"}),Ne.jsx(Vh,{size:"sm",onClick:()=>E(!1),className:"flex-1",children:"Appliquer"})]})]})})]})]}),Ne.jsxs(bp,{defaultValue:"pending",className:"space-y-4",children:[Ne.jsxs(wp,{children:[Ne.jsxs(Np,{value:"pending",children:["En Attente (",U.length,")"]}),Ne.jsxs(Np,{value:"history",children:["Historique (",W.length,")"]})]}),Ne.jsx(_p,{value:"pending",children:Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{children:[Ne.jsx(Vm,{children:"Arrivages  valider"}),Ne.jsx(Bm,{children:"Achats et transferts en attente de validation"})]}),Ne.jsx(Hm,{children:u?Ne.jsx("div",{className:"space-y-3",children:Array.from({length:5}).map((e,t)=>Ne.jsxs("div",{className:"flex items-center space-x-4 p-4 border rounded-lg",children:[Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-4 w-16 rounded"}),Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-4 w-32 rounded"}),Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-4 w-48 rounded"}),Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-4 w-24 rounded"}),Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-4 w-20 rounded"}),Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-8 w-24 rounded"})]},t))}):0===U.length?Ne.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[Ne.jsx(Ur,{className:"w-16 h-16 text-muted-foreground/20 mb-4"}),Ne.jsx("p",{className:"text-muted-foreground mb-4",children:n?"Aucun arrivage ne correspond  votre recherche":"Aucun arrivage en attente"})]}):Ne.jsxs(Ne.Fragment,{children:[Ne.jsx("div",{className:"hidden sm:block",children:Ne.jsxs(fg,{children:[Ne.jsx(xg,{children:Ne.jsxs(vg,{children:[Ne.jsx(jg,{children:"Type"}),!a&&Ne.jsx(jg,{children:"Fournisseur"}),Ne.jsx(jg,{children:"Produit"}),Ne.jsx(jg,{children:"Magasin"}),Ne.jsx(jg,{children:"Date"}),Ne.jsx(jg,{children:"Actions"})]})}),Ne.jsx(gg,{children:U.map(e=>{var t,s,r,n,i,o,l,c,d,u,h,m,p;return Ne.jsxs(vg,{children:[Ne.jsx(yg,{children:e.type}),!a&&Ne.jsx(yg,{children:"Achat"===e.type?(null==(t=e.suppliers)?void 0:t.name)||(null==(r=null==(s=e.purchases)?void 0:s.suppliers)?void 0:r.name):""}),Ne.jsx(yg,{children:Ne.jsxs("div",{children:[Ne.jsx("p",{className:"font-medium",children:"Achat"===e.type?(null==(n=e.products)?void 0:n.name)||(null==(o=null==(i=e.purchases)?void 0:i.products)?void 0:o.name):e.product_name||(null==(l=e.products)?void 0:l.name)}),"Achat"===e.type&&Ne.jsxs("p",{className:"text-sm text-muted-foreground",children:["SKU: ",(null==(c=e.products)?void 0:c.sku)||(null==(u=null==(d=e.purchases)?void 0:d.products)?void 0:u.sku)]})]})}),Ne.jsx(yg,{children:"Achat"===e.type?(null==(h=e.stores)?void 0:h.name)||(null==(p=null==(m=e.purchases)?void 0:m.stores)?void 0:p.name):""}),Ne.jsx(yg,{children:new Date(e.created_at).toLocaleDateString()}),Ne.jsx(yg,{children:"Achat"===e.type?Ne.jsxs(Vh,{size:"sm",onClick:()=>L(e),className:"gap-1",children:[Ne.jsx(hr,{className:"w-3 h-3"})," Valider"]}):Ne.jsxs(Vh,{size:"sm",onClick:()=>{w(e),y(!0)},className:"gap-1",children:[Ne.jsx(hr,{className:"w-3 h-3"})," Rceptionner"]})})]},`${e.type}-${e.id}`)})})]})}),Ne.jsx("div",{className:"space-y-3 sm:hidden",children:U.map(e=>{var t,s,r,n,i,o,l,c,d,u,h,m,p;return Ne.jsxs("div",{className:"border rounded-lg p-3",children:[Ne.jsxs("div",{className:"flex items-start justify-between gap-2",children:[Ne.jsxs("div",{className:"min-w-0",children:[Ne.jsx("p",{className:"text-xs uppercase text-muted-foreground",children:e.type}),Ne.jsx("p",{className:"font-medium truncate",children:"Achat"===e.type?(null==(t=e.products)?void 0:t.name)||(null==(r=null==(s=e.purchases)?void 0:s.products)?void 0:r.name):e.product_name||(null==(n=e.products)?void 0:n.name)}),"Achat"===e.type&&Ne.jsxs("p",{className:"text-xs text-muted-foreground",children:["SKU: ",(null==(i=e.products)?void 0:i.sku)||(null==(l=null==(o=e.purchases)?void 0:o.products)?void 0:l.sku)]})]}),Ne.jsx("div",{children:Ne.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(e.created_at).toLocaleDateString()})})]}),Ne.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-2 text-sm",children:[!a&&Ne.jsxs("div",{children:[Ne.jsx("span",{className:"text-muted-foreground",children:"Fournisseur"}),Ne.jsx("div",{className:"font-medium",children:"Achat"===e.type?(null==(c=e.suppliers)?void 0:c.name)||(null==(u=null==(d=e.purchases)?void 0:d.suppliers)?void 0:u.name):""})]}),Ne.jsxs("div",{className:"text-right",children:[Ne.jsx("span",{className:"text-muted-foreground",children:"Magasin"}),Ne.jsx("div",{className:"font-medium",children:"Achat"===e.type?(null==(h=e.stores)?void 0:h.name)||(null==(p=null==(m=e.purchases)?void 0:m.stores)?void 0:p.name):""})]})]}),Ne.jsx("div",{className:"mt-3 flex items-center justify-end",children:"Achat"===e.type?Ne.jsxs(Vh,{size:"sm",onClick:()=>L(e),className:"gap-1 w-full sm:w-auto",children:[Ne.jsx(hr,{className:"w-3 h-3"})," Valider"]}):Ne.jsxs(Vh,{size:"sm",onClick:()=>{w(e),y(!0)},className:"gap-1 w-full sm:w-auto",children:[Ne.jsx(hr,{className:"w-3 h-3"})," Rceptionner"]})})]},`${e.type}-${e.id}`)})})]})})]})}),Ne.jsx(_p,{value:"history",children:Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsx(Wm,{children:Ne.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[Ne.jsxs("div",{children:[Ne.jsx(Vm,{children:"Historique des arrivages"}),Ne.jsx(Bm,{children:"Achats valids et rceptions de transferts"})]}),Ne.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:items-center",children:[Ne.jsxs("div",{className:"flex items-center gap-2",children:[Ne.jsx("span",{className:"text-sm text-muted-foreground",children:"Par page"}),Ne.jsxs(Kf,{value:String(A),onValueChange:e=>P("all"===e?"all":parseInt(e)),children:[Ne.jsx(Gf,{className:"h-8 w-[92px]",children:Ne.jsx(Yf,{placeholder:"20"})}),Ne.jsxs(Xf,{children:[Ne.jsx(Zf,{value:"all",children:"All"}),Ne.jsx(Zf,{value:"10",children:"10"}),Ne.jsx(Zf,{value:"20",children:"20"}),Ne.jsx(Zf,{value:"50",children:"50"})]})]})]}),Ne.jsxs("div",{className:"flex gap-2",children:[Ne.jsxs(Vh,{variant:"outline",size:"sm",onClick:()=>{const e=W,t=[["Type",..."Manager"===(null==r?void 0:r.role)?[]:["Fournisseur"],"Produit","Quantit","Date"].join(",")].concat(e.map(e=>{var t,s,a,n,i;const o="Achat"===e.type&&(null==(s=null==(t=e.purchases)?void 0:t.suppliers)?void 0:s.name)||"",l="Achat"===e.type?(null==(n=null==(a=e.purchases)?void 0:a.products)?void 0:n.name)||"":e.product_name||(null==(i=e.products)?void 0:i.name)||"",c=e.received_quantity??"",d=new Date(e.received_at||e.created_at).toLocaleDateString();return[e.type,..."Manager"===(null==r?void 0:r.role)?[]:[o],l,c,d].map(e=>`"${String(e).replace(/"/g,'""')}"`).join(",")})).join("\n"),s=new Blob([t],{type:"text/csv;charset=utf-8;"}),a=URL.createObjectURL(s),n=document.createElement("a");n.href=a,n.download=`arrivages_historique_${(new Date).toISOString().slice(0,10)}.csv`,n.click(),URL.revokeObjectURL(a)},className:"gap-2",children:[Ne.jsx(kr,{className:"w-4 h-4"})," CSV"]}),Ne.jsxs(Vh,{variant:"outline",size:"sm",onClick:()=>{const e=window.open("","_blank");if(!e)return;const t=W,s="Manager"!==(null==r?void 0:r.role),a=`\n      <tr>\n        <th style="text-align:left;padding:6px">Type</th>\n        ${s?'<th style="text-align:left;padding:6px">Fournisseur</th>':""}\n        <th style="text-align:left;padding:6px">Produit</th>\n        <th style="text-align:right;padding:6px">Quantit</th>\n        <th style="text-align:left;padding:6px">Date</th>\n      </tr>`,n=t.map(e=>{var t,r,a,n,i;const o="Achat"===e.type&&(null==(r=null==(t=e.purchases)?void 0:t.suppliers)?void 0:r.name)||"",l="Achat"===e.type?(null==(n=null==(a=e.purchases)?void 0:a.products)?void 0:n.name)||"":e.product_name||(null==(i=e.products)?void 0:i.name)||"",c=e.received_quantity??"",d=new Date(e.received_at||e.created_at).toLocaleDateString();return`\n        <tr>\n          <td style="padding:6px">${e.type}</td>\n          ${s?`<td style="padding:6px">${o}</td>`:""}\n          <td style="padding:6px">${l}</td>\n          <td style="padding:6px;text-align:right">${c}</td>\n          <td style="padding:6px">${d}</td>\n        </tr>`}).join("");e.document.write(`\n      <html><head><title>Historique des arrivages</title></head>\n      <body>\n        <h3>Historique des arrivages</h3>\n        <table style="width:100%;border-collapse:collapse" border="1">${a}${n}</table>\n      </body></html>`),e.document.close(),e.focus(),e.print()},className:"gap-2",children:[Ne.jsx(kr,{className:"w-4 h-4"})," PDF"]})]})]})]})}),Ne.jsx(Hm,{children:m?Ne.jsx("div",{className:"space-y-3",children:Array.from({length:5}).map((e,t)=>Ne.jsxs("div",{className:"flex items-center space-x-4 p-4 border rounded-lg",children:[Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-4 w-16 rounded"}),Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-4 w-32 rounded"}),Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-4 w-48 rounded"}),Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-4 w-24 rounded"}),Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-4 w-20 rounded"}),Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-4 w-24 rounded"}),Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-4 w-20 rounded"})]},t))}):0===W.length?Ne.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[Ne.jsx(Ur,{className:"w-16 h-16 text-muted-foreground/20 mb-4"}),Ne.jsx("p",{className:"text-muted-foreground mb-4",children:n?"Aucun arrivage ne correspond  votre recherche":"Aucun arrivage valid"})]}):Ne.jsxs(Ne.Fragment,{children:[Ne.jsx("div",{className:"hidden sm:block",children:Ne.jsxs(fg,{children:[Ne.jsx(xg,{children:Ne.jsxs(vg,{children:[Ne.jsx(jg,{children:"Type"}),!a&&Ne.jsx(jg,{children:"Fournisseur"}),Ne.jsx(jg,{children:"Produit"}),Ne.jsx(jg,{children:"Quantit"}),Ne.jsx(jg,{children:"Statut"}),Ne.jsx(jg,{children:"Valid par"}),Ne.jsx(jg,{children:"Date validation"})]})}),Ne.jsx(gg,{children:K.map(e=>{var t,s,r,n,i,o,l;return Ne.jsxs(vg,{children:[Ne.jsx(yg,{children:e.type}),!a&&Ne.jsx(yg,{children:"Achat"===e.type?null==(s=null==(t=e.purchases)?void 0:t.suppliers)?void 0:s.name:""}),Ne.jsx(yg,{children:Ne.jsxs("div",{children:[Ne.jsx("p",{className:"font-medium",children:"Achat"===e.type?null==(n=null==(r=e.purchases)?void 0:r.products)?void 0:n.name:e.product_name||(null==(i=e.products)?void 0:i.name)}),"Achat"===e.type&&Ne.jsxs("p",{className:"text-sm text-muted-foreground",children:["SKU: ",null==(l=null==(o=e.purchases)?void 0:o.products)?void 0:l.sku]})]})}),Ne.jsx(yg,{children:Ne.jsx("div",{className:"flex items-center gap-2",children:Ne.jsxs("span",{children:["Reu: ",e.received_quantity]})})}),Ne.jsx(yg,{children:F()}),Ne.jsx(yg,{children:"N/A"}),Ne.jsx(yg,{children:new Date(e.received_at||e.created_at).toLocaleDateString()})]},`${e.type}-${e.id}`)})})]})}),Ne.jsx("div",{className:"space-y-3 sm:hidden",children:K.map(e=>{var t,s,r,n,i,o,l;return Ne.jsxs("div",{className:"border rounded-lg p-3",children:[Ne.jsxs("div",{className:"flex items-start justify-between gap-2",children:[Ne.jsxs("div",{className:"min-w-0",children:[Ne.jsx("p",{className:"text-xs uppercase text-muted-foreground",children:e.type}),Ne.jsx("p",{className:"font-medium truncate",children:"Achat"===e.type?null==(s=null==(t=e.purchases)?void 0:t.products)?void 0:s.name:e.product_name||(null==(r=e.products)?void 0:r.name)}),"Achat"===e.type&&Ne.jsxs("p",{className:"text-xs text-muted-foreground",children:["SKU: ",null==(i=null==(n=e.purchases)?void 0:n.products)?void 0:i.sku]})]}),Ne.jsx("div",{children:F()})]}),Ne.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-2 text-sm",children:[!a&&Ne.jsxs("div",{children:[Ne.jsx("span",{className:"text-muted-foreground",children:"Fournisseur"}),Ne.jsx("div",{className:"font-medium",children:"Achat"===e.type?null==(l=null==(o=e.purchases)?void 0:o.suppliers)?void 0:l.name:""})]}),Ne.jsxs("div",{className:"text-right",children:[Ne.jsx("span",{className:"text-muted-foreground",children:"Reu"}),Ne.jsx("div",{className:"font-medium",children:e.received_quantity})]}),Ne.jsxs("div",{children:[Ne.jsx("span",{className:"text-muted-foreground",children:"Date"}),Ne.jsx("div",{className:"font-medium",children:new Date(e.received_at||e.created_at).toLocaleDateString()})]}),Ne.jsxs("div",{className:"text-right",children:[Ne.jsx("span",{className:"text-muted-foreground",children:"Valid par"}),Ne.jsx("div",{className:"font-medium",children:"N/A"})]})]})]},`${e.type}-${e.id}`)})}),Ne.jsxs("div",{className:"mt-4 flex items-center justify-center gap-2",children:[Ne.jsx(Vh,{variant:"outline",size:"sm",disabled:H<=1,onClick:()=>T(e=>Math.max(1,e-1)),children:"Prcdent"}),Ne.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",H," / ",B]}),Ne.jsx(Vh,{variant:"outline",size:"sm",disabled:H>=B,onClick:()=>T(e=>Math.min(B,e+1)),children:"Suivant"})]})]})})]})})]})]}),Ne.jsx(Ey,{isOpen:f,onClose:()=>x(!1),onSuccess:I,purchase:g}),Ne.jsx(My,{isOpen:j,onClose:()=>y(!1),onSuccess:I,transfer:b})]})}function Ay({isOpen:e,onClose:t,onSuccess:s,purchase:r}){var a,n;const{user:i,userProfile:o}=Ih(),{toast:l}=is(),[c,d]=Nt.useState(!1),[u,h]=Nt.useState([]),[m,p]=Nt.useState([]),[f,x]=Nt.useState([]),[g,v]=Nt.useState(null),[j,y]=Nt.useState({store_id:"",supplier_id:"",product_id:"",quantity:"",unit_price:""});Nt.useEffect(()=>{var t,s;e&&(b(),w(),N(),y(r?{store_id:r.store_id||"",supplier_id:r.supplier_id||"",product_id:r.product_id||"",quantity:(null==(t=r.quantity)?void 0:t.toString())||"",unit_price:(null==(s=r.unit_price)?void 0:s.toString())||""}:{store_id:"",supplier_id:"",product_id:"",quantity:"",unit_price:""}))},[e,r]);const b=async()=>{try{const{data:e,error:t}=await Dh.from("stores").select("*").eq("is_active",!0).order("name");if(t)throw t;h(e||[])}catch(e){l({title:"Erreur",description:"Impossible de charger les magasins",variant:"destructive"})}},w=async()=>{try{const{data:e,error:t}=await Dh.from("suppliers").select("*").eq("is_active",!0).order("name");if(t)throw t;p(e||[])}catch(e){l({title:"Erreur",description:"Impossible de charger les fournisseurs",variant:"destructive"})}},N=async()=>{try{const{data:e,error:t}=await Dh.from("products").select("*, units(name, symbol)").eq("is_active",!0).order("name");if(t)throw t;x(e||[])}catch(e){l({title:"Erreur",description:"Impossible de charger les produits",variant:"destructive"})}},_=()=>(parseFloat(j.quantity)||0)*(parseFloat(j.unit_price)||0);return Ne.jsx(bg,{open:e,onOpenChange:t,children:Ne.jsxs(kg,{className:"max-w-2xl",children:[Ne.jsxs(Sg,{children:[Ne.jsx(Eg,{children:r?"Modifier l'achat":"Nouvel achat"}),Ne.jsx(Mg,{children:r?"Modifiez les informations de l'achat":"Crez une nouvelle commande fournisseur"})]}),Ne.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),i&&o){if(j.store_id?j.supplier_id?j.product_id?!j.quantity||parseInt(j.quantity)<=0?(l({title:"Erreur",description:"La quantit doit tre suprieure  0",variant:"destructive"}),0):j.unit_price&&lv(parseFloat(j.unit_price))||(l({title:"Erreur",description:"Le prix unitaire doit tre valide",variant:"destructive"}),0):(l({title:"Erreur",description:"Veuillez slectionner un produit",variant:"destructive"}),0):(l({title:"Erreur",description:"Veuillez slectionner un fournisseur",variant:"destructive"}),0):(l({title:"Erreur",description:"Veuillez slectionner un magasin",variant:"destructive"}),0)){d(!0);try{const e=_(),a={store_id:j.store_id,supplier_id:j.supplier_id,product_id:j.product_id,quantity:parseInt(j.quantity),unit_price:parseFloat(j.unit_price),total_amount:e,created_by:o.id};if(r){const{error:e}=await Dh.from("purchases").update(a).eq("id",r.id);if(e)throw e;l({title:"Succs",description:"Achat modifi avec succs"})}else{const{error:e}=await Dh.from("purchases").insert([a]);if(e)throw e;l({title:"Succs",description:"Achat cr avec succs"})}s(),t()}catch(a){const e=nv(a);l({title:"Erreur",description:e.error,variant:"destructive"})}finally{d(!1)}}}else l({title:"Erreur",description:"Vous devez tre connect pour crer un achat",variant:"destructive"})},className:"space-y-4",children:[Ne.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{htmlFor:"store",children:"Magasin *"}),Ne.jsx(av,{value:j.store_id,onValueChange:e=>y(t=>({...t,store_id:e})),options:u.map(e=>({value:e.id,label:e.name})),placeholder:"Slectionner un magasin"})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{htmlFor:"supplier",children:"Fournisseur *"}),Ne.jsx(av,{value:j.supplier_id,onValueChange:e=>y(t=>({...t,supplier_id:e})),options:m.map(e=>({value:e.id,label:e.name})),placeholder:"Slectionner un fournisseur"})]})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{htmlFor:"product",children:"Produit *"}),Ne.jsx(av,{value:j.product_id,onValueChange:e=>{const t=f.find(t=>t.id===e);v(t||null),y(t=>({...t,product_id:e}))},options:f.map(e=>({value:e.id,label:`${e.name} - ${e.sku}`})),placeholder:"Slectionner un produit"}),g&&Ne.jsxs("p",{className:"text-sm text-muted-foreground",children:["Unit: ",null==(a=g.units)?void 0:a.name," (",null==(n=g.units)?void 0:n.symbol,")"]})]}),Ne.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{htmlFor:"quantity",children:"Quantit *"}),Ne.jsx(Bh,{id:"quantity",type:"number",value:j.quantity,onChange:e=>y(t=>({...t,quantity:e.target.value})),required:!0,min:"1"})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{htmlFor:"unit_price",children:"Prix unitaire (XOF) *"}),Ne.jsx(Bh,{id:"unit_price",type:"number",step:"0.01",value:j.unit_price,onChange:e=>y(t=>({...t,unit_price:e.target.value})),required:!0,min:"0"})]})]}),j.quantity&&j.unit_price&&Ne.jsx("div",{className:"bg-muted p-4 rounded-md",children:Ne.jsxs("p",{className:"text-sm font-medium",children:["Montant total: ",_().toLocaleString()," XOF"]})}),Ne.jsxs(Cg,{children:[Ne.jsx(Vh,{type:"button",variant:"outline",onClick:t,children:"Annuler"}),Ne.jsx(Vh,{type:"submit",disabled:c,children:c?"Enregistrement...":r?"Modifier":"Crer"})]})]})]})})}function Py(){const{formatAmount:e}=rx(),{toast:t}=is(),{userProfile:s}=Ih(),[r,a]=Nt.useState(""),[n,i]=Nt.useState([]),[o,l]=Nt.useState(!0),[c,d]=Nt.useState(null),[u,h]=Nt.useState(!1),[m,p]=Nt.useState(null),[f,x]=Nt.useState("pending"),[g,v]=Nt.useState(1),[j,y]=Nt.useState(20),b=(null==s?void 0:s.role)&&["Admin","SuperAdmin","Manager"].includes(s.role),w=(null==s?void 0:s.role)&&["Admin","SuperAdmin","Manager"].includes(s.role),N=(null==s?void 0:s.role)&&["Admin","SuperAdmin"].includes(s.role);Nt.useEffect(()=>{b&&_()},[b]);const _=async()=>{try{l(!0),d(null);const{data:e,error:t}=await Dh.from("purchases").select("\n          *,\n          suppliers(name),\n          products(name, sku),\n          stores(name)\n        ").order("created_at",{ascending:!1});if(t)throw t;const s=[...new Set((e||[]).map(e=>e.created_by).filter(Boolean))];let r={};if(s.length>0){const{data:e,error:t}=await Dh.from("users").select("id, first_name, last_name").in("id",s);!t&&e&&(r=e.reduce((e,t)=>(e[t.id]=t,e),{}))}const a=(e||[]).map(e=>({...e,created_by_user:r[e.created_by]}));i(a)}catch(e){d("Impossible de charger les achats"),t({title:"Erreur",description:"Impossible de charger les achats",variant:"destructive"})}finally{l(!1)}},k=e=>"validated"===e?Ne.jsx(Cp,{variant:"default",className:"bg-success text-success-foreground",children:"Valid"}):Ne.jsx(Cp,{variant:"secondary",children:"En attente"}),S=()=>{b?(p(null),h(!0)):t({title:"Permission refuse",description:"Vous n'avez pas les permissions pour crer des achats",variant:"destructive"})},C=e=>{w?"validated"!==e.status?(p(e),h(!0)):t({title:"Modification impossible",description:"Impossible de modifier un achat valid",variant:"destructive"}):t({title:"Permission refuse",description:"Vous n'avez pas les permissions pour modifier des achats",variant:"destructive"})},E=async(e,s)=>{if(N){if(s)t({title:"Suppression impossible",description:"Impossible de supprimer un achat valid",variant:"destructive"});else if(confirm("tes-vous sr de vouloir supprimer cet achat ?"))try{const{error:s}=await Dh.from("purchases").delete().eq("id",e);if(s)throw s;t({title:"Succs",description:"Achat supprim avec succs"}),_()}catch(r){t({title:"Erreur",description:"Impossible de supprimer l'achat",variant:"destructive"})}}else t({title:"Permission refuse",description:"Vous n'avez pas les permissions pour supprimer des achats",variant:"destructive"})},{totalAmount:M,pendingCount:T,filteredPendingPurchases:A,filteredHistoryPurchases:P}=Nt.useMemo(()=>{const e=e=>e?String(e).normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase():"",t=e(r).split(/\s+/).filter(Boolean),s=n.reduce((e,t)=>e+(t.total_amount||0),0),a=0===t.length?n:n.filter(s=>{var r,a,n,i;const o=[null==(r=s.suppliers)?void 0:r.name,null==(a=s.products)?void 0:a.name,null==(n=s.products)?void 0:n.sku,null==(i=s.stores)?void 0:i.name,s.purchase_code],l=e(o.filter(Boolean).join(" "));return t.every(e=>l.includes(e))});return{totalAmount:s,pendingCount:n.filter(e=>"validated"!==e.status).length,filteredPendingPurchases:a.filter(e=>"validated"!==e.status),filteredHistoryPurchases:a.filter(e=>"validated"===e.status)}},[n,r]),D="all"===j?1:Math.max(1,Math.ceil(P.length/j)),R=Math.min(g,D),O="all"===j?P:P.slice((R-1)*j,R*j);Nt.useEffect(()=>{v(1)},[P.length,j]);const q=e=>{const t=[["Fournisseur","Produit","SKU","Magasin","Quantit","Prix unitaire","Total","Statut","Date"].join(",")].concat((e||[]).map(e=>{var t,s,r,a;return[(null==(t=e.suppliers)?void 0:t.name)||"",(null==(s=e.products)?void 0:s.name)||"",(null==(r=e.products)?void 0:r.sku)||"",(null==(a=e.stores)?void 0:a.name)||"",e.quantity??"",e.unit_price??"",e.total_amount??"","validated"===e.status?"Valid":"En attente",new Date(e.created_at).toLocaleDateString()].map(e=>`"${String(e).replace(/"/g,'""')}"`).join(",")})).join("\n"),s=new Blob([t],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(s),a=document.createElement("a");a.href=r,a.download=`achats_${(new Date).toISOString().slice(0,10)}.csv`,a.click(),URL.revokeObjectURL(r)},I=e=>{const t=window.open("","_blank");if(!t)return;const s=(e||[]).map(e=>{var t,s,r,a;return`\n        <tr>\n          <td style="padding:6px">${(null==(t=e.suppliers)?void 0:t.name)||""}</td>\n          <td style="padding:6px">${(null==(s=e.products)?void 0:s.name)||""}</td>\n          <td style="padding:6px">${(null==(r=e.products)?void 0:r.sku)||""}</td>\n          <td style="padding:6px">${(null==(a=e.stores)?void 0:a.name)||""}</td>\n          <td style="padding:6px;text-align:right">${e.quantity??""}</td>\n          <td style="padding:6px;text-align:right">${e.unit_price??""}</td>\n          <td style="padding:6px;text-align:right">${e.total_amount??""}</td>\n          <td style="padding:6px">${"validated"===e.status?"Valid":"En attente"}</td>\n          <td style="padding:6px">${new Date(e.created_at).toLocaleDateString()}</td>\n        </tr>`}).join("");t.document.write(`\n      <html><head><title>Liste des achats</title></head>\n      <body>\n        <h3>Liste des achats</h3>\n        <table style="width:100%;border-collapse:collapse" border="1">\n      <tr>\n        <th style="text-align:left;padding:6px">Fournisseur</th>\n        <th style="text-align:left;padding:6px">Produit</th>\n        <th style="text-align:left;padding:6px">SKU</th>\n        <th style="text-align:left;padding:6px">Magasin</th>\n        <th style="text-align:right;padding:6px">Quantit</th>\n        <th style="text-align:right;padding:6px">PU</th>\n        <th style="text-align:right;padding:6px">Total</th>\n        <th style="text-align:left;padding:6px">Statut</th>\n        <th style="text-align:left;padding:6px">Date</th>\n      </tr>${s}</table>\n      </body></html>`),t.document.close(),t.focus(),t.print()};return c&&!b?Ne.jsxs("div",{className:"space-y-6",children:[Ne.jsx("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:Ne.jsxs("div",{children:[Ne.jsxs("h1",{className:"text-2xl md:text-3xl font-bold flex items-center gap-2",children:[Ne.jsx(ta,{className:"w-7 h-7 text-primary"}),"Achats"]}),Ne.jsx("p",{className:"text-muted-foreground",children:"Grez vos commandes et achats fournisseurs"})]})}),Ne.jsxs("div",{className:"bg-destructive/10 border border-destructive/20 rounded-lg p-6 text-center",children:[Ne.jsx(rr,{className:"w-12 h-12 text-destructive mx-auto mb-4"}),Ne.jsx("h3",{className:"text-lg font-semibold text-destructive mb-2",children:"Accs refus"}),Ne.jsx("p",{className:"text-destructive/80 mb-4",children:"Vous n'avez pas les permissions pour accder  cette page"})]})]}):Ne.jsxs("div",{className:"space-y-6",children:[Ne.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[Ne.jsxs("div",{children:[Ne.jsxs("h1",{className:"text-2xl md:text-3xl font-bold flex items-center gap-2",children:[Ne.jsx(ta,{className:"w-7 h-7 text-primary"}),"Achats"]}),Ne.jsx("p",{className:"text-muted-foreground",children:"Grez vos commandes et achats fournisseurs"})]}),b&&Ne.jsxs(Vh,{onClick:S,size:"touch",className:"gap-2 w-full sm:w-auto",children:[Ne.jsx(Yr,{className:"w-4 h-4"}),"Nouvel achat"]})]}),c?Ne.jsx(Um,{className:"bg-destructive/10 border border-destructive/20",children:Ne.jsxs(Hm,{className:"p-6 text-center",children:[Ne.jsx(rr,{className:"w-12 h-12 text-destructive mx-auto mb-4"}),Ne.jsx("h3",{className:"text-lg font-semibold text-destructive mb-2",children:"Erreur de chargement"}),Ne.jsx("p",{className:"text-destructive/80 mb-4",children:c}),Ne.jsxs(Vh,{onClick:()=>{d(null),_()},variant:"outline",className:"gap-2",children:[Ne.jsx(Gr,{className:"w-4 h-4"}),"Ressayer"]})]})}):Ne.jsxs(Ne.Fragment,{children:[Ne.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Ne.jsx(Vm,{className:"text-sm font-medium",children:"Total achats"}),Ne.jsx(_r,{className:"h-4 w-4 text-muted-foreground"})]}),Ne.jsxs(Hm,{children:[Ne.jsx("div",{className:"text-2xl font-bold",children:e(M)}),Ne.jsx("p",{className:"text-xs text-muted-foreground",children:"Ce mois-ci"})]})]}),Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Ne.jsx(Vm,{className:"text-sm font-medium",children:"Commandes"}),Ne.jsx(ta,{className:"h-4 w-4 text-muted-foreground"})]}),Ne.jsxs(Hm,{children:[Ne.jsx("div",{className:"text-2xl font-bold",children:n.length}),Ne.jsx("p",{className:"text-xs text-muted-foreground",children:"Total commandes"})]})]}),Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Ne.jsx(Vm,{className:"text-sm font-medium",children:"En attente"}),Ne.jsx(ta,{className:"h-4 w-4 text-warning"})]}),Ne.jsxs(Hm,{children:[Ne.jsx("div",{className:"text-2xl font-bold",children:T}),Ne.jsx("p",{className:"text-xs text-muted-foreground",children:" traiter"})]})]})]}),Ne.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[Ne.jsxs("div",{className:"relative flex-1",children:[Ne.jsx(Xr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),Ne.jsx(Bh,{placeholder:"Rechercher un achat...",value:r,onChange:e=>a(e.target.value),className:"pl-10 h-10 sm:h-12 text-sm sm:text-base"})]}),Ne.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[Ne.jsxs(Vh,{variant:"outline",size:"touch",className:"gap-2 flex-1 sm:flex-none",children:[Ne.jsx(Mr,{className:"w-4 h-4"}),"Filtres"]}),Ne.jsxs(Vh,{variant:"outline",size:"touch",onClick:()=>{q("history"===f?P:A)},className:"gap-2 flex-1 sm:flex-none",children:[Ne.jsx(kr,{className:"w-4 h-4"})," CSV"]}),Ne.jsxs(Vh,{variant:"outline",size:"touch",onClick:()=>{I("history"===f?P:A)},className:"gap-2 flex-1 sm:flex-none",children:[Ne.jsx(kr,{className:"w-4 h-4"})," PDF"]})]})]}),Ne.jsxs(bp,{defaultValue:"pending",onValueChange:e=>x(e),className:"space-y-4",children:[Ne.jsxs(wp,{children:[Ne.jsxs(Np,{value:"pending",children:["En Attente (",A.length,")"]}),Ne.jsxs(Np,{value:"history",children:["Historique (",P.length,")"]})]}),Ne.jsx(_p,{value:"pending",children:Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{children:[Ne.jsx(Vm,{children:"Achats en attente"}),Ne.jsx(Bm,{children:"Commandes fournisseurs non valides"})]}),Ne.jsx(Hm,{children:o?Ne.jsx("div",{className:"space-y-3",children:Array.from({length:5}).map((e,t)=>Ne.jsxs("div",{className:"flex items-center space-x-4 p-4 border rounded-lg",children:[Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-4 w-32 rounded"}),Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-4 w-48 rounded"}),Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-4 w-24 rounded"}),Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-4 w-16 rounded"}),Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-4 w-20 rounded"}),Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-4 w-24 rounded"}),Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-4 w-20 rounded"}),Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-8 w-24 rounded"})]},t))}):0===A.length?Ne.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[Ne.jsx(ta,{className:"w-16 h-16 text-muted-foreground/20 mb-4"}),Ne.jsx("p",{className:"text-muted-foreground mb-4",children:r?"Aucun achat en attente ne correspond  votre recherche":"Aucun achat en attente"}),b&&Ne.jsx(Vh,{onClick:S,variant:"outline",children:"Crer un achat"})]}):Ne.jsxs(Ne.Fragment,{children:[Ne.jsx("div",{className:"hidden sm:block",children:Ne.jsxs(fg,{children:[Ne.jsx(xg,{children:Ne.jsxs(vg,{children:[Ne.jsx(jg,{children:"Fournisseur"}),Ne.jsx(jg,{children:"Produit"}),Ne.jsx(jg,{children:"Magasin"}),Ne.jsx(jg,{children:"Quantit"}),Ne.jsx(jg,{children:"Prix unitaire"}),Ne.jsx(jg,{children:"Total"}),Ne.jsx(jg,{children:"Statut"}),Ne.jsx(jg,{children:"Actions"})]})}),Ne.jsx(gg,{children:A.map(t=>{var s,r,a,n;return Ne.jsxs(vg,{children:[Ne.jsx(yg,{children:null==(s=t.suppliers)?void 0:s.name}),Ne.jsx(yg,{children:Ne.jsxs("div",{children:[Ne.jsx("p",{className:"font-medium",children:null==(r=t.products)?void 0:r.name}),Ne.jsxs("p",{className:"text-sm text-muted-foreground",children:["SKU: ",null==(a=t.products)?void 0:a.sku]})]})}),Ne.jsx(yg,{children:null==(n=t.stores)?void 0:n.name}),Ne.jsx(yg,{children:t.quantity}),Ne.jsx(yg,{children:e(t.unit_price)}),Ne.jsx(yg,{className:"font-medium",children:e(t.total_amount)}),Ne.jsx(yg,{children:k(t.status)}),Ne.jsx(yg,{children:Ne.jsxs(Om,{children:[Ne.jsx(qm,{asChild:!0,children:Ne.jsx(Vh,{variant:"ghost",className:"h-8 w-8 p-0",children:Ne.jsx(zr,{className:"h-4 w-4"})})}),Ne.jsxs(Im,{align:"end",children:[Ne.jsx(Fm,{children:"Voir dtails"}),w&&Ne.jsx(Fm,{onClick:()=>C(t),disabled:"validated"===t.status,children:"Modifier"}),N&&Ne.jsx(Fm,{className:"text-destructive",onClick:()=>E(t.id,"validated"===t.status),children:"Supprimer"})]})]})})]},t.id)})})]})}),Ne.jsx("div",{className:"space-y-3 sm:hidden",children:A.map(t=>{var s,r,a,n;return Ne.jsxs("div",{className:"border rounded-lg p-3",children:[Ne.jsxs("div",{className:"flex items-start justify-between gap-2",children:[Ne.jsxs("div",{className:"min-w-0",children:[Ne.jsx("p",{className:"font-medium truncate",children:(null==(s=t.suppliers)?void 0:s.name)||""}),Ne.jsx("p",{className:"text-sm text-muted-foreground truncate",children:(null==(r=t.stores)?void 0:r.name)||""})]}),Ne.jsx("div",{children:k(t.status)})]}),Ne.jsxs("div",{className:"mt-2",children:[Ne.jsx("p",{className:"font-medium",children:null==(a=t.products)?void 0:a.name}),Ne.jsxs("p",{className:"text-xs text-muted-foreground",children:["SKU: ",null==(n=t.products)?void 0:n.sku]})]}),Ne.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-2 text-sm",children:[Ne.jsxs("div",{children:[Ne.jsx("span",{className:"text-muted-foreground",children:"Qt"}),Ne.jsx("div",{className:"font-medium",children:t.quantity})]}),Ne.jsxs("div",{className:"text-right",children:[Ne.jsx("span",{className:"text-muted-foreground",children:"PU"}),Ne.jsx("div",{className:"font-medium",children:e(t.unit_price)})]}),Ne.jsxs("div",{children:[Ne.jsx("span",{className:"text-muted-foreground",children:"Date"}),Ne.jsx("div",{className:"font-medium",children:new Date(t.created_at).toLocaleDateString()})]}),Ne.jsxs("div",{className:"text-right",children:[Ne.jsx("span",{className:"text-muted-foreground",children:"Total"}),Ne.jsx("div",{className:"font-medium",children:e(t.total_amount)})]})]}),Ne.jsx("div",{className:"mt-3 flex items-center justify-end",children:Ne.jsxs(Om,{children:[Ne.jsx(qm,{asChild:!0,children:Ne.jsx(Vh,{variant:"ghost",className:"h-8 w-8 p-0",children:Ne.jsx(zr,{className:"h-4 w-4"})})}),Ne.jsxs(Im,{align:"end",children:[Ne.jsx(Fm,{children:"Voir dtails"}),w&&Ne.jsx(Fm,{onClick:()=>C(t),disabled:"validated"===t.status,children:"Modifier"}),N&&Ne.jsx(Fm,{className:"text-destructive",onClick:()=>E(t.id,"validated"===t.status),children:"Supprimer"})]})]})})]},t.id)})})]})})]})}),Ne.jsx(_p,{value:"history",children:Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsx(Wm,{children:Ne.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[Ne.jsxs("div",{children:[Ne.jsx(Vm,{children:"Historique des achats"}),Ne.jsx(Bm,{children:"Commandes fournisseurs valides"})]}),Ne.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:items-center",children:[Ne.jsxs("div",{className:"flex items-center gap-2",children:[Ne.jsx("span",{className:"text-sm text-muted-foreground",children:"Par page"}),Ne.jsxs(Kf,{value:String(j),onValueChange:e=>y("all"===e?"all":parseInt(e)),children:[Ne.jsx(Gf,{className:"h-9 w-full sm:w-[92px]",children:Ne.jsx(Yf,{placeholder:"20"})}),Ne.jsxs(Xf,{children:[Ne.jsx(Zf,{value:"all",children:"All"}),Ne.jsx(Zf,{value:"10",children:"10"}),Ne.jsx(Zf,{value:"20",children:"20"}),Ne.jsx(Zf,{value:"50",children:"50"})]})]})]}),Ne.jsxs("div",{className:"hidden sm:flex gap-2",children:[Ne.jsxs(Vh,{variant:"outline",size:"sm",onClick:()=>q(P),className:"gap-2",children:[Ne.jsx(kr,{className:"w-4 h-4"})," CSV"]}),Ne.jsxs(Vh,{variant:"outline",size:"sm",onClick:()=>I(P),className:"gap-2",children:[Ne.jsx(kr,{className:"w-4 h-4"})," PDF"]})]})]})]})}),Ne.jsx(Hm,{children:o?Ne.jsx("div",{className:"space-y-3",children:Array.from({length:5}).map((e,t)=>Ne.jsxs("div",{className:"flex items-center space-x-4 p-4 border rounded-lg",children:[Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-4 w-32 rounded"}),Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-4 w-48 rounded"}),Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-4 w-24 rounded"}),Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-4 w-16 rounded"}),Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-4 w-20 rounded"}),Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-4 w-24 rounded"}),Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-4 w-20 rounded"}),Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-8 w-24 rounded"})]},t))}):0===P.length?Ne.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[Ne.jsx(ta,{className:"w-16 h-16 text-muted-foreground/20 mb-4"}),Ne.jsx("p",{className:"text-muted-foreground mb-4",children:r?"Aucun achat valid ne correspond  votre recherche":"Aucun achat valid"})]}):Ne.jsxs(Ne.Fragment,{children:[Ne.jsx("div",{className:"hidden sm:block",children:Ne.jsxs(fg,{children:[Ne.jsx(xg,{children:Ne.jsxs(vg,{children:[Ne.jsx(jg,{children:"Fournisseur"}),Ne.jsx(jg,{children:"Produit"}),Ne.jsx(jg,{children:"Magasin"}),Ne.jsx(jg,{children:"Quantit"}),Ne.jsx(jg,{children:"Prix unitaire"}),Ne.jsx(jg,{children:"Total"}),Ne.jsx(jg,{children:"Statut"}),Ne.jsx(jg,{children:"Actions"})]})}),Ne.jsx(gg,{children:O.map(t=>{var s,r,a,n;return Ne.jsxs(vg,{children:[Ne.jsx(yg,{children:null==(s=t.suppliers)?void 0:s.name}),Ne.jsx(yg,{children:Ne.jsxs("div",{children:[Ne.jsx("p",{className:"font-medium",children:null==(r=t.products)?void 0:r.name}),Ne.jsxs("p",{className:"text-sm text-muted-foreground",children:["SKU: ",null==(a=t.products)?void 0:a.sku]})]})}),Ne.jsx(yg,{children:null==(n=t.stores)?void 0:n.name}),Ne.jsx(yg,{children:t.quantity}),Ne.jsx(yg,{children:e(t.unit_price)}),Ne.jsx(yg,{className:"font-medium",children:e(t.total_amount)}),Ne.jsx(yg,{children:k(t.status)}),Ne.jsx(yg,{children:Ne.jsxs(Om,{children:[Ne.jsx(qm,{asChild:!0,children:Ne.jsx(Vh,{variant:"ghost",className:"h-8 w-8 p-0",children:Ne.jsx(zr,{className:"h-4 w-4"})})}),Ne.jsxs(Im,{align:"end",children:[Ne.jsx(Fm,{children:"Voir dtails"}),w&&Ne.jsx(Fm,{disabled:!0,children:"Modifier"}),N&&Ne.jsx(Fm,{className:"text-destructive",onClick:()=>E(t.id,!0),children:"Supprimer"})]})]})})]},t.id)})})]})}),Ne.jsx("div",{className:"space-y-3 sm:hidden",children:O.map(t=>{var s,r,a,n;return Ne.jsxs("div",{className:"border rounded-lg p-3",children:[Ne.jsxs("div",{className:"flex items-start justify-between gap-2",children:[Ne.jsxs("div",{className:"min-w-0",children:[Ne.jsx("p",{className:"font-medium truncate",children:(null==(s=t.suppliers)?void 0:s.name)||""}),Ne.jsx("p",{className:"text-sm text-muted-foreground truncate",children:(null==(r=t.stores)?void 0:r.name)||""})]}),Ne.jsx("div",{children:k(t.status)})]}),Ne.jsxs("div",{className:"mt-2",children:[Ne.jsx("p",{className:"font-medium",children:null==(a=t.products)?void 0:a.name}),Ne.jsxs("p",{className:"text-xs text-muted-foreground",children:["SKU: ",null==(n=t.products)?void 0:n.sku]})]}),Ne.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-2 text-sm",children:[Ne.jsxs("div",{children:[Ne.jsx("span",{className:"text-muted-foreground",children:"Qt"}),Ne.jsx("div",{className:"font-medium",children:t.quantity})]}),Ne.jsxs("div",{className:"text-right",children:[Ne.jsx("span",{className:"text-muted-foreground",children:"PU"}),Ne.jsx("div",{className:"font-medium",children:e(t.unit_price)})]}),Ne.jsxs("div",{children:[Ne.jsx("span",{className:"text-muted-foreground",children:"Date"}),Ne.jsx("div",{className:"font-medium",children:new Date(t.created_at).toLocaleDateString()})]}),Ne.jsxs("div",{className:"text-right",children:[Ne.jsx("span",{className:"text-muted-foreground",children:"Total"}),Ne.jsx("div",{className:"font-medium",children:e(t.total_amount)})]})]}),Ne.jsx("div",{className:"mt-3 flex items-center justify-end",children:Ne.jsxs(Om,{children:[Ne.jsx(qm,{asChild:!0,children:Ne.jsx(Vh,{variant:"ghost",className:"h-8 w-8 p-0",children:Ne.jsx(zr,{className:"h-4 w-4"})})}),Ne.jsxs(Im,{align:"end",children:[Ne.jsx(Fm,{children:"Voir dtails"}),w&&Ne.jsx(Fm,{disabled:!0,children:"Modifier"}),N&&Ne.jsx(Fm,{className:"text-destructive",onClick:()=>E(t.id,!0),children:"Supprimer"})]})]})})]},t.id)})}),Ne.jsxs("div",{className:"mt-4 flex items-center justify-center gap-2",children:[Ne.jsx(Vh,{variant:"outline",size:"sm",disabled:R<=1,onClick:()=>v(e=>Math.max(1,e-1)),children:"Prcdent"}),Ne.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",R," / ",D]}),Ne.jsx(Vh,{variant:"outline",size:"sm",disabled:R>=D,onClick:()=>v(e=>Math.min(D,e+1)),children:"Suivant"})]})]})})]})})]})]}),Ne.jsx(Ay,{isOpen:u,onClose:()=>h(!1),onSuccess:_,purchase:m})]})}function Dy(){return Ne.jsx(Uh,{allowedRoles:["Admin","SuperAdmin","Manager"],children:Ne.jsx(Py,{})})}(py=my||(my={}))[py.Today=0]="Today",py[py.Selected=1]="Selected",py[py.LastFocused=2]="LastFocused",py[py.FocusedModifier=3]="FocusedModifier",Ny.displayName="Calendar";const Ry=async(e,t,s)=>{try{const{data:r,error:a}=await Dh.from("product_stores").select("current_stock").eq("store_id",e).eq("product_id",t).maybeSingle();if(a)throw a;const n=(null==r?void 0:r.current_stock)||0;return{available:n>=s,current_stock:n}}catch(r){return{available:!1,current_stock:0,error:r instanceof Error?r.message:"Erreur inconnue"}}},Oy=async e=>{try{const t=await Ry(e.source_store_id,e.product_id,e.quantity);if(!t.available)return{success:!1,error:`Stock insuffisant dans le magasin source. Stock disponible: ${t.current_stock}, Quantit demande: ${e.quantity}`};const s=`TRF-${Date.now()}-${Math.random().toString(36).substr(2,9).toUpperCase()}`,{data:r,error:a}=await Dh.from("store_transfers").insert({transfer_code:s,source_store_id:e.source_store_id,destination_store_id:e.destination_store_id,product_id:e.product_id,quantity:e.quantity,notes:e.notes,created_by:e.created_by}).select("id").single();if(a)throw a;const n=await(async e=>{try{const{data:t,error:s}=await Dh.from("product_stores").select("id, current_stock").eq("store_id",e.store_id).eq("product_id",e.product_id).maybeSingle();if(s&&"PGRST116"!==s.code)throw s;const r=(null==t?void 0:t.current_stock)||0,a=r+e.quantity_change;if(a<0&&"correction"!==e.adjustment_type)return{success:!1,error:`Stock insuffisant. Stock actuel: ${r}, Tentative de retrait: ${Math.abs(e.quantity_change)}`};let n;if(t){const{error:e}=await Dh.from("product_stores").update({current_stock:a}).eq("id",t.id);if(e)throw e;n=t.id}else{const{data:t,error:s}=await Dh.from("product_stores").insert({store_id:e.store_id,product_id:e.product_id,current_stock:a}).select("id").single();if(s)throw s;n=t.id}const{error:i}=await Dh.from("inventory_adjustments").insert({inventory_id:n,store_id:e.store_id,product_id:e.product_id,adjustment_type:e.adjustment_type,previous_quantity:r,new_quantity:a,quantity_change:e.quantity_change,reason:e.reason,reference_id:e.reference_id,reference_type:e.reference_type,created_by:e.created_by});if(i)throw i;return{success:!0}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Erreur inconnue"}}})({store_id:e.source_store_id,product_id:e.product_id,adjustment_type:"transfer_out",quantity_change:-e.quantity,reason:`Transfert vers ${e.destination_store_id}`,reference_id:r.id,reference_type:"transfer",created_by:e.created_by});return n.success?{success:!0,transfer_id:r.id}:(await Dh.from("store_transfers").update({status:"cancelled"}).eq("id",r.id),{success:!1,error:n.error})}catch(t){return{success:!1,error:t instanceof Error?t.message:"Erreur inconnue"}}},qy=async(e,t,s)=>{try{if("SuperAdmin"===s||"Admin"===s)return!0;if("Manager"===s||"Vendeur"===s){const{data:s,error:r}=await Dh.from("user_stores").select("id").eq("user_id",e).eq("store_id",t).single();return!r&&!!s}return!1}catch(r){return!1}},Iy=async(e,t)=>{try{let s=Dh.from("stores").select("id, name").eq("is_active",!0).order("name");if("SuperAdmin"===t||"Admin"===t){const{data:e,error:t}=await s;if(t)throw t;return e||[]}if("Manager"===t||"Vendeur"===t){const{data:t,error:r}=await Dh.from("user_stores").select("store_id").eq("user_id",e);if(r)throw r;if(t&&t.length>0){const e=t.map(e=>e.store_id),{data:r,error:a}=await s.in("id",e);if(a)throw a;return r||[]}return[]}return[]}catch(s){return[]}},Fy=async()=>{try{const{data:e,error:t}=await Dh.from("stores").select("id, name").eq("is_active",!0).order("name");if(t)throw t;return e||[]}catch(e){return[]}};function Ly({open:e,onOpenChange:t,onSuccess:s}){const{formatAmount:r}=rx(),{userProfile:a}=Ih(),[n,i]=Nt.useState(!1),[o,l]=Nt.useState([]),[c,d]=Nt.useState([]),[u,h]=Nt.useState([]),[m,p]=Nt.useState([]),[f,x]=Nt.useState({store_id:"",payment_method:"",customer_name:"",customer_email:"",customer_phone:"",notes:""}),[g,v]=Nt.useState(""),[j,y]=Nt.useState(1),[b,w]=Nt.useState(""),[N,_]=Nt.useState(""),[k,S]=Nt.useState(0),{toast:C}=is();Nt.useEffect(()=>{e&&(M(),T(),A(),E())},[e]);const E=async()=>{try{const{data:e,error:t}=await Dh.from("system_settings").select("setting_value").eq("setting_key","sales.tax_rate").maybeSingle();if(!t&&e&&e.setting_value){const t=parseFloat(String(e.setting_value));isNaN(t)||S(t)}}catch(zw){}},M=async()=>{try{if(!(null==a?void 0:a.id)||!(null==a?void 0:a.role))return void l([]);const e=await Iy(a.id,a.role);l(e||[]),e&&1===e.length&&x(t=>({...t,store_id:e[0].id}))}catch(e){C({title:"Erreur",description:"Impossible de charger les magasins accessibles",variant:"destructive"}),l([])}},T=async()=>{const{data:e,error:t}=await Dh.from("products").select("id, name, sku, current_sale_price, min_sale_price");t?C({title:"Erreur",description:"Impossible de charger les produits",variant:"destructive"}):d(e||[])};Nt.useEffect(()=>{(async()=>{if(!f.store_id)return h([]),void v("");const{data:e,error:t}=await Dh.from("product_stores").select("current_stock, products:products!inner(id, name, sku, current_sale_price, min_sale_price)").eq("store_id",f.store_id).gt("current_stock",0);if(t)return void h([]);const s=(e||[]).map(e=>e.products);h(s),g&&!s.find(e=>e.id===g)&&v("")})()},[f.store_id]);const A=()=>{x({store_id:"",payment_method:"",customer_name:"",customer_email:"",customer_phone:"",notes:""}),p([]),v(""),y(1),w(""),_("")},P=e=>{p(m.filter((t,s)=>s!==e))},D=(e,t)=>{t<=0?P(e):p(m.map((s,r)=>r===e?{...s,quantity:t,total_price:t*s.unit_price}:s))},R=()=>m.reduce((e,t)=>e+t.total_price,0),O=()=>R()*(k/100),q=()=>R()+O(),I=c.find(e=>e.id===g);return Ne.jsx(bg,{open:e,onOpenChange:t,children:Ne.jsxs(kg,{className:"w-[92vw] sm:max-w-xl md:max-w-3xl lg:max-w-4xl max-h-[90vh] overflow-y-auto",children:[Ne.jsxs(Sg,{children:[Ne.jsxs(Eg,{className:"flex items-center gap-2",children:[Ne.jsx(ta,{className:"w-5 h-5"}),"Nouvelle Vente"]}),Ne.jsx(Mg,{children:"Crer une nouvelle transaction de vente"})]}),Ne.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),f.store_id&&f.payment_method&&0!==m.length){i(!0);try{const e=`VTE${Date.now().toString().slice(-6)}${Math.random().toString(36).substring(2,5).toUpperCase()}`,r=R(),n=O(),o=q();if(!(null==a?void 0:a.id))return C({title:"Erreur",description:"Profil utilisateur invalide",variant:"destructive"}),void i(!1);if(!(await qy(a.id,f.store_id,a.role)))return C({title:"Magasin non assign",description:"Vous devez tre assign  ce magasin pour enregistrer une vente.",variant:"destructive"}),void i(!1);const{data:l,error:c}=await Dh.from("sales").insert({sale_code:e,store_id:f.store_id,payment_method:f.payment_method,customer_name:f.customer_name||null,customer_email:f.customer_email||null,customer_phone:f.customer_phone||null,subtotal:r,tax_amount:n,total_amount:o,notes:f.notes||null,sold_by:a.id}).select().single();if(c)throw c;const d=m.map(e=>({sale_id:l.id,product_id:e.product.id,product_name:e.product.name,product_sku:e.product.sku,quantity:e.quantity,unit_price:e.unit_price,total_price:e.total_price,discount_reason:e.discount_reason})),{error:u}=await Dh.from("sale_items").insert(d);if(u)throw u;C({title:"Vente enregistre",description:`Code de vente: ${e}`}),s(),t(!1)}catch(r){C({title:"Erreur",description:"Erreur lors de l'enregistrement de la vente",variant:"destructive"})}finally{i(!1)}}else C({title:"Donnes manquantes",description:"Veuillez remplir tous les champs requis et ajouter des articles",variant:"destructive"})},className:"space-y-4 sm:space-y-6",children:[Ne.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{htmlFor:"store",children:"Magasin *"}),Ne.jsx(av,{value:f.store_id,onValueChange:e=>x(t=>({...t,store_id:e})),options:o.map(e=>({value:e.id,label:e.name})),placeholder:"Slectionner un magasin",triggerClassName:"h-10 sm:h-12"})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{htmlFor:"payment_method",children:"Mthode de paiement *"}),Ne.jsx(av,{value:f.payment_method,onValueChange:e=>x(t=>({...t,payment_method:e})),options:[{value:"cash",label:"Espces"},{value:"card",label:"Carte bancaire"},{value:"mobile_money",label:"Mobile Money"},{value:"bank_transfer",label:"Virement bancaire"},{value:"check",label:"Chque"}],placeholder:"Slectionner une mthode",triggerClassName:"h-10 sm:h-12"})]})]}),Ne.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-4",children:[Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{htmlFor:"customer_name",children:"Nom du client"}),Ne.jsx(Bh,{id:"customer_name",value:f.customer_name,onChange:e=>x(t=>({...t,customer_name:e.target.value})),placeholder:"Nom du client",className:"h-10 sm:h-12 text-sm sm:text-base"})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{htmlFor:"customer_email",children:"Email"}),Ne.jsx(Bh,{id:"customer_email",type:"email",value:f.customer_email,onChange:e=>x(t=>({...t,customer_email:e.target.value})),placeholder:"email@exemple.com",className:"h-10 sm:h-12 text-sm sm:text-base"})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{htmlFor:"customer_phone",children:"Tlphone"}),Ne.jsx(Bh,{id:"customer_phone",value:f.customer_phone,onChange:e=>x(t=>({...t,customer_phone:e.target.value})),placeholder:"Numro de tlphone",className:"h-10 sm:h-12 text-sm sm:text-base"})]})]}),Ne.jsxs(Um,{children:[Ne.jsx(Wm,{children:Ne.jsx(Vm,{children:"Ajouter des articles"})}),Ne.jsx(Hm,{className:"space-y-3 sm:space-y-4",children:Ne.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-5 gap-3 sm:gap-4",children:[Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{children:"Produit"}),Ne.jsx(av,{value:g,onValueChange:v,options:(f.store_id?u:c).map(e=>({value:e.id,label:`${e.name} - ${e.sku}`})),placeholder:"Slectionner",triggerClassName:"h-10 sm:h-12"})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{children:"Quantit"}),Ne.jsx(Bh,{type:"number",min:"1",value:j,onChange:e=>y(parseInt(e.target.value)||1),className:"h-10 sm:h-12 text-sm sm:text-base"})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{children:"Prix unitaire"}),Ne.jsx(Bh,{type:"number",step:"0.01",placeholder:(null==I?void 0:I.current_sale_price.toString())||"0",value:b,onChange:e=>w(e.target.value),className:"h-10 sm:h-12 text-sm sm:text-base"}),I&&Ne.jsxs("p",{className:"text-xs text-muted-foreground",children:["Prix normal: ",r(I.current_sale_price)," | Min: ",r(I.min_sale_price)]})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{children:"Raison rduction"}),Ne.jsx(Bh,{placeholder:"Si prix rduit",value:N,onChange:e=>_(e.target.value),disabled:!b||parseFloat(b)>=((null==I?void 0:I.current_sale_price)||0),className:"h-10 sm:h-12 text-sm sm:text-base disabled:opacity-60"})]}),Ne.jsx("div",{className:"flex items-end",children:Ne.jsxs(Vh,{type:"button",onClick:async()=>{if(!g||j<=0)return void C({title:"Donnes manquantes",description:"Veuillez slectionner un produit et une quantit",variant:"destructive"});if(!f.store_id)return void C({title:"Magasin requis",description:"Veuillez slectionner un magasin avant d'ajouter des produits",variant:"destructive"});const e=c.find(e=>e.id===g);if(!e)return;const t=b?parseFloat(b):e.current_sale_price;if(t<e.min_sale_price&&!N)return void C({title:"Prix minimum requis",description:"Veuillez spcifier une raison pour la rduction",variant:"destructive"});const s=await Ry(f.store_id,g,j);if(!s.available)return void C({title:"Stock insuffisant",description:`Stock disponible: ${s.current_stock}, Quantit demande: ${j}`,variant:"destructive"});const r=m.find(s=>s.product.id===e.id&&s.unit_price===t);if(r){const s=r.quantity+j,a=await Ry(f.store_id,g,s);if(!a.available)return void C({title:"Stock insuffisant",description:`Stock disponible: ${a.current_stock}, Quantit totale demande: ${s}`,variant:"destructive"});p(m.map(r=>r.product.id===e.id&&r.unit_price===t?{...r,quantity:s,total_price:s*t}:r))}else p([...m,{product:e,quantity:j,unit_price:t,total_price:j*t,discount_reason:t<e.current_sale_price?N:void 0}]);v(""),y(1),w(""),_("")},disabled:!g,className:"gap-2 w-full sm:w-auto",children:[Ne.jsx(Yr,{className:"w-4 h-4"}),"Ajouter"]})})]})})]}),m.length>0&&Ne.jsxs(Um,{children:[Ne.jsx(Wm,{children:Ne.jsxs(Vm,{children:["Panier (",m.length," article",m.length>1?"s":"",")"]})}),Ne.jsxs(Hm,{children:[Ne.jsxs(fg,{className:"hidden sm:table",children:[Ne.jsx(xg,{children:Ne.jsxs(vg,{children:[Ne.jsx(jg,{children:"Produit"}),Ne.jsx(jg,{children:"Prix unitaire"}),Ne.jsx(jg,{children:"Quantit"}),Ne.jsx(jg,{children:"Total"}),Ne.jsx(jg,{children:"Actions"})]})}),Ne.jsx(gg,{children:m.map((e,t)=>Ne.jsxs(vg,{children:[Ne.jsx(yg,{children:Ne.jsxs("div",{children:[Ne.jsx("p",{className:"font-medium",children:e.product.name}),Ne.jsx("p",{className:"text-sm text-muted-foreground",children:e.product.sku}),e.discount_reason&&Ne.jsx(Cp,{variant:"secondary",className:"text-xs mt-1",children:e.discount_reason})]})}),Ne.jsx(yg,{children:r(e.unit_price)}),Ne.jsx(yg,{children:Ne.jsxs("div",{className:"flex items-center gap-2",children:[Ne.jsx(Vh,{type:"button",variant:"outline",size:"sm",onClick:()=>D(t,e.quantity-1),children:Ne.jsx($r,{className:"w-3 h-3"})}),Ne.jsx("span",{className:"w-8 text-center",children:e.quantity}),Ne.jsx(Vh,{type:"button",variant:"outline",size:"sm",onClick:()=>D(t,e.quantity+1),children:Ne.jsx(Yr,{className:"w-3 h-3"})})]})}),Ne.jsx(yg,{className:"font-medium",children:r(e.total_price)}),Ne.jsx(yg,{children:Ne.jsx(Vh,{type:"button",variant:"ghost",size:"sm",onClick:()=>P(t),children:Ne.jsx(xa,{className:"w-4 h-4"})})})]},t))})]}),Ne.jsx("div",{className:"space-y-3 sm:hidden",children:m.map((e,t)=>Ne.jsxs("div",{className:"border rounded-lg p-3",children:[Ne.jsxs("div",{className:"flex items-start justify-between gap-2",children:[Ne.jsxs("div",{className:"min-w-0",children:[Ne.jsx("p",{className:"font-medium truncate",children:e.product.name}),Ne.jsx("p",{className:"text-xs text-muted-foreground",children:e.product.sku}),e.discount_reason&&Ne.jsx(Cp,{variant:"secondary",className:"text-xs mt-1",children:e.discount_reason})]}),Ne.jsxs("div",{className:"text-right",children:[Ne.jsx("div",{className:"text-sm text-muted-foreground",children:"PU"}),Ne.jsx("div",{className:"font-medium",children:r(e.unit_price)})]})]}),Ne.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-2 text-sm",children:[Ne.jsxs("div",{children:[Ne.jsx("span",{className:"text-muted-foreground",children:"Quantit"}),Ne.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[Ne.jsx(Vh,{type:"button",variant:"outline",size:"sm",onClick:()=>D(t,e.quantity-1),children:Ne.jsx($r,{className:"w-3 h-3"})}),Ne.jsx("span",{className:"w-8 text-center",children:e.quantity}),Ne.jsx(Vh,{type:"button",variant:"outline",size:"sm",onClick:()=>D(t,e.quantity+1),children:Ne.jsx(Yr,{className:"w-3 h-3"})})]})]}),Ne.jsxs("div",{className:"text-right",children:[Ne.jsx("span",{className:"text-muted-foreground",children:"Total"}),Ne.jsx("div",{className:"font-medium",children:r(e.total_price)})]})]}),Ne.jsx("div",{className:"mt-3 flex items-center justify-end",children:Ne.jsx(Vh,{type:"button",variant:"ghost",size:"sm",onClick:()=>P(t),children:Ne.jsx(xa,{className:"w-4 h-4"})})})]},t))}),Ne.jsxs("div",{className:"mt-4 space-y-2 text-right",children:[Ne.jsxs("div",{className:"flex justify-between",children:[Ne.jsx("span",{children:"Sous-total:"}),Ne.jsx("span",{children:r(R())})]}),Ne.jsxs("div",{className:"flex justify-between",children:[Ne.jsxs("span",{children:["TVA (",k,"%):"]}),Ne.jsx("span",{children:r(O())})]}),Ne.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[Ne.jsx("span",{children:"Total:"}),Ne.jsx("span",{children:r(q())})]})]})]})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{htmlFor:"notes",children:"Notes"}),Ne.jsx(Tg,{id:"notes",value:f.notes,onChange:e=>x(t=>({...t,notes:e.target.value})),placeholder:"Notes optionnelles...",className:"text-sm sm:text-base"})]}),Ne.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-2",children:[Ne.jsx(Vh,{type:"button",variant:"outline",onClick:()=>t(!1),className:"w-full sm:w-auto",children:"Annuler"}),Ne.jsxs(Vh,{type:"submit",disabled:n||0===m.length,className:"w-full sm:w-auto",children:[n&&Ne.jsx(Rr,{className:"mr-2 h-4 w-4 animate-spin"}),"Enregistrer la vente"]})]})]})]})})}function $y({open:e,onOpenChange:t,onSuccess:s}){const{userProfile:r}=Ih(),{toast:a}=is(),[n,i]=Nt.useState([]),[o,l]=Nt.useState(""),[c,d]=Nt.useState(""),[u,h]=Nt.useState([]),[m,p]=Nt.useState(""),[f,x]=Nt.useState(!1);Nt.useEffect(()=>{e&&(h([]),p(""),l(""),d(""),(async()=>{if(!(null==r?void 0:r.id)||!(null==r?void 0:r.role))return;const e=await Iy(r.id,r.role);i((e||[]).map(e=>({id:e.id,name:e.name})))})())},[e,null==r?void 0:r.id,null==r?void 0:r.role]);return Ne.jsx(bg,{open:e,onOpenChange:t,children:Ne.jsxs(kg,{className:"w-[92vw] max-w-lg sm:max-w-2xl",children:[Ne.jsxs(Sg,{children:[Ne.jsx(Eg,{children:"Importer des articles de vente (CSV)"}),Ne.jsx(Mg,{children:"Format: product_sku, quantity, unit_price (optionnel), discount_reason (optionnel)"})]}),Ne.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{children:"Magasin *"}),Ne.jsx(av,{value:o,onValueChange:l,options:n.map(e=>({value:e.id,label:e.name})),placeholder:"Slectionner un magasin",triggerClassName:"h-10"})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{children:"Mthode de paiement *"}),Ne.jsx(av,{value:c,onValueChange:d,options:[{value:"cash",label:"Espces"},{value:"card",label:"Carte bancaire"},{value:"mobile_money",label:"Mobile Money"},{value:"bank_transfer",label:"Virement bancaire"},{value:"check",label:"Chque"}],placeholder:"Slectionner une mthode",triggerClassName:"h-10"})]})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{children:"Fichier CSV"}),Ne.jsx(Bh,{type:"file",accept:".csv",onChange:e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];s&&(async e=>{p(e.name);const t=(await e.text()).split(/\r?\n/).filter(e=>e.trim().length>0);if(t.length<2)return void h([]);const s=t[0].split(",").map(e=>e.trim().toLowerCase()),r=s.indexOf("product_sku"),n=s.indexOf("quantity"),i=s.indexOf("unit_price"),o=s.indexOf("discount_reason");if(-1===r||-1===n)return void a({title:"Format invalide",description:"Enttes requis: product_sku, quantity",variant:"destructive"});const l=[];for(let a=1;a<t.length;a++){const e=t[a].split(",");if(0===e.length||!e[r])continue;const s=String(e[r]).trim(),c=parseInt(String(e[n]).trim(),10),d=-1!==i?parseFloat(String(e[i]).trim()):NaN,u=-1!==o?String(e[o]).trim():"";!s||isNaN(c)||c<=0||l.push({product_sku:s,quantity:c,unit_price:isNaN(d)?null:d,discount_reason:u||null})}h(l)})(s)}}),m&&Ne.jsx("div",{className:"text-xs text-muted-foreground",children:m})]}),Ne.jsxs(Um,{children:[Ne.jsx(Wm,{children:Ne.jsxs(Vm,{children:["Aperu (",u.length,")"]})}),Ne.jsx(Hm,{className:"overflow-auto max-h-64",children:Ne.jsxs(fg,{children:[Ne.jsx(xg,{children:Ne.jsxs(vg,{children:[Ne.jsx(jg,{children:"SKU"}),Ne.jsx(jg,{children:"Quantit"}),Ne.jsx(jg,{children:"PU"}),Ne.jsx(jg,{children:"Raison"})]})}),Ne.jsx(gg,{children:u.map((e,t)=>Ne.jsxs(vg,{children:[Ne.jsx(yg,{children:e.product_sku}),Ne.jsx(yg,{children:e.quantity}),Ne.jsx(yg,{children:"number"==typeof e.unit_price?e.unit_price:""}),Ne.jsx(yg,{children:e.discount_reason||""})]},t))})]})})]}),Ne.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-2",children:[Ne.jsx(Vh,{variant:"outline",onClick:()=>t(!1),className:"w-full sm:w-auto",children:"Annuler"}),Ne.jsx(Vh,{onClick:async()=>{if(null==r?void 0:r.id)if(o&&c)if(0!==u.length){x(!0);try{const e=Array.from(new Set(u.map(e=>e.product_sku))),{data:n,error:i}=await Dh.from("products").select("id, sku, name, current_sale_price, min_sale_price").in("sku",e);if(i)throw i;const l=new Map((n||[]).map(e=>[e.sku,e])),d=[];for(const t of u){const e=l.get(t.product_sku);if(!e){a({title:"SKU introuvable",description:`Produit ${t.product_sku} ignor`,variant:"destructive"});continue}const s="number"!=typeof t.unit_price||isNaN(t.unit_price)?e.current_sale_price:t.unit_price;d.push({product_id:e.id,product_name:e.name,product_sku:e.sku,quantity:t.quantity,unit_price:s,total_price:s*t.quantity,discount_reason:t.discount_reason||void 0})}if(0===d.length)return a({title:"Aucun article valide",description:"Vrifiez vos donnes",variant:"destructive"}),void x(!1);const h=d.reduce((e,t)=>e+t.total_price,0),m=`VTE${Date.now().toString().slice(-6)}${Math.random().toString(36).substring(2,5).toUpperCase()}`,{data:p,error:f}=await Dh.from("sales").insert({sale_code:m,store_id:o,payment_method:c,total_amount:h,subtotal:h,tax_amount:0,sold_by:r.id}).select().single();if(f)throw f;const g=d.map(e=>({sale_id:p.id,...e})),{error:v}=await Dh.from("sale_items").insert(g);if(v)throw v;a({title:"Import russi",description:`${d.length} article(s) imports`}),s(),t(!1)}catch(zw){a({title:"Erreur import",description:"Impossible de terminer l'importation",variant:"destructive"})}finally{x(!1)}}else a({title:"Fichier vide",description:"Aucune ligne valide  importer",variant:"destructive"});else a({title:"Champs requis",description:"Slectionnez un magasin et une mthode de paiement",variant:"destructive"});else a({title:"Erreur",description:"Utilisateur invalide",variant:"destructive"})},disabled:f||!o||!c||0===u.length,className:"w-full sm:w-auto",children:"Importer"})]})]})})}function zy(){var e,t,s,r,a,n;const{formatAmount:i}=rx(),{userProfile:o}=Ih(),{toast:l}=is(),[c,d]=Nt.useState(""),[u,h]=Nt.useState([]),[m,p]=Nt.useState(!0),[f,x]=Nt.useState(null),[g,v]=Nt.useState(!1),[j,y]=Nt.useState(!1),[b,w]=Nt.useState(!1),[N,_]=Nt.useState(!1),[k,S]=Nt.useState(!1),[C,E]=Nt.useState(!1),[M,T]=Nt.useState(null),[A,P]=Nt.useState(!1),[D,R]=Nt.useState(!1),[O,q]=Nt.useState(!1),[I,F]=Nt.useState(""),[L,$]=Nt.useState(""),[z,U]=Nt.useState({}),[W,V]=Nt.useState([]),[B,H]=Nt.useState(0),[K,Y]=Nt.useState(1),[G,Q]=Nt.useState(20),[J,X]=Nt.useState({dateRange:null,store:"all",paymentMethod:"all",status:"all"}),Z=(null==o?void 0:o.role)&&["Vendeur","Manager","Admin","SuperAdmin"].includes(o.role),ee=(null==o?void 0:o.role)&&["Vendeur","Manager","Admin","SuperAdmin"].includes(o.role);(null==o?void 0:o.role)&&["Manager","Admin","SuperAdmin"].includes(o.role);const te=(null==o?void 0:o.role)&&["Vendeur","Manager","Admin","SuperAdmin"].includes(o.role),se=(null==o?void 0:o.role)&&["Vendeur","Manager","Admin","SuperAdmin"].includes(o.role),re=(null==o?void 0:o.role)&&["Manager","Admin","SuperAdmin"].includes(o.role),ae=(null==o?void 0:o.role)&&["Manager","Admin","SuperAdmin"].includes(o.role),ne=(null==o?void 0:o.role)&&["Manager","Admin","SuperAdmin"].includes(o.role),ie=(null==o?void 0:o.role)&&["Manager","Admin","SuperAdmin"].includes(o.role),oe=e=>!!(null==o?void 0:o.id)&&(!!["Manager","Admin","SuperAdmin"].includes(o.role||"")||"Vendeur"===o.role&&e.sold_by===o.id);Nt.useEffect(()=>{ee&&ce()},[ee]),Nt.useEffect(()=>{(async()=>{try{const{data:e,error:t}=await Dh.from("system_settings").select("setting_value").eq("setting_key","sales.tax_rate").maybeSingle();if(!t&&e&&e.setting_value){const t=parseFloat(String(e.setting_value));isNaN(t)||H(t)}}catch{}})()},[]);const le=e=>!(!e||"object"!=typeof e)&&(!(!e.id||!e.sale_code)&&(!(!e.total_amount||e.total_amount<0)&&!!e.created_at)),ce=async()=>{try{p(!0),x(null);let e=Dh.from("sales").select("\n          *,\n          sale_items(id, product_name, product_sku, quantity, unit_price, total_price),\n          stores(name)\n        ").order("created_at",{ascending:!1});"Vendeur"===(null==o?void 0:o.role)&&(e=e.eq("sold_by",o.id));const{data:t,error:s}=await e;if(s)throw s;if(t&&t.length>0)if("Vendeur"===(null==o?void 0:o.role)){const e=t.map(e=>({...e,users:{id:o.id,first_name:o.first_name,last_name:o.last_name,email:o.email}}));h(e)}else{const e=[...new Set(t.map(e=>e.sold_by).filter(Boolean))];if(e.length>0){const{data:s,error:r}=await Dh.from("users").select("id, first_name, last_name, email").in("id",e);if(!r&&s){const e=new Map(s.map(e=>[e.id,e])),r=t.map(t=>({...t,users:e.get(t.sold_by)||null}));h(r)}else h(t)}else h(t)}else h([])}catch(e){x("Impossible de charger les ventes"),l({title:"Erreur",description:"Impossible de charger les ventes",variant:"destructive"})}finally{p(!1)}},de=e=>"string"==typeof(null==e?void 0:e.notes)&&e.notes.includes("[ERROR]"),ue=e=>{T(e),F(""),P(!0)},he=e=>{T(e),$(""),R(!0)},me=e=>{T(e),U({customer_name:e.customer_name||"",customer_email:e.customer_email||"",customer_phone:e.customer_phone||"",payment_method:e.payment_method||"cash",notes:e.notes||""});const t=(e.sale_items||[]).map(e=>({id:e.id,product_name:e.product_name,product_sku:e.product_sku,quantity:Number(e.quantity)||0,unit_price:Number(e.unit_price)||0,discount_reason:e.discount_reason||""}));V(t),q(!0)},pe=()=>W.reduce((e,t)=>e+(Number(t.unit_price)||0)*(Number(t.quantity)||0),0),fe=()=>pe()*(B/100),xe=()=>{Z?v(!0):l({title:"Permission refuse",description:"Vous n'avez pas les permissions pour crer des ventes",variant:"destructive"})},ge=e=>{te?(T(e),_(!0)):l({title:"Permission refuse",description:"Vous n'avez pas les permissions pour voir les dtails",variant:"destructive"})},ve=e=>{se?be(e):l({title:"Permission refuse",description:"Vous n'avez pas les permissions pour imprimer",variant:"destructive"})},je=e=>{re||oe(e)?(T(e),S(!0)):l({title:"Permission refuse",description:"Vous n'avez pas les permissions pour grer les retours",variant:"destructive"})},ye=e=>{ae||oe(e)?(T(e),E(!0)):l({title:"Permission refuse",description:"Vous n'avez pas les permissions pour annuler les ventes",variant:"destructive"})},be=e=>{var t,s;try{const r=`\n        ========================================\n        RECU DE VENTE - ${e.sale_code}\n        ========================================\n        \n        Date: ${new Date(e.created_at).toLocaleDateString("fr-FR")}\n        Heure: ${new Date(e.created_at).toLocaleTimeString("fr-FR")}\n        \n        Client: ${e.customer_name||"Client anonyme"}\n        Magasin: ${(null==(t=e.stores)?void 0:t.name)||"N/A"}\n        Vendeur: ${e.users?`${e.users.first_name||""} ${e.users.last_name||""}`.trim()||e.users.email:"N/A"}\n        \n        ========================================\n        PRODUITS:\n        ${(null==(s=e.sale_items)?void 0:s.map(e=>`${e.product_name||"Produit"} - Qty: ${e.quantity} x ${i(e.unit_price)} = ${i(e.total_price)}`).join("\n"))||"Aucun dtail produit"}\n        ========================================\n        \n        TOTAL: ${i(e.total_amount)}\n        Paiement: ${_e(e.payment_method)}\n        Statut: ${e.status||"completed"}\n        \n        ========================================\n        Merci de votre achat !\n        ========================================\n      `,a=window.open("","_blank");a&&(a.document.write(`\n          <html>\n            <head>\n              <title>Reu - ${e.sale_code}</title>\n              <style>\n                body { font-family: monospace; font-size: 12px; line-height: 1.4; }\n                .receipt { white-space: pre-line; }\n              </style>\n            </head>\n            <body>\n              <div class="receipt">${r}</div>\n              <script>window.print(); window.close();<\/script>\n            </body>\n          </html>\n        `),a.document.close(),l({title:"Impression lance",description:"Le reu a t envoy  l'imprimante"}))}catch(r){l({title:"Erreur d'impression",description:"Impossible d'imprimer le reu",variant:"destructive"})}},we=e=>{const t=(null==e?void 0:e.sale_items)||[];return t.length?t.map(e=>[e.product_name,e.product_sku].filter(Boolean).join(" ")).join(", "):""},_e=e=>{switch(e){case"card":return"Carte";case"cash":return"Espces";case"check":return"Chque";case"transfer":return"Virement";default:return e}},ke=e=>{switch(e){case"completed":return Ne.jsx(Cp,{variant:"default",children:"Pay"});case"pending":return Ne.jsx(Cp,{variant:"secondary",children:"En attente"});case"cancelled":return Ne.jsx(Cp,{variant:"destructive",children:"Annul"});default:return Ne.jsx(Cp,{variant:"outline",children:e})}},Se=()=>{X({dateRange:null,store:"all",paymentMethod:"all",status:"all"})},Ce=Nt.useMemo(()=>{var e,t;const s=e=>e?String(e).normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase():"",r=s(c).split(/\s+/).filter(Boolean);let a=u.filter(le).filter(e=>{var t;if(0===r.length)return!0;const a=[];a.push(e.sale_code),a.push(e.customer_name),a.push(null==(t=e.stores)?void 0:t.name),a.push(e.payment_method),Array.isArray(e.sale_items)&&e.sale_items.forEach(e=>{a.push(e.product_name),a.push(e.product_sku)});const n=s(a.filter(Boolean).join(" "));return r.every(e=>n.includes(e))});return J.store&&"all"!==J.store&&(a=a.filter(e=>{var t;return(null==(t=e.stores)?void 0:t.name)===J.store})),J.paymentMethod&&"all"!==J.paymentMethod&&(a=a.filter(e=>e.payment_method===J.paymentMethod)),J.status&&"all"!==J.status&&(a=a.filter(e=>(e.status||"completed")===J.status)),(null==(e=J.dateRange)?void 0:e.from)&&(a=a.filter(e=>new Date(e.created_at)>=J.dateRange.from)),(null==(t=J.dateRange)?void 0:t.to)&&(a=a.filter(e=>new Date(e.created_at)<=J.dateRange.to)),a},[u,c,J]),Ee="all"===G?1:Math.max(1,Math.ceil(Ce.length/G)),Me=Math.min(K,Ee),Te="all"===G?Ce:Ce.slice((Me-1)*G,Me*G);Nt.useEffect(()=>{Y(1)},[G,c,J]);const{totalSales:Ae,averageTicket:Pe,pendingSales:De}=Nt.useMemo(()=>{const e=u.reduce((e,t)=>e+(t.total_amount||0),0);return{totalSales:e,averageTicket:u.length>0?e/u.length:0,pendingSales:u.filter(e=>"pending"===e.status).length}},[u]),Re=Nt.useMemo(()=>{const e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate()),s=new Date(t.getTime()-864e5),r=new Date(t.getTime()-1728e5),a=new Date(e.getFullYear(),e.getMonth(),1),n=new Date(t.getTime()-6048e5),i=u.filter(e=>{const s=new Date(e.created_at);return s>=t&&s<new Date(t.getTime()+864e5)}),o=u.filter(e=>{const r=new Date(e.created_at);return r>=s&&r<t}),l=u.filter(e=>{const t=new Date(e.created_at);return t>=r&&t<s}),c=u.filter(e=>new Date(e.created_at)>=a),d=u.filter(e=>new Date(e.created_at)>=n);return{todayProductsSold:i.reduce((e,t)=>{var s;return e+((null==(s=t.sale_items)?void 0:s.reduce((e,t)=>e+(t.quantity||0),0))||0)},0),yesterdayProductsSold:o.reduce((e,t)=>{var s;return e+((null==(s=t.sale_items)?void 0:s.reduce((e,t)=>e+(t.quantity||0),0))||0)},0),beforeYesterdayProductsSold:l.reduce((e,t)=>{var s;return e+((null==(s=t.sale_items)?void 0:s.reduce((e,t)=>e+(t.quantity||0),0))||0)},0),monthlyProductsSold:c.reduce((e,t)=>{var s;return e+((null==(s=t.sale_items)?void 0:s.reduce((e,t)=>e+(t.quantity||0),0))||0)},0),weeklyProductsSold:d.reduce((e,t)=>{var s;return e+((null==(s=t.sale_items)?void 0:s.reduce((e,t)=>e+(t.quantity||0),0))||0)},0),todaySales:i.reduce((e,t)=>e+(t.total_amount||0),0),todayCount:i.length,monthlySales:c.reduce((e,t)=>e+(t.total_amount||0),0),weeklySales:d.reduce((e,t)=>e+(t.total_amount||0),0),yesterdaySales:o.reduce((e,t)=>e+(t.total_amount||0),0),beforeYesterdaySales:l.reduce((e,t)=>e+(t.total_amount||0),0)}},[u]),Oe=Nt.useMemo(()=>{const e=u.map(e=>{var t;return null==(t=e.stores)?void 0:t.name}).filter(Boolean);return[...new Set(e)]},[u]);return Ne.jsxs("div",{className:"space-y-6 p-6",children:[Ne.jsx(Sy,{items:[{label:"Ventes",icon:void 0}]}),Ne.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[Ne.jsxs("div",{children:[Ne.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Ventes"}),Ne.jsx("p",{className:"text-muted-foreground",children:"Grez vos ventes et transactions"})]}),Z&&Ne.jsxs(Vh,{onClick:xe,className:"gap-2",children:[Ne.jsx(Yr,{className:"w-4 h-4"}),"Nouvelle vente"]})]}),f?Ne.jsx(Um,{className:"bg-destructive/10 border-destructive",children:Ne.jsxs(Hm,{className:"pt-6",children:[Ne.jsxs("div",{className:"flex items-center gap-2 text-destructive",children:[Ne.jsx(rr,{className:"w-5 h-5"}),Ne.jsx("span",{className:"font-medium",children:"Erreur de chargement"})]}),Ne.jsx("p",{className:"text-sm text-destructive/80 mt-2",children:f}),Ne.jsxs(Vh,{onClick:()=>{x(null),ee&&ce()},variant:"outline",size:"sm",className:"mt-3",children:[Ne.jsx(Gr,{className:"w-4 h-4 mr-2"}),"Ressayer"]})]})}):Ne.jsxs(Ne.Fragment,{children:[Ne.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:[Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Ne.jsx(Vm,{className:"text-sm font-medium",children:"Ventes du jour"}),Ne.jsx(ia,{className:"h-4 w-4 text-muted-foreground"})]}),Ne.jsxs(Hm,{children:[Ne.jsx("div",{className:"text-2xl font-bold",children:Re.todayProductsSold}),Ne.jsxs("p",{className:"text-xs text-muted-foreground",children:[i(Re.todaySales)," de chiffre d'affaires"]})]})]}),Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Ne.jsx(Vm,{className:"text-sm font-medium",children:"Panier moyen"}),Ne.jsx(yr,{className:"h-4 w-4 text-muted-foreground"})]}),Ne.jsxs(Hm,{children:[Ne.jsx("div",{className:"text-2xl font-bold",children:i(Pe)}),Ne.jsxs("p",{className:"text-xs text-muted-foreground",children:[Re.todayProductsSold," produits vendus"]})]})]}),Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Ne.jsx(Vm,{className:"text-sm font-medium",children:"Total du mois"}),Ne.jsx(dr,{className:"h-4 w-4 text-muted-foreground"})]}),Ne.jsxs(Hm,{children:[Ne.jsx("div",{className:"text-2xl font-bold",children:i(Re.monthlySales)}),Ne.jsxs("p",{className:"text-xs text-muted-foreground",children:[Re.monthlyProductsSold," produits vendus"]})]})]}),Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Ne.jsx(Vm,{className:"text-sm font-medium",children:"Total 7 derniers jours"}),Ne.jsx(ia,{className:"h-4 w-4 text-muted-foreground"})]}),Ne.jsxs(Hm,{children:[Ne.jsx("div",{className:"text-2xl font-bold",children:i(Re.weeklySales)}),Ne.jsxs("p",{className:"text-xs text-muted-foreground",children:[Re.weeklyProductsSold," produits vendus"]})]})]}),Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Ne.jsx(Vm,{className:"text-sm font-medium",children:"Total hier"}),Ne.jsx(dr,{className:"h-4 w-4 text-muted-foreground"})]}),Ne.jsxs(Hm,{children:[Ne.jsx("div",{className:"text-2xl font-bold",children:i(Re.yesterdaySales)}),Ne.jsxs("p",{className:"text-xs text-muted-foreground",children:[Re.yesterdayProductsSold," produits vendus"]})]})]}),Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Ne.jsx(Vm,{className:"text-sm font-medium",children:"Total avant-hier"}),Ne.jsx(dr,{className:"h-4 w-4 text-muted-foreground"})]}),Ne.jsxs(Hm,{children:[Ne.jsx("div",{className:"text-2xl font-bold",children:i(Re.beforeYesterdaySales)}),Ne.jsxs("p",{className:"text-xs text-muted-foreground",children:[Re.beforeYesterdayProductsSold," produits vendus"]})]})]})]}),Ne.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[Ne.jsxs("div",{className:"relative sm:col-span-2",children:[Ne.jsx(Xr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),Ne.jsx(Bh,{placeholder:"Rechercher (code, client, magasin, produit, SKU, paiement)",value:c,onChange:e=>d(e.target.value),className:"pl-10 h-10 sm:h-12 text-sm sm:text-base"})]}),Ne.jsxs(tv,{open:b,onOpenChange:w,children:[Ne.jsx(sv,{asChild:!0,children:Ne.jsxs(Vh,{variant:"outline",size:"sm",className:"gap-2 w-full sm:w-auto",children:[Ne.jsx(Mr,{className:"w-4 h-4"}),"Filtres"]})}),Ne.jsx(rv,{className:"w-[92vw] sm:w-80 max-h-[70vh] overflow-auto",align:"end",children:Ne.jsxs("div",{className:"space-y-4",children:[Ne.jsx("h4",{className:"font-medium leading-none",children:"Filtres"}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx("label",{className:"text-sm font-medium",children:"Priode"}),Ne.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[Ne.jsxs("div",{className:"space-y-1",children:[Ne.jsx("span",{className:"text-xs text-muted-foreground",children:"De"}),Ne.jsxs(tv,{children:[Ne.jsx(sv,{asChild:!0,children:Ne.jsxs(Vh,{variant:"outline",className:"w-full justify-start h-9 font-normal",children:[Ne.jsx(dr,{className:"mr-2 h-4 w-4"}),(null==(e=J.dateRange)?void 0:e.from)?lg(J.dateRange.from,"dd/MM/yyyy",{locale:mg}):"Date de dbut"]})}),Ne.jsx(rv,{className:"p-0 w-[92vw] sm:w-auto",align:"start",children:Ne.jsx(Ny,{mode:"single",selected:null==(t=J.dateRange)?void 0:t.from,onSelect:e=>X(t=>{var s;return{...t,dateRange:{from:e||void 0,to:null==(s=t.dateRange)?void 0:s.to}}}),initialFocus:!0,locale:mg})})]})]}),Ne.jsxs("div",{className:"space-y-1",children:[Ne.jsx("span",{className:"text-xs text-muted-foreground",children:""}),Ne.jsxs(tv,{children:[Ne.jsx(sv,{asChild:!0,children:Ne.jsxs(Vh,{variant:"outline",className:"w-full justify-start h-9 font-normal",children:[Ne.jsx(dr,{className:"mr-2 h-4 w-4"}),(null==(s=J.dateRange)?void 0:s.to)?lg(J.dateRange.to,"dd/MM/yyyy",{locale:mg}):"Date de fin"]})}),Ne.jsx(rv,{className:"p-0 w-[92vw] sm:w-auto",align:"start",children:Ne.jsx(Ny,{mode:"single",selected:null==(r=J.dateRange)?void 0:r.to,onSelect:e=>X(t=>{var s;return{...t,dateRange:{from:null==(s=t.dateRange)?void 0:s.from,to:e||void 0}}}),initialFocus:!0,locale:mg})})]})]})]})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx("label",{className:"text-sm font-medium",children:"Magasin"}),Ne.jsxs(Kf,{value:J.store,onValueChange:e=>X(t=>({...t,store:e})),children:[Ne.jsx(Gf,{className:"w-full",children:Ne.jsx(Yf,{placeholder:"Tous les magasins"})}),Ne.jsxs(Xf,{children:[Ne.jsx(Zf,{value:"all",children:"Tous les magasins"}),Oe.map(e=>Ne.jsx(Zf,{value:e,children:e},e))]})]})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx("label",{className:"text-sm font-medium",children:"Statut"}),Ne.jsxs(Kf,{value:J.status,onValueChange:e=>X(t=>({...t,status:e})),children:[Ne.jsx(Gf,{className:"w-full",children:Ne.jsx(Yf,{placeholder:"Tous les statuts"})}),Ne.jsxs(Xf,{children:[Ne.jsx(Zf,{value:"all",children:"Tous les statuts"}),Ne.jsx(Zf,{value:"completed",children:"Pay"}),Ne.jsx(Zf,{value:"pending",children:"En attente"}),Ne.jsx(Zf,{value:"cancelled",children:"Annul"})]})]})]}),Ne.jsxs("div",{className:"flex gap-2 w-full",children:[Ne.jsx(Vh,{variant:"outline",size:"sm",onClick:Se,className:"flex-1",children:"Effacer"}),Ne.jsx(Vh,{size:"sm",onClick:()=>w(!1),className:"flex-1",children:"Appliquer"})]})]})})]})]}),Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsx(Wm,{children:Ne.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[Ne.jsxs("div",{children:[Ne.jsx(Vm,{children:"Historique des ventes"}),Ne.jsx(Bm,{children:"Liste de toutes vos transactions"})]}),Ne.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-2 w-full sm:w-auto",children:[Ne.jsxs(Vh,{variant:"outline",size:"sm",onClick:()=>y(!0),className:"gap-2 w-full sm:w-auto",children:[Ne.jsx(ca,{className:"w-4 h-4"})," Importer"]}),Ne.jsxs(Vh,{variant:"outline",size:"sm",onClick:()=>{try{const e=[["Code","Client","Magasin","Montant","Produits","Statut","Date","Vendeur","Quantit vendue"],...Ce.map(e=>{var t;const s=new Date(e.created_at),r=Array.isArray(e.sale_items)?e.sale_items.reduce((e,t)=>e+(Number(t.quantity)||0),0):0,a=Array.isArray(e.sale_items)?e.sale_items.map(e=>`${e.product_name} (${e.product_sku})`).join(" | "):"",n=e.users&&(`${e.users.first_name||""} ${e.users.last_name||""}`.trim()||e.users.email)||"";return[e.sale_code||"",e.customer_name||"",(null==(t=e.stores)?void 0:t.name)||"",String(e.total_amount??""),a,e.status||"completed",lg(s,"dd/MM/yyyy HH:mm",{locale:mg}),n,String(r)]})].map(e=>e.map(e=>'"'+String(e??"").replace(/"/g,'""')+'"').join(",")).join("\n"),t=new Blob(["\ufeff"+e],{type:"text/csv;charset=utf-8;"}),s=URL.createObjectURL(t),r=document.createElement("a");r.href=s;const a=lg(new Date,"yyyyMMdd_HHmm");r.download=`ventes_${a}.csv`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(s)}catch(zw){l({title:"Erreur",description:"Impossible d'exporter les ventes",variant:"destructive"})}},className:"gap-2 w-full sm:w-auto",children:[Ne.jsx(kr,{className:"w-4 h-4"})," Exporter"]}),Ne.jsxs(Vh,{variant:"outline",size:"sm",onClick:()=>{var e,t;try{const s=(null==(e=null==J?void 0:J.dateRange)?void 0:e.from)?lg(J.dateRange.from,"dd/MM/yyyy",{locale:mg}):"",r=(null==(t=null==J?void 0:J.dateRange)?void 0:t.to)?lg(J.dateRange.to,"dd/MM/yyyy",{locale:mg}):"",a=(null==J?void 0:J.store)&&"all"!==J.store?String(J.store):"Tous",n=(()=>{switch(null==J?void 0:J.status){case"completed":return"Pay";case"pending":return"En attente";case"cancelled":return"Annul";default:return"Tous"}})(),i=Ce.map(e=>{var t;const s=new Date(e.created_at),r=Array.isArray(e.sale_items)?e.sale_items.reduce((e,t)=>e+(Number(t.quantity)||0),0):0,a=Array.isArray(e.sale_items)?e.sale_items.map(e=>`${e.product_name} (${e.product_sku})`).join(" | "):"",n=e.users&&(`${e.users.first_name||""} ${e.users.last_name||""}`.trim()||e.users.email)||"";return`\n          <tr>\n            <td>${e.sale_code||""}</td>\n            <td>${e.customer_name||""}</td>\n            <td>${(null==(t=e.stores)?void 0:t.name)||""}</td>\n            <td>${e.total_amount??""}</td>\n            <td>${a}</td>\n            <td>${e.status||"completed"}</td>\n            <td>${lg(s,"dd/MM/yyyy HH:mm",{locale:mg})}</td>\n            <td>${n}</td>\n            <td>${r}</td>\n          </tr>`}).join(""),o=`\n        <html>\n          <head>\n            <meta charset="utf-8" />\n            <title>Export ventes</title>\n            ${"\n        <style>\n          @media print { @page { size: auto; margin: 16mm; } }\n          body { font-family: Arial, sans-serif; padding: 16px; position: relative; }\n          .watermark { position: fixed; inset: 0; display: flex; align-items: center; justify-content: center; pointer-events: none; z-index: 0; opacity: 0.06; }\n          .watermark img { max-width: 70%; max-height: 70%; }\n          .content { position: relative; z-index: 1; }\n          h1 { font-size: 18px; margin-bottom: 12px; }\n          .brand { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }\n          .brand img { width: 28px; height: 28px; object-fit: contain; }\n          .brand-name { font-weight: 700; font-size: 16px; }\n          table { width: 100%; border-collapse: collapse; }\n          th, td { border: 1px solid #ddd; padding: 6px 8px; font-size: 12px; }\n          th { background: #f5f5f5; text-align: left; }\n        </style>\n      "}\n          </head>\n          <body>\n            <div class="watermark"><img src="/logo.png" alt="GesFlex Pro" /></div>\n            <div class="content">\n              <div class="brand"><img src="/logo.png" alt="GesFlex Pro" /><div class="brand-name">GesFlex Pro</div></div>\n              <h1>Ventes exportes (${lg(new Date,"dd/MM/yyyy HH:mm",{locale:mg})})</h1>\n              <div class="filters">\n                <table>\n                  <thead>\n                    <tr>\n                      <th>Priode - De</th>\n                      <th>Priode - </th>\n                      <th>Magasin</th>\n                      <th>Statut</th>\n                    </tr>\n                  </thead>\n                  <tbody>\n                    <tr>\n                      <td>${s}</td>\n                      <td>${r}</td>\n                      <td>${a}</td>\n                      <td>${n}</td>\n                    </tr>\n                  </tbody>\n                </table>\n              </div>\n              <table>\n              <thead>\n                <tr>\n                  <th>Code</th>\n                  <th>Client</th>\n                  <th>Magasin</th>\n                  <th>Montant</th>\n                  <th>Produits</th>\n                  <th>Statut</th>\n                  <th>Date</th>\n                  <th>Vendeur</th>\n                  <th>Quantit vendue</th>\n                </tr>\n              </thead>\n              <tbody>\n                ${i}\n              </tbody>\n              </table>\n            </div>\n            <script>window.onload = () => { window.print(); setTimeout(() => window.close(), 300); };<\/script>\n          </body>\n        </html>\n      `,l=window.open("","_blank");if(!l)return;l.document.open(),l.document.write(o),l.document.close()}catch(zw){l({title:"Erreur",description:"Impossible d'exporter en PDF",variant:"destructive"})}},className:"gap-2 w-full sm:w-auto",children:[Ne.jsx(Er,{className:"w-4 h-4"})," PDF"]}),Ne.jsxs("div",{className:"flex items-center sm:gap-2",children:[Ne.jsx("span",{className:"text-sm text-muted-foreground hidden sm:inline",children:"Par page"}),Ne.jsxs(Kf,{value:String(G),onValueChange:e=>Q("all"===e?"all":parseInt(e)),children:[Ne.jsx(Gf,{className:"h-9 w-full sm:w-[92px]",children:Ne.jsx(Yf,{placeholder:"20"})}),Ne.jsxs(Xf,{children:[Ne.jsx(Zf,{value:"all",children:"All"}),Ne.jsx(Zf,{value:"10",children:"10"}),Ne.jsx(Zf,{value:"20",children:"20"}),Ne.jsx(Zf,{value:"50",children:"50"})]})]})]})]})]})}),Ne.jsx(Hm,{children:m?Ne.jsx("div",{className:"space-y-3",children:Array.from({length:5}).map((e,t)=>Ne.jsxs("div",{className:"flex items-center space-x-4 p-4 border rounded-lg",children:[Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-4 w-24 rounded"}),Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-4 w-32 rounded"}),Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-4 w-28 rounded"}),Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-4 w-20 rounded"}),Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-4 w-24 rounded"}),Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-4 w-16 rounded"}),Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-4 w-20 rounded"}),Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-4 w-24 rounded"}),Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-4 w-20 rounded"}),Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-8 w-8 rounded"})]},t))}):0===Ce.length?Ne.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[Ne.jsx(ia,{className:"w-16 h-16 text-muted-foreground/20 mb-4"}),c||Object.values(J).some(e=>"all"!==e&&null!==e)?Ne.jsxs(Ne.Fragment,{children:[Ne.jsx("p",{className:"text-muted-foreground mb-2",children:"Aucune vente trouve avec les critres actuels"}),Ne.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Essayez de modifier vos filtres ou votre recherche"}),Ne.jsxs(Vh,{onClick:Se,variant:"outline",className:"gap-2",children:[Ne.jsx(Gr,{className:"w-4 h-4"}),"Effacer les filtres"]})]}):Ne.jsxs(Ne.Fragment,{children:[Ne.jsx("p",{className:"text-muted-foreground mb-4",children:"Aucune vente enregistre"}),Z&&Ne.jsx(Vh,{onClick:xe,variant:"outline",children:"Crer votre premire vente"})]})]}):Ne.jsxs(Ne.Fragment,{children:[Ne.jsx("div",{className:"hidden sm:block",children:Ne.jsxs(fg,{children:[Ne.jsx(xg,{children:Ne.jsxs(vg,{children:[Ne.jsx(jg,{children:"Code"}),Ne.jsx(jg,{children:"Client"}),Ne.jsx(jg,{children:"Magasin"}),Ne.jsx(jg,{children:"Montant"}),Ne.jsx(jg,{children:"Produits"}),Ne.jsx(jg,{children:"Statut"}),Ne.jsx(jg,{children:"Date"}),Ne.jsx(jg,{children:"Vendeur"}),Ne.jsx(jg,{children:"Quantit vendue"}),Ne.jsx(jg,{children:"Actions"})]})}),Ne.jsx(gg,{children:Te.map(e=>{var t,s;return Ne.jsxs(vg,{className:de(e)?"border border-red-300 bg-red-50/40":"",children:[Ne.jsx(yg,{className:"font-medium",children:e.sale_code}),Ne.jsx(yg,{children:e.customer_name||"Client anonyme"}),Ne.jsx(yg,{children:null==(t=e.stores)?void 0:t.name}),Ne.jsx(yg,{className:"font-medium",children:i(e.total_amount)}),Ne.jsxs(yg,{className:"max-w-[280px] truncate flex items-center gap-2",children:[de(e)&&Ne.jsx(Cp,{variant:"destructive",children:"Erreur signale"}),Ne.jsx("span",{className:"truncate",children:we(e)})]}),Ne.jsx(yg,{children:ke(e.status||"completed")}),Ne.jsx(yg,{children:new Date(e.created_at).toLocaleDateString()}),Ne.jsx(yg,{className:"font-medium",children:e.users&&(`${e.users.first_name||""} ${e.users.last_name||""}`.trim()||e.users.email)||"Utilisateur inconnu"}),Ne.jsx(yg,{className:"font-medium",children:(null==(s=e.sale_items)?void 0:s.reduce((e,t)=>e+t.quantity,0))||0}),Ne.jsx(yg,{children:Ne.jsxs(Om,{children:[Ne.jsx(qm,{asChild:!0,children:Ne.jsx(Vh,{variant:"ghost",className:"h-8 w-8 p-0",children:Ne.jsx(zr,{className:"h-4 w-4"})})}),Ne.jsxs(Im,{align:"end",children:[Ne.jsx(Fm,{onClick:()=>ge(e),children:"Voir dtails"}),Ne.jsx(Fm,{onClick:()=>ve(e),children:"Imprimer reu"}),!de(e)&&Ne.jsx(Fm,{onClick:()=>ue(e),children:"Signaler une erreur"}),de(e)&&ne&&Ne.jsx(Fm,{onClick:()=>he(e),children:"Marquer comme rsolue"}),ie&&Ne.jsx(Fm,{onClick:()=>me(e),children:"Modifier la vente"}),(re||oe(e))&&Ne.jsx(Fm,{onClick:()=>je(e),children:"Retour/change"}),(ae||oe(e))&&Ne.jsx(Fm,{className:"text-destructive",onClick:()=>ye(e),children:"Annuler"})]})]})})]},e.id)})})]})}),Ne.jsx("div",{className:"space-y-3 sm:hidden",children:Te.map(e=>{var t,s;return Ne.jsxs("div",{className:"border rounded-lg p-3 "+(de(e)?"border-red-300 bg-red-50/40":""),children:[Ne.jsxs("div",{className:"flex items-start justify-between gap-2",children:[Ne.jsxs("div",{className:"min-w-0",children:[Ne.jsx("p",{className:"font-medium truncate",children:e.sale_code}),Ne.jsx("p",{className:"text-sm text-muted-foreground truncate",children:e.customer_name||"Client anonyme"})]}),Ne.jsx("div",{children:Ne.jsxs("div",{className:"flex items-center gap-2",children:[de(e)&&Ne.jsx(Cp,{variant:"destructive",children:"Erreur"}),ke(e.status||"completed")]})})]}),Ne.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-2 text-sm",children:[Ne.jsxs("div",{children:[Ne.jsx("span",{className:"text-muted-foreground",children:"Magasin"}),Ne.jsx("div",{className:"font-medium",children:(null==(t=e.stores)?void 0:t.name)||""})]}),Ne.jsxs("div",{className:"text-right",children:[Ne.jsx("span",{className:"text-muted-foreground",children:"Montant"}),Ne.jsx("div",{className:"font-medium",children:i(e.total_amount)})]}),Ne.jsxs("div",{className:"col-span-2",children:[Ne.jsx("span",{className:"text-muted-foreground",children:"Produits"}),Ne.jsx("div",{className:"font-medium truncate",children:we(e)})]}),Ne.jsxs("div",{className:"text-right",children:[Ne.jsx("span",{className:"text-muted-foreground",children:"Date"}),Ne.jsx("div",{className:"font-medium",children:new Date(e.created_at).toLocaleDateString()})]}),Ne.jsxs("div",{children:[Ne.jsx("span",{className:"text-muted-foreground",children:"Vendeur"}),Ne.jsx("div",{className:"font-medium",children:e.users&&(`${e.users.first_name||""} ${e.users.last_name||""}`.trim()||e.users.email)||"Inconnu"})]}),Ne.jsxs("div",{className:"text-right",children:[Ne.jsx("span",{className:"text-muted-foreground",children:"Qt vendue"}),Ne.jsx("div",{className:"font-medium",children:(null==(s=e.sale_items)?void 0:s.reduce((e,t)=>e+t.quantity,0))||0})]})]}),Ne.jsx("div",{className:"mt-3 flex items-center justify-end",children:Ne.jsxs(Om,{children:[Ne.jsx(qm,{asChild:!0,children:Ne.jsx(Vh,{variant:"ghost",className:"h-8 w-8 p-0",children:Ne.jsx(zr,{className:"h-4 w-4"})})}),Ne.jsxs(Im,{align:"end",children:[Ne.jsx(Fm,{onClick:()=>ge(e),children:"Voir dtails"}),Ne.jsx(Fm,{onClick:()=>ve(e),children:"Imprimer reu"}),!de(e)&&Ne.jsx(Fm,{onClick:()=>ue(e),children:"Signaler une erreur"}),de(e)&&ne&&Ne.jsx(Fm,{onClick:()=>he(e),children:"Marquer comme rsolue"}),ie&&Ne.jsx(Fm,{onClick:()=>me(e),children:"Modifier la vente"}),(re||oe(e))&&Ne.jsx(Fm,{onClick:()=>je(e),children:"Retour/change"}),(ae||oe(e))&&Ne.jsx(Fm,{className:"text-destructive",onClick:()=>ye(e),children:"Annuler"})]})]})})]},e.id)})}),Ne.jsxs("div",{className:"mt-4 flex items-center justify-center gap-2",children:[Ne.jsx(Vh,{variant:"outline",size:"sm",disabled:Me<=1||"all"===G,onClick:()=>Y(e=>Math.max(1,e-1)),children:"Prcdent"}),Ne.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",Me," / ",Ee]}),Ne.jsx(Vh,{variant:"outline",size:"sm",disabled:Me>=Ee||"all"===G,onClick:()=>Y(e=>Math.min(Ee,e+1)),children:"Suivant"})]})]})})]}),Ne.jsx($y,{open:j,onOpenChange:y,onSuccess:()=>ce()})]}),Ne.jsx(Ly,{open:g,onOpenChange:v,onSuccess:ce}),N&&M&&Ne.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:Ne.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[Ne.jsxs("div",{className:"flex justify-between items-center mb-4",children:[Ne.jsxs("h2",{className:"text-xl font-bold",children:["Dtails de la vente ",M.sale_code]}),Ne.jsx(Vh,{variant:"ghost",onClick:()=>_(!1),children:""})]}),Ne.jsxs("div",{className:"space-y-4",children:[de(M)&&Ne.jsxs("div",{className:"p-3 border border-red-300 bg-red-50 rounded-md",children:[Ne.jsxs("div",{className:"flex items-center gap-2 text-red-700",children:[Ne.jsx(rr,{className:"w-4 h-4"}),Ne.jsx("span",{className:"font-medium",children:"Erreur signale"})]}),Ne.jsx("p",{className:"text-sm text-red-700/90 mt-2 whitespace-pre-line",children:M.notes})]}),Ne.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[Ne.jsxs("div",{children:[Ne.jsx("label",{className:"font-medium text-sm text-gray-600",children:"Code de vente"}),Ne.jsx("p",{className:"text-lg",children:M.sale_code})]}),Ne.jsxs("div",{children:[Ne.jsx("label",{className:"font-medium text-sm text-gray-600",children:"Date"}),Ne.jsx("p",{className:"text-lg",children:new Date(M.created_at).toLocaleDateString("fr-FR")})]}),Ne.jsxs("div",{children:[Ne.jsx("label",{className:"font-medium text-sm text-gray-600",children:"Client"}),Ne.jsx("p",{className:"text-lg",children:M.customer_name||"Client anonyme"})]}),Ne.jsxs("div",{children:[Ne.jsx("label",{className:"font-medium text-sm text-gray-600",children:"Magasin"}),Ne.jsx("p",{className:"text-lg",children:(null==(a=M.stores)?void 0:a.name)||"N/A"})]}),Ne.jsxs("div",{children:[Ne.jsx("label",{className:"font-medium text-sm text-gray-600",children:"Vendeur"}),Ne.jsx("p",{className:"text-lg",children:M.users&&(`${M.users.first_name||""} ${M.users.last_name||""}`.trim()||M.users.email)||"Utilisateur inconnu"})]}),Ne.jsxs("div",{children:[Ne.jsx("label",{className:"font-medium text-sm text-gray-600",children:"Statut"}),Ne.jsx("div",{className:"mt-1",children:ke(M.status||"completed")})]})]}),Ne.jsxs("div",{children:[Ne.jsx("label",{className:"font-medium text-sm text-gray-600",children:"Produits vendus"}),Ne.jsx("div",{className:"mt-2 space-y-2",children:(null==(n=M.sale_items)?void 0:n.map((e,t)=>Ne.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[Ne.jsxs("div",{children:[Ne.jsxs("span",{className:"font-medium",children:["Produit #",t+1]}),Ne.jsxs("span",{className:"text-sm text-gray-600 ml-2",children:["Qty: ",e.quantity," x ",i(e.unit_price)]})]}),Ne.jsx("span",{className:"font-bold",children:i(e.total_price)})]},t)))||Ne.jsx("p",{className:"text-gray-500",children:"Aucun dtail produit disponible"})})]}),Ne.jsxs("div",{className:"border-t pt-4",children:[Ne.jsxs("div",{className:"flex justify-between items-center text-xl font-bold",children:[Ne.jsx("span",{children:"Total"}),Ne.jsx("span",{children:i(M.total_amount)})]}),Ne.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:["Paiement: ",_e(M.payment_method)]})]})]}),Ne.jsx("div",{className:"flex justify-end gap-2 mt-6",children:Ne.jsx(Vh,{variant:"outline",onClick:()=>_(!1),children:"Fermer"})})]})}),k&&M&&Ne.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:Ne.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[Ne.jsxs("div",{className:"flex justify-between items-center mb-4",children:[Ne.jsx("h2",{className:"text-xl font-bold",children:"Retour/change"}),Ne.jsx(Vh,{variant:"ghost",onClick:()=>S(!1),children:""})]}),Ne.jsxs("div",{className:"space-y-4",children:[Ne.jsxs("p",{className:"text-gray-600",children:["Vente: ",Ne.jsx("span",{className:"font-medium",children:M.sale_code})]}),Ne.jsxs("p",{className:"text-gray-600",children:["Client: ",Ne.jsx("span",{className:"font-medium",children:M.customer_name||"Client anonyme"})]}),Ne.jsxs("p",{className:"text-gray-600",children:["Montant: ",Ne.jsx("span",{className:"font-medium",children:i(M.total_amount)})]}),Ne.jsxs("div",{className:"text-center py-8",children:[Ne.jsx(rr,{className:"w-16 h-16 text-orange-500 mx-auto mb-4"}),Ne.jsx("p",{className:"text-gray-600",children:"Cette fonctionnalit sera bientt disponible pour grer les retours et changes."})]})]}),Ne.jsx("div",{className:"flex justify-end gap-2 mt-6",children:Ne.jsx(Vh,{variant:"outline",onClick:()=>S(!1),children:"Fermer"})})]})}),C&&M&&Ne.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:Ne.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[Ne.jsxs("div",{className:"flex justify-between items-center mb-4",children:[Ne.jsx("h2",{className:"text-xl font-bold",children:"Annuler la vente"}),Ne.jsx(Vh,{variant:"ghost",onClick:()=>E(!1),children:""})]}),Ne.jsxs("div",{className:"space-y-4",children:[Ne.jsxs("div",{className:"text-center py-4",children:[Ne.jsx(rr,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),Ne.jsx("p",{className:"text-gray-600 mb-2",children:"tes-vous sr de vouloir annuler cette vente ?"}),Ne.jsxs("p",{className:"text-sm text-gray-500",children:[Ne.jsx("strong",{children:"Vente:"})," ",M.sale_code,Ne.jsx("br",{}),Ne.jsx("strong",{children:"Client:"})," ",M.customer_name||"Client anonyme",Ne.jsx("br",{}),Ne.jsx("strong",{children:"Montant:"})," ",i(M.total_amount)]})]}),Ne.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:Ne.jsx("p",{className:"text-sm text-red-700",children:" Cette action est irrversible. La vente sera marque comme annule."})})]}),Ne.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[Ne.jsx(Vh,{variant:"outline",onClick:()=>E(!1),children:"Annuler"}),Ne.jsxs(Vh,{variant:"destructive",onClick:async()=>{if(M)try{const{error:e}=await Dh.from("sales").update({status:"cancelled",updated_at:(new Date).toISOString()}).eq("id",M.id);if(e)throw e;l({title:"Vente annule",description:"La vente a t annule avec succs"}),E(!1),T(null),ce()}catch(e){l({title:"Erreur",description:"Impossible d'annuler la vente",variant:"destructive"})}},className:"gap-2",children:[Ne.jsx(rr,{className:"w-4 h-4"}),"Confirmer l'annulation"]})]})]})}),A&&M&&Ne.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[9999]",children:Ne.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[Ne.jsxs("div",{className:"flex justify-between items-center mb-4",children:[Ne.jsx("h2",{className:"text-xl font-bold",children:"Signaler une erreur"}),Ne.jsx(Vh,{variant:"ghost",onClick:()=>P(!1),children:""})]}),Ne.jsxs("p",{className:"text-sm text-muted-foreground mb-2",children:["Vente: ",Ne.jsx("span",{className:"font-medium",children:M.sale_code})]}),Ne.jsx(Tg,{placeholder:"Dcrivez l'erreur (ex: mauvais produit, mauvaise quantit, client, etc.)",value:I,onChange:e=>F(e.target.value),className:"min-h-[120px]"}),Ne.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[Ne.jsx(Vh,{variant:"outline",onClick:()=>P(!1),children:"Annuler"}),Ne.jsx(Vh,{onClick:async()=>{if(M)try{const e=`${(null==o?void 0:o.first_name)||""} ${(null==o?void 0:o.last_name)||""}`.trim()||(null==o?void 0:o.email)||"Utilisateur",t=`[ERROR] Signale par ${e} le ${(new Date).toLocaleString("fr-FR")}\nRaison: ${I||"Non spcifie"}\n---\n`+(M.notes||""),{error:s}=await Dh.from("sales").update({notes:t,updated_at:(new Date).toISOString()}).eq("id",M.id);if(s)throw s;l({title:"Erreur signale",description:"La vente a t marque pour rvision."}),P(!1),T(null),ce()}catch(zw){l({title:"Permission refuse ou erreur",description:"Impossible de signaler l'erreur.",variant:"destructive"})}},children:"Envoyer"})]})]})}),D&&M&&Ne.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[9999]",children:Ne.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[Ne.jsxs("div",{className:"flex justify-between items-center mb-4",children:[Ne.jsx("h2",{className:"text-xl font-bold",children:"Rsoudre l'erreur"}),Ne.jsx(Vh,{variant:"ghost",onClick:()=>R(!1),children:""})]}),Ne.jsxs("p",{className:"text-sm text-muted-foreground mb-2",children:["Vente: ",Ne.jsx("span",{className:"font-medium",children:M.sale_code})]}),Ne.jsx(Tg,{placeholder:"Note de rsolution (optionnelle)",value:L,onChange:e=>$(e.target.value),className:"min-h-[100px]"}),Ne.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[Ne.jsx(Vh,{variant:"outline",onClick:()=>R(!1),children:"Annuler"}),Ne.jsx(Vh,{onClick:async()=>{if(M)try{const e=`${(null==o?void 0:o.first_name)||""} ${(null==o?void 0:o.last_name)||""}`.trim()||(null==o?void 0:o.email)||"Admin",t=(M.notes||"").replace("[ERROR]","[RESOLVED]")+`\n[RESOLUTION] Par ${e} le ${(new Date).toLocaleString("fr-FR")}\n${L||""}`,{error:s}=await Dh.from("sales").update({notes:t,updated_at:(new Date).toISOString()}).eq("id",M.id);if(s)throw s;l({title:"Erreur rsolue",description:"La vente a t marque comme rsolue."}),R(!1),T(null),ce()}catch(zw){l({title:"Erreur",description:"Impossible de marquer comme rsolue.",variant:"destructive"})}},children:"Marquer rsolue"})]})]})}),O&&M&&Ne.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[9999]",children:Ne.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-lg w-full mx-4 max-h-[90vh] overflow-y-auto",children:[Ne.jsxs("div",{className:"flex justify-between items-center mb-4",children:[Ne.jsx("h2",{className:"text-xl font-bold",children:"Modifier la vente"}),Ne.jsx(Vh,{variant:"ghost",onClick:()=>q(!1),children:""})]}),Ne.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[Ne.jsxs("div",{children:[Ne.jsx("label",{className:"text-sm font-medium",children:"Nom du client"}),Ne.jsx(Bh,{value:z.customer_name||"",onChange:e=>U(t=>({...t,customer_name:e.target.value}))})]}),Ne.jsxs("div",{children:[Ne.jsx("label",{className:"text-sm font-medium",children:"Email"}),Ne.jsx(Bh,{type:"email",value:z.customer_email||"",onChange:e=>U(t=>({...t,customer_email:e.target.value}))})]}),Ne.jsxs("div",{children:[Ne.jsx("label",{className:"text-sm font-medium",children:"Tlphone"}),Ne.jsx(Bh,{value:z.customer_phone||"",onChange:e=>U(t=>({...t,customer_phone:e.target.value}))})]}),Ne.jsxs("div",{children:[Ne.jsx("label",{className:"text-sm font-medium",children:"Mthode de paiement"}),Ne.jsxs(Kf,{value:z.payment_method||"",onValueChange:e=>U(t=>({...t,payment_method:e})),children:[Ne.jsx(Gf,{children:Ne.jsx(Yf,{placeholder:"Mthode"})}),Ne.jsxs(Xf,{children:[Ne.jsx(Zf,{value:"cash",children:"Espces"}),Ne.jsx(Zf,{value:"card",children:"Carte"}),Ne.jsx(Zf,{value:"mobile_money",children:"Mobile Money"}),Ne.jsx(Zf,{value:"bank_transfer",children:"Virement bancaire"}),Ne.jsx(Zf,{value:"check",children:"Chque"})]})]})]}),Ne.jsxs("div",{className:"md:col-span-2",children:[Ne.jsx("label",{className:"text-sm font-medium",children:"Notes"}),Ne.jsx(Tg,{value:z.notes||"",onChange:e=>U(t=>({...t,notes:e.target.value})),className:"min-h-[120px]"}),Ne.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Astuce: utilisez des notes claires. Les balises [ERROR] et [RESOLVED] sont gres automatiquement par les actions."})]})]}),Ne.jsxs("div",{className:"mt-6",children:[Ne.jsxs("div",{className:"flex items-center justify-between mb-2",children:[Ne.jsx("h3",{className:"font-semibold",children:"Articles de la vente"}),Ne.jsx("span",{className:"text-xs text-muted-foreground",children:"Qt/produit non ditables ici"})]}),Ne.jsx("div",{className:"overflow-x-auto",children:Ne.jsxs(fg,{children:[Ne.jsx(xg,{children:Ne.jsxs(vg,{children:[Ne.jsx(jg,{children:"Produit"}),Ne.jsx(jg,{children:"SKU"}),Ne.jsx(jg,{children:"Qt"}),Ne.jsx(jg,{children:"PU"}),Ne.jsx(jg,{children:"Raison remise"}),Ne.jsx(jg,{children:"Total"})]})}),Ne.jsx(gg,{children:W.map(e=>{const t=(Number(e.unit_price)||0)*(Number(e.quantity)||0);return Ne.jsxs(vg,{children:[Ne.jsx(yg,{className:"font-medium whitespace-nowrap",children:e.product_name}),Ne.jsx(yg,{className:"whitespace-nowrap",children:e.product_sku}),Ne.jsx(yg,{children:e.quantity}),Ne.jsx(yg,{className:"min-w-[120px]",children:Ne.jsx(Bh,{type:"number",step:"0.01",value:String(e.unit_price),onChange:t=>((e,t)=>{const s=parseFloat(t);V(t=>t.map(t=>t.id===e?{...t,unit_price:isNaN(s)?0:s}:t))})(e.id,t.target.value)})}),Ne.jsx(yg,{className:"min-w-[200px]",children:Ne.jsx(Bh,{value:e.discount_reason||"",onChange:t=>{return s=e.id,r=t.target.value,void V(e=>e.map(e=>e.id===s?{...e,discount_reason:r}:e));var s,r},placeholder:"Si prix infrieur"})}),Ne.jsx(yg,{className:"font-medium",children:i(t)})]},e.id)})})]})}),Ne.jsxs("div",{className:"mt-4 space-y-1",children:[Ne.jsxs("div",{className:"flex justify-between",children:[Ne.jsx("span",{children:"Sous-total"}),Ne.jsx("span",{children:i(pe())})]}),Ne.jsxs("div",{className:"flex justify-between",children:[Ne.jsxs("span",{children:["TVA (",B,"%)"]}),Ne.jsx("span",{children:i(fe())})]}),Ne.jsxs("div",{className:"flex justify-between font-semibold text-lg",children:[Ne.jsx("span",{children:"Total"}),Ne.jsx("span",{children:i(pe()+fe())})]})]})]}),Ne.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[Ne.jsx(Vh,{variant:"outline",onClick:()=>q(!1),children:"Annuler"}),Ne.jsx(Vh,{onClick:async()=>{if(M)try{const e=M.sale_items||[],t=W.filter(t=>{const s=e.find(e=>e.id===t.id);if(!s)return!1;const r=Number(s.unit_price)!==Number(t.unit_price),a=(s.discount_reason||"")!==(t.discount_reason||"");return r||a});if(t.length>0){const e=t.map(e=>{const t=(Number(e.unit_price)||0)*(Number(e.quantity)||0);return Dh.from("sale_items").update({unit_price:e.unit_price,total_price:t,discount_reason:e.discount_reason||null}).eq("id",e.id)}),s=(await Promise.all(e)).find(e=>e.error);if(s&&s.error)throw s.error}const s=W.reduce((e,t)=>e+(Number(t.unit_price)||0)*(Number(t.quantity)||0),0),r=s*(B/100),a=s+r,n={customer_name:z.customer_name||null,customer_email:z.customer_email||null,customer_phone:z.customer_phone||null,payment_method:z.payment_method,notes:z.notes??null,subtotal:s,tax_amount:r,total_amount:a,updated_at:(new Date).toISOString()},{error:i}=await Dh.from("sales").update(n).eq("id",M.id);if(i)throw i;l({title:"Vente mise  jour",description:"Les informations ont t enregistres."}),q(!1),T(null),ce()}catch(zw){l({title:"Erreur",description:"Impossible de modifier la vente.",variant:"destructive"})}},children:"Enregistrer"})]})]})})]})}function Uy({open:e,onOpenChange:t,onSuccess:s}){const{user:r,userProfile:a}=Ih(),[n,i]=Nt.useState(!1),[o,l]=Nt.useState(!1),[c,d]=Nt.useState(""),[u,h]=Nt.useState(null),[m,p]=Nt.useState([]),[f,x]=Nt.useState({returned_product_id:"",returned_quantity:1,product_condition:"good",new_product_id:"",new_quantity:1,reason:""}),{toast:g}=is();Nt.useEffect(()=>{e&&(v(),j())},[e]);const v=async()=>{try{const{data:e,error:t}=await Dh.from("products").select("*").eq("is_active",!0).order("name");if(t)throw t;p(e||[])}catch(e){g({title:"Erreur",description:"Impossible de charger les produits",variant:"destructive"})}},j=()=>{d(""),h(null),x({returned_product_id:"",returned_quantity:1,product_condition:"good",new_product_id:"",new_quantity:1,reason:""})},y=()=>{if(!f.new_product_id||!f.returned_product_id)return 0;const e=null==u?void 0:u.sale_items.find(e=>e.product_id===f.returned_product_id),t=m.find(e=>e.id===f.new_product_id);if(!e||!t)return 0;const s=e.unit_price*f.returned_quantity;return t.current_sale_price*f.new_quantity-s},b=null==u?void 0:u.sale_items.find(e=>e.product_id===f.returned_product_id),w=m.find(e=>e.id===f.new_product_id),N=y();return Ne.jsx(bg,{open:e,onOpenChange:t,children:Ne.jsxs(kg,{className:"w-[92vw] max-w-md sm:max-w-xl md:max-w-3xl max-h-[90vh] overflow-y-auto",children:[Ne.jsxs(Sg,{children:[Ne.jsxs(Eg,{className:"flex items-center gap-2",children:[Ne.jsx(Gr,{className:"w-5 h-5"}),"Nouveau Retour/change"]}),Ne.jsx(Mg,{children:"Traiter un retour ou un change de produit"})]}),Ne.jsxs("div",{className:"space-y-6",children:[Ne.jsxs(Um,{children:[Ne.jsx(Wm,{children:Ne.jsx(Vm,{children:"1. Rechercher la vente"})}),Ne.jsxs(Hm,{className:"space-y-4",children:[Ne.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[Ne.jsxs("div",{className:"flex-1",children:[Ne.jsx(Zm,{htmlFor:"sale_code",children:"Code de vente"}),Ne.jsx(Bh,{id:"sale_code",value:c,onChange:e=>d(e.target.value),placeholder:"Ex: VTE123456",className:"h-10 sm:h-12 text-sm sm:text-base"})]}),Ne.jsx("div",{className:"flex items-end",children:Ne.jsxs(Vh,{type:"button",onClick:async()=>{if(c.trim()){l(!0);try{const{data:e,error:t}=await Dh.from("sales").select("\n          *,\n          sale_items (\n            id,\n            product_id,\n            quantity,\n            unit_price,\n            products (\n              id,\n              name,\n              sku\n            )\n          )\n        ").eq("sale_code",c.trim()).single();if(t)throw t;e?(h(e),g({title:"Vente trouve",description:`Vente ${e.sale_code} trouve`})):g({title:"Vente non trouve",description:"Aucune vente avec ce code",variant:"destructive"})}catch(e){const t=nv(e);g({title:"Erreur",description:t.error,variant:"destructive"})}finally{l(!1)}}else g({title:"Code requis",description:"Veuillez saisir un code de vente",variant:"destructive"})},disabled:o,className:"w-full sm:w-auto",children:[o?Ne.jsx(Rr,{className:"mr-2 h-4 w-4 animate-spin"}):Ne.jsx(Xr,{className:"mr-2 h-4 w-4"}),"Rechercher"]})})]}),u&&Ne.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[Ne.jsx("h4",{className:"font-medium mb-2",children:"Informations de la vente"}),Ne.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[Ne.jsxs("div",{children:[Ne.jsxs("p",{children:[Ne.jsx("strong",{children:"Code:"})," ",u.sale_code]}),Ne.jsxs("p",{children:[Ne.jsx("strong",{children:"Date:"})," ",new Date(u.created_at).toLocaleDateString()]})]}),Ne.jsxs("div",{children:[Ne.jsxs("p",{children:[Ne.jsx("strong",{children:"Client:"})," ",u.customer_name||"Client anonyme"]}),Ne.jsxs("p",{children:[Ne.jsx("strong",{children:"Email:"})," ",u.customer_email||"Non renseign"]})]})]})]})]})]}),u&&Ne.jsxs("form",{onSubmit:async e=>{var r,n;if(e.preventDefault(),!u||!f.returned_product_id||!f.reason)return void g({title:"Donnes manquantes",description:"Veuillez remplir tous les champs requis",variant:"destructive"});const o=b;if(o)if(f.returned_quantity>(o.quantity||0))g({title:"Quantit invalide",description:"La quantit retourne dpasse la quantit vendue",variant:"destructive"});else{i(!0);try{const e=`RET${Date.now().toString().slice(-6)}${Math.random().toString(36).substring(2,5).toUpperCase()}`,l=y();if(!(null==a?void 0:a.id)||!(null==a?void 0:a.role))return g({title:"Erreur",description:"Profil utilisateur invalide",variant:"destructive"}),void i(!1);const c=u;if(!c)return g({title:"Erreur",description:"Vente d'origine introuvable",variant:"destructive"}),void i(!1);const{data:d}=await Dh.from("sales").select("store_id").eq("id",c.id).single();if(!(!!(null==d?void 0:d.store_id)&&await qy(a.id,d.store_id,a.role)))return g({title:"Magasin non assign",description:"Vous devez tre assign au magasin de la vente pour traiter un retour/change.",variant:"destructive"}),void i(!1);if(f.new_product_id){const{data:e,error:t}=await Dh.from("product_stores").select("current_stock").eq("product_id",f.new_product_id).eq("store_id",d.store_id).limit(1);if((e&&e.length>0?e[0].current_stock:0)<f.new_quantity)return g({title:"Stock insuffisant",description:"Stock insuffisant pour le produit d'change dans ce magasin",variant:"destructive"}),void i(!1)}const{data:h,error:m}=await Dh.from("returns").insert({return_code:e,original_sale_id:u.id,customer_name:u.customer_name||"Client anonyme",customer_email:u.customer_email||null,customer_phone:u.customer_phone||null,return_reason:f.reason,return_status:"pending",processed_by:a.id,processed_at:null}).select().single();if(m)throw m;const p=w,x=p?p.current_sale_price:null,v=p?x*f.new_quantity:null,{error:j}=await Dh.from("return_items").insert({return_id:h.id,original_sale_item_id:null==o?void 0:o.id,product_id:null==o?void 0:o.product_id,product_name:null==(r=null==o?void 0:o.products)?void 0:r.name,product_sku:null==(n=null==o?void 0:o.products)?void 0:n.sku,returned_quantity:f.returned_quantity,original_unit_price:null==o?void 0:o.unit_price,original_total_price:(null==o?void 0:o.unit_price)*f.returned_quantity,exchange_product_id:f.new_product_id||null,exchange_quantity:f.new_product_id?f.new_quantity:null,exchange_unit_price:x,exchange_total_price:v,price_difference:l});if(j)throw j;g({title:"Retour/change enregistr",description:`Code: ${e}`}),s(),t(!1)}catch(l){const e=nv(l);g({title:"Erreur",description:e.error,variant:"destructive"})}finally{i(!1)}}else g({title:"Produit manquant",description:"Slectionnez le produit  retourner",variant:"destructive"})},className:"space-y-6",children:[Ne.jsxs(Um,{children:[Ne.jsx(Wm,{children:Ne.jsx(Vm,{children:"2. Produit  retourner"})}),Ne.jsx(Hm,{className:"space-y-4",children:Ne.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{children:"Produit"}),Ne.jsx(av,{value:f.returned_product_id,onValueChange:e=>x(t=>({...t,returned_product_id:e})),options:u.sale_items.map(e=>({value:e.product_id,label:`${e.products.name} - ${e.products.sku} (Qt: ${e.quantity})`})),placeholder:"Slectionner",triggerClassName:"h-10 sm:h-12"})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{children:"Quantit  retourner"}),Ne.jsx(Bh,{type:"number",min:"1",max:(null==b?void 0:b.quantity)||1,value:f.returned_quantity,onChange:e=>x(t=>({...t,returned_quantity:parseInt(e.target.value)||1})),className:"h-10 sm:h-12 text-sm sm:text-base"})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{children:"tat du produit"}),Ne.jsxs(Kf,{value:f.product_condition,onValueChange:e=>x(t=>({...t,product_condition:e})),children:[Ne.jsx(Gf,{className:"h-10 sm:h-12",children:Ne.jsx(Yf,{})}),Ne.jsxs(Xf,{children:[Ne.jsx(Zf,{value:"good",children:"Bon tat"}),Ne.jsx(Zf,{value:"damaged",children:"Endommag"}),Ne.jsx(Zf,{value:"defective",children:"Dfectueux"})]})]})]})]})})]}),Ne.jsxs(Um,{children:[Ne.jsx(Wm,{children:Ne.jsx(Vm,{children:"3. change (optionnel)"})}),Ne.jsxs(Hm,{className:"space-y-4",children:[Ne.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{children:"Nouveau produit"}),Ne.jsx(av,{value:f.new_product_id,onValueChange:e=>x(t=>({...t,new_product_id:e})),options:m.map(e=>({value:e.id,label:`${e.name} - ${e.sku} (${e.current_sale_price})`})),placeholder:"Aucun change",triggerClassName:"h-10 sm:h-12"})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{children:"Quantit"}),Ne.jsx(Bh,{type:"number",min:"1",value:f.new_quantity,onChange:e=>x(t=>({...t,new_quantity:parseInt(e.target.value)||1})),disabled:!f.new_product_id,className:"h-10 sm:h-12 text-sm sm:text-base disabled:opacity-60"})]})]}),f.new_product_id&&w&&b&&Ne.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[Ne.jsx("h4",{className:"font-medium mb-2",children:"Calcul de la diffrence"}),Ne.jsxs("div",{className:"text-sm space-y-1",children:[Ne.jsxs("p",{children:["Valeur retourne: ",(b.unit_price*f.returned_quantity).toFixed(2),""]}),Ne.jsxs("p",{children:["Valeur nouveau produit: ",(w.current_sale_price*f.new_quantity).toFixed(2),""]}),Ne.jsxs("p",{className:"font-medium "+(N>=0?"text-warning":"text-success"),children:["Diffrence: ",N>=0?"+":"",N.toFixed(2),"",N>0&&" ( payer)",N<0&&" ( rembourser)"]})]})]})]})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{htmlFor:"reason",children:"Raison du retour/change *"}),Ne.jsx(Tg,{id:"reason",value:f.reason,onChange:e=>x(t=>({...t,reason:e.target.value})),placeholder:"Expliquez la raison du retour ou de l'change...",required:!0,className:"text-sm sm:text-base"})]}),Ne.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-2",children:[Ne.jsx(Vh,{type:"button",variant:"outline",onClick:()=>t(!1),className:"w-full sm:w-auto",children:"Annuler"}),Ne.jsxs(Vh,{type:"submit",disabled:n,className:"w-full sm:w-auto",children:[n&&Ne.jsx(Rr,{className:"mr-2 h-4 w-4 animate-spin"}),"Enregistrer"]})]})]})]})]})})}function Wy(){var e;const{formatAmount:t}=rx(),{userProfile:s}=Ih(),{toast:r}=is(),[a,n]=Nt.useState(""),[i,o]=Nt.useState([]),[l,c]=Nt.useState(!0),[d,u]=Nt.useState(null),[h,m]=Nt.useState(!1),[p,f]=Nt.useState(null),[x,g]=Nt.useState(!1),[v,j]=Nt.useState([]),[y,b]=Nt.useState(1),[w,N]=Nt.useState(20),_=(null==s?void 0:s.role)&&["Vendeur","Manager","Admin","SuperAdmin"].includes(s.role),k=(null==s?void 0:s.role)&&["Vendeur","Manager","Admin","SuperAdmin"].includes(s.role),S=(null==s?void 0:s.role)&&["Manager","Admin","SuperAdmin"].includes(s.role);Nt.useEffect(()=>{k&&C()},[k]);const C=async()=>{try{c(!0),u(null);let e=Dh.from("returns").select("\n          *,\n          original_sale:sales(sale_code, customer_name)\n        ").order("created_at",{ascending:!1});S||(e=e.eq("processed_by",null==s?void 0:s.id));const{data:t,error:r}=await e;if(r)throw r;o(t||[])}catch(e){u("Impossible de charger les retours"),r({title:"Erreur",description:"Impossible de charger les retours",variant:"destructive"})}finally{c(!1)}},E=e=>"exchange"===e.return_type?Ne.jsxs(Cp,{variant:"outline",className:"gap-1 bg-blue-50 text-blue-700 border-blue-200",children:[Ne.jsx(ar,{className:"w-3 h-3"}),"change"]}):Ne.jsxs(Cp,{variant:"outline",className:"gap-1",children:[Ne.jsx(Qr,{className:"w-3 h-3"}),"Retour"]}),M=e=>{switch(e){case"completed":return Ne.jsx(Cp,{variant:"default",className:"bg-success text-success-foreground",children:"Trait"});case"pending":return Ne.jsx(Cp,{variant:"secondary",children:"En cours"});case"refunded":return Ne.jsx(Cp,{variant:"outline",className:"bg-primary/10 text-primary",children:"Rembours"});default:return Ne.jsx(Cp,{variant:"outline",children:e})}},T=()=>{_?m(!0):r({title:"Permission refuse",description:"Vous n'avez pas les permissions pour crer des retours",variant:"destructive"})},A=e=>{k?(f(e),O(e.id,e),g(!0)):r({title:"Permission refuse",description:"Vous n'avez pas les permissions pour voir les dtails",variant:"destructive"})},P=e=>{k?q(e):r({title:"Permission refuse",description:"Vous n'avez pas les permissions pour imprimer",variant:"destructive"})},D=e=>{S?(f(e),m(!0)):r({title:"Permission refuse",description:"Vous n'avez pas les permissions pour modifier",variant:"destructive"})},R=async e=>{if(S)try{const{error:t}=await Dh.from("returns").update({return_status:"cancelled"}).eq("id",e.id);if(t)throw t;r({title:"Retour annul",description:"Le retour a t annul avec succs"}),C()}catch(t){r({title:"Erreur",description:"Impossible d'annuler le retour",variant:"destructive"})}else r({title:"Permission refuse",description:"Vous n'avez pas les permissions pour annuler",variant:"destructive"})},O=async(e,t)=>{try{const{data:s,error:r}=await Dh.from("return_items").select("product_name, product_sku, returned_quantity, original_unit_price, original_total_price, exchange_product_id, exchange_quantity, exchange_total_price, price_difference").eq("return_id",e);if(r)throw r;j(s||[]);const a=t||p;if(null==a?void 0:a.processed_by){const{data:e,error:t}=await Dh.from("users").select("first_name, last_name, email").eq("id",a.processed_by).single();if(!t&&e){const t=`${e.first_name||""} ${e.last_name||""}`.trim()||e.email||"Utilisateur inconnu";f(e=>({...e,processed_by_name:t}))}}}catch(zw){j([]),r({title:"Erreur",description:"Impossible de charger les dtails du retour",variant:"destructive"})}},q=async e=>{var s;try{let a=v;if(!a||0===a.length){const{data:t}=await Dh.from("return_items").select("product_name, product_sku, returned_quantity, original_unit_price, original_total_price, exchange_product_id, exchange_quantity, exchange_total_price, price_difference").eq("return_id",e.id);a=t||[]}const n=`\n===============================\nBON DE RETOUR / ECHANGE - ${e.return_code}\n===============================\n\nDate: ${new Date(e.created_at).toLocaleDateString("fr-FR")}\nClient: ${e.customer_name||"Client anonyme"}\nVente d'origine: ${(null==(s=e.original_sale)?void 0:s.sale_code)||"N/A"}\nType: ${"exchange"===e.return_type?"ECHANGE":"RETOUR"}\nStatut: ${e.return_status}\n\n--- LIGNES ---\n${(a||[]).map((e,s)=>{const r=`${s+1}. ${[e.product_name,e.product_sku].filter(Boolean).join(" ")} - Qt: ${e.returned_quantity} x ${t(e.original_unit_price)} = ${t(e.original_total_price)}`;return e.exchange_product_id?`${r}\n   Echange: Qt ${e.exchange_quantity} | Total ${t(e.exchange_total_price||0)} | Diffrence ${t(e.price_difference||0)}`:r}).join("\n")}\n\n===============================\n`,i=window.open("","_blank");i&&(i.document.write(`\n          <html>\n            <head>\n              <title>Retour ${e.return_code}</title>\n              <style>body{font-family:monospace;font-size:12px;white-space:pre-wrap}</style>\n            </head>\n            <body>\n              <div>${n.replace(/</g,"&lt;")}</div>\n              <script>window.print(); window.close();<\/script>\n            </body>\n          </html>\n        `),i.document.close(),r({title:"Impression lance",description:"Le bon de retour a t envoy  l'imprimante"}))}catch(zw){r({title:"Erreur d'impression",description:"Impossible d'imprimer le bon",variant:"destructive"})}},{totalReturns:I,totalExchanges:F,totalAmount:L}=Nt.useMemo(()=>{const e=i.filter(e=>"exchange"!==e.return_type),t=i.filter(e=>"exchange"===e.return_type),s=i.reduce((e,t)=>e+Math.abs(t.price_difference||0),0);return{totalReturns:e.length,totalExchanges:t.length,totalAmount:s}},[i]),$=Nt.useMemo(()=>{const e=e=>e?String(e).normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase():"",t=e(a).split(/\s+/).filter(Boolean);return 0===t.length?i:i.filter(s=>{var r;const a=[s.return_code,null==(r=s.original_sale)?void 0:r.sale_code,s.customer_name,s.return_reason],n=e(a.filter(Boolean).join(" "));return t.every(e=>n.includes(e))})},[i,a]),z="all"===w?1:Math.max(1,Math.ceil($.length/w)),U=Math.min(y,z),W="all"===w?$:$.slice((U-1)*w,U*w);return Nt.useEffect(()=>{b(1)},[w,a]),d&&!k?Ne.jsxs("div",{className:"space-y-6",children:[Ne.jsx("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:Ne.jsxs("div",{children:[Ne.jsxs("h1",{className:"text-2xl md:text-3xl font-bold flex items-center gap-2",children:[Ne.jsx(Gr,{className:"w-7 h-7 text-primary"}),"Retours & changes"]}),Ne.jsx("p",{className:"text-muted-foreground",children:"Grez les retours et changes de vos clients"})]})}),Ne.jsxs("div",{className:"bg-destructive/10 border border-destructive/20 rounded-lg p-6 text-center",children:[Ne.jsx(rr,{className:"w-12 h-12 text-destructive mx-auto mb-4"}),Ne.jsx("h3",{className:"text-lg font-semibold text-destructive mb-2",children:"Accs refus"}),Ne.jsx("p",{className:"text-destructive/80 mb-4",children:"Vous n'avez pas les permissions pour accder  cette page"})]})]}):Ne.jsxs("div",{className:"space-y-6",children:[Ne.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[Ne.jsxs("div",{children:[Ne.jsxs("h1",{className:"text-2xl md:text-3xl font-bold flex items-center gap-2",children:[Ne.jsx(Gr,{className:"w-7 h-7 text-primary"}),"Retours & changes"]}),Ne.jsx("p",{className:"text-muted-foreground",children:"Grez les retours et changes de vos clients"})]}),_&&Ne.jsxs(Vh,{onClick:T,size:"touch",className:"gap-2",children:[Ne.jsx(Yr,{className:"w-4 h-4"}),"Nouveau retour/change"]})]}),d?Ne.jsx(Um,{className:"bg-destructive/10 border border-destructive/20",children:Ne.jsxs(Hm,{className:"p-6 text-center",children:[Ne.jsx(rr,{className:"w-12 h-12 text-destructive mx-auto mb-4"}),Ne.jsx("h3",{className:"text-lg font-semibold text-destructive mb-2",children:"Erreur de chargement"}),Ne.jsx("p",{className:"text-destructive/80 mb-4",children:d}),Ne.jsxs(Vh,{onClick:()=>{u(null),C()},variant:"outline",className:"gap-2",children:[Ne.jsx(Gr,{className:"w-4 h-4"}),"Ressayer"]})]})}):Ne.jsxs(Ne.Fragment,{children:[Ne.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Ne.jsx(Vm,{className:"text-sm font-medium",children:"Total retours"}),Ne.jsx(Qr,{className:"h-4 w-4 text-muted-foreground"})]}),Ne.jsxs(Hm,{children:[Ne.jsx("div",{className:"text-2xl font-bold",children:I}),Ne.jsx("p",{className:"text-xs text-muted-foreground",children:"Ce mois-ci"})]})]}),Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Ne.jsx(Vm,{className:"text-sm font-medium",children:"Total changes"}),Ne.jsx(ar,{className:"h-4 w-4 text-muted-foreground"})]}),Ne.jsxs(Hm,{children:[Ne.jsx("div",{className:"text-2xl font-bold",children:F}),Ne.jsx("p",{className:"text-xs text-muted-foreground",children:"Ce mois-ci"})]})]}),Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Ne.jsx(Vm,{className:"text-sm font-medium",children:"Montant impact"}),Ne.jsx(Gr,{className:"h-4 w-4 text-warning"})]}),Ne.jsxs(Hm,{children:[Ne.jsx("div",{className:"text-2xl font-bold",children:t(L)}),Ne.jsx("p",{className:"text-xs text-muted-foreground",children:"Total transactions"})]})]})]}),Ne.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[Ne.jsxs("div",{className:"relative flex-1",children:[Ne.jsx(Xr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),Ne.jsx(Bh,{placeholder:"Rechercher un retour/change...",value:a,onChange:e=>n(e.target.value),className:"pl-10 h-10 sm:h-12 text-sm sm:text-base"})]}),Ne.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-2 w-full sm:w-auto",children:[Ne.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-auto",children:[Ne.jsx("span",{className:"text-sm text-muted-foreground hidden sm:inline",children:"Par page"}),Ne.jsxs(Kf,{value:String(w),onValueChange:e=>N("all"===e?"all":parseInt(e)),children:[Ne.jsx(Gf,{className:"h-9 w-full sm:w-[92px]",children:Ne.jsx(Yf,{placeholder:"20"})}),Ne.jsxs(Xf,{children:[Ne.jsx(Zf,{value:"all",children:"All"}),Ne.jsx(Zf,{value:"10",children:"10"}),Ne.jsx(Zf,{value:"20",children:"20"}),Ne.jsx(Zf,{value:"50",children:"50"})]})]})]}),Ne.jsxs(Vh,{variant:"outline",size:"touch",className:"gap-2 w-full sm:w-auto",children:[Ne.jsx(Mr,{className:"w-4 h-4"}),"Filtres"]})]})]}),Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{children:[Ne.jsx(Vm,{children:"Historique des retours et changes"}),Ne.jsx(Bm,{children:"Liste de toutes les oprations de retour et d'change"})]}),Ne.jsx(Hm,{children:l?Ne.jsx("div",{className:"space-y-3",children:Array.from({length:5}).map((e,t)=>Ne.jsxs("div",{className:"flex items-center space-x-4 p-4 border rounded-lg",children:[Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-4 w-24 rounded"}),Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-4 w-20 rounded"}),Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-4 w-28 rounded"}),Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-4 w-32 rounded"}),Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-4 w-48 rounded"}),Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-4 w-20 rounded"}),Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-8 w-24 rounded"})]},t))}):0===$.length?Ne.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[Ne.jsx(Gr,{className:"w-16 h-16 text-muted-foreground/20 mb-4"}),Ne.jsx("p",{className:"text-muted-foreground mb-4",children:"Aucun retour/change trouv"}),_&&Ne.jsx(Vh,{onClick:T,variant:"outline",children:"Crer un retour/change"})]}):Ne.jsxs(Ne.Fragment,{children:[Ne.jsx("div",{className:"hidden sm:block",children:Ne.jsxs(fg,{children:[Ne.jsx(xg,{children:Ne.jsxs(vg,{children:[Ne.jsx(jg,{children:"Code"}),Ne.jsx(jg,{children:"Type"}),Ne.jsx(jg,{children:"Vente origine"}),Ne.jsx(jg,{children:"Client"}),Ne.jsx(jg,{children:"Raison"}),Ne.jsx(jg,{children:"Statut"}),Ne.jsx(jg,{children:"Actions"})]})}),Ne.jsx(gg,{children:W.map(e=>{var t;return Ne.jsxs(vg,{children:[Ne.jsx(yg,{className:"font-medium",children:e.return_code}),Ne.jsx(yg,{children:E(e)}),Ne.jsx(yg,{children:(null==(t=e.original_sale)?void 0:t.sale_code)||"N/A"}),Ne.jsx(yg,{children:e.customer_name||"Client anonyme"}),Ne.jsx(yg,{className:"max-w-[150px] truncate",children:e.return_reason}),Ne.jsx(yg,{children:M(e.return_status)}),Ne.jsx(yg,{children:Ne.jsxs(Om,{children:[Ne.jsx(qm,{asChild:!0,children:Ne.jsx(Vh,{variant:"ghost",className:"h-8 w-8 p-0",children:Ne.jsx(zr,{className:"h-4 w-4"})})}),Ne.jsxs(Im,{align:"end",children:[Ne.jsx(Fm,{onClick:()=>A(e),children:"Voir dtails"}),Ne.jsx(Fm,{onClick:()=>P(e),children:"Imprimer bon"}),S&&Ne.jsx(Fm,{onClick:()=>D(e),children:"Modifier"}),S&&Ne.jsx(Fm,{className:"text-destructive",onClick:()=>R(e),children:"Annuler"})]})]})})]},e.id)})})]})}),Ne.jsx("div",{className:"space-y-3 sm:hidden",children:W.map(e=>{var t;return Ne.jsxs("div",{className:"border rounded-lg p-3",children:[Ne.jsxs("div",{className:"flex items-start justify-between gap-2",children:[Ne.jsxs("div",{className:"min-w-0",children:[Ne.jsx("p",{className:"font-medium truncate",children:e.return_code}),Ne.jsx("p",{className:"text-sm text-muted-foreground truncate",children:(null==(t=e.original_sale)?void 0:t.sale_code)||"N/A"})]}),Ne.jsx("div",{children:M(e.return_status)})]}),Ne.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-2 text-sm",children:[Ne.jsxs("div",{children:[Ne.jsx("span",{className:"text-muted-foreground",children:"Type"}),Ne.jsx("div",{className:"font-medium",children:"exchange"===e.return_type?"change":"Retour"})]}),Ne.jsxs("div",{className:"text-right",children:[Ne.jsx("span",{className:"text-muted-foreground",children:"Client"}),Ne.jsx("div",{className:"font-medium",children:e.customer_name||""})]}),Ne.jsxs("div",{className:"col-span-2",children:[Ne.jsx("span",{className:"text-muted-foreground",children:"Raison"}),Ne.jsx("div",{className:"font-medium truncate",children:e.return_reason||""})]})]}),Ne.jsx("div",{className:"mt-3 flex items-center justify-end",children:Ne.jsxs(Om,{children:[Ne.jsx(qm,{asChild:!0,children:Ne.jsx(Vh,{variant:"ghost",className:"h-8 w-8 p-0",children:Ne.jsx(zr,{className:"h-4 w-4"})})}),Ne.jsxs(Im,{align:"end",children:[Ne.jsx(Fm,{onClick:()=>A(e),children:"Voir dtails"}),Ne.jsx(Fm,{onClick:()=>P(e),children:"Imprimer bon"}),S&&Ne.jsx(Fm,{onClick:()=>D(e),children:"Modifier"}),S&&Ne.jsx(Fm,{className:"text-destructive",onClick:()=>R(e),children:"Annuler"})]})]})})]},e.id)})}),Ne.jsxs("div",{className:"mt-4 flex items-center justify-center gap-2",children:[Ne.jsx(Vh,{variant:"outline",size:"sm",disabled:U<=1||"all"===w,onClick:()=>b(e=>Math.max(1,e-1)),children:"Prcdent"}),Ne.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",U," / ",z]}),Ne.jsx(Vh,{variant:"outline",size:"sm",disabled:U>=z||"all"===w,onClick:()=>b(e=>Math.min(z,e+1)),children:"Suivant"})]})]})})]})]}),Ne.jsx(Uy,{open:h,onOpenChange:m,onSuccess:C}),x&&p&&Ne.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:Ne.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[Ne.jsxs("div",{className:"flex justify-between items-center mb-6",children:[Ne.jsxs("h2",{className:"text-2xl font-bold",children:["Dtails retour ",p.return_code]}),Ne.jsx(Vh,{variant:"ghost",onClick:()=>g(!1),children:""})]}),Ne.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6",children:[Ne.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[Ne.jsx("label",{className:"font-semibold text-sm text-blue-700 mb-2 block",children:"Informations de base"}),Ne.jsxs("div",{className:"space-y-2 text-sm",children:[Ne.jsxs("div",{children:[Ne.jsx("span",{className:"font-medium",children:"Code:"})," ",p.return_code]}),Ne.jsxs("div",{children:[Ne.jsx("span",{className:"font-medium",children:"Type:"})," ","exchange"===p.return_type?"change":"Retour"]}),Ne.jsxs("div",{children:[Ne.jsx("span",{className:"font-medium",children:"Statut:"})," ",M(p.return_status)]}),Ne.jsxs("div",{children:[Ne.jsx("span",{className:"font-medium",children:"Date cration:"})," ",new Date(p.created_at).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})]}),p.updated_at&&p.updated_at!==p.created_at&&Ne.jsxs("div",{children:[Ne.jsx("span",{className:"font-medium",children:"Dernire modification:"})," ",new Date(p.updated_at).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]})]}),Ne.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[Ne.jsx("label",{className:"font-semibold text-sm text-green-700 mb-2 block",children:"Vente d'origine"}),Ne.jsxs("div",{className:"space-y-2 text-sm",children:[Ne.jsxs("div",{children:[Ne.jsx("span",{className:"font-medium",children:"Code vente:"})," ",(null==(e=p.original_sale)?void 0:e.sale_code)||"N/A"]}),Ne.jsxs("div",{children:[Ne.jsx("span",{className:"font-medium",children:"Client:"})," ",p.customer_name||"Client anonyme"]}),Ne.jsxs("div",{children:[Ne.jsx("span",{className:"font-medium",children:"Raison:"})," ",p.return_reason||"Non spcifie"]}),p.return_notes&&Ne.jsxs("div",{children:[Ne.jsx("span",{className:"font-medium",children:"Notes:"})," ",p.return_notes]})]})]}),Ne.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg",children:[Ne.jsx("label",{className:"font-semibold text-sm text-orange-700 mb-2 block",children:"Informations financires"}),Ne.jsxs("div",{className:"space-y-2 text-sm",children:[Ne.jsxs("div",{children:[Ne.jsx("span",{className:"font-medium",children:"Montant total retour:"})," ",t(v.reduce((e,t)=>e+(t.original_total_price||0),0))]}),Ne.jsxs("div",{children:[Ne.jsx("span",{className:"font-medium",children:"Montant total change:"})," ",t(v.reduce((e,t)=>e+(t.exchange_total_price||0),0))]}),Ne.jsxs("div",{children:[Ne.jsx("span",{className:"font-medium",children:"Diffrence totale:"})," ",t(v.reduce((e,t)=>e+(t.price_difference||0),0))]}),p.processed_by&&Ne.jsxs("div",{children:[Ne.jsx("span",{className:"font-medium",children:"Trait par:"})," ",p.processed_by_name||p.processed_by]})]})]})]}),Ne.jsxs("div",{className:"mb-6",children:[Ne.jsx("label",{className:"font-semibold text-lg text-gray-800 mb-4 block",children:"Dtail des produits"}),Ne.jsxs("div",{className:"space-y-3",children:[(v||[]).map((e,s)=>Ne.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:Ne.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[Ne.jsxs("div",{className:"bg-red-50 p-3 rounded-lg",children:[Ne.jsxs("h4",{className:"font-semibold text-red-700 mb-2 flex items-center gap-2",children:[Ne.jsx(Qr,{className:"w-4 h-4"}),"Produit retourn"]}),Ne.jsxs("div",{className:"space-y-2 text-sm",children:[Ne.jsxs("div",{children:[Ne.jsx("span",{className:"font-medium",children:"Nom:"})," ",e.product_name||"N/A"]}),Ne.jsxs("div",{children:[Ne.jsx("span",{className:"font-medium",children:"SKU:"})," ",e.product_sku||"N/A"]}),Ne.jsxs("div",{children:[Ne.jsx("span",{className:"font-medium",children:"Quantit:"})," ",e.returned_quantity]}),Ne.jsxs("div",{children:[Ne.jsx("span",{className:"font-medium",children:"Prix unitaire:"})," ",t(e.original_unit_price)]}),Ne.jsxs("div",{children:[Ne.jsx("span",{className:"font-medium",children:"Prix total:"})," ",t(e.original_total_price)]})]})]}),e.exchange_product_id?Ne.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg",children:[Ne.jsxs("h4",{className:"font-semibold text-blue-700 mb-2 flex items-center gap-2",children:[Ne.jsx(ar,{className:"w-4 h-4"}),"Produit d'change"]}),Ne.jsxs("div",{className:"space-y-2 text-sm",children:[Ne.jsxs("div",{children:[Ne.jsx("span",{className:"font-medium",children:"Quantit:"})," ",e.exchange_quantity]}),Ne.jsxs("div",{children:[Ne.jsx("span",{className:"font-medium",children:"Prix total change:"})," ",t(e.exchange_total_price||0)]}),Ne.jsxs("div",{children:[Ne.jsx("span",{className:"font-medium",children:"Diffrence:"})," ",t(e.price_difference||0)]})]})]}):Ne.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[Ne.jsx("h4",{className:"font-semibold text-gray-700 mb-2",children:"Aucun change"}),Ne.jsx("p",{className:"text-sm text-gray-600",children:"Produit retourn sans change"})]})]})},s)),(!v||0===v.length)&&Ne.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[Ne.jsx(Gr,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),Ne.jsx("p",{children:"Aucune ligne de produit pour ce retour"})]})]})]}),Ne.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[Ne.jsx(Vh,{variant:"outline",onClick:()=>g(!1),children:"Fermer"}),Ne.jsxs(Vh,{onClick:()=>q(p),className:"gap-2",children:[Ne.jsx(Gr,{className:"w-4 h-4"}),"Imprimer"]})]})]})})]})}function Vy({open:e,onOpenChange:t,onSuccess:s,productId:r,storeId:a}){const[n,i]=Nt.useState(!1),[o,l]=Nt.useState([]),[c,d]=Nt.useState([]),[u,h]=Nt.useState(null),[m,p]=Nt.useState({product_id:r||"",store_id:a||"",adjustment_type:"set",quantity:0,reason:""}),{toast:f}=is();Nt.useEffect(()=>{e&&(x(),g(),j())},[e]),Nt.useEffect(()=>{m.product_id&&m.store_id&&v()},[m.product_id,m.store_id]);const x=async()=>{const{data:e,error:t}=await Dh.from("products").select("id, name, sku").order("name");t||l(e||[])},g=async()=>{const{data:e,error:t}=await Dh.from("stores").select("id, name").eq("is_active",!0).order("name");t||d(e||[])},v=async()=>{const{data:e,error:t}=await Dh.from("inventory").select("quantity").eq("product_id",m.product_id).eq("store_id",m.store_id).maybeSingle();h(t?0:(null==e?void 0:e.quantity)||0)},j=()=>{p({product_id:r||"",store_id:a||"",adjustment_type:"set",quantity:0,reason:""}),h(null)},y=()=>{if(null===u)return 0;switch(m.adjustment_type){case"set":return m.quantity;case"add":return u+m.quantity;case"subtract":return Math.max(0,u-m.quantity);default:return u}};return o.find(e=>e.id===m.product_id),c.find(e=>e.id===m.store_id),Ne.jsx(bg,{open:e,onOpenChange:t,children:Ne.jsxs(kg,{className:"max-w-md",children:[Ne.jsxs(Sg,{children:[Ne.jsxs(Eg,{className:"flex items-center gap-2",children:[Ne.jsx(Ur,{className:"w-5 h-5"}),"Ajustement de Stock"]}),Ne.jsx(Mg,{children:"Modifier la quantit en stock d'un produit"})]}),Ne.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),m.product_id&&m.store_id&&m.reason){i(!0);try{const e=y(),{data:r}=await Dh.from("inventory").select("id").eq("product_id",m.product_id).eq("store_id",m.store_id).maybeSingle();if(r){const{error:t}=await Dh.from("inventory").update({quantity:e,updated_at:(new Date).toISOString()}).eq("id",r.id);if(t)throw t}else{const{error:t}=await Dh.from("inventory").insert({product_id:m.product_id,store_id:m.store_id,quantity:e});if(t)throw t}f({title:"Stock ajust",description:`Nouveau stock: ${e}`}),s(),t(!1)}catch(r){f({title:"Erreur",description:"Erreur lors de l'ajustement du stock",variant:"destructive"})}finally{i(!1)}}else f({title:"Donnes manquantes",description:"Veuillez remplir tous les champs requis",variant:"destructive"})},className:"space-y-4",children:[Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{children:"Produit"}),Ne.jsx(av,{value:m.product_id,onValueChange:e=>p(t=>({...t,product_id:e})),options:o.map(e=>({value:e.id,label:`${e.name} - ${e.sku}`})),placeholder:"Slectionner un produit",disabled:!!r})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{children:"Magasin"}),Ne.jsx(av,{value:m.store_id,onValueChange:e=>p(t=>({...t,store_id:e})),options:c.map(e=>({value:e.id,label:e.name})),placeholder:"Slectionner un magasin",disabled:!!a})]}),null!==u&&Ne.jsx("div",{className:"p-3 bg-muted rounded-lg",children:Ne.jsxs("p",{className:"text-sm",children:[Ne.jsx("strong",{children:"Stock actuel:"})," ",u," units"]})}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{children:"Type d'ajustement"}),Ne.jsxs(Kf,{value:m.adjustment_type,onValueChange:e=>p(t=>({...t,adjustment_type:e})),children:[Ne.jsx(Gf,{children:Ne.jsx(Yf,{})}),Ne.jsxs(Xf,{children:[Ne.jsx(Zf,{value:"set",children:"Dfinir la quantit"}),Ne.jsx(Zf,{value:"add",children:"Ajouter  la quantit"}),Ne.jsx(Zf,{value:"subtract",children:"Retirer de la quantit"})]})]})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsxs(Zm,{children:["Quantit","set"===m.adjustment_type&&" (nouvelle quantit)","add"===m.adjustment_type&&" ( ajouter)","subtract"===m.adjustment_type&&" ( retirer)"]}),Ne.jsx(Bh,{type:"number",min:"0",value:m.quantity,onChange:e=>p(t=>({...t,quantity:parseInt(e.target.value)||0})),required:!0})]}),null!==u&&Ne.jsx("div",{className:"p-3 bg-primary/5 rounded-lg",children:Ne.jsxs("p",{className:"text-sm font-medium",children:["Nouveau stock: ",y()," units"]})}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{htmlFor:"reason",children:"Raison de l'ajustement *"}),Ne.jsx(Tg,{id:"reason",value:m.reason,onChange:e=>p(t=>({...t,reason:e.target.value})),placeholder:"Ex: Inventaire physique, casse, vol, correction d'erreur...",required:!0})]}),Ne.jsxs("div",{className:"flex justify-end gap-2",children:[Ne.jsx(Vh,{type:"button",variant:"outline",onClick:()=>t(!1),children:"Annuler"}),Ne.jsxs(Vh,{type:"submit",disabled:n||null===u,children:[n&&Ne.jsx(Rr,{className:"mr-2 h-4 w-4 animate-spin"}),"Ajuster le stock"]})]})]})]})})}function By(){const[e,t]=Nt.useState(""),[s,r]=Nt.useState([]),[a,n]=Nt.useState(!0),[i,o]=Nt.useState(!1),[l,c]=Nt.useState(""),[d,u]=Nt.useState(""),[h,m]=Nt.useState(!1),[p,f]=Nt.useState({store:"all",status:"all"}),{toast:x}=is();Nt.useEffect(()=>{g()},[]);const g=async()=>{try{const{data:e,error:t}=await Dh.from("product_stores").select("\n          *,\n          products(id, name, sku, alert_stock, categories(name)),\n          stores(name)\n        ").order("assigned_at",{ascending:!1});if(t)throw t;r(e||[])}catch(e){x({title:"Erreur",description:"Impossible de charger l'inventaire",variant:"destructive"})}finally{n(!1)}},v=e=>{var t;const s=e.current_stock,r=(null==(t=e.products)?void 0:t.alert_stock)||10;return 0===s?Ne.jsxs(Cp,{variant:"destructive",className:"gap-1",children:[Ne.jsx(rr,{className:"w-3 h-3"}),"Rupture"]}):s<=r?Ne.jsxs(Cp,{variant:"secondary",className:"gap-1 bg-warning/10 text-warning",children:[Ne.jsx(rr,{className:"w-3 h-3"}),"Stock faible"]}):Ne.jsxs(Cp,{variant:"default",className:"gap-1 bg-success text-success-foreground",children:[Ne.jsx(hr,{className:"w-3 h-3"}),"Normal"]})},j=()=>{c(""),u(""),o(!0)},y=s.length,b=s.filter(e=>{var t;return e.current_stock<=((null==(t=e.products)?void 0:t.alert_stock)||10)&&e.current_stock>0}).length,w=s.filter(e=>0===e.current_stock).length,N=Nt.useMemo(()=>{const t=e=>e?String(e).normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase():"",r=t(e).split(/\s+/).filter(Boolean);let a=s;return"all"!==p.store&&(a=a.filter(e=>{var t;return(null==(t=e.stores)?void 0:t.name)===p.store})),"all"!==p.status&&(a=a.filter(e=>{var t;const s=e.current_stock,r=(null==(t=e.products)?void 0:t.alert_stock)||10;return"out"===p.status?0===s:"low"===p.status?s>0&&s<=r:"ok"!==p.status||s>r})),0===r.length?a:a.filter(e=>{var s,a,n;const i=[null==(s=e.products)?void 0:s.name,null==(a=e.products)?void 0:a.sku,null==(n=e.stores)?void 0:n.name],o=t(i.filter(Boolean).join(" "));return r.every(e=>o.includes(e))})},[s,e,p]);return Ne.jsxs("div",{className:"space-y-6",children:[Ne.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[Ne.jsxs("div",{children:[Ne.jsxs("h1",{className:"text-2xl md:text-3xl font-bold flex items-center gap-2",children:[Ne.jsx(pa,{className:"w-7 h-7 text-primary"}),"Inventaire"]}),Ne.jsx("p",{className:"text-muted-foreground",children:"Grez et suivez vos stocks en temps rel"})]}),Ne.jsxs(Vh,{onClick:j,size:"touch",className:"gap-2",children:[Ne.jsx(Yr,{className:"w-4 h-4"}),"Faire un inventaire"]})]}),Ne.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Ne.jsx(Vm,{className:"text-sm font-medium",children:"Total produits"}),Ne.jsx(Ur,{className:"h-4 w-4 text-muted-foreground"})]}),Ne.jsxs(Hm,{children:[Ne.jsx("div",{className:"text-2xl font-bold",children:y}),Ne.jsx("p",{className:"text-xs text-muted-foreground",children:"Rfrences"})]})]}),Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Ne.jsx(Vm,{className:"text-sm font-medium",children:"Stock faible"}),Ne.jsx(rr,{className:"h-4 w-4 text-warning"})]}),Ne.jsxs(Hm,{children:[Ne.jsx("div",{className:"text-2xl font-bold text-warning",children:b}),Ne.jsx("p",{className:"text-xs text-muted-foreground",children:" rapprovisionner"})]})]}),Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Ne.jsx(Vm,{className:"text-sm font-medium",children:"Ruptures"}),Ne.jsx(rr,{className:"h-4 w-4 text-destructive"})]}),Ne.jsxs(Hm,{children:[Ne.jsx("div",{className:"text-2xl font-bold text-destructive",children:w}),Ne.jsx("p",{className:"text-xs text-muted-foreground",children:"Urgence"})]})]}),Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Ne.jsx(Vm,{className:"text-sm font-medium",children:"Surstockage"}),Ne.jsx(Ur,{className:"h-4 w-4 text-info"})]}),Ne.jsxs(Hm,{children:[Ne.jsx("div",{className:"text-2xl font-bold text-info",children:0}),Ne.jsx("p",{className:"text-xs text-muted-foreground",children:" couler"})]})]})]}),Ne.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[Ne.jsxs("div",{className:"relative flex-1",children:[Ne.jsx(Xr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),Ne.jsx(Bh,{placeholder:"Rechercher un produit...",value:e,onChange:e=>t(e.target.value),className:"pl-10"})]}),Ne.jsxs(tv,{open:h,onOpenChange:m,children:[Ne.jsx(sv,{asChild:!0,children:Ne.jsxs(Vh,{variant:"outline",size:"touch",className:"gap-2 w-full sm:w-auto",children:[Ne.jsx(Mr,{className:"w-4 h-4"}),"Filtres"]})}),Ne.jsx(rv,{className:"w-[92vw] sm:w-80 max-h-[70vh] overflow-auto",align:"end",children:Ne.jsxs("div",{className:"space-y-4",children:[Ne.jsx("h4",{className:"font-medium",children:"Filtres"}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx("label",{className:"text-sm font-medium",children:"Magasin"}),Ne.jsxs(Kf,{value:p.store,onValueChange:e=>f(t=>({...t,store:e})),children:[Ne.jsx(Gf,{className:"w-full",children:Ne.jsx(Yf,{placeholder:"Tous les magasins"})}),Ne.jsxs(Xf,{children:[Ne.jsx(Zf,{value:"all",children:"Tous les magasins"}),Array.from(new Set(s.map(e=>{var t;return null==(t=e.stores)?void 0:t.name}).filter(Boolean))).map(e=>Ne.jsx(Zf,{value:String(e),children:String(e)},String(e)))]})]})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx("label",{className:"text-sm font-medium",children:"Statut"}),Ne.jsxs(Kf,{value:p.status,onValueChange:e=>f(t=>({...t,status:e})),children:[Ne.jsx(Gf,{className:"w-full",children:Ne.jsx(Yf,{placeholder:"Tous les statuts"})}),Ne.jsxs(Xf,{children:[Ne.jsx(Zf,{value:"all",children:"Tous"}),Ne.jsx(Zf,{value:"out",children:"Rupture"}),Ne.jsx(Zf,{value:"low",children:"Stock faible"}),Ne.jsx(Zf,{value:"ok",children:"Normal"})]})]})]}),Ne.jsxs("div",{className:"flex gap-2 w-full",children:[Ne.jsx(Vh,{variant:"outline",size:"sm",onClick:()=>f({store:"all",status:"all"}),className:"flex-1",children:"Effacer"}),Ne.jsx(Vh,{size:"sm",onClick:()=>m(!1),className:"flex-1",children:"Appliquer"})]})]})})]})]}),Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{children:[Ne.jsx(Vm,{children:"tat des stocks"}),Ne.jsx(Bm,{children:"Vue d'ensemble de votre inventaire"})]}),Ne.jsx(Hm,{children:a?Ne.jsx("div",{className:"flex justify-center py-12",children:Ne.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):0===N.length?Ne.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[Ne.jsx(pa,{className:"w-16 h-16 text-muted-foreground/20 mb-4"}),Ne.jsx("p",{className:"text-muted-foreground mb-4",children:"Aucun produit en stock"}),Ne.jsx(Vh,{onClick:j,variant:"outline",children:"Ajouter un stock"})]}):Ne.jsxs(fg,{children:[Ne.jsx(xg,{children:Ne.jsxs(vg,{children:[Ne.jsx(jg,{children:"Produit"}),Ne.jsx(jg,{children:"SKU"}),Ne.jsx(jg,{children:"Magasin"}),Ne.jsx(jg,{children:"Stock actuel"}),Ne.jsx(jg,{children:"Seuil d'alerte"}),Ne.jsx(jg,{children:"Statut"}),Ne.jsx(jg,{children:"Dernire MAJ"}),Ne.jsx(jg,{children:"Actions"})]})}),Ne.jsx(gg,{children:N.map(e=>{var t,s,r,a;return Ne.jsxs(vg,{children:[Ne.jsx(yg,{className:"font-medium",children:null==(t=e.products)?void 0:t.name}),Ne.jsx(yg,{children:null==(s=e.products)?void 0:s.sku}),Ne.jsx(yg,{children:null==(r=e.stores)?void 0:r.name}),Ne.jsx(yg,{className:"font-medium",children:e.current_stock}),Ne.jsx(yg,{children:(null==(a=e.products)?void 0:a.alert_stock)||10}),Ne.jsx(yg,{children:v(e)}),Ne.jsx(yg,{children:new Date(e.assigned_at).toLocaleDateString()}),Ne.jsx(yg,{children:Ne.jsxs(Om,{children:[Ne.jsx(qm,{asChild:!0,children:Ne.jsx(Vh,{variant:"ghost",className:"h-8 w-8 p-0",children:Ne.jsx(zr,{className:"h-4 w-4"})})}),Ne.jsxs(Im,{align:"end",children:[Ne.jsx(Fm,{onClick:()=>{return t=e.product_id,s=e.store_id,c(t),u(s),void o(!0);var t,s},children:"Ajuster stock"}),Ne.jsx(Fm,{children:"Voir historique"}),Ne.jsx(Fm,{children:"Dfinir seuils"}),Ne.jsx(Fm,{children:"Transfert magasin"})]})]})})]},e.id)})})]})})]}),Ne.jsx(Vy,{open:i,onOpenChange:o,onSuccess:g,productId:l,storeId:d})]})}var Hy="Checkbox",[Ky,Yy]=ke(Hy),[Gy,Qy]=Ky(Hy);function Jy(e){const{__scopeCheckbox:t,checked:s,children:r,defaultChecked:a,disabled:n,form:i,name:o,onCheckedChange:l,required:c,value:d="on",internal_do_not_use_render:u}=e,[h,m]=Me({prop:s,defaultProp:a??!1,onChange:l,caller:Hy}),[p,f]=Nt.useState(null),[x,g]=Nt.useState(null),v=Nt.useRef(!1),j=!p||(!!i||!!p.closest("form")),y={checked:h,disabled:n,setChecked:m,control:p,setControl:f,name:o,form:i,value:d,hasConsumerStoppedPropagationRef:v,required:c,defaultChecked:!ib(a)&&a,isFormControl:j,bubbleInput:x,setBubbleInput:g};return Ne.jsx(Gy,{scope:t,...y,children:nb(u)?u(y):r})}var Xy="CheckboxTrigger",Zy=Nt.forwardRef(({__scopeCheckbox:e,onKeyDown:t,onClick:s,...r},a)=>{const{control:n,value:i,disabled:o,checked:l,required:c,setControl:d,setChecked:u,hasConsumerStoppedPropagationRef:h,isFormControl:m,bubbleInput:p}=Qy(Xy,e),f=Ce(a,d),x=Nt.useRef(l);return Nt.useEffect(()=>{const e=null==n?void 0:n.form;if(e){const t=()=>u(x.current);return e.addEventListener("reset",t),()=>e.removeEventListener("reset",t)}},[n,u]),Ne.jsx(_e.button,{type:"button",role:"checkbox","aria-checked":ib(l)?"mixed":l,"aria-required":c,"data-state":ob(l),"data-disabled":o?"":void 0,disabled:o,value:i,...r,ref:f,onKeyDown:Ae(t,e=>{"Enter"===e.key&&e.preventDefault()}),onClick:Ae(s,e=>{u(e=>!!ib(e)||!e),p&&m&&(h.current=e.isPropagationStopped(),h.current||e.stopPropagation())})})});Zy.displayName=Xy;var eb=Nt.forwardRef((e,t)=>{const{__scopeCheckbox:s,name:r,checked:a,defaultChecked:n,required:i,disabled:o,value:l,onCheckedChange:c,form:d,...u}=e;return Ne.jsx(Jy,{__scopeCheckbox:s,checked:a,defaultChecked:n,disabled:o,required:i,onCheckedChange:c,name:r,form:d,value:l,internal_do_not_use_render:({isFormControl:e})=>Ne.jsxs(Ne.Fragment,{children:[Ne.jsx(Zy,{...u,ref:t,__scopeCheckbox:s}),e&&Ne.jsx(ab,{__scopeCheckbox:s})]})})});eb.displayName=Hy;var tb="CheckboxIndicator",sb=Nt.forwardRef((e,t)=>{const{__scopeCheckbox:s,forceMount:r,...a}=e,n=Qy(tb,s);return Ne.jsx(Te,{present:r||ib(n.checked)||!0===n.checked,children:Ne.jsx(_e.span,{"data-state":ob(n.checked),"data-disabled":n.disabled?"":void 0,...a,ref:t,style:{pointerEvents:"none",...e.style}})})});sb.displayName=tb;var rb="CheckboxBubbleInput",ab=Nt.forwardRef(({__scopeCheckbox:e,...t},s)=>{const{control:r,hasConsumerStoppedPropagationRef:a,checked:n,defaultChecked:i,required:o,disabled:l,name:c,value:d,form:u,bubbleInput:h,setBubbleInput:m}=Qy(rb,e),p=Ce(s,m),f=Tp(n),x=bt(r);Nt.useEffect(()=>{const e=h;if(!e)return;const t=window.HTMLInputElement.prototype,s=Object.getOwnPropertyDescriptor(t,"checked").set,r=!a.current;if(f!==n&&s){const t=new Event("click",{bubbles:r});e.indeterminate=ib(n),s.call(e,!ib(n)&&n),e.dispatchEvent(t)}},[h,f,n,a]);const g=Nt.useRef(!ib(n)&&n);return Ne.jsx(_e.input,{type:"checkbox","aria-hidden":!0,defaultChecked:i??g.current,required:o,disabled:l,name:c,value:d,form:u,...t,tabIndex:-1,ref:p,style:{...t.style,...x,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});function nb(e){return"function"==typeof e}function ib(e){return"indeterminate"===e}function ob(e){return ib(e)?"indeterminate":e?"checked":"unchecked"}ab.displayName=rb;const lb=Nt.forwardRef(({className:e,...t},s)=>Ne.jsx(eb,{ref:s,className:un("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",e),...t,children:Ne.jsx(sb,{className:un("flex items-center justify-center text-current"),children:Ne.jsx(mr,{className:"h-4 w-4"})})}));function cb({open:e,onOpenChange:t,onSuccess:s,user:r,mode:a}){const[n,i]=Nt.useState(!1),[o,l]=Nt.useState([]),[c,d]=Nt.useState({email:"",first_name:"",last_name:"",phone:"",role:"Vendeur",status:"pending",store_id:"",store_ids:[],password:""}),{toast:u}=is(),{userProfile:h}=Ih();Nt.useEffect(()=>{e&&(m(),"edit"===a&&r?(d({email:r.email||"",first_name:r.first_name||"",last_name:r.last_name||"",phone:r.phone||"",role:r.role||"Vendeur",status:r.status||"pending",store_id:"",store_ids:[],password:""}),f(r.id)):p())},[e,a,r]);const m=async()=>{const{data:e,error:t}=await Dh.from("stores").select("id, name").eq("is_active",!0).order("name");t||l(e||[])},p=()=>{d({email:"",first_name:"",last_name:"",phone:"",role:"Vendeur",status:"pending",store_id:"",store_ids:[],password:""})},f=async e=>{const{data:t}=await Dh.from("user_stores").select("store_id, is_primary").eq("user_id",e).order("is_primary",{ascending:!1}),s=(t||[]).map(e=>e.store_id),r=(t||[]).find(e=>e.is_primary);d(e=>({...e,store_ids:s,store_id:(null==r?void 0:r.store_id)??s[0]??""}))};return Ne.jsx(bg,{open:e,onOpenChange:t,children:Ne.jsxs(kg,{className:"max-w-md",children:[Ne.jsxs(Sg,{children:[Ne.jsxs(Eg,{className:"flex items-center gap-2",children:[Ne.jsx(ma,{className:"w-5 h-5"}),"create"===a?"Nouvel Utilisateur":"Modifier l'Utilisateur"]}),Ne.jsx(Mg,{children:"create"===a?"Crer un nouveau compte utilisateur":"Modifier les informations de l'utilisateur"})]}),Ne.jsxs("form",{onSubmit:async e=>{var n,o,l;if(e.preventDefault(),c.email&&c.first_name&&c.last_name)if("create"!==a||c.password){i(!0);try{if("create"===a){const{data:e}=await Dh.auth.getSession(),t=null==(n=e.session)?void 0:n.access_token,s=null==(o=e.session)?void 0:o.refresh_token,r=async()=>{t&&s&&await Dh.auth.setSession({access_token:t,refresh_token:s})};let a=null;const{data:i,error:d}=await Dh.auth.signUp({email:c.email,password:c.password,options:{data:{first_name:c.first_name,last_name:c.last_name}}});if(d){if(!d.message.includes("already registered"))throw d;{const{data:e}=await Dh.auth.signInWithPassword({email:c.email,password:c.password});a=(null==(l=e.user)?void 0:l.id)??null}}else i.user&&(a=i.user.id);if(await r(),a){const{data:e,error:t}=await Dh.from("users").upsert({auth_id:a,email:c.email,first_name:c.first_name,last_name:c.last_name,phone:c.phone||null,role:c.role,status:c.status},{onConflict:"auth_id"}).select("id").maybeSingle();if(t)throw t;if(null==e?void 0:e.id){const t=e.id;if(await Dh.from("user_stores").delete().eq("user_id",t),"Vendeur"===c.role){if(c.store_id){const{error:e}=await Dh.from("user_stores").insert({user_id:t,store_id:c.store_id,is_primary:!0,assigned_by:(null==h?void 0:h.id)||null});if(e)throw e}}else if("Manager"===c.role&&c.store_ids&&c.store_ids.length>0){const e=c.store_id&&c.store_ids.includes(c.store_id)?c.store_id:c.store_ids[0],s=c.store_ids.map(s=>({user_id:t,store_id:s,is_primary:s===e,assigned_by:(null==h?void 0:h.id)||null})),{error:r}=await Dh.from("user_stores").insert(s);if(r)throw r}}}}else{const{error:e}=await Dh.from("users").update({first_name:c.first_name,last_name:c.last_name,phone:c.phone||null,role:c.role,status:c.status}).eq("id",r.id);if(e)throw e;if(await Dh.from("user_stores").delete().eq("user_id",r.id),"Vendeur"===c.role){if(c.store_id){const{error:e}=await Dh.from("user_stores").insert({user_id:r.id,store_id:c.store_id,is_primary:!0,assigned_by:(null==h?void 0:h.id)||null});if(e)throw e}}else if("Manager"===c.role&&c.store_ids&&c.store_ids.length>0){const e=c.store_id&&c.store_ids.includes(c.store_id)?c.store_id:c.store_ids[0],t=c.store_ids.map(t=>({user_id:r.id,store_id:t,is_primary:t===e,assigned_by:(null==h?void 0:h.id)||null})),{error:s}=await Dh.from("user_stores").insert(t);if(s)throw s}}u({title:"create"===a?"Utilisateur cr":"Utilisateur modifi",description:"create"===a?"Le nouvel utilisateur a t cr avec succs":"Les modifications ont t enregistres"}),s(),t(!1)}catch(d){u({title:"Erreur",description:d.message||"Une erreur est survenue",variant:"destructive"})}finally{i(!1)}}else u({title:"Mot de passe requis",description:"Veuillez saisir un mot de passe",variant:"destructive"});else u({title:"Donnes manquantes",description:"Veuillez remplir tous les champs requis",variant:"destructive"})},className:"space-y-4",children:[Ne.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{htmlFor:"first_name",children:"Prnom *"}),Ne.jsx(Bh,{id:"first_name",value:c.first_name,onChange:e=>d(t=>({...t,first_name:e.target.value})),required:!0})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{htmlFor:"last_name",children:"Nom *"}),Ne.jsx(Bh,{id:"last_name",value:c.last_name,onChange:e=>d(t=>({...t,last_name:e.target.value})),required:!0})]})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{htmlFor:"email",children:"Email *"}),Ne.jsx(Bh,{id:"email",type:"email",value:c.email,onChange:e=>d(t=>({...t,email:e.target.value})),disabled:"edit"===a,required:!0})]}),"create"===a&&Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{htmlFor:"password",children:"Mot de passe *"}),Ne.jsx(Bh,{id:"password",type:"password",value:c.password,onChange:e=>d(t=>({...t,password:e.target.value})),required:!0,minLength:6})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{htmlFor:"phone",children:"Tlphone"}),Ne.jsx(Bh,{id:"phone",value:c.phone,onChange:e=>d(t=>({...t,phone:e.target.value}))})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{children:"Rle"}),Ne.jsxs(Kf,{value:c.role,onValueChange:e=>d(t=>({...t,role:e})),children:[Ne.jsx(Gf,{children:Ne.jsx(Yf,{})}),Ne.jsx(Xf,{children:[{value:"Vendeur",label:"Vendeur"},{value:"Manager",label:"Manager"},{value:"Admin",label:"Admin"},{value:"SuperAdmin",label:"Super Admin"}].filter(e=>(e=>!!h&&("SuperAdmin"===h.role||"Admin"===h.role&&"SuperAdmin"!==e))(e.value)).map(e=>Ne.jsx(Zf,{value:e.value,children:e.label},e.value))})]})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{children:"Statut"}),Ne.jsxs(Kf,{value:c.status,onValueChange:e=>d(t=>({...t,status:e})),children:[Ne.jsx(Gf,{children:Ne.jsx(Yf,{})}),Ne.jsxs(Xf,{children:[Ne.jsx(Zf,{value:"pending",children:"En attente"}),Ne.jsx(Zf,{value:"active",children:"Actif"}),Ne.jsx(Zf,{value:"rejected",children:"Rejet"})]})]})]}),"Vendeur"===c.role&&Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{children:"Magasin (un seul)"}),Ne.jsx(av,{value:c.store_id,onValueChange:e=>d(t=>({...t,store_id:e})),options:o.map(e=>({value:e.id,label:e.name})),placeholder:"Aucun magasin assign"})]}),"Manager"===c.role&&Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{children:"Magasins (plusieurs)"}),Ne.jsx("div",{className:"grid grid-cols-1 gap-2 max-h-48 overflow-auto p-2 border rounded-md",children:o.map(e=>{const t=c.store_ids.includes(e.id);return Ne.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[Ne.jsx(lb,{checked:t,onCheckedChange:t=>((e,t)=>{d(s=>{const r=new Set(s.store_ids);t?r.add(e):r.delete(e);const a=Array.from(r);return{...s,store_ids:a,store_id:a.includes(s.store_id)?s.store_id:a[0]??""}})})(e.id,Boolean(t))}),Ne.jsx("span",{children:e.name})]},e.id)})}),c.store_ids.length>0&&Ne.jsxs("div",{className:"space-y-1",children:[Ne.jsx(Zm,{children:"Magasin principal"}),Ne.jsx(av,{value:c.store_id,onValueChange:e=>d(t=>({...t,store_id:e})),options:c.store_ids.map(e=>{const t=o.find(t=>t.id===e);return t?{value:e,label:t.name}:null}).filter(Boolean),placeholder:"Slectionner le magasin principal"})]})]}),Ne.jsxs("div",{className:"flex justify-end gap-2",children:[Ne.jsx(Vh,{type:"button",variant:"outline",onClick:()=>t(!1),children:"Annuler"}),Ne.jsxs(Vh,{type:"submit",disabled:n,children:[n&&Ne.jsx(Rr,{className:"mr-2 h-4 w-4 animate-spin"}),"create"===a?"Crer":"Modifier"]})]})]})]})})}function db(){const[e,t]=Nt.useState(""),[s,r]=Nt.useState([]),[a,n]=Nt.useState(!0),[i,o]=Nt.useState(!1),[l,c]=Nt.useState(null),[d,u]=Nt.useState("create"),{toast:h}=is(),{userProfile:m}=Ih();Nt.useEffect(()=>{p()},[]);const p=async()=>{try{const{data:e,error:t}=await Dh.from("users").select("\n          *,\n          user_stores:user_stores!user_id (\n            is_primary,\n            stores ( name )\n          )\n        ").order("created_at",{ascending:!1});if(t)throw t;const s=(e||[]).map(e=>({...e,stores:(e.user_stores||[]).sort((e,t)=>Number(t.is_primary)-Number(e.is_primary)).map(e=>{var t;return{name:(null==(t=e.stores)?void 0:t.name)||""}})}));r(s)}catch(e){h({title:"Erreur",description:"Impossible de charger les utilisateurs",variant:"destructive"})}finally{n(!1)}},f=e=>{switch(e){case"SuperAdmin":return Ne.jsxs(Cp,{variant:"default",className:"gap-1 bg-gradient-primary text-white",children:[Ne.jsx(br,{className:"w-3 h-3"}),"SuperAdmin"]});case"Admin":return Ne.jsxs(Cp,{variant:"default",className:"gap-1",children:[Ne.jsx(br,{className:"w-3 h-3"}),"Admin"]});case"Manager":return Ne.jsxs(Cp,{variant:"secondary",className:"gap-1",children:[Ne.jsx(da,{className:"w-3 h-3"}),"Manager"]});case"Vendeur":return Ne.jsxs(Cp,{variant:"outline",className:"gap-1",children:[Ne.jsx(ma,{className:"w-3 h-3"}),"Vendeur"]});default:return Ne.jsx(Cp,{variant:"outline",children:e})}},x=e=>{switch(e){case"active":return Ne.jsx(Cp,{variant:"default",className:"bg-success text-success-foreground",children:"Actif"});case"pending":return Ne.jsx(Cp,{variant:"secondary",children:"En attente"});case"rejected":return Ne.jsx(Cp,{variant:"destructive",children:"Rejet"});default:return Ne.jsx(Cp,{variant:"outline",children:e})}},g=()=>{c(null),u("create"),o(!0)},v=s.length,j=s.filter(e=>"active"===e.status).length,y=s.filter(e=>"pending"===e.status).length,b=s.filter(e=>"rejected"===e.status).length,w=Nt.useMemo(()=>{const t=e=>e?String(e).normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase():"",r=t(e).split(/\s+/).filter(Boolean);return 0===r.length?s:s.filter(e=>{const s=[e.first_name,e.last_name,e.email,e.role,e.phone],a=t(s.filter(Boolean).join(" "));return r.every(e=>a.includes(e))})},[s,e]);return Ne.jsxs("div",{className:"space-y-6",children:[Ne.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[Ne.jsxs("div",{children:[Ne.jsxs("h1",{className:"text-2xl md:text-3xl font-bold flex items-center gap-2",children:[Ne.jsx(ma,{className:"w-7 h-7 text-primary"}),"Utilisateurs"]}),Ne.jsx("p",{className:"text-muted-foreground",children:"Grez les comptes utilisateurs et leurs permissions"})]}),Ne.jsxs(Vh,{onClick:g,size:"touch",className:"gap-2",children:[Ne.jsx(Yr,{className:"w-4 h-4"}),"Nouvel utilisateur"]})]}),Ne.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Ne.jsx(Vm,{className:"text-sm font-medium",children:"Total utilisateurs"}),Ne.jsx(ma,{className:"h-4 w-4 text-muted-foreground"})]}),Ne.jsxs(Hm,{children:[Ne.jsx("div",{className:"text-2xl font-bold",children:v}),Ne.jsx("p",{className:"text-xs text-muted-foreground",children:"Comptes crs"})]})]}),Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Ne.jsx(Vm,{className:"text-sm font-medium",children:"Utilisateurs actifs"}),Ne.jsx(da,{className:"h-4 w-4 text-success"})]}),Ne.jsxs(Hm,{children:[Ne.jsx("div",{className:"text-2xl font-bold text-success",children:j}),Ne.jsx("p",{className:"text-xs text-muted-foreground",children:"Connects rcemment"})]})]}),Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Ne.jsx(Vm,{className:"text-sm font-medium",children:"En attente"}),Ne.jsx(ua,{className:"h-4 w-4 text-warning"})]}),Ne.jsxs(Hm,{children:[Ne.jsx("div",{className:"text-2xl font-bold text-warning",children:y}),Ne.jsx("p",{className:"text-xs text-muted-foreground",children:" valider"})]})]}),Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Ne.jsx(Vm,{className:"text-sm font-medium",children:"Inactifs"}),Ne.jsx(ua,{className:"h-4 w-4 text-destructive"})]}),Ne.jsxs(Hm,{children:[Ne.jsx("div",{className:"text-2xl font-bold text-destructive",children:b}),Ne.jsx("p",{className:"text-xs text-muted-foreground",children:"Dsactivs"})]})]})]}),Ne.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[Ne.jsxs("div",{className:"relative flex-1",children:[Ne.jsx(Xr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),Ne.jsx(Bh,{placeholder:"Rechercher un utilisateur...",value:e,onChange:e=>t(e.target.value),className:"pl-10"})]}),Ne.jsxs(Vh,{variant:"outline",size:"touch",className:"gap-2",children:[Ne.jsx(Mr,{className:"w-4 h-4"}),"Filtres"]})]}),Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{children:[Ne.jsx(Vm,{children:"Liste des utilisateurs"}),Ne.jsx(Bm,{children:"Grez les comptes et permissions utilisateurs"})]}),Ne.jsx(Hm,{children:a?Ne.jsx("div",{className:"flex justify-center py-12",children:Ne.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):0===w.length?Ne.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[Ne.jsx(ma,{className:"w-16 h-16 text-muted-foreground/20 mb-4"}),Ne.jsx("p",{className:"text-muted-foreground mb-4",children:"Aucun utilisateur trouv"}),Ne.jsx(Vh,{onClick:g,variant:"outline",children:"Crer un utilisateur"})]}):Ne.jsxs(fg,{children:[Ne.jsx(xg,{children:Ne.jsxs(vg,{children:[Ne.jsx(jg,{children:"Nom"}),Ne.jsx(jg,{children:"Email"}),Ne.jsx(jg,{children:"Rle"}),Ne.jsx(jg,{children:"Magasin"}),Ne.jsx(jg,{children:"Statut"}),Ne.jsx(jg,{children:"Cr le"}),Ne.jsx(jg,{children:"Actions"})]})}),Ne.jsx(gg,{children:w.map(e=>{var t,s;return Ne.jsxs(vg,{children:[Ne.jsxs(yg,{className:"font-medium",children:[e.first_name," ",e.last_name]}),Ne.jsx(yg,{children:e.email}),Ne.jsx(yg,{children:f(e.role)}),Ne.jsx(yg,{children:(null==(t=e.stores)?void 0:t.map(e=>e.name).join(", "))||"Aucun"}),Ne.jsx(yg,{children:x(e.status)}),Ne.jsx(yg,{children:new Date(e.created_at).toLocaleDateString()}),Ne.jsx(yg,{children:Ne.jsxs(Om,{children:[Ne.jsx(qm,{asChild:!0,children:Ne.jsx(Vh,{variant:"ghost",className:"h-8 w-8 p-0",disabled:(s=e,!(m&&("SuperAdmin"===m.role||"Admin"===m.role&&"SuperAdmin"!==s.role))),children:Ne.jsx(zr,{className:"h-4 w-4"})})}),Ne.jsxs(Im,{align:"end",children:[Ne.jsx(Fm,{onClick:()=>(e=>{c(e),u("edit"),o(!0)})(e),children:"Modifier profil"}),Ne.jsx(Fm,{children:"Rinitialiser mot de passe"}),Ne.jsx(Fm,{className:"active"===e.status?"text-warning":"text-success",onClick:()=>(async e=>{const t="active"===e.status?"rejected":"active";try{const{error:s}=await Dh.from("users").update({status:t}).eq("id",e.id);if(s)throw s;h({title:"Statut mis  jour",description:"Utilisateur "+("active"===t?"activ":"dsactiv")}),p()}catch(s){h({title:"Erreur",description:"Impossible de modifier le statut",variant:"destructive"})}})(e),children:"active"===e.status?"Dsactiver":"Activer"}),Ne.jsx(Fm,{className:"text-destructive",children:"Supprimer"})]})]})})]},e.id)})})]})})]}),Ne.jsx(cb,{open:i,onOpenChange:o,onSuccess:p,user:l,mode:d})]})}lb.displayName=eb.displayName;var ub="Switch",[hb,mb]=ke(ub),[pb,fb]=hb(ub),xb=Nt.forwardRef((e,t)=>{const{__scopeSwitch:s,name:r,checked:a,defaultChecked:n,required:i,disabled:o,value:l="on",onCheckedChange:c,form:d,...u}=e,[h,m]=Nt.useState(null),p=Ce(t,e=>m(e)),f=Nt.useRef(!1),x=!h||(d||!!h.closest("form")),[g,v]=Me({prop:a,defaultProp:n??!1,onChange:c,caller:ub});return Ne.jsxs(pb,{scope:s,checked:g,disabled:o,children:[Ne.jsx(_e.button,{type:"button",role:"switch","aria-checked":g,"aria-required":i,"data-state":yb(g),"data-disabled":o?"":void 0,disabled:o,value:l,...u,ref:p,onClick:Ae(e.onClick,e=>{v(e=>!e),x&&(f.current=e.isPropagationStopped(),f.current||e.stopPropagation())})}),x&&Ne.jsx(jb,{control:h,bubbles:!f.current,name:r,value:l,checked:g,required:i,disabled:o,form:d,style:{transform:"translateX(-100%)"}})]})});xb.displayName=ub;var gb="SwitchThumb",vb=Nt.forwardRef((e,t)=>{const{__scopeSwitch:s,...r}=e,a=fb(gb,s);return Ne.jsx(_e.span,{"data-state":yb(a.checked),"data-disabled":a.disabled?"":void 0,...r,ref:t})});vb.displayName=gb;var jb=Nt.forwardRef(({__scopeSwitch:e,control:t,checked:s,bubbles:r=!0,...a},n)=>{const i=Nt.useRef(null),o=Ce(i,n),l=Tp(s),c=bt(t);return Nt.useEffect(()=>{const e=i.current;if(!e)return;const t=window.HTMLInputElement.prototype,a=Object.getOwnPropertyDescriptor(t,"checked").set;if(l!==s&&a){const t=new Event("click",{bubbles:r});a.call(e,s),e.dispatchEvent(t)}},[l,s,r]),Ne.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:s,...a,tabIndex:-1,ref:o,style:{...a.style,...c,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});function yb(e){return e?"checked":"unchecked"}jb.displayName="SwitchBubbleInput";var bb=xb,wb=vb;const Nb=Nt.forwardRef(({className:e,...t},s)=>Ne.jsx(bb,{className:un("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",e),...t,ref:s,children:Ne.jsx(wb,{className:un("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));function _b({open:e,onOpenChange:t,store:s,onSuccess:r}){const[a,n]=Nt.useState(!1),[i,o]=Nt.useState({name:"",address:"",phone:"",email:"",is_active:!0}),{toast:l}=is();Nt.useEffect(()=>{o(s||{name:"",address:"",phone:"",email:"",is_active:!0})},[s]);return Ne.jsx(bg,{open:e,onOpenChange:t,children:Ne.jsxs(kg,{children:[Ne.jsxs(Sg,{children:[Ne.jsxs(Eg,{children:[s?"Modifier":"Crer"," un magasin"]}),Ne.jsx(Mg,{children:s?"Modifiez les informations du magasin":"Crez un nouveau magasin"})]}),Ne.jsxs("form",{onSubmit:async e=>{e.preventDefault(),n(!0);try{if(null==s?void 0:s.id){const{error:e}=await Dh.from("stores").update({name:i.name,address:i.address||null,phone:i.phone||null,email:i.email||null,is_active:i.is_active}).eq("id",s.id);if(e)throw e;l({title:"Succs",description:"Magasin modifi avec succs"})}else{const{error:e}=await Dh.from("stores").insert({name:i.name,address:i.address||null,phone:i.phone||null,email:i.email||null,is_active:i.is_active});if(e)throw e;l({title:"Succs",description:"Magasin cr avec succs"})}r(),t(!1)}catch(a){l({title:"Erreur",description:a.message||"Erreur lors de l'enregistrement",variant:"destructive"})}finally{n(!1)}},children:[Ne.jsxs("div",{className:"space-y-4",children:[Ne.jsxs("div",{children:[Ne.jsx(Zm,{htmlFor:"name",children:"Nom du magasin *"}),Ne.jsx(Bh,{id:"name",value:i.name,onChange:e=>o({...i,name:e.target.value}),required:!0})]}),Ne.jsxs("div",{children:[Ne.jsx(Zm,{htmlFor:"address",children:"Adresse"}),Ne.jsx(Tg,{id:"address",value:i.address||"",onChange:e=>o({...i,address:e.target.value}),rows:2})]}),Ne.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[Ne.jsxs("div",{children:[Ne.jsx(Zm,{htmlFor:"phone",children:"Tlphone"}),Ne.jsx(Bh,{id:"phone",type:"tel",value:i.phone||"",onChange:e=>o({...i,phone:e.target.value})})]}),Ne.jsxs("div",{children:[Ne.jsx(Zm,{htmlFor:"email",children:"Email"}),Ne.jsx(Bh,{id:"email",type:"email",value:i.email||"",onChange:e=>o({...i,email:e.target.value})})]})]}),Ne.jsxs("div",{className:"flex items-center space-x-2",children:[Ne.jsx(Nb,{id:"is_active",checked:i.is_active,onCheckedChange:e=>o({...i,is_active:e})}),Ne.jsx(Zm,{htmlFor:"is_active",children:"Magasin actif"})]})]}),Ne.jsxs(Cg,{className:"mt-6",children:[Ne.jsx(Vh,{type:"button",variant:"outline",onClick:()=>t(!1),children:"Annuler"}),Ne.jsx(Vh,{type:"submit",disabled:a,children:a?"Enregistrement...":"Enregistrer"})]})]})]})})}function kb({open:e,onOpenChange:t,onSuccess:s}){const{toast:r}=is(),{user:a,userProfile:n}=Ih(),[i,o]=Nt.useState(!1),[l,c]=Nt.useState([]),[d,u]=Nt.useState([]),[h,m]=Nt.useState([]),[p,f]=Nt.useState(null),[x,g]=Nt.useState({source_store_id:"",destination_store_id:"",product_id:"",quantity:0,notes:""});Nt.useEffect(()=>{e&&(v(),j(),b())},[e]),Nt.useEffect(()=>{x.source_store_id&&x.product_id&&y()},[x.source_store_id,x.product_id]);const v=async()=>{try{const{data:e,error:t}=await Dh.from("products").select("id, name, sku").eq("is_active",!0).order("name");if(t)throw t;c(e||[])}catch(e){r({title:"Erreur",description:"Impossible de charger les produits",variant:"destructive"})}},j=async()=>{try{if(!(null==n?void 0:n.id)||!(null==n?void 0:n.role))return void r({title:"Erreur",description:"Informations utilisateur manquantes",variant:"destructive"});const[e,t]=await Promise.all([Iy(n.id,n.role),Fy()]);u(e),m(t),0===e.length&&r({title:"Attention",description:"Aucun magasin source accessible. Contactez votre administrateur.",variant:"destructive"}),0===t.length&&r({title:"Attention",description:"Aucun magasin destination disponible. Contactez votre administrateur.",variant:"destructive"})}catch(e){r({title:"Erreur",description:"Impossible de charger la liste des magasins",variant:"destructive"})}},y=async()=>{try{const{data:e,error:t}=await Dh.from("product_stores").select("current_stock").eq("product_id",x.product_id).eq("store_id",x.source_store_id).single();if(t)throw t;f((null==e?void 0:e.current_stock)||0)}catch(e){f(0)}},b=()=>{g({source_store_id:"",destination_store_id:"",product_id:"",quantity:0,notes:""}),f(null)};l.find(e=>e.id===x.product_id);const w=d.find(e=>e.id===x.source_store_id);return h.find(e=>e.id===x.destination_store_id),Ne.jsx(bg,{open:e,onOpenChange:t,children:Ne.jsxs(kg,{className:"max-w-md",children:[Ne.jsxs(Sg,{children:[Ne.jsxs(Eg,{className:"flex items-center gap-2",children:[Ne.jsx(la,{className:"w-5 h-5"}),"Transfert entre Magasins"]}),Ne.jsx(Mg,{children:"Transfrer des produits d'un magasin  un autre"})]}),Ne.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!x.source_store_id||!x.destination_store_id||!x.product_id||x.quantity<=0)return void r({title:"Donnes manquantes",description:"Veuillez remplir tous les champs requis",variant:"destructive"});if(x.source_store_id===x.destination_store_id)return void r({title:"Magasins identiques",description:"Le magasin source et destination ne peuvent pas tre identiques",variant:"destructive"});if(!(null==n?void 0:n.id)||!(null==n?void 0:n.role))return void r({title:"Erreur",description:"Informations utilisateur manquantes",variant:"destructive"});if(!d.some(e=>e.id===x.source_store_id))return void r({title:"Permission refuse",description:"Vous n'avez pas accs au magasin source slectionn",variant:"destructive"});if(h.some(e=>e.id===x.destination_store_id)){if((null==n?void 0:n.id)&&(null==n?void 0:n.role)){const e=await(async(e,t,s,r)=>{try{return await qy(e,s,t)?s===r?{canCreate:!1,error:"Le magasin source et destination doivent tre diffrents"}:{canCreate:!0}:{canCreate:!1,error:"Vous n'avez pas accs au magasin source. Vous devez tre assign  ce magasin pour transfrer des produits."}}catch(a){return{canCreate:!1,error:"Erreur lors de la vrification des permissions"}}})(n.id,n.role,x.source_store_id,x.destination_store_id);if(!e.canCreate)return void r({title:"Permission refuse",description:e.error||"Vous n'avez pas les permissions pour crer ce transfert",variant:"destructive"})}if(null==n?void 0:n.id){o(!0);try{const e=await Ry(x.source_store_id,x.product_id,x.quantity);if(!e.available)return void r({title:"Stock insuffisant",description:`Stock disponible: ${e.current_stock}, Quantit demande: ${x.quantity}`,variant:"destructive"});const a=await Oy({source_store_id:x.source_store_id,destination_store_id:x.destination_store_id,product_id:x.product_id,quantity:x.quantity,notes:x.notes,created_by:n.id});if(!a.success)throw new Error(a.error);r({title:"Transfert cr",description:`Transfert de ${x.quantity} units cr avec succs`}),s(),t(!1)}catch(a){r({title:"Erreur",description:"Erreur lors de la cration du transfert",variant:"destructive"})}finally{o(!1)}}else r({title:"Erreur",description:"Profil utilisateur non disponible",variant:"destructive"})}else r({title:"Magasin invalide",description:"Le magasin destination slectionn n'existe pas",variant:"destructive"})},className:"space-y-4",children:[Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsxs(Zm,{className:"flex items-center gap-2",children:[Ne.jsx(Ur,{className:"w-4 h-4"}),"Magasin Source",Ne.jsx("span",{className:"text-xs text-muted-foreground",children:"(Vos magasins assigns)"})]}),Ne.jsx(av,{value:x.source_store_id,onValueChange:e=>g(t=>({...t,source_store_id:e})),options:d.map(e=>({value:e.id,label:e.name})),placeholder:"Slectionner le magasin source"}),0===d.length&&Ne.jsx("p",{className:"text-xs text-destructive",children:"Vous devez tre assign  au moins un magasin pour crer des transferts"})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsxs(Zm,{className:"flex items-center gap-2",children:[Ne.jsx(la,{className:"w-4 h-4"}),"Magasin Destination",Ne.jsx("span",{className:"text-xs text-muted-foreground",children:"(Tous les magasins disponibles)"})]}),Ne.jsx(av,{value:x.destination_store_id,onValueChange:e=>g(t=>({...t,destination_store_id:e})),options:h.filter(e=>e.id!==x.source_store_id).map(e=>({value:e.id,label:e.name})),placeholder:"Slectionner le magasin destination"}),0===h.length&&Ne.jsx("p",{className:"text-xs text-destructive",children:"Aucun magasin destination disponible"})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{children:"Produit"}),Ne.jsx(av,{value:x.product_id,onValueChange:e=>g(t=>({...t,product_id:e})),options:l.map(e=>({value:e.id,label:`${e.name} - ${e.sku}`})),placeholder:"Slectionner un produit"})]}),null!==p&&Ne.jsx("div",{className:"p-3 bg-muted rounded-lg",children:Ne.jsxs("p",{className:"text-sm",children:[Ne.jsxs("strong",{children:["Stock disponible dans ",null==w?void 0:w.name,":"]})," ",p," units"]})}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{htmlFor:"quantity",children:"Quantit  transfrer"}),Ne.jsx(Bh,{id:"quantity",type:"number",min:"1",max:p||void 0,value:x.quantity,onChange:e=>g(t=>({...t,quantity:parseInt(e.target.value)||0})),required:!0})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{htmlFor:"notes",children:"Notes (optionnel)"}),Ne.jsx(Tg,{id:"notes",value:x.notes,onChange:e=>g(t=>({...t,notes:e.target.value})),placeholder:"Raison du transfert, urgence, etc."})]}),Ne.jsxs("div",{className:"flex justify-end gap-2",children:[Ne.jsx(Vh,{type:"button",variant:"outline",onClick:()=>t(!1),children:"Annuler"}),Ne.jsxs(Vh,{type:"submit",disabled:i||null===p||x.quantity>(p||0),children:[i&&Ne.jsx(Rr,{className:"mr-2 h-4 w-4 animate-spin"}),"Crer le Transfert"]})]})]})]})})}function Sb(){const[e,t]=Nt.useState(""),[s,r]=Nt.useState([]),[a,n]=Nt.useState(!0),[i,o]=Nt.useState(null),[l,c]=Nt.useState(!1),[d,u]=Nt.useState(!1),{toast:h}=is();Nt.useEffect(()=>{m()},[]);const m=async()=>{try{const{data:e,error:t}=await Dh.from("stores").select("*").order("created_at",{ascending:!1});if(t)throw t;r(e||[])}catch(e){h({title:"Erreur",description:"Impossible de charger les magasins",variant:"destructive"})}finally{n(!1)}},p=()=>{o(null),c(!0)},f=useMemo(()=>{const t=e=>e?String(e).normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase():"",r=t(e).split(/\s+/).filter(Boolean);return 0===r.length?s:s.filter(e=>{const s=[e.name,e.code,e.address,e.email,e.phone],a=t(s.filter(Boolean).join(" "));return r.every(e=>a.includes(e))})},[s,e]),x=s.length,g=s.filter(e=>e.is_active).length;return Ne.jsxs("div",{className:"space-y-6",children:[Ne.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[Ne.jsxs("div",{children:[Ne.jsxs("h1",{className:"text-2xl md:text-3xl font-bold flex items-center gap-2",children:[Ne.jsx(ra,{className:"w-7 h-7 text-primary"}),"Magasins"]}),Ne.jsx("p",{className:"text-muted-foreground",children:"Grez vos points de vente et entrepts"})]}),Ne.jsxs("div",{className:"flex gap-2",children:[Ne.jsxs(Vh,{onClick:()=>u(!0),variant:"outline",size:"touch",className:"gap-2",children:[Ne.jsx(ar,{className:"w-4 h-4"}),"Transfert"]}),Ne.jsxs(Vh,{onClick:p,size:"touch",className:"gap-2",children:[Ne.jsx(Yr,{className:"w-4 h-4"}),"Nouveau magasin"]})]})]}),Ne.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Ne.jsx(Vm,{className:"text-sm font-medium",children:"Total magasins"}),Ne.jsx(ra,{className:"h-4 w-4 text-muted-foreground"})]}),Ne.jsxs(Hm,{children:[Ne.jsx("div",{className:"text-2xl font-bold",children:x}),Ne.jsx("p",{className:"text-xs text-muted-foreground",children:"Points de vente"})]})]}),Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Ne.jsx(Vm,{className:"text-sm font-medium",children:"Magasins actifs"}),Ne.jsx(ra,{className:"h-4 w-4 text-success"})]}),Ne.jsxs(Hm,{children:[Ne.jsx("div",{className:"text-2xl font-bold text-success",children:g}),Ne.jsx("p",{className:"text-xs text-muted-foreground",children:"En fonctionnement"})]})]}),Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Ne.jsx(Vm,{className:"text-sm font-medium",children:"Transferts en cours"}),Ne.jsx(ar,{className:"h-4 w-4 text-muted-foreground"})]}),Ne.jsxs(Hm,{children:[Ne.jsx("div",{className:"text-2xl font-bold",children:"-"}),Ne.jsx("p",{className:"text-xs text-muted-foreground",children:"En attente validation"})]})]}),Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Ne.jsx(Vm,{className:"text-sm font-medium",children:"Taux activit"}),Ne.jsx(ra,{className:"h-4 w-4 text-info"})]}),Ne.jsxs(Hm,{children:[Ne.jsxs("div",{className:"text-2xl font-bold text-info",children:[x>0?Math.round(g/x*100):0,"%"]}),Ne.jsx("p",{className:"text-xs text-muted-foreground",children:"Magasins actifs"})]})]})]}),Ne.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[Ne.jsxs("div",{className:"relative flex-1",children:[Ne.jsx(Xr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),Ne.jsx(Bh,{placeholder:"Rechercher un magasin...",value:e,onChange:e=>t(e.target.value),className:"pl-10"})]}),Ne.jsxs(Vh,{variant:"outline",size:"touch",className:"gap-2",children:[Ne.jsx(Mr,{className:"w-4 h-4"}),"Filtres"]})]}),Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{children:[Ne.jsx(Vm,{children:"Liste des magasins"}),Ne.jsx(Bm,{children:"Grez vos points de vente et leurs informations"})]}),Ne.jsx(Hm,{children:a?Ne.jsx("div",{className:"flex items-center justify-center py-12",children:Ne.jsx("div",{className:"text-muted-foreground",children:"Chargement..."})}):0===f.length?Ne.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[Ne.jsx(ra,{className:"w-16 h-16 text-muted-foreground/20 mb-4"}),Ne.jsx("p",{className:"text-muted-foreground mb-4",children:"Aucun magasin trouv"}),Ne.jsx(Vh,{onClick:p,variant:"outline",children:"Crer un magasin"})]}):Ne.jsxs(fg,{children:[Ne.jsx(xg,{children:Ne.jsxs(vg,{children:[Ne.jsx(jg,{children:"Nom"}),Ne.jsx(jg,{children:"Adresse"}),Ne.jsx(jg,{children:"Contact"}),Ne.jsx(jg,{children:"Statut"}),Ne.jsx(jg,{children:"Actions"})]})}),Ne.jsx(gg,{children:f.map(e=>{return Ne.jsxs(vg,{children:[Ne.jsx(yg,{className:"font-medium",children:e.name}),Ne.jsx(yg,{children:e.address?Ne.jsxs("div",{className:"flex items-start gap-1",children:[Ne.jsx(Ir,{className:"w-3 h-3 text-muted-foreground mt-0.5 shrink-0"}),Ne.jsx("span",{className:"text-sm max-w-[200px]",children:e.address})]}):Ne.jsx("span",{className:"text-muted-foreground text-sm",children:"Non renseigne"})}),Ne.jsx(yg,{children:Ne.jsxs("div",{className:"space-y-1",children:[e.phone&&Ne.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[Ne.jsx(Hr,{className:"w-3 h-3 text-muted-foreground"}),e.phone]}),e.email&&Ne.jsx("div",{className:"text-xs text-muted-foreground",children:e.email}),!e.phone&&!e.email&&Ne.jsx("span",{className:"text-muted-foreground text-sm",children:"Non renseign"})]})}),Ne.jsx(yg,{children:(t=e.is_active,t?Ne.jsx(Cp,{variant:"default",className:"bg-success text-success-foreground",children:"Actif"}):Ne.jsx(Cp,{variant:"destructive",children:"Inactif"}))}),Ne.jsx(yg,{children:Ne.jsxs(Om,{children:[Ne.jsx(qm,{asChild:!0,children:Ne.jsx(Vh,{variant:"ghost",className:"h-8 w-8 p-0",children:Ne.jsx(zr,{className:"h-4 w-4"})})}),Ne.jsxs(Im,{align:"end",children:[Ne.jsx(Fm,{onClick:()=>(e=>{o(e),c(!0)})(e),children:"Modifier"}),Ne.jsx(Fm,{children:"Voir inventaire"}),Ne.jsx(Fm,{className:"text-destructive",onClick:()=>(async e=>{try{const{error:t}=await Dh.from("stores").delete().eq("id",e);if(t)throw t;h({title:"Succs",description:"Magasin supprim avec succs"}),m()}catch(t){h({title:"Erreur",description:"Erreur lors de la suppression",variant:"destructive"})}})(e.id),children:"Supprimer"})]})]})})]},e.id);var t})})]})})]}),Ne.jsx(_b,{open:l,onOpenChange:c,store:i,onSuccess:m}),Ne.jsx(kb,{open:d,onOpenChange:u,onSuccess:()=>{h({title:"Succs",description:"Demande de transfert cre"})}})]})}function Cb({open:e,onOpenChange:t,supplier:s,onSuccess:r}){const[a,n]=Nt.useState(!1),[i,o]=Nt.useState({name:"",contact_person:"",email:"",phone:"",address:"",is_active:!0}),{toast:l}=is();Nt.useEffect(()=>{o(s||{name:"",contact_person:"",email:"",phone:"",address:"",is_active:!0})},[s]);return Ne.jsx(bg,{open:e,onOpenChange:t,children:Ne.jsxs(kg,{children:[Ne.jsxs(Sg,{children:[Ne.jsxs(Eg,{children:[s?"Modifier":"Crer"," un fournisseur"]}),Ne.jsx(Mg,{children:s?"Modifiez les informations du fournisseur":"Crez un nouveau fournisseur"})]}),Ne.jsxs("form",{onSubmit:async e=>{e.preventDefault(),n(!0);try{if(null==s?void 0:s.id){const{error:e}=await Dh.from("suppliers").update({name:i.name,contact_person:i.contact_person||null,email:i.email||null,phone:i.phone||null,address:i.address||null,is_active:i.is_active}).eq("id",s.id);if(e)throw e;l({title:"Succs",description:"Fournisseur modifi avec succs"})}else{const{error:e}=await Dh.from("suppliers").insert({name:i.name,contact_person:i.contact_person||null,email:i.email||null,phone:i.phone||null,address:i.address||null,is_active:i.is_active});if(e)throw e;l({title:"Succs",description:"Fournisseur cr avec succs"})}r(),t(!1)}catch(a){l({title:"Erreur",description:a.message||"Erreur lors de l'enregistrement",variant:"destructive"})}finally{n(!1)}},children:[Ne.jsxs("div",{className:"space-y-4",children:[Ne.jsxs("div",{children:[Ne.jsx(Zm,{htmlFor:"name",children:"Nom du fournisseur *"}),Ne.jsx(Bh,{id:"name",value:i.name,onChange:e=>o({...i,name:e.target.value}),required:!0})]}),Ne.jsxs("div",{children:[Ne.jsx(Zm,{htmlFor:"contact_person",children:"Personne de contact"}),Ne.jsx(Bh,{id:"contact_person",value:i.contact_person||"",onChange:e=>o({...i,contact_person:e.target.value})})]}),Ne.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[Ne.jsxs("div",{children:[Ne.jsx(Zm,{htmlFor:"email",children:"Email"}),Ne.jsx(Bh,{id:"email",type:"email",value:i.email||"",onChange:e=>o({...i,email:e.target.value})})]}),Ne.jsxs("div",{children:[Ne.jsx(Zm,{htmlFor:"phone",children:"Tlphone"}),Ne.jsx(Bh,{id:"phone",type:"tel",value:i.phone||"",onChange:e=>o({...i,phone:e.target.value})})]})]}),Ne.jsxs("div",{children:[Ne.jsx(Zm,{htmlFor:"address",children:"Adresse"}),Ne.jsx(Tg,{id:"address",value:i.address||"",onChange:e=>o({...i,address:e.target.value}),rows:2})]}),Ne.jsxs("div",{className:"flex items-center space-x-2",children:[Ne.jsx(Nb,{id:"is_active",checked:i.is_active,onCheckedChange:e=>o({...i,is_active:e})}),Ne.jsx(Zm,{htmlFor:"is_active",children:"Fournisseur actif"})]})]}),Ne.jsxs(Cg,{className:"mt-6",children:[Ne.jsx(Vh,{type:"button",variant:"outline",onClick:()=>t(!1),children:"Annuler"}),Ne.jsx(Vh,{type:"submit",disabled:a,children:a?"Enregistrement...":"Enregistrer"})]})]})]})})}function Eb(){const[e,t]=Nt.useState(""),[s,r]=Nt.useState([]),[a,n]=Nt.useState(!0),[i,o]=Nt.useState(null),[l,c]=Nt.useState(!1),{toast:d}=is();Nt.useEffect(()=>{u()},[]);const u=async()=>{try{const{data:e,error:t}=await Dh.from("suppliers").select("*").order("created_at",{ascending:!1});if(t)throw t;r(e||[])}catch(e){d({title:"Erreur",description:"Impossible de charger les fournisseurs",variant:"destructive"})}finally{n(!1)}},h=()=>{o(null),c(!0)},m=useMemo(()=>{const t=e=>e?String(e).normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase():"",r=t(e).split(/\s+/).filter(Boolean);return 0===r.length?s:s.filter(e=>{const s=[e.name,e.contact_person,e.phone,e.email],a=t(s.filter(Boolean).join(" "));return r.every(e=>a.includes(e))})},[s,e]),p=s.length,f=s.filter(e=>e.is_active).length;return Ne.jsxs("div",{className:"space-y-6",children:[Ne.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[Ne.jsxs("div",{children:[Ne.jsxs("h1",{className:"text-2xl md:text-3xl font-bold flex items-center gap-2",children:[Ne.jsx(la,{className:"w-7 h-7 text-primary"}),"Fournisseurs"]}),Ne.jsx("p",{className:"text-muted-foreground",children:"Grez vos fournisseurs et partenaires commerciaux"})]}),Ne.jsxs(Vh,{onClick:h,size:"touch",className:"gap-2",children:[Ne.jsx(Yr,{className:"w-4 h-4"}),"Nouveau fournisseur"]})]}),Ne.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Ne.jsx(Vm,{className:"text-sm font-medium",children:"Total fournisseurs"}),Ne.jsx(la,{className:"h-4 w-4 text-muted-foreground"})]}),Ne.jsxs(Hm,{children:[Ne.jsx("div",{className:"text-2xl font-bold",children:p}),Ne.jsx("p",{className:"text-xs text-muted-foreground",children:"Partenaires"})]})]}),Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Ne.jsx(Vm,{className:"text-sm font-medium",children:"Fournisseurs actifs"}),Ne.jsx(la,{className:"h-4 w-4 text-success"})]}),Ne.jsxs(Hm,{children:[Ne.jsx("div",{className:"text-2xl font-bold text-success",children:f}),Ne.jsx("p",{className:"text-xs text-muted-foreground",children:"En activit"})]})]}),Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Ne.jsx(Vm,{className:"text-sm font-medium",children:"Commandes ce mois"}),Ne.jsx(la,{className:"h-4 w-4 text-muted-foreground"})]}),Ne.jsxs(Hm,{children:[Ne.jsx("div",{className:"text-2xl font-bold",children:"-"}),Ne.jsx("p",{className:"text-xs text-muted-foreground",children:" implmenter"})]})]}),Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Ne.jsx(Vm,{className:"text-sm font-medium",children:"Taux activit"}),Ne.jsx(la,{className:"h-4 w-4 text-info"})]}),Ne.jsxs(Hm,{children:[Ne.jsxs("div",{className:"text-2xl font-bold text-info",children:[p>0?Math.round(f/p*100):0,"%"]}),Ne.jsx("p",{className:"text-xs text-muted-foreground",children:"Fournisseurs actifs"})]})]})]}),Ne.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[Ne.jsxs("div",{className:"relative flex-1",children:[Ne.jsx(Xr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),Ne.jsx(Bh,{placeholder:"Rechercher un fournisseur...",value:e,onChange:e=>t(e.target.value),className:"pl-10"})]}),Ne.jsxs(Vh,{variant:"outline",size:"touch",className:"gap-2",children:[Ne.jsx(Mr,{className:"w-4 h-4"}),"Filtres"]})]}),Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{children:[Ne.jsx(Vm,{children:"Liste des fournisseurs"}),Ne.jsx(Bm,{children:"Grez vos fournisseurs et leurs informations"})]}),Ne.jsx(Hm,{children:a?Ne.jsx("div",{className:"flex items-center justify-center py-12",children:Ne.jsx("div",{className:"text-muted-foreground",children:"Chargement..."})}):0===m.length?Ne.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[Ne.jsx(la,{className:"w-16 h-16 text-muted-foreground/20 mb-4"}),Ne.jsx("p",{className:"text-muted-foreground mb-4",children:"Aucun fournisseur trouv"}),Ne.jsx(Vh,{onClick:h,variant:"outline",children:"Crer un fournisseur"})]}):Ne.jsxs(fg,{children:[Ne.jsx(xg,{children:Ne.jsxs(vg,{children:[Ne.jsx(jg,{children:"Nom"}),Ne.jsx(jg,{children:"Contact"}),Ne.jsx(jg,{children:"Coordonnes"}),Ne.jsx(jg,{children:"Adresse"}),Ne.jsx(jg,{children:"Statut"}),Ne.jsx(jg,{children:"Actions"})]})}),Ne.jsx(gg,{children:m.map(e=>{return Ne.jsxs(vg,{children:[Ne.jsx(yg,{className:"font-medium",children:e.name}),Ne.jsx(yg,{children:e.contact_person?Ne.jsxs("div",{className:"flex items-center gap-1",children:[Ne.jsx(ha,{className:"w-3 h-3 text-muted-foreground"}),Ne.jsx("span",{className:"text-sm",children:e.contact_person})]}):Ne.jsx("span",{className:"text-muted-foreground text-sm",children:"Non renseign"})}),Ne.jsx(yg,{children:Ne.jsxs("div",{className:"space-y-1",children:[e.phone&&Ne.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[Ne.jsx(Hr,{className:"w-3 h-3 text-muted-foreground"}),e.phone]}),e.email&&Ne.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[Ne.jsx(qr,{className:"w-3 h-3 text-muted-foreground"}),e.email]}),!e.phone&&!e.email&&Ne.jsx("span",{className:"text-muted-foreground text-sm",children:"Non renseignes"})]})}),Ne.jsx(yg,{children:e.address?Ne.jsxs("div",{className:"flex items-start gap-1",children:[Ne.jsx(Ir,{className:"w-3 h-3 text-muted-foreground mt-0.5 shrink-0"}),Ne.jsx("span",{className:"text-sm max-w-[200px]",children:e.address})]}):Ne.jsx("span",{className:"text-muted-foreground text-sm",children:"Non renseigne"})}),Ne.jsx(yg,{children:(t=e.is_active,t?Ne.jsx(Cp,{variant:"default",className:"bg-success text-success-foreground",children:"Actif"}):Ne.jsx(Cp,{variant:"destructive",children:"Inactif"}))}),Ne.jsx(yg,{children:Ne.jsxs(Om,{children:[Ne.jsx(qm,{asChild:!0,children:Ne.jsx(Vh,{variant:"ghost",className:"h-8 w-8 p-0",children:Ne.jsx(zr,{className:"h-4 w-4"})})}),Ne.jsxs(Im,{align:"end",children:[Ne.jsx(Fm,{onClick:()=>(e=>{o(e),c(!0)})(e),children:"Modifier"}),Ne.jsx(Fm,{children:"Voir commandes"}),Ne.jsx(Fm,{className:"text-destructive",onClick:()=>(async e=>{try{const{error:t}=await Dh.from("suppliers").delete().eq("id",e);if(t)throw t;d({title:"Succs",description:"Fournisseur supprim avec succs"}),u()}catch(t){d({title:"Erreur",description:t.message||"Erreur lors de la suppression",variant:"destructive"})}})(e.id),children:"Supprimer"})]})]})})]},e.id);var t})})]})})]}),Ne.jsx(Cb,{open:l,onOpenChange:c,supplier:i,onSuccess:u})]})}function Mb({open:e,onOpenChange:t,onSuccess:s}){const[r,a]=Nt.useState(!1),[n,i]=Nt.useState([]),[o,l]=Nt.useState(new Date),{toast:c}=is(),{userProfile:d}=Ih(),[u,h]=Nt.useState({title:"",category:"",amount:"",description:"",store_id:"all"});Nt.useEffect(()=>{e&&m()},[e]);const m=async()=>{try{const{data:e,error:t}=await Dh.from("stores").select("id, name").eq("is_active",!0).order("name");if(t)throw t;i(e||[])}catch(e){c({title:"Erreur",description:"Impossible de charger les magasins",variant:"destructive"})}},p=(e,t)=>{h(s=>({...s,[e]:t}))};return Ne.jsx(bg,{open:e,onOpenChange:t,children:Ne.jsxs(kg,{className:"sm:max-w-[500px]",children:[Ne.jsxs(Sg,{children:[Ne.jsx(Eg,{children:"Nouvelle Dpense"}),Ne.jsx(Mg,{children:"Enregistrez une nouvelle dpense pour le suivi financier"})]}),Ne.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),d){if(u.title.trim()?u.category?u.amount&&lv(parseFloat(u.amount))||(c({title:"Erreur",description:"Le montant doit tre valide",variant:"destructive"}),0):(c({title:"Erreur",description:"La catgorie est obligatoire",variant:"destructive"}),0):(c({title:"Erreur",description:"Le titre est obligatoire",variant:"destructive"}),0))if(o&&o>new Date)c({title:"Erreur",description:"La date de dpense ne peut pas tre dans le futur",variant:"destructive"});else{a(!0);try{const e={title:u.title,category:u.category,amount:parseFloat(u.amount),description:u.description||null,store_id:"all"===u.store_id?null:u.store_id,expense_date:null==o?void 0:o.toISOString().split("T")[0],created_by:d.id},{error:r}=await Dh.from("expenses").insert(e);if(r)throw new Error(r.message||"Erreur lors de l'enregistrement de la dpense");c({title:"Succs",description:"Dpense enregistre avec succs"}),h({title:"",category:"",amount:"",description:"",store_id:"all"}),l(new Date),s(),t(!1)}catch(r){c({title:"Erreur",description:r.message||"Erreur lors de l'enregistrement",variant:"destructive"})}finally{a(!1)}}}else c({title:"Erreur",description:"Utilisateur non connect",variant:"destructive"})},className:"space-y-4",children:[Ne.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{htmlFor:"title",children:"Titre *"}),Ne.jsx(Bh,{id:"title",value:u.title,onChange:e=>p("title",e.target.value),placeholder:"Ex: Facture lectricit",required:!0})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{htmlFor:"category",children:"Catgorie *"}),Ne.jsxs(Kf,{value:u.category,onValueChange:e=>p("category",e),children:[Ne.jsx(Gf,{children:Ne.jsx(Yf,{placeholder:"Slectionner une catgorie"})}),Ne.jsx(Xf,{children:["Loyer","lectricit","Eau","Internet/Tlphone","Assurance","Maintenance","Matriel","Marketing","Formation","Transport","Frais bancaires","Autre"].map(e=>Ne.jsx(Zf,{value:e,children:e},e))})]})]})]}),Ne.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{htmlFor:"amount",children:"Montant *"}),Ne.jsx(Bh,{id:"amount",type:"number",step:"0.01",value:u.amount,onChange:e=>p("amount",e.target.value),placeholder:"0.00",required:!0})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{htmlFor:"store",children:"Magasin"}),Ne.jsx(av,{value:u.store_id,onValueChange:e=>p("store_id",e),options:[{value:"all",label:"Tous les magasins"},...n.map(e=>({value:e.id,label:e.name}))],placeholder:"Slectionner un magasin"})]})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{htmlFor:"date",children:"Date de la dpense"}),Ne.jsxs(tv,{children:[Ne.jsx(sv,{asChild:!0,children:Ne.jsxs(Vh,{variant:"outline",className:un("w-full justify-start text-left font-normal",!o&&"text-muted-foreground"),children:[Ne.jsx(dr,{className:"mr-2 h-4 w-4"}),o?lg(o,"PPP",{locale:mg}):Ne.jsx("span",{children:"Slectionner une date"})]})}),Ne.jsx(rv,{className:"w-auto p-0",children:Ne.jsx(Ny,{mode:"single",selected:o,onSelect:e=>l(e||new Date),initialFocus:!0})})]})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{htmlFor:"description",children:"Description"}),Ne.jsx(Tg,{id:"description",value:u.description,onChange:e=>p("description",e.target.value),placeholder:"Description optionnelle de la dpense...",rows:3})]}),Ne.jsxs(Cg,{children:[Ne.jsx(Vh,{type:"button",variant:"outline",onClick:()=>t(!1),children:"Annuler"}),Ne.jsx(Vh,{type:"submit",disabled:r,children:r?"Enregistrement...":"Enregistrer"})]})]})]})})}function Tb(){const{formatAmount:e}=rx(),[t,s]=Nt.useState(""),[r,a]=Nt.useState(!1),[n,i]=Nt.useState([]),[o,l]=Nt.useState({totalRevenue:0,totalExpenses:0,netProfit:0,monthlyGrowth:0}),[c,d]=Nt.useState(!0),{toast:u}=is(),{userProfile:h}=Ih();Nt.useEffect(()=>{m()},[]);const m=async()=>{try{d(!0);const{data:e,error:t}=await Dh.from("expenses").select("\n          *,\n          stores(name)\n        ").order("expense_date",{ascending:!1});if(t)throw t;const{data:s,error:r}=await Dh.from("sales").select("total_amount, created_at").gte("created_at",new Date((new Date).getFullYear(),(new Date).getMonth(),1).toISOString());if(r)throw r;const a=(null==e?void 0:e.reduce((e,t)=>e+t.amount,0))||0,n=(null==s?void 0:s.reduce((e,t)=>e+t.total_amount,0))||0,o=n-a,c=new Date((new Date).getFullYear(),(new Date).getMonth()-1,1),{data:u}=await Dh.from("sales").select("total_amount, created_at").gte("created_at",c.toISOString()).lt("created_at",new Date((new Date).getFullYear(),(new Date).getMonth(),1).toISOString()),h=(null==u?void 0:u.reduce((e,t)=>e+t.total_amount,0))||0,m=h>0?(n-h)/h*100:0;i(e||[]),l({totalRevenue:n,totalExpenses:a,netProfit:o,monthlyGrowth:m})}catch(e){u({title:"Erreur",description:"Impossible de charger les donnes financires",variant:"destructive"})}finally{d(!1)}},p=()=>{a(!0)},f=n.filter(e=>e.title.toLowerCase().includes(t.toLowerCase())||e.category.toLowerCase().includes(t.toLowerCase()));return Ne.jsxs("div",{className:"space-y-6",children:[Ne.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[Ne.jsxs("div",{children:[Ne.jsxs("h1",{className:"text-2xl md:text-3xl font-bold flex items-center gap-2",children:[Ne.jsx(_r,{className:"w-7 h-7 text-primary"}),"Gestion Financire"]}),Ne.jsx("p",{className:"text-muted-foreground",children:"Suivi des finances et comptabilit"})]}),Ne.jsxs(Vh,{onClick:p,className:"gap-2",children:[Ne.jsx(Yr,{className:"w-4 h-4"}),"Nouvelle Dpense"]})]}),Ne.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Ne.jsx(Vm,{className:"text-sm font-medium",children:"Revenus Totaux"}),Ne.jsx(ia,{className:"h-4 w-4 text-success"})]}),Ne.jsxs(Hm,{children:[Ne.jsx("div",{className:"text-2xl font-bold",children:e(o.totalRevenue)}),Ne.jsxs("p",{className:"text-xs text-muted-foreground",children:["+",o.monthlyGrowth.toFixed(1),"% par rapport au mois dernier"]})]})]}),Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Ne.jsx(Vm,{className:"text-sm font-medium",children:"Dpenses Totales"}),Ne.jsx(na,{className:"h-4 w-4 text-destructive"})]}),Ne.jsxs(Hm,{children:[Ne.jsx("div",{className:"text-2xl font-bold",children:e(o.totalExpenses)}),Ne.jsx("p",{className:"text-xs text-muted-foreground",children:"Dpenses du mois en cours"})]})]}),Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Ne.jsx(Vm,{className:"text-sm font-medium",children:"Bnfice Net"}),Ne.jsx(_r,{className:"h-4 w-4 text-primary"})]}),Ne.jsxs(Hm,{children:[Ne.jsx("div",{className:"text-2xl font-bold "+(o.netProfit>=0?"text-success":"text-destructive"),children:e(o.netProfit)}),Ne.jsx("p",{className:"text-xs text-muted-foreground",children:o.netProfit>=0?"Bnfice":"Perte"})]})]}),Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Ne.jsx(Vm,{className:"text-sm font-medium",children:"Croissance Mensuelle"}),Ne.jsx(Kr,{className:"h-4 w-4 text-accent"})]}),Ne.jsxs(Hm,{children:[Ne.jsxs("div",{className:"text-2xl font-bold "+(o.monthlyGrowth>=0?"text-success":"text-destructive"),children:[o.monthlyGrowth>=0?"+":"",o.monthlyGrowth.toFixed(1),"%"]}),Ne.jsx("p",{className:"text-xs text-muted-foreground",children:"Par rapport au mois dernier"})]})]})]}),Ne.jsxs(bp,{defaultValue:"expenses",className:"space-y-4",children:[Ne.jsxs(wp,{children:[Ne.jsx(Np,{value:"expenses",children:"Dpenses"}),Ne.jsx(Np,{value:"analytics",children:"Analytics"})]}),Ne.jsx(_p,{value:"expenses",className:"space-y-4",children:Ne.jsxs(Um,{children:[Ne.jsxs(Wm,{children:[Ne.jsx(Vm,{children:"Dpenses"}),Ne.jsx(Bm,{children:"Liste de toutes les dpenses enregistres"}),Ne.jsxs("div",{className:"flex items-center space-x-2",children:[Ne.jsx(Xr,{className:"w-4 h-4 text-muted-foreground"}),Ne.jsx(Bh,{placeholder:"Rechercher une dpense...",value:t,onChange:e=>s(e.target.value),className:"max-w-sm"})]})]}),Ne.jsx(Hm,{children:c?Ne.jsx("div",{className:"flex items-center justify-center py-8",children:Ne.jsx("div",{className:"text-muted-foreground",children:"Chargement..."})}):0===f.length?Ne.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[Ne.jsx(_r,{className:"w-16 h-16 text-muted-foreground/20 mb-4"}),Ne.jsx("p",{className:"text-muted-foreground",children:"Aucune dpense enregistre"}),Ne.jsx(Vh,{onClick:p,className:"mt-4",children:"Ajouter une dpense"})]}):Ne.jsxs(fg,{children:[Ne.jsx(xg,{children:Ne.jsxs(vg,{children:[Ne.jsx(jg,{children:"Dpense"}),Ne.jsx(jg,{children:"Catgorie"}),Ne.jsx(jg,{children:"Montant"}),Ne.jsx(jg,{children:"Magasin"}),Ne.jsx(jg,{children:"Date"})]})}),Ne.jsx(gg,{children:f.map(t=>{var s;return Ne.jsxs(vg,{children:[Ne.jsx(yg,{className:"font-medium",children:t.title}),Ne.jsx(yg,{children:Ne.jsx(Cp,{variant:"outline",children:t.category})}),Ne.jsx(yg,{className:"font-medium text-destructive",children:e(t.amount)}),Ne.jsx(yg,{children:(null==(s=t.stores)?void 0:s.name)||"Tous"}),Ne.jsx(yg,{children:new Date(t.expense_date).toLocaleDateString()})]},t.id)})})]})})]})}),Ne.jsx(_p,{value:"analytics",className:"space-y-4",children:Ne.jsxs(Um,{children:[Ne.jsxs(Wm,{children:[Ne.jsx(Vm,{children:"Analytics Financiers"}),Ne.jsx(Bm,{children:"Graphiques et analyses des performances financires"})]}),Ne.jsx(Hm,{children:Ne.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[Ne.jsx(Kr,{className:"w-16 h-16 text-muted-foreground/20 mb-4"}),Ne.jsx("p",{className:"text-muted-foreground",children:"Graphiques et analytics  venir"}),Ne.jsx("p",{className:"text-sm text-muted-foreground",children:"Intgration de graphiques interactifs pour l'analyse financire"})]})})]})})]}),Ne.jsx(Mb,{open:r,onOpenChange:a,onSuccess:m})]})}function Ab({data:e,title:t,type:s="area"}){const{formatAmount:r}=rx(),a=({active:e,payload:t,label:s})=>e&&t&&t.length?Ne.jsxs("div",{className:"bg-background border rounded-lg p-3 shadow-lg",children:[Ne.jsx("p",{className:"font-medium",children:s}),Ne.jsxs("p",{className:"text-success",children:["Ventes: ",t[0].value]}),Ne.jsxs("p",{className:"text-primary",children:["CA: ",r(t[1].value)]})]}):null;return"line"===s?Ne.jsxs("div",{className:"w-full h-80",children:[Ne.jsx("h3",{className:"text-lg font-semibold mb-4",children:t}),Ne.jsx(Tt,{width:"100%",height:"100%",children:Ne.jsxs(At,{data:e,children:[Ne.jsx(Pt,{strokeDasharray:"3 3",className:"opacity-30"}),Ne.jsx(Dt,{dataKey:"date",className:"text-xs",tick:{fontSize:12}}),Ne.jsx(Rt,{className:"text-xs",tick:{fontSize:12},tickFormatter:e=>e.toLocaleString()}),Ne.jsx(Ot,{content:Ne.jsx(a,{})}),Ne.jsx(qt,{type:"monotone",dataKey:"sales",stroke:"#10b981",strokeWidth:2,dot:{fill:"#10b981",strokeWidth:2,r:4},activeDot:{r:6,stroke:"#10b981",strokeWidth:2}}),Ne.jsx(qt,{type:"monotone",dataKey:"revenue",stroke:"#3b82f6",strokeWidth:2,dot:{fill:"#3b82f6",strokeWidth:2,r:4},activeDot:{r:6,stroke:"#3b82f6",strokeWidth:2}})]})})]}):Ne.jsxs("div",{className:"w-full h-80",children:[Ne.jsx("h3",{className:"text-lg font-semibold mb-4",children:t}),Ne.jsx(Tt,{width:"100%",height:"100%",children:Ne.jsxs(It,{data:e,children:[Ne.jsx(Pt,{strokeDasharray:"3 3",className:"opacity-30"}),Ne.jsx(Dt,{dataKey:"date",className:"text-xs",tick:{fontSize:12}}),Ne.jsx(Rt,{className:"text-xs",tick:{fontSize:12},tickFormatter:e=>e.toLocaleString()}),Ne.jsx(Ot,{content:Ne.jsx(a,{})}),Ne.jsx(Ft,{type:"monotone",dataKey:"sales",stackId:"1",stroke:"#10b981",fill:"#10b981",fillOpacity:.3}),Ne.jsx(Ft,{type:"monotone",dataKey:"revenue",stackId:"2",stroke:"#3b82f6",fill:"#3b82f6",fillOpacity:.3})]})})]})}Nb.displayName=bb.displayName;const Pb=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#06b6d4","#84cc16","#f97316"];function Db({data:e,title:t,type:s="bar",dataKey:r="revenue"}){const{formatAmount:a}=rx(),n=({active:e,payload:t,label:s})=>{if(e&&t&&t.length){const e=t[0].payload;return Ne.jsxs("div",{className:"bg-background border rounded-lg p-3 shadow-lg",children:[Ne.jsx("p",{className:"font-medium",children:s}),Ne.jsxs("p",{className:"text-primary",children:["Quantit: ",e.quantity]}),Ne.jsxs("p",{className:"text-success",children:["CA: ",a(e.revenue)]}),Ne.jsxs("p",{className:"text-warning",children:["Marge: ",e.margin,"%"]})]})}return null},i=({active:e,payload:t})=>{if(e&&t&&t.length){const e=t[0].payload;return Ne.jsxs("div",{className:"bg-background border rounded-lg p-3 shadow-lg",children:[Ne.jsx("p",{className:"font-medium",children:e.name}),Ne.jsxs("p",{className:"text-primary",children:["quantity"===r?"Quantit":"revenue"===r?"CA":"Marge",": ","revenue"===r?a(e[r]):e[r]]})]})}return null};return"pie"===s?Ne.jsxs("div",{className:"w-full h-80",children:[Ne.jsx("h3",{className:"text-lg font-semibold mb-4",children:t}),Ne.jsx(Tt,{width:"100%",height:"100%",children:Ne.jsxs(Lt,{children:[Ne.jsx($t,{data:e,cx:"50%",cy:"50%",labelLine:!1,label:({name:e,percent:t})=>`${e} ${(100*t).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:r,children:e.map((e,t)=>Ne.jsx(zt,{fill:Pb[t%Pb.length]},`cell-${t}`))}),Ne.jsx(Ot,{content:Ne.jsx(i,{})}),Ne.jsx(Ut,{})]})})]}):Ne.jsxs("div",{className:"w-full h-80",children:[Ne.jsx("h3",{className:"text-lg font-semibold mb-4",children:t}),Ne.jsx(Tt,{width:"100%",height:"100%",children:Ne.jsxs(Wt,{data:e,children:[Ne.jsx(Pt,{strokeDasharray:"3 3",className:"opacity-30"}),Ne.jsx(Dt,{dataKey:"name",className:"text-xs",tick:{fontSize:10},angle:-45,textAnchor:"end",height:80}),Ne.jsx(Rt,{className:"text-xs",tick:{fontSize:12},tickFormatter:e=>"revenue"===r?a(e):e.toLocaleString()}),Ne.jsx(Ot,{content:Ne.jsx(n,{})}),Ne.jsx(Vt,{dataKey:r,fill:"#3b82f6",radius:[4,4,0,0]})]})})]})}function Rb({data:e,title:t,type:s="bar"}){const{formatAmount:r}=rx(),a=({active:e,payload:t,label:s})=>{if(e&&t&&t.length){const e=t[0].payload;return Ne.jsxs("div",{className:"bg-background border rounded-lg p-3 shadow-lg",children:[Ne.jsx("p",{className:"font-medium",children:s}),Ne.jsxs("p",{className:"text-primary",children:["Ventes: ",e.sales]}),Ne.jsxs("p",{className:"text-success",children:["CA: ",r(e.revenue)]}),Ne.jsxs("p",{className:"text-warning",children:["Panier moyen: ",formatCurrency(e.avgTicket)]}),Ne.jsxs("p",{className:""+(e.growth>=0?"text-success":"text-destructive"),children:["Croissance: ",e.growth>=0?"+":"",e.growth,"%"]})]})}return null};return"radar"===s?Ne.jsxs("div",{className:"w-full h-80",children:[Ne.jsx("h3",{className:"text-lg font-semibold mb-4",children:t}),Ne.jsx(Tt,{width:"100%",height:"100%",children:Ne.jsxs(Bt,{data:e,children:[Ne.jsx(Ht,{}),Ne.jsx(Kt,{dataKey:"name"}),Ne.jsx(Yt,{}),Ne.jsx(Gt,{name:"Performance",dataKey:"revenue",stroke:"#3b82f6",fill:"#3b82f6",fillOpacity:.3}),Ne.jsx(Ot,{content:Ne.jsx(a,{})})]})})]}):"composed"===s?Ne.jsxs("div",{className:"w-full h-80",children:[Ne.jsx("h3",{className:"text-lg font-semibold mb-4",children:t}),Ne.jsx(Tt,{width:"100%",height:"100%",children:Ne.jsxs(Qt,{data:e,children:[Ne.jsx(Pt,{strokeDasharray:"3 3",className:"opacity-30"}),Ne.jsx(Dt,{dataKey:"name",className:"text-xs",tick:{fontSize:10}}),Ne.jsx(Rt,{className:"text-xs",tick:{fontSize:12},yAxisId:"left",tickFormatter:e=>e.toLocaleString()}),Ne.jsx(Rt,{className:"text-xs",tick:{fontSize:12},yAxisId:"right",orientation:"right",tickFormatter:e=>r(e)}),Ne.jsx(Ot,{content:Ne.jsx(a,{})}),Ne.jsx(Vt,{dataKey:"sales",fill:"#10b981",yAxisId:"left",radius:[4,4,0,0]}),Ne.jsx(qt,{type:"monotone",dataKey:"revenue",stroke:"#3b82f6",strokeWidth:2,yAxisId:"right",dot:{fill:"#3b82f6",strokeWidth:2,r:4}})]})})]}):Ne.jsxs("div",{className:"w-full h-80",children:[Ne.jsx("h3",{className:"text-lg font-semibold mb-4",children:t}),Ne.jsx(Tt,{width:"100%",height:"100%",children:Ne.jsxs(Wt,{data:e,children:[Ne.jsx(Pt,{strokeDasharray:"3 3",className:"opacity-30"}),Ne.jsx(Dt,{dataKey:"name",className:"text-xs",tick:{fontSize:10},angle:-45,textAnchor:"end",height:80}),Ne.jsx(Rt,{className:"text-xs",tick:{fontSize:12},tickFormatter:e=>r(e)}),Ne.jsx(Ot,{content:Ne.jsx(a,{})}),Ne.jsx(Vt,{dataKey:"revenue",fill:"#3b82f6",radius:[4,4,0,0]})]})})]})}function Ob({icon:e,title:t,description:s,action:r,className:a}){return Ne.jsxs("div",{className:un("flex flex-col items-center justify-center py-12 text-center",a),children:[e&&Ne.jsx(e,{className:"h-12 w-12 text-muted-foreground/50 mb-4"}),Ne.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:t}),s&&Ne.jsx("p",{className:"text-sm text-muted-foreground mb-4 max-w-sm",children:s}),r&&Ne.jsx("div",{className:"flex items-center gap-2",children:r})]})}function qb({icon:e=Rr,title:t="Chargement...",description:s,size:r="md",className:a}){return Ne.jsxs("div",{className:un("flex flex-col items-center justify-center py-8 text-center",a),children:[Ne.jsx(e,{className:un("animate-spin text-muted-foreground mb-3",{sm:"h-4 w-4",md:"h-6 w-6",lg:"h-8 w-8"}[r])}),Ne.jsx("h3",{className:"text-sm font-medium text-foreground mb-1",children:t}),s&&Ne.jsx("p",{className:"text-xs text-muted-foreground",children:s})]})}function Ib(){var e,t,s,r,a,n;const{formatAmount:i}=rx(),[o,l]=Nt.useState("graphs"),[c,d]=Nt.useState("7d"),[u,h]=Nt.useState(!0),[m,p]=Nt.useState({salesChartData:[],productChartData:[],storeChartData:[],topProducts:[],storePerformance:[],recentSales:[],stockAlerts:[],userPerformance:[]}),{toast:f}=is();Nt.useEffect(()=>{x()},[c]);const x=async()=>{try{h(!0);const{data:e,error:t}=await Dh.from("sales").select("\n          *,\n          sale_items(*, products(name)),\n          stores(name)\n        ").order("created_at",{ascending:!1});if(t)return void f({title:"Erreur",description:"Impossible de charger les donnes de ventes",variant:"destructive"});const{data:s,error:r}=await Dh.from("product_stores").select("\n          *,\n          products(name, current_sale_price),\n          stores(name)\n        ");if(r)return void f({title:"Erreur",description:"Impossible de charger les donnes d'inventaire",variant:"destructive"});const a=g(e,c),n={};null==e||e.forEach(e=>{var t;null==(t=e.sale_items)||t.forEach(e=>{var t;const s=null==(t=e.products)?void 0:t.name;s&&(n[s]||(n[s]={quantity:0,revenue:0,margin:0}),n[s].quantity+=e.quantity,n[s].revenue+=Number(e.total_price))})});const i=Object.entries(n).map(([e,t])=>{const s=iv(t.revenue,t.quantity,100);return{name:e,...t,margin:Math.max(0,Math.min(100,s))}}).sort((e,t)=>t.revenue-e.revenue).slice(0,10),o={};null==e||e.forEach(e=>{var t;const s=(null==(t=e.stores)?void 0:t.name)||"Magasin principal";o[s]||(o[s]={sales:0,revenue:0,avgTicket:0,growth:0}),o[s].sales+=1,o[s].revenue+=Number(e.total_amount)}),Object.keys(o).forEach(t=>{const s=o[t];s.avgTicket=ov(s.revenue,s.sales);const r="7d"===c?7:"30d"===c?30:90,a=2*r,n=(null==e?void 0:e.filter(e=>{var s;return(null==(s=e.stores)?void 0:s.name)===t&&new Date(e.created_at)>new Date(Date.now()-24*r*60*60*1e3)}).length)||0,i=(null==e?void 0:e.filter(e=>{var s;return(null==(s=e.stores)?void 0:s.name)===t&&new Date(e.created_at)<=new Date(Date.now()-24*r*60*60*1e3)&&new Date(e.created_at)>new Date(Date.now()-24*a*60*60*1e3)}).length)||0;var l,d;s.growth=(l=n,0===(d=i)?l>0?100:0:Math.round((l-d)/d*100))});const l=Object.entries(o).map(([e,t])=>({name:e,...t})),d={};null==e||e.forEach(e=>{var t;const s=e.created_by,r=e.users;s&&(d[s]||(d[s]={id:s,name:r?`${r.first_name} ${r.last_name}`:"Utilisateur",sales:0,revenue:0,avgTicket:0,productsSold:0,efficiency:0}),d[s].sales+=1,d[s].revenue+=Number(e.total_amount),d[s].productsSold+=(null==(t=e.sale_items)?void 0:t.reduce((e,t)=>e+t.quantity,0))||0)}),Object.keys(d).forEach(e=>{const t=d[e];t.avgTicket=ov(t.revenue,t.sales);const s="7d"===c?7:"30d"===c?30:90;t.efficiency=((e,t,s)=>{if(e<=0||s<=0)return 0;const r=e/s,a=t/e;return Math.round(r*a/1e3*100)/100})(t.sales,t.revenue,s)});const u=Object.values(d).sort((e,t)=>t.revenue-e.revenue).slice(0,10);p({salesChartData:a,productChartData:i,storeChartData:l,topProducts:i,storePerformance:l,recentSales:(null==e?void 0:e.slice(0,10))||[],stockAlerts:(null==s?void 0:s.filter(e=>e.quantity<10))||[],userPerformance:u})}catch(e){f({title:"Erreur",description:"Impossible de charger les donnes d'analyse",variant:"destructive"})}finally{h(!1)}},g=(e,t)=>{const s=[];for(let r=("7d"===t?7:"30d"===t?30:90)-1;r>=0;r--){const t=new Date;t.setDate(t.getDate()-r);const a=t.toISOString().split("T")[0],n=(null==e?void 0:e.filter(e=>e.created_at.startsWith(a)))||[],i=n.reduce((e,t)=>e+Number(t.total_amount),0),o=n.length;s.push({date:t.toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit"}),sales:o,revenue:i})}return s};return u?Ne.jsx(qb,{title:"Chargement des analyses",description:"Rcupration des donnes en cours..."}):Ne.jsxs("div",{className:"space-y-6",children:[Ne.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[Ne.jsxs("div",{children:[Ne.jsxs("h1",{className:"text-2xl md:text-3xl font-bold flex items-center gap-2",children:[Ne.jsx(or,{className:"w-7 h-7 text-primary"}),"Analytics"]}),Ne.jsx("p",{className:"text-muted-foreground",children:"Analyse approfondie de vos donnes commerciales"})]}),Ne.jsxs("div",{className:"flex gap-2",children:[Ne.jsxs(Kf,{value:c,onValueChange:d,children:[Ne.jsx(Gf,{className:"w-32",children:Ne.jsx(Yf,{})}),Ne.jsxs(Xf,{children:[Ne.jsx(Zf,{value:"7d",children:"7 jours"}),Ne.jsx(Zf,{value:"30d",children:"30 jours"}),Ne.jsx(Zf,{value:"90d",children:"90 jours"})]})]}),Ne.jsx(Vh,{variant:"outline",onClick:x,children:Ne.jsx(Gr,{className:"w-4 h-4"})}),Ne.jsxs(Vh,{onClick:()=>{f({title:"Export",description:`Export ${"PDF"} en cours de dveloppement`})},children:[Ne.jsx(kr,{className:"w-4 h-4 mr-2"}),"Exporter"]})]})]}),Ne.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Ne.jsx(Vm,{className:"text-sm font-medium",children:"CA Total"}),Ne.jsx(ia,{className:"h-4 w-4 text-success"})]}),Ne.jsxs(Hm,{children:[Ne.jsx("div",{className:"text-2xl font-bold",children:i(m.salesChartData.reduce((e,t)=>e+t.revenue,0))}),Ne.jsx("p",{className:"text-xs text-muted-foreground",children:"7d"===c?"7 derniers jours":"30d"===c?"30 derniers jours":"90 derniers jours"})]})]}),Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Ne.jsx(Vm,{className:"text-sm font-medium",children:"Ventes"}),Ne.jsx(Ur,{className:"h-4 w-4 text-primary"})]}),Ne.jsxs(Hm,{children:[Ne.jsx("div",{className:"text-2xl font-bold",children:m.salesChartData.reduce((e,t)=>e+t.sales,0)}),Ne.jsx("p",{className:"text-xs text-muted-foreground",children:"Transactions totales"})]})]}),Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Ne.jsx(Vm,{className:"text-sm font-medium",children:"Produits"}),Ne.jsx(Ur,{className:"h-4 w-4 text-info"})]}),Ne.jsxs(Hm,{children:[Ne.jsx("div",{className:"text-2xl font-bold",children:m.topProducts.length}),Ne.jsx("p",{className:"text-xs text-muted-foreground",children:"Produits vendus"})]})]}),Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Ne.jsx(Vm,{className:"text-sm font-medium",children:"Magasins"}),Ne.jsx(ra,{className:"h-4 w-4 text-warning"})]}),Ne.jsxs(Hm,{children:[Ne.jsx("div",{className:"text-2xl font-bold",children:m.storePerformance.length}),Ne.jsx("p",{className:"text-xs text-muted-foreground",children:"Magasins actifs"})]})]}),Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Ne.jsx(Vm,{className:"text-sm font-medium",children:"Utilisateurs"}),Ne.jsx(ma,{className:"h-4 w-4 text-purple-500"})]}),Ne.jsxs(Hm,{children:[Ne.jsx("div",{className:"text-2xl font-bold",children:m.userPerformance.length}),Ne.jsx("p",{className:"text-xs text-muted-foreground",children:"Utilisateurs actifs"})]})]})]}),Ne.jsxs(bp,{value:o,onValueChange:l,className:"space-y-4",children:[Ne.jsxs(wp,{className:"grid w-full grid-cols-2",children:[Ne.jsx(Np,{value:"graphs",children:"Graphiques"}),Ne.jsx(Np,{value:"data",children:"Donnes"})]}),Ne.jsxs(_p,{value:"graphs",className:"space-y-6",children:[Ne.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[Ne.jsxs(Um,{children:[Ne.jsxs(Wm,{children:[Ne.jsx(Vm,{children:"volution des Ventes"}),Ne.jsxs(Bm,{children:["Ventes et CA sur ","7d"===c?"7 jours":"30d"===c?"30 jours":"90 jours"]})]}),Ne.jsx(Hm,{children:Ne.jsx(Ab,{data:m.salesChartData,title:"",type:"area"})})]}),Ne.jsxs(Um,{children:[Ne.jsxs(Wm,{children:[Ne.jsx(Vm,{children:"Top Produits par CA"}),Ne.jsx(Bm,{children:"Produits les plus rentables"})]}),Ne.jsx(Hm,{children:Ne.jsx(Db,{data:m.productChartData.slice(0,5),title:"",type:"bar",dataKey:"revenue"})})]})]}),Ne.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[Ne.jsxs(Um,{children:[Ne.jsxs(Wm,{children:[Ne.jsx(Vm,{children:"Rpartition des Produits"}),Ne.jsx(Bm,{children:"Rpartition par quantit vendue"})]}),Ne.jsx(Hm,{children:Ne.jsx(Db,{data:m.productChartData.slice(0,6),title:"",type:"pie",dataKey:"quantity"})})]}),Ne.jsxs(Um,{children:[Ne.jsxs(Wm,{children:[Ne.jsx(Vm,{children:"Performance des Magasins"}),Ne.jsx(Bm,{children:"Ventes et CA par magasin"})]}),Ne.jsx(Hm,{children:Ne.jsx(Rb,{data:m.storeChartData,title:"",type:"composed"})})]})]}),Ne.jsxs(Um,{children:[Ne.jsxs(Wm,{children:[Ne.jsx(Vm,{children:"Performance des Utilisateurs"}),Ne.jsx(Bm,{children:"Top 5 utilisateurs par CA"})]}),Ne.jsx(Hm,{children:Ne.jsx("div",{className:"h-80",children:Ne.jsx("div",{className:"space-y-4",children:m.userPerformance.slice(0,5).map((e,t)=>Ne.jsxs("div",{className:"flex items-center justify-between",children:[Ne.jsxs("div",{className:"flex items-center gap-3",children:[Ne.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center text-sm font-bold",children:t+1}),Ne.jsxs("div",{children:[Ne.jsx("p",{className:"font-medium",children:e.name}),Ne.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.sales," ventes"]})]})]}),Ne.jsxs("div",{className:"text-right",children:[Ne.jsx("p",{className:"font-bold",children:i(e.revenue)}),Ne.jsxs("p",{className:"text-sm text-muted-foreground",children:["Panier: ",i(e.avgTicket)]})]})]},e.id))})})})]}),Ne.jsxs(Um,{children:[Ne.jsxs(Wm,{children:[Ne.jsx(Vm,{children:"Analyse des Tendances"}),Ne.jsx(Bm,{children:"volution dtaille des ventes"})]}),Ne.jsx(Hm,{children:Ne.jsx(Ab,{data:m.salesChartData,title:"",type:"line"})})]})]}),Ne.jsxs(_p,{value:"data",className:"space-y-6",children:[Ne.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[Ne.jsxs(Um,{children:[Ne.jsx(Wm,{className:"pb-2",children:Ne.jsx(Vm,{className:"text-sm",children:"Meilleur Vendeur"})}),Ne.jsxs(Hm,{children:[Ne.jsx("div",{className:"text-lg font-bold",children:(null==(e=m.userPerformance[0])?void 0:e.name)||"N/A"}),Ne.jsxs("p",{className:"text-sm text-muted-foreground",children:[m.userPerformance[0]?i(m.userPerformance[0].revenue):"0"," de CA"]})]})]}),Ne.jsxs(Um,{children:[Ne.jsx(Wm,{className:"pb-2",children:Ne.jsx(Vm,{className:"text-sm",children:"Meilleur Panier"})}),Ne.jsxs(Hm,{children:[Ne.jsx("div",{className:"text-lg font-bold",children:(null==(t=m.userPerformance.sort((e,t)=>t.avgTicket-e.avgTicket)[0])?void 0:t.name)||"N/A"}),Ne.jsxs("p",{className:"text-sm text-muted-foreground",children:[m.userPerformance.sort((e,t)=>t.avgTicket-e.avgTicket)[0]?i(m.userPerformance.sort((e,t)=>t.avgTicket-e.avgTicket)[0].avgTicket):"0"," par vente"]})]})]}),Ne.jsxs(Um,{children:[Ne.jsx(Wm,{className:"pb-2",children:Ne.jsx(Vm,{className:"text-sm",children:"Plus de Ventes"})}),Ne.jsxs(Hm,{children:[Ne.jsx("div",{className:"text-lg font-bold",children:(null==(s=m.userPerformance.sort((e,t)=>t.sales-e.sales)[0])?void 0:s.name)||"N/A"}),Ne.jsxs("p",{className:"text-sm text-muted-foreground",children:[(null==(r=m.userPerformance.sort((e,t)=>t.sales-e.sales)[0])?void 0:r.sales)||0," ventes"]})]})]}),Ne.jsxs(Um,{children:[Ne.jsx(Wm,{className:"pb-2",children:Ne.jsx(Vm,{className:"text-sm",children:"Plus Efficace"})}),Ne.jsxs(Hm,{children:[Ne.jsx("div",{className:"text-lg font-bold",children:(null==(a=m.userPerformance.sort((e,t)=>t.efficiency-e.efficiency)[0])?void 0:a.name)||"N/A"}),Ne.jsxs("p",{className:"text-sm text-muted-foreground",children:["Score: ",(null==(n=m.userPerformance.sort((e,t)=>t.efficiency-e.efficiency)[0])?void 0:n.efficiency.toFixed(2))||"0"]})]})]})]}),Ne.jsxs(Um,{children:[Ne.jsxs(Wm,{children:[Ne.jsx(Vm,{children:"Top Produits"}),Ne.jsx(Bm,{children:"Produits les plus performants"})]}),Ne.jsx(Hm,{children:Ne.jsxs(fg,{children:[Ne.jsx(xg,{children:Ne.jsxs(vg,{children:[Ne.jsx(jg,{children:"Rang"}),Ne.jsx(jg,{children:"Produit"}),Ne.jsx(jg,{children:"Quantit"}),Ne.jsx(jg,{children:"CA"}),Ne.jsx(jg,{children:"Marge"})]})}),Ne.jsx(gg,{children:m.topProducts.map((e,t)=>Ne.jsxs(vg,{children:[Ne.jsx(yg,{children:Ne.jsxs(Cp,{variant:t<3?"default":"secondary",children:["#",t+1]})}),Ne.jsx(yg,{className:"font-medium",children:e.name}),Ne.jsx(yg,{children:e.quantity}),Ne.jsx(yg,{children:i(e.revenue)}),Ne.jsx(yg,{children:Ne.jsxs(Cp,{variant:e.margin>30?"default":"secondary",children:[e.margin,"%"]})})]},e.name))})]})})]}),Ne.jsxs(Um,{children:[Ne.jsxs(Wm,{children:[Ne.jsx(Vm,{children:"Performance des Magasins"}),Ne.jsx(Bm,{children:"Comparaison des performances par magasin"})]}),Ne.jsx(Hm,{children:Ne.jsxs(fg,{children:[Ne.jsx(xg,{children:Ne.jsxs(vg,{children:[Ne.jsx(jg,{children:"Magasin"}),Ne.jsx(jg,{children:"Ventes"}),Ne.jsx(jg,{children:"CA"}),Ne.jsx(jg,{children:"Panier Moyen"}),Ne.jsx(jg,{children:"Croissance"})]})}),Ne.jsx(gg,{children:m.storePerformance.map(e=>Ne.jsxs(vg,{children:[Ne.jsx(yg,{className:"font-medium",children:e.name}),Ne.jsx(yg,{children:e.sales}),Ne.jsx(yg,{children:i(e.revenue)}),Ne.jsx(yg,{children:i(e.avgTicket)}),Ne.jsx(yg,{children:Ne.jsxs(Cp,{variant:e.growth>=0?"default":"destructive",children:[e.growth>=0?"+":"",e.growth,"%"]})})]},e.name))})]})})]}),Ne.jsxs(Um,{children:[Ne.jsxs(Wm,{children:[Ne.jsx(Vm,{children:"Performance des Utilisateurs"}),Ne.jsx(Bm,{children:"Classement des utilisateurs par performance"})]}),Ne.jsx(Hm,{children:0===m.userPerformance.length?Ne.jsx(Ob,{icon:ma,title:"Aucune donne de performance",description:"Aucun utilisateur n'a encore effectu de ventes dans cette priode"}):Ne.jsxs(fg,{children:[Ne.jsx(xg,{children:Ne.jsxs(vg,{children:[Ne.jsx(jg,{children:"Rang"}),Ne.jsx(jg,{children:"Utilisateur"}),Ne.jsx(jg,{children:"Ventes"}),Ne.jsx(jg,{children:"CA"}),Ne.jsx(jg,{children:"Panier Moyen"}),Ne.jsx(jg,{children:"Produits Vendus"}),Ne.jsx(jg,{children:"Efficacit"})]})}),Ne.jsx(gg,{children:m.userPerformance.map((e,t)=>Ne.jsxs(vg,{children:[Ne.jsx(yg,{children:Ne.jsxs(Cp,{variant:t<3?"default":"secondary",children:["#",t+1]})}),Ne.jsx(yg,{className:"font-medium",children:e.name}),Ne.jsx(yg,{children:e.sales}),Ne.jsx(yg,{children:i(e.revenue)}),Ne.jsx(yg,{children:i(e.avgTicket)}),Ne.jsx(yg,{children:e.productsSold}),Ne.jsx(yg,{children:Ne.jsx(Cp,{variant:e.efficiency>.5?"default":e.efficiency>.3?"secondary":"outline",children:e.efficiency.toFixed(2)})})]},e.id))})]})})]}),Ne.jsxs(Um,{children:[Ne.jsxs(Wm,{children:[Ne.jsx(Vm,{children:"Alertes de Stock"}),Ne.jsx(Bm,{children:"Produits ncessitant un rapprovisionnement"})]}),Ne.jsx(Hm,{children:0===m.stockAlerts.length?Ne.jsx(Ob,{icon:Ur,title:"Aucune alerte de stock",description:"Tous les produits ont des stocks suffisants"}):Ne.jsxs(fg,{children:[Ne.jsx(xg,{children:Ne.jsxs(vg,{children:[Ne.jsx(jg,{children:"Produit"}),Ne.jsx(jg,{children:"Stock Actuel"}),Ne.jsx(jg,{children:"Magasin"}),Ne.jsx(jg,{children:"Statut"})]})}),Ne.jsx(gg,{children:m.stockAlerts.map(e=>{var t,s;return Ne.jsxs(vg,{children:[Ne.jsx(yg,{className:"font-medium",children:null==(t=e.products)?void 0:t.name}),Ne.jsx(yg,{children:e.quantity}),Ne.jsx(yg,{children:null==(s=e.stores)?void 0:s.name}),Ne.jsx(yg,{children:Ne.jsx(Cp,{variant:"destructive",children:"Stock Critique"})})]},e.id)})})]})})]})]})]})]})}function Fb(){const{formatAmount:e}=rx(),[t,s]=Nt.useState(""),[r,a]=Nt.useState([]),[n,i]=Nt.useState({totalReports:0,recentReports:0,todayRevenue:0,itemsSold:0}),[o,l]=Nt.useState(!0),{toast:c}=is();Nt.useEffect(()=>{d()},[]);const d=async()=>{try{const{data:e}=await Dh.from("sales").select("*, sale_items(*)"),t=(new Date).toISOString().split("T")[0],s=(null==e?void 0:e.filter(e=>e.created_at.startsWith(t)))||[],r=s.reduce((e,t)=>e+Number(t.total_amount),0),n=s.reduce((e,t)=>{var s;return e+((null==(s=t.sale_items)?void 0:s.reduce((e,t)=>e+t.quantity,0))||0)},0),o=[{id:"RPT001",name:"Rapport des ventes journalires",type:"Ventes",period:"Aujourd'hui",totalSales:r,transactions:s.length,generatedAt:(new Date).toISOString().split("T")[0],status:"Gnr"},{id:"RPT002",name:"Rapport des ventes hebdomadaires",type:"Ventes",period:"Cette semaine",totalSales:7*r,transactions:7*s.length,generatedAt:(new Date).toISOString().split("T")[0],status:"Gnr"},{id:"RPT003",name:"Rapport des ventes mensuelles",type:"Ventes",period:"Ce mois",totalSales:30*r,transactions:30*s.length,generatedAt:(new Date).toISOString().split("T")[0],status:"En cours"}];a(o),i({totalReports:o.length,recentReports:o.length,todayRevenue:r,itemsSold:n})}catch(e){c({title:"Erreur",description:"Impossible de charger les donnes de rapport",variant:"destructive"})}finally{l(!1)}},u=e=>{switch(e){case"Ventes":return Ne.jsx(Cp,{variant:"default",className:"bg-success text-success-foreground",children:e});case"Inventaire":return Ne.jsx(Cp,{variant:"secondary",children:e});case"RH":return Ne.jsx(Cp,{variant:"outline",className:"bg-info/10 text-info",children:e});case"Finance":return Ne.jsx(Cp,{variant:"default",className:"bg-primary text-primary-foreground",children:e});default:return Ne.jsx(Cp,{variant:"outline",children:e})}},h=e=>{switch(e){case"Gnr":return Ne.jsx(Cp,{variant:"default",className:"bg-success text-success-foreground",children:e});case"En cours":return Ne.jsx(Cp,{variant:"secondary",className:"bg-warning/10 text-warning",children:e});default:return Ne.jsx(Cp,{variant:"outline",children:e})}},m=()=>{c({title:"Nouveau Rapport",description:"Fonctionnalit en cours de dveloppement"})},p=e=>{c({title:"Gnration",description:`Gnration du rapport ${e} en cours...`})},f=r.filter(e=>e.name.toLowerCase().includes(t.toLowerCase())||e.type.toLowerCase().includes(t.toLowerCase()));return o?Ne.jsx("div",{className:"flex items-center justify-center py-12",children:Ne.jsx("div",{className:"text-muted-foreground",children:"Chargement des rapports..."})}):Ne.jsxs("div",{className:"space-y-6",children:[Ne.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[Ne.jsxs("div",{children:[Ne.jsxs("h1",{className:"text-2xl md:text-3xl font-bold flex items-center gap-2",children:[Ne.jsx(or,{className:"w-7 h-7 text-primary"}),"Rapports"]}),Ne.jsx("p",{className:"text-muted-foreground",children:"Gestion et gnration de rapports"})]}),Ne.jsxs(Vh,{onClick:m,size:"touch",className:"gap-2",children:[Ne.jsx(Yr,{className:"w-4 h-4"}),"Nouveau rapport"]})]}),Ne.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Ne.jsx(Vm,{className:"text-sm font-medium",children:"Rapports totaux"}),Ne.jsx(or,{className:"h-4 w-4 text-muted-foreground"})]}),Ne.jsxs(Hm,{children:[Ne.jsx("div",{className:"text-2xl font-bold",children:n.totalReports}),Ne.jsx("p",{className:"text-xs text-muted-foreground",children:"Gnrs"})]})]}),Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Ne.jsx(Vm,{className:"text-sm font-medium",children:"Cette semaine"}),Ne.jsx(dr,{className:"h-4 w-4 text-muted-foreground"})]}),Ne.jsxs(Hm,{children:[Ne.jsx("div",{className:"text-2xl font-bold",children:n.recentReports}),Ne.jsx("p",{className:"text-xs text-muted-foreground",children:"Nouveaux rapports"})]})]}),Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Ne.jsx(Vm,{className:"text-sm font-medium",children:"CA aujourd'hui"}),Ne.jsx(ia,{className:"h-4 w-4 text-success"})]}),Ne.jsxs(Hm,{children:[Ne.jsx("div",{className:"text-2xl font-bold text-success",children:e(n.todayRevenue)}),Ne.jsx("p",{className:"text-xs text-muted-foreground",children:"+12% vs hier"})]})]}),Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Ne.jsx(Vm,{className:"text-sm font-medium",children:"Articles vendus"}),Ne.jsx(or,{className:"h-4 w-4 text-info"})]}),Ne.jsxs(Hm,{children:[Ne.jsx("div",{className:"text-2xl font-bold text-info",children:n.itemsSold}),Ne.jsx("p",{className:"text-xs text-muted-foreground",children:"Aujourd'hui"})]})]})]}),Ne.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[Ne.jsxs(Um,{className:"bg-gradient-card shadow-card cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>p("Ventes"),children:[Ne.jsxs(Wm,{className:"text-center",children:[Ne.jsx(ia,{className:"w-12 h-12 text-success mx-auto mb-2"}),Ne.jsx(Vm,{className:"text-lg",children:"Rapport de ventes"}),Ne.jsx(Bm,{children:"Gnrer un rapport des ventes quotidiennes"})]}),Ne.jsx(Hm,{children:Ne.jsx(Vh,{className:"w-full",variant:"outline",children:"Gnrer maintenant"})})]}),Ne.jsxs(Um,{className:"bg-gradient-card shadow-card cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>p("Inventaire"),children:[Ne.jsxs(Wm,{className:"text-center",children:[Ne.jsx(or,{className:"w-12 h-12 text-info mx-auto mb-2"}),Ne.jsx(Vm,{className:"text-lg",children:"Analyse des stocks"}),Ne.jsx(Bm,{children:"Vue d'ensemble de l'tat des stocks"})]}),Ne.jsx(Hm,{children:Ne.jsx(Vh,{className:"w-full",variant:"outline",children:"Analyser stocks"})})]}),Ne.jsxs(Um,{className:"bg-gradient-card shadow-card cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>p("Finance"),children:[Ne.jsxs(Wm,{className:"text-center",children:[Ne.jsx(dr,{className:"w-12 h-12 text-primary mx-auto mb-2"}),Ne.jsx(Vm,{className:"text-lg",children:"Bilan mensuel"}),Ne.jsx(Bm,{children:"Rapport financier du mois coul"})]}),Ne.jsx(Hm,{children:Ne.jsx(Vh,{className:"w-full",variant:"outline",children:"Crer bilan"})})]})]}),Ne.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[Ne.jsxs("div",{className:"relative flex-1",children:[Ne.jsx(Xr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),Ne.jsx(Bh,{placeholder:"Rechercher un rapport...",value:t,onChange:e=>s(e.target.value),className:"pl-10"})]}),Ne.jsxs(Vh,{variant:"outline",size:"touch",className:"gap-2",children:[Ne.jsx(Mr,{className:"w-4 h-4"}),"Filtres"]})]}),Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{children:[Ne.jsx(Vm,{children:"Historique des rapports"}),Ne.jsx(Bm,{children:"Liste de tous vos rapports gnrs"})]}),Ne.jsx(Hm,{children:0===f.length?Ne.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[Ne.jsx(or,{className:"w-16 h-16 text-muted-foreground/20 mb-4"}),Ne.jsx("p",{className:"text-muted-foreground mb-4",children:"Aucun rapport trouv"}),Ne.jsx(Vh,{onClick:m,variant:"outline",children:"Crer un rapport"})]}):Ne.jsxs(fg,{children:[Ne.jsx(xg,{children:Ne.jsxs(vg,{children:[Ne.jsx(jg,{children:"Nom du rapport"}),Ne.jsx(jg,{children:"Type"}),Ne.jsx(jg,{children:"Priode"}),Ne.jsx(jg,{children:"Donnes cls"}),Ne.jsx(jg,{children:"Gnr le"}),Ne.jsx(jg,{children:"Statut"}),Ne.jsx(jg,{children:"Actions"})]})}),Ne.jsx(gg,{children:f.map(t=>Ne.jsxs(vg,{children:[Ne.jsx(yg,{className:"font-medium",children:t.name}),Ne.jsx(yg,{children:u(t.type)}),Ne.jsx(yg,{children:t.period}),Ne.jsx(yg,{children:Ne.jsxs("div",{className:"text-sm space-y-1",children:[t.totalSales&&Ne.jsxs("div",{children:["CA: ",e(t.totalSales)]}),t.transactions&&Ne.jsxs("div",{children:[t.transactions," transactions"]}),t.totalProducts&&Ne.jsxs("div",{children:[t.totalProducts," produits"]}),t.revenue&&Ne.jsxs("div",{children:["Revenus: ",e(t.revenue)]})]})}),Ne.jsx(yg,{children:new Date(t.generatedAt).toLocaleDateString()}),Ne.jsx(yg,{children:h(t.status)}),Ne.jsx(yg,{children:Ne.jsxs(Om,{children:[Ne.jsx(qm,{asChild:!0,children:Ne.jsx(Vh,{variant:"ghost",className:"h-8 w-8 p-0",children:Ne.jsx(zr,{className:"h-4 w-4"})})}),Ne.jsxs(Im,{align:"end",children:[Ne.jsxs(Fm,{className:"gap-2",children:[Ne.jsx(Cr,{className:"w-4 h-4"}),"Voir rapport"]}),Ne.jsxs(Fm,{className:"gap-2",children:[Ne.jsx(kr,{className:"w-4 h-4"}),"Tlcharger PDF"]}),Ne.jsxs(Fm,{className:"gap-2",children:[Ne.jsx(kr,{className:"w-4 h-4"}),"Exporter Excel"]}),Ne.jsx(Fm,{children:"Dupliquer"}),Ne.jsx(Fm,{className:"text-destructive",children:"Supprimer"})]})]})})]},t.id))})]})})]})]})}function Lb(){const{toast:e}=is(),[t,s]=Nt.useState({email:!0,push:!1,lowStock:!0,newSales:!0}),[r,a]=Nt.useState({autoBackup:!0,maintenanceMode:!1,debugMode:!1}),[n,i]=Nt.useState("20");return Nt.useEffect(()=>{(async()=>{const{data:e,error:t}=await Dh.from("system_settings").select("setting_value").eq("setting_key","sales.tax_rate").maybeSingle();!t&&(null==e?void 0:e.setting_value)&&i(String(e.setting_value))})()},[]),Ne.jsxs("div",{className:"space-y-6",children:[Ne.jsx("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:Ne.jsxs("div",{children:[Ne.jsxs("h1",{className:"text-2xl md:text-3xl font-bold flex items-center gap-2",children:[Ne.jsx(Zr,{className:"w-7 h-7 text-primary"}),"Configuration"]}),Ne.jsx("p",{className:"text-muted-foreground",children:"Grez les paramtres de votre application"})]})}),Ne.jsxs(bp,{defaultValue:"general",className:"w-full",children:[Ne.jsxs(wp,{className:"grid w-full grid-cols-5",children:[Ne.jsxs(Np,{value:"general",className:"gap-2",children:[Ne.jsx(Zr,{className:"w-4 h-4"}),"Gnral"]}),Ne.jsxs(Np,{value:"stores",className:"gap-2",children:[Ne.jsx(ra,{className:"w-4 h-4"}),"Magasins"]}),Ne.jsxs(Np,{value:"users",className:"gap-2",children:[Ne.jsx(ma,{className:"w-4 h-4"}),"Utilisateurs"]}),Ne.jsxs(Np,{value:"notifications",className:"gap-2",children:[Ne.jsx(lr,{className:"w-4 h-4"}),"Notifications"]}),Ne.jsxs(Np,{value:"system",className:"gap-2",children:[Ne.jsx(wr,{className:"w-4 h-4"}),"Systme"]})]}),Ne.jsxs(_p,{value:"general",className:"space-y-6",children:[Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{children:[Ne.jsxs(Vm,{className:"flex items-center gap-2",children:[Ne.jsx(Ar,{className:"w-5 h-5 text-primary"}),"Informations gnrales"]}),Ne.jsx(Bm,{children:"Configuration de base de l'application"})]}),Ne.jsxs(Hm,{className:"space-y-6",children:[Ne.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{htmlFor:"company-name",children:"Nom de l'entreprise"}),Ne.jsx(Bh,{id:"company-name",defaultValue:"GesFlex Solutions"})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{htmlFor:"business-type",children:"Type d'activit"}),Ne.jsx(Bh,{id:"business-type",defaultValue:"Commerce de dtail"})]})]}),Ne.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{htmlFor:"currency",children:"Devise par dfaut"}),Ne.jsx(Bh,{id:"currency",defaultValue:"EUR - Euro"})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{htmlFor:"timezone",children:"Fuseau horaire"}),Ne.jsx(Bh,{id:"timezone",defaultValue:"Europe/Paris"})]})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{htmlFor:"address",children:"Adresse principale"}),Ne.jsx(Bh,{id:"address",defaultValue:"123 Rue de la Rpublique, 75001 Paris"})]}),Ne.jsx(Qh,{}),Ne.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{htmlFor:"tax_rate",children:"TVA (%)"}),Ne.jsx(Bh,{id:"tax_rate",type:"number",step:"0.01",value:n,onChange:e=>i(e.target.value)})]}),Ne.jsx("div",{className:"flex items-end",children:Ne.jsx(Vh,{type:"button",onClick:async()=>{const t=parseFloat(n);if(isNaN(t)||t<0||t>100)return void e({title:"Valeur invalide",description:"Entrez un pourcentage entre 0 et 100",variant:"destructive"});const{error:s}=await Dh.from("system_settings").upsert({setting_key:"sales.tax_rate",setting_value:String(t),setting_type:"number",category:"sales",description:"TVA %",is_required:!1,is_public:!0},{onConflict:"setting_key"});e(s?{title:"Erreur",description:"Impossible d'enregistrer la TVA",variant:"destructive"}:{title:"Enregistr",description:"TVA mise  jour"})},children:"Enregistrer la TVA"})})]}),Ne.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{htmlFor:"phone",children:"Tlphone"}),Ne.jsx(Bh,{id:"phone",defaultValue:"+33 1 23 45 67 89"})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{htmlFor:"email",children:"Email"}),Ne.jsx(Bh,{id:"email",defaultValue:"contact@gesflex.com"})]})]}),Ne.jsx(Vh,{children:"Enregistrer les modifications"})]})]}),Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{children:[Ne.jsxs(Vm,{className:"flex items-center gap-2",children:[Ne.jsx(Wr,{className:"w-5 h-5 text-primary"}),"Apparence"]}),Ne.jsx(Bm,{children:"Personnalisez l'interface utilisateur"})]}),Ne.jsxs(Hm,{className:"space-y-4",children:[Ne.jsxs("div",{className:"flex items-center justify-between",children:[Ne.jsxs("div",{className:"space-y-1",children:[Ne.jsx(Zm,{children:"Mode sombre"}),Ne.jsx("p",{className:"text-sm text-muted-foreground",children:"Activer le thme sombre"})]}),Ne.jsx(Nb,{})]}),Ne.jsx(Qh,{}),Ne.jsxs("div",{className:"flex items-center justify-between",children:[Ne.jsxs("div",{className:"space-y-1",children:[Ne.jsx(Zm,{children:"Sidebar compacte"}),Ne.jsx("p",{className:"text-sm text-muted-foreground",children:"Rduire la taille de la barre latrale"})]}),Ne.jsx(Nb,{})]})]})]})]}),Ne.jsx(_p,{value:"stores",className:"space-y-6",children:Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{children:[Ne.jsxs(Vm,{className:"flex items-center gap-2",children:[Ne.jsx(ra,{className:"w-5 h-5 text-primary"}),"Configuration des magasins"]}),Ne.jsx(Bm,{children:"Paramtres globaux pour tous les magasins"})]}),Ne.jsxs(Hm,{className:"space-y-6",children:[Ne.jsxs("div",{className:"flex items-center justify-between",children:[Ne.jsxs("div",{className:"space-y-1",children:[Ne.jsx(Zm,{children:"Multi-magasins"}),Ne.jsx("p",{className:"text-sm text-muted-foreground",children:"Activer la gestion multi-magasins"})]}),Ne.jsx(Nb,{defaultChecked:!0})]}),Ne.jsx(Qh,{}),Ne.jsxs("div",{className:"flex items-center justify-between",children:[Ne.jsxs("div",{className:"space-y-1",children:[Ne.jsx(Zm,{children:"Transferts automatiques"}),Ne.jsx("p",{className:"text-sm text-muted-foreground",children:"Permettre les transferts automatiques entre magasins"})]}),Ne.jsx(Nb,{})]}),Ne.jsx(Qh,{}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{children:"Horaires par dfaut"}),Ne.jsxs("div",{className:"grid gap-2 md:grid-cols-2",children:[Ne.jsx(Bh,{placeholder:"Heure d'ouverture",defaultValue:"09:00"}),Ne.jsx(Bh,{placeholder:"Heure de fermeture",defaultValue:"19:00"})]})]})]})]})}),Ne.jsx(_p,{value:"users",className:"space-y-6",children:Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{children:[Ne.jsxs(Vm,{className:"flex items-center gap-2",children:[Ne.jsx(ma,{className:"w-5 h-5 text-primary"}),"Gestion des utilisateurs"]}),Ne.jsx(Bm,{children:"Paramtres de scurit et d'accs"})]}),Ne.jsxs(Hm,{className:"space-y-6",children:[Ne.jsxs("div",{className:"flex items-center justify-between",children:[Ne.jsxs("div",{className:"space-y-1",children:[Ne.jsx(Zm,{children:"Inscription libre"}),Ne.jsx("p",{className:"text-sm text-muted-foreground",children:"Permettre aux nouveaux utilisateurs de s'inscrire"})]}),Ne.jsx(Nb,{})]}),Ne.jsx(Qh,{}),Ne.jsxs("div",{className:"flex items-center justify-between",children:[Ne.jsxs("div",{className:"space-y-1",children:[Ne.jsx(Zm,{children:"Validation des comptes"}),Ne.jsx("p",{className:"text-sm text-muted-foreground",children:"Validation manuelle des nouveaux comptes"})]}),Ne.jsx(Nb,{defaultChecked:!0})]}),Ne.jsx(Qh,{}),Ne.jsxs("div",{className:"flex items-center justify-between",children:[Ne.jsxs("div",{className:"space-y-1",children:[Ne.jsx(Zm,{children:"Authentification  deux facteurs"}),Ne.jsx("p",{className:"text-sm text-muted-foreground",children:"Obligatoire pour les administrateurs"})]}),Ne.jsx(Nb,{})]}),Ne.jsx(Qh,{}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{children:"Dure de session (minutes)"}),Ne.jsx(Bh,{type:"number",defaultValue:"480",placeholder:"480"})]})]})]})}),Ne.jsx(_p,{value:"notifications",className:"space-y-6",children:Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{children:[Ne.jsxs(Vm,{className:"flex items-center gap-2",children:[Ne.jsx(lr,{className:"w-5 h-5 text-primary"}),"Notifications"]}),Ne.jsx(Bm,{children:"Configurez les alertes et notifications"})]}),Ne.jsxs(Hm,{className:"space-y-6",children:[Ne.jsxs("div",{className:"flex items-center justify-between",children:[Ne.jsxs("div",{className:"space-y-1",children:[Ne.jsx(Zm,{children:"Notifications par email"}),Ne.jsx("p",{className:"text-sm text-muted-foreground",children:"Recevoir les alertes par email"})]}),Ne.jsx(Nb,{checked:t.email,onCheckedChange:e=>s(t=>({...t,email:e}))})]}),Ne.jsx(Qh,{}),Ne.jsxs("div",{className:"flex items-center justify-between",children:[Ne.jsxs("div",{className:"space-y-1",children:[Ne.jsx(Zm,{children:"Notifications push"}),Ne.jsx("p",{className:"text-sm text-muted-foreground",children:"Alertes en temps rel dans l'application"})]}),Ne.jsx(Nb,{checked:t.push,onCheckedChange:e=>s(t=>({...t,push:e}))})]}),Ne.jsx(Qh,{}),Ne.jsxs("div",{className:"flex items-center justify-between",children:[Ne.jsxs("div",{className:"space-y-1",children:[Ne.jsx(Zm,{children:"Alertes de stock faible"}),Ne.jsx("p",{className:"text-sm text-muted-foreground",children:"Notification quand un produit est en rupture"})]}),Ne.jsx(Nb,{checked:t.lowStock,onCheckedChange:e=>s(t=>({...t,lowStock:e}))})]}),Ne.jsx(Qh,{}),Ne.jsxs("div",{className:"flex items-center justify-between",children:[Ne.jsxs("div",{className:"space-y-1",children:[Ne.jsx(Zm,{children:"Nouvelles ventes"}),Ne.jsx("p",{className:"text-sm text-muted-foreground",children:"Notification pour chaque nouvelle vente"})]}),Ne.jsx(Nb,{checked:t.newSales,onCheckedChange:e=>s(t=>({...t,newSales:e}))})]})]})]})}),Ne.jsxs(_p,{value:"system",className:"space-y-6",children:[Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{children:[Ne.jsxs(Vm,{className:"flex items-center gap-2",children:[Ne.jsx(wr,{className:"w-5 h-5 text-primary"}),"Paramtres systme"]}),Ne.jsx(Bm,{children:"Configuration technique de l'application"})]}),Ne.jsxs(Hm,{className:"space-y-6",children:[Ne.jsxs("div",{className:"flex items-center justify-between",children:[Ne.jsxs("div",{className:"space-y-1",children:[Ne.jsx(Zm,{children:"Sauvegarde automatique"}),Ne.jsx("p",{className:"text-sm text-muted-foreground",children:"Sauvegarde quotidienne des donnes"})]}),Ne.jsx(Nb,{checked:r.autoBackup,onCheckedChange:e=>a(t=>({...t,autoBackup:e}))})]}),Ne.jsx(Qh,{}),Ne.jsxs("div",{className:"flex items-center justify-between",children:[Ne.jsxs("div",{className:"space-y-1",children:[Ne.jsx(Zm,{children:"Mode maintenance"}),Ne.jsx("p",{className:"text-sm text-muted-foreground",children:"Dsactiver l'accs utilisateur temporairement"})]}),Ne.jsxs("div",{className:"flex items-center gap-2",children:[Ne.jsx(Nb,{checked:r.maintenanceMode,onCheckedChange:e=>a(t=>({...t,maintenanceMode:e}))}),r.maintenanceMode&&Ne.jsx(Cp,{variant:"destructive",children:"Actif"})]})]}),Ne.jsx(Qh,{}),Ne.jsxs("div",{className:"flex items-center justify-between",children:[Ne.jsxs("div",{className:"space-y-1",children:[Ne.jsx(Zm,{children:"Mode debug"}),Ne.jsx("p",{className:"text-sm text-muted-foreground",children:"Activer les logs dtaills pour le support"})]}),Ne.jsx(Nb,{checked:r.debugMode,onCheckedChange:e=>a(t=>({...t,debugMode:e}))})]}),Ne.jsx(Qh,{}),Ne.jsxs("div",{className:"space-y-4",children:[Ne.jsx(Zm,{children:"Actions systme"}),Ne.jsxs("div",{className:"flex gap-2 flex-wrap",children:[Ne.jsxs(Vh,{variant:"outline",className:"gap-2",children:[Ne.jsx(wr,{className:"w-4 h-4"}),"Sauvegarder maintenant"]}),Ne.jsxs(Vh,{variant:"outline",className:"gap-2",children:[Ne.jsx(ea,{className:"w-4 h-4"}),"Vrifier intgrit"]}),Ne.jsxs(Vh,{variant:"destructive",className:"gap-2",children:[Ne.jsx(wr,{className:"w-4 h-4"}),"Rinitialiser cache"]})]})]})]})]}),Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{children:[Ne.jsx(Vm,{children:"Informations systme"}),Ne.jsx(Bm,{children:"tat actuel de l'application"})]}),Ne.jsx(Hm,{children:Ne.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{children:"Version de l'application"}),Ne.jsx("p",{className:"text-sm font-mono",children:"v2.1.3"})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{children:"Dernire sauvegarde"}),Ne.jsx("p",{className:"text-sm",children:"27/01/2025  03:00"})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{children:"Base de donnes"}),Ne.jsx("div",{className:"flex items-center gap-2",children:Ne.jsx(Cp,{variant:"default",className:"bg-success text-success-foreground",children:"En ligne"})})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{children:"Espace utilis"}),Ne.jsx("p",{className:"text-sm",children:"2.4 GB / 10 GB"})]})]})})]})]})]})]})}function $b(){var e,t,s,r;const{toast:a}=is(),{userProfile:n}=Ih();rx();const[i,o]=Nt.useState([]),[l,c]=Nt.useState([]),[d,u]=Nt.useState(!0),[h,m]=Nt.useState(null),[p,f]=Nt.useState(!1),[x,g]=Nt.useState(null),[v,j]=Nt.useState(!1),[y,b]=Nt.useState(!1),[w,N]=Nt.useState(""),[_,k]=Nt.useState("validate"),[S,C]=Nt.useState({search:"",sourceStore:"all",destinationStore:"all",status:"all",dateRange:{from:null,to:null}}),E="SuperAdmin"===(null==n?void 0:n.role),M="SuperAdmin"===(null==n?void 0:n.role);null==n||n.role;const T="SuperAdmin"===(null==n?void 0:n.role);Nt.useEffect(()=>{T&&(P(),A())},[T]);const A=async()=>{try{const{data:e,error:t}=await Dh.from("stores").select("id, name").eq("is_active",!0).order("name");if(t)throw t;c(e||[])}catch(e){a({title:"Erreur",description:"Impossible de charger la liste des magasins",variant:"destructive"})}},P=async()=>{try{u(!0),m(null);let e=Dh.from("store_transfers").select("\n          *,\n          source_store:stores!store_transfers_source_store_id_fkey(id, name),\n          destination_store:stores!store_transfers_destination_store_id_fkey(id, name),\n          product:products(id, name, sku),\n          created_by_user:users!store_transfers_created_by_fkey(id, first_name, last_name)\n        ").order("created_at",{ascending:!1});const{data:t,error:s}=await e;if(s)throw s;o(t||[])}catch(e){m("Impossible de charger les transferts"),a({title:"Erreur",description:"Impossible de charger les transferts",variant:"destructive"})}finally{u(!1)}},D=e=>{switch(e){case"pending":return Ne.jsxs(Cp,{variant:"secondary",className:"gap-1",children:[Ne.jsx(jr,{className:"w-3 h-3"}),"En attente"]});case"validated":return Ne.jsxs(Cp,{variant:"default",className:"gap-1 bg-green-600",children:[Ne.jsx(ur,{className:"w-3 h-3"}),"Valid"]});case"rejected":return Ne.jsxs(Cp,{variant:"destructive",className:"gap-1",children:[Ne.jsx(fa,{className:"w-3 h-3"}),"Rejet"]});default:return Ne.jsx(Cp,{variant:"secondary",children:e})}},R=Nt.useMemo(()=>{const e=e=>e?String(e).normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase():"",t=e(S.search||"").split(/\s+/).filter(Boolean);return i.filter(s=>{var r,a,n,i;const o=e([s.transfer_code,null==(r=s.product)?void 0:r.name,null==(a=s.product)?void 0:a.sku,null==(n=s.source_store)?void 0:n.name,null==(i=s.destination_store)?void 0:i.name].filter(Boolean).join(" ")),l=0===t.length||t.every(e=>o.includes(e)),c="all"===S.sourceStore||s.source_store_id===S.sourceStore,d="all"===S.destinationStore||s.destination_store_id===S.destinationStore,u="all"===S.status||s.status===S.status;return l&&c&&d&&u})},[i,S]),{pendingTransfers:O,validatedTransfers:q,totalQuantityTransferred:I}=Nt.useMemo(()=>{const e=i.filter(e=>"pending"===e.status),t=i.filter(e=>"validated"===e.status),s=t.reduce((e,t)=>e+t.quantity,0);return{pendingTransfers:e,validatedTransfers:t,totalQuantityTransferred:s}},[i]);return h&&!T?Ne.jsxs("div",{className:"space-y-6 p-6",children:[Ne.jsx("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:Ne.jsxs("div",{children:[Ne.jsxs("h1",{className:"text-3xl font-bold tracking-tight flex items-center gap-2",children:[Ne.jsx(la,{className:"w-8 h-8 text-primary"}),"Transferts entre Magasins"]}),Ne.jsx("p",{className:"text-muted-foreground",children:"Grez les transferts de stock entre vos magasins"})]})}),Ne.jsxs("div",{className:"bg-destructive/10 border border-destructive/20 rounded-lg p-6 text-center",children:[Ne.jsx(rr,{className:"w-12 h-12 text-destructive mx-auto mb-4"}),Ne.jsx("h3",{className:"text-lg font-semibold text-destructive mb-2",children:"Accs refus"}),Ne.jsx("p",{className:"text-destructive/80 mb-4",children:"Vous n'avez pas les permissions pour accder  cette page"})]})]}):Ne.jsxs("div",{className:"space-y-6 p-6",children:[Ne.jsx(Sy,{items:[{label:"Transferts",icon:void 0}]}),Ne.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[Ne.jsxs("div",{children:[Ne.jsxs("h1",{className:"text-3xl font-bold tracking-tight flex items-center gap-2",children:[Ne.jsx(la,{className:"w-8 h-8 text-primary"}),"Transferts entre Magasins"]}),Ne.jsx("p",{className:"text-muted-foreground",children:"Grez les transferts de stock entre vos magasins"})]}),E&&Ne.jsxs(Vh,{onClick:()=>f(!0),className:"gap-2",children:[Ne.jsx(Yr,{className:"w-4 h-4"}),"Nouveau Transfert"]})]}),h?Ne.jsx(Um,{className:"bg-destructive/10 border border-destructive/20",children:Ne.jsxs(Hm,{className:"p-6 text-center",children:[Ne.jsx(rr,{className:"w-12 h-12 text-destructive mx-auto mb-4"}),Ne.jsx("h3",{className:"text-lg font-semibold text-destructive mb-2",children:"Erreur de chargement"}),Ne.jsx("p",{className:"text-destructive/80 mb-4",children:h}),Ne.jsxs(Vh,{onClick:()=>{m(null),P()},variant:"outline",className:"gap-2",children:[Ne.jsx(Gr,{className:"w-4 h-4"}),"Ressayer"]})]})}):Ne.jsxs(Ne.Fragment,{children:[Ne.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[Ne.jsxs(Um,{children:[Ne.jsxs(Wm,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Ne.jsx(Vm,{className:"text-sm font-medium",children:"En attente"}),Ne.jsx(jr,{className:"h-4 w-4 text-muted-foreground"})]}),Ne.jsxs(Hm,{children:[Ne.jsx("div",{className:"text-2xl font-bold",children:O.length}),Ne.jsx("p",{className:"text-xs text-muted-foreground",children:"transferts  valider"})]})]}),Ne.jsxs(Um,{children:[Ne.jsxs(Wm,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Ne.jsx(Vm,{className:"text-sm font-medium",children:"Valids"}),Ne.jsx(ur,{className:"h-4 w-4 text-muted-foreground"})]}),Ne.jsxs(Hm,{children:[Ne.jsx("div",{className:"text-2xl font-bold",children:q.length}),Ne.jsx("p",{className:"text-xs text-muted-foreground",children:"ce mois"})]})]}),Ne.jsxs(Um,{children:[Ne.jsxs(Wm,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Ne.jsx(Vm,{className:"text-sm font-medium",children:"Total transfr"}),Ne.jsx(Ur,{className:"h-4 w-4 text-muted-foreground"})]}),Ne.jsxs(Hm,{children:[Ne.jsx("div",{className:"text-2xl font-bold",children:I}),Ne.jsx("p",{className:"text-xs text-muted-foreground",children:"units ce mois"})]})]}),Ne.jsxs(Um,{children:[Ne.jsxs(Wm,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Ne.jsx(Vm,{className:"text-sm font-medium",children:"Total transferts"}),Ne.jsx(la,{className:"h-4 w-4 text-muted-foreground"})]}),Ne.jsxs(Hm,{children:[Ne.jsx("div",{className:"text-2xl font-bold",children:i.length}),Ne.jsx("p",{className:"text-xs text-muted-foreground",children:"tous statuts"})]})]})]}),Ne.jsx(Um,{children:Ne.jsx(Hm,{className:"pt-6",children:Ne.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3",children:[Ne.jsx("div",{className:"sm:col-span-2 lg:col-span-1",children:Ne.jsxs("div",{className:"relative",children:[Ne.jsx(Xr,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),Ne.jsx(Bh,{placeholder:"Rechercher par produit, SKU, magasin...",value:S.search,onChange:e=>C(t=>({...t,search:e.target.value})),className:"pl-8 h-10"})]})}),Ne.jsxs("div",{className:"flex gap-2 sm:col-span-2 lg:col-span-3 flex-wrap",children:[Ne.jsxs(Kf,{value:S.sourceStore,onValueChange:e=>C(t=>({...t,sourceStore:e})),children:[Ne.jsx(Gf,{className:"h-10 w-full",children:Ne.jsx(Yf,{placeholder:"Magasin source"})}),Ne.jsxs(Xf,{children:[Ne.jsx(Zf,{value:"all",children:"Tous les magasins"}),l.map(e=>Ne.jsx(Zf,{value:e.id,children:e.name},e.id))]})]}),Ne.jsxs(Kf,{value:S.destinationStore,onValueChange:e=>C(t=>({...t,destinationStore:e})),children:[Ne.jsx(Gf,{className:"h-10 w-full",children:Ne.jsx(Yf,{placeholder:"Magasin destination"})}),Ne.jsxs(Xf,{children:[Ne.jsx(Zf,{value:"all",children:"Tous les magasins"}),l.map(e=>Ne.jsx(Zf,{value:e.id,children:e.name},e.id))]})]}),Ne.jsxs(Kf,{value:S.status,onValueChange:e=>C(t=>({...t,status:e})),children:[Ne.jsx(Gf,{className:"h-10 w-full",children:Ne.jsx(Yf,{placeholder:"Statut"})}),Ne.jsxs(Xf,{children:[Ne.jsx(Zf,{value:"all",children:"Tous"}),Ne.jsx(Zf,{value:"pending",children:"En attente"}),Ne.jsx(Zf,{value:"validated",children:"Valid"}),Ne.jsx(Zf,{value:"rejected",children:"Rejet"})]})]})]})]})})}),Ne.jsxs(Um,{children:[Ne.jsxs(Wm,{children:[Ne.jsx(Vm,{children:"Liste des transferts"}),Ne.jsxs(Bm,{children:[R.length," transfert",R.length>1?"s":""]})]}),Ne.jsx(Hm,{children:Ne.jsxs(fg,{children:[Ne.jsx(xg,{children:Ne.jsxs(vg,{children:[Ne.jsx(jg,{children:"Produit"}),Ne.jsx(jg,{children:"Source  Destination"}),Ne.jsx(jg,{children:"Quantit"}),Ne.jsx(jg,{children:"Statut"}),Ne.jsx(jg,{children:"Cr par"}),Ne.jsx(jg,{children:"Date"}),Ne.jsx(jg,{children:"Actions"})]})}),Ne.jsx(gg,{children:d?Array.from({length:5}).map((e,t)=>Ne.jsxs(vg,{children:[Ne.jsx(yg,{children:Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-4 w-32 rounded"}),Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-3 w-24 rounded"})]})}),Ne.jsx(yg,{children:Ne.jsxs("div",{className:"flex items-center gap-2",children:[Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-4 w-20 rounded"}),Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-4 w-4 rounded"}),Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-4 w-24 rounded"})]})}),Ne.jsx(yg,{children:Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-6 w-20 rounded"})}),Ne.jsx(yg,{children:Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-6 w-20 rounded"})}),Ne.jsx(yg,{children:Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-4 w-24 rounded"})}),Ne.jsx(yg,{children:Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-4 w-20 rounded"})}),Ne.jsx(yg,{children:Ne.jsx("div",{className:"animate-pulse bg-gray-300 h-8 w-8 rounded"})})]},t)):0===R.length?Ne.jsx(vg,{children:Ne.jsx(yg,{colSpan:7,className:"text-center py-8",children:"Aucun transfert trouv"})}):R.map(e=>{var t,s,r,a;return Ne.jsxs(vg,{children:[Ne.jsx(yg,{children:Ne.jsxs("div",{children:[Ne.jsx("div",{className:"font-medium",children:null==(t=e.product)?void 0:t.name}),Ne.jsx("div",{className:"text-sm text-muted-foreground",children:null==(s=e.product)?void 0:s.sku})]})}),Ne.jsx(yg,{children:Ne.jsxs("div",{className:"flex items-center gap-2",children:[Ne.jsx("span",{className:"text-sm",children:null==(r=e.source_store)?void 0:r.name}),Ne.jsx(nr,{className:"w-4 h-4 text-muted-foreground"}),Ne.jsx("span",{className:"text-sm",children:null==(a=e.destination_store)?void 0:a.name})]})}),Ne.jsx(yg,{children:Ne.jsxs(Cp,{variant:"outline",children:[e.quantity," units"]})}),Ne.jsx(yg,{children:D(e.status)}),Ne.jsx(yg,{children:Ne.jsx("div",{className:"text-sm",children:e.created_by_user?`${e.created_by_user.first_name} ${e.created_by_user.last_name}`:"Utilisateur inconnu"})}),Ne.jsx(yg,{children:Ne.jsx("div",{className:"text-sm",children:new Date(e.created_at).toLocaleDateString("fr-FR")})}),Ne.jsx(yg,{children:Ne.jsxs(Om,{children:[Ne.jsx(qm,{asChild:!0,children:Ne.jsx(Vh,{variant:"ghost",className:"h-8 w-8 p-0",children:Ne.jsx(zr,{className:"h-4 w-4"})})}),Ne.jsxs(Im,{align:"end",children:[Ne.jsx(Lm,{children:"Actions"}),Ne.jsx(Fm,{onClick:()=>{g(e),j(!0)},children:"Voir dtails"}),M&&"pending"===e.status&&Ne.jsxs(Ne.Fragment,{children:[Ne.jsx($m,{}),Ne.jsxs(Fm,{onClick:()=>{g(e),k("validate"),b(!0)},children:[Ne.jsx(ur,{className:"w-4 h-4 mr-2"}),"Valider"]}),Ne.jsxs(Fm,{onClick:()=>{g(e),k("reject"),b(!0)},children:[Ne.jsx(fa,{className:"w-4 h-4 mr-2"}),"Rejeter"]})]})]})]})})]},e.id)})})]})})]})]}),Ne.jsx(kb,{open:p,onOpenChange:f,onSuccess:P}),Ne.jsx(bg,{open:v,onOpenChange:j,children:Ne.jsxs(kg,{className:"max-w-2xl",children:[Ne.jsx(Sg,{children:Ne.jsx(Eg,{children:"Dtails du transfert"})}),x&&Ne.jsxs("div",{className:"space-y-4",children:[Ne.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[Ne.jsxs("div",{children:[Ne.jsx(Zm,{className:"text-sm font-medium text-muted-foreground",children:"Produit"}),Ne.jsx("p",{className:"font-medium",children:null==(e=x.product)?void 0:e.name}),Ne.jsx("p",{className:"text-sm text-muted-foreground",children:null==(t=x.product)?void 0:t.sku})]}),Ne.jsxs("div",{children:[Ne.jsx(Zm,{className:"text-sm font-medium text-muted-foreground",children:"Quantit"}),Ne.jsxs("p",{className:"font-medium",children:[x.quantity," units"]})]})]}),Ne.jsx(Qh,{}),Ne.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[Ne.jsxs("div",{children:[Ne.jsx(Zm,{className:"text-sm font-medium text-muted-foreground",children:"Magasin source"}),Ne.jsx("p",{className:"font-medium",children:null==(s=x.source_store)?void 0:s.name})]}),Ne.jsxs("div",{children:[Ne.jsx(Zm,{className:"text-sm font-medium text-muted-foreground",children:"Magasin destination"}),Ne.jsx("p",{className:"font-medium",children:null==(r=x.destination_store)?void 0:r.name})]})]}),Ne.jsx(Qh,{}),Ne.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[Ne.jsxs("div",{children:[Ne.jsx(Zm,{className:"text-sm font-medium text-muted-foreground",children:"Statut"}),Ne.jsx("div",{className:"mt-1",children:D(x.status)})]}),Ne.jsxs("div",{children:[Ne.jsx(Zm,{className:"text-sm font-medium text-muted-foreground",children:"Date de cration"}),Ne.jsx("p",{className:"font-medium",children:new Date(x.created_at).toLocaleString("fr-FR")})]})]}),Ne.jsx("div",{className:"grid grid-cols-2 gap-4",children:Ne.jsxs("div",{children:[Ne.jsx(Zm,{className:"text-sm font-medium text-muted-foreground",children:"Cr par"}),Ne.jsx("p",{className:"font-medium",children:x.created_by_user?`${x.created_by_user.first_name} ${x.created_by_user.last_name}`:"Utilisateur inconnu"})]})}),x.notes&&Ne.jsxs("div",{children:[Ne.jsx(Zm,{className:"text-sm font-medium text-muted-foreground",children:"Notes"}),Ne.jsx("p",{className:"mt-1 p-3 bg-muted rounded-lg",children:x.notes})]})]})]})}),Ne.jsx(bg,{open:y,onOpenChange:b,children:Ne.jsxs(kg,{className:"max-w-md",children:[Ne.jsxs(Sg,{children:[Ne.jsx(Eg,{children:"validate"===_?"Valider le transfert":"Rejeter le transfert"}),Ne.jsx(Mg,{children:"validate"===_?"Ce transfert sera valid et le stock sera mis  jour.":"Ce transfert sera rejet et annul."})]}),Ne.jsxs("div",{className:"space-y-4",children:[Ne.jsxs("div",{children:[Ne.jsx(Zm,{htmlFor:"validation-notes",children:"Notes (optionnel)"}),Ne.jsx(Tg,{id:"validation-notes",value:w,onChange:e=>N(e.target.value),placeholder:"Raison de la validation/rejet..."})]}),Ne.jsxs("div",{className:"flex justify-end gap-2",children:[Ne.jsx(Vh,{variant:"outline",onClick:()=>b(!1),children:"Annuler"}),Ne.jsx(Vh,{variant:"validate"===_?"default":"destructive",onClick:()=>x&&(async(e,t,s)=>{if(null==n?void 0:n.id)if(M)try{if("validate"===t)return a({title:"Validation via Arrivages",description:"Pour valider un transfert, allez dans Arrivages et enregistrez la rception."}),b(!1),void g(null);const{error:r}=await Dh.from("store_transfers").update({status:"rejected",notes:s||null}).eq("id",e);if(r)throw r;a({title:"Transfert rejet",description:"Le transfert a t rejet."}),P(),b(!1),g(null)}catch(r){a({title:"Erreur",description:"Erreur lors de la validation du transfert",variant:"destructive"})}else a({title:"Permission refuse",description:"Vous n'avez pas les permissions pour valider les transferts",variant:"destructive"});else a({title:"Erreur",description:"Utilisateur non identifi",variant:"destructive"})})(x.id,_,w),children:"validate"===_?"Valider":"Rejeter"})]})]})]})})]})}const zb={enableStoreTransfers:!0,globalStockAlerts:!0,globalStockThreshold:10,defaultOpeningTime:"09:00",defaultClosingTime:"19:00",autoBackup:!0,debugMode:!1,enableRealTimeAnalytics:!0,gamificationEnabled:!0,dailySalesTarget:5e4,performanceThreshold:80,pointsPerSale:10,autoGenerateReports:!0,reportSchedule:"weekly",maintenanceMode:!1,maintenanceMessage:"",adminOnlyAccess:!1,defaultCurrency:"XOF",currencySymbol:"CFA",currencyPosition:"after",decimalPlaces:0};function Ub(){const{user:e,userProfile:t}=Ih(),{settings:s,loading:r,error:a,hasEditPermissions:n,saveSetting:i,saveAllSettings:o,resetToDefaults:l}=function(){const[e,t]=Nt.useState(zb),[s,r]=Nt.useState(!0),[a,n]=Nt.useState(null),{toast:i}=is(),{userProfile:o}=Ih(),l="Admin"===(null==o?void 0:o.role)||"SuperAdmin"===(null==o?void 0:o.role),c={enableStoreTransfers:"stores.enable_transfers",globalStockAlerts:"stores.global_stock_alerts",globalStockThreshold:"stores.global_stock_threshold",defaultOpeningTime:"stores.default_opening_time",defaultClosingTime:"stores.default_closing_time",autoBackup:"system.auto_backup",debugMode:"system.debug_mode",enableRealTimeAnalytics:"system.enable_real_time_analytics",gamificationEnabled:"performance.gamification_enabled",dailySalesTarget:"performance.daily_sales_target",performanceThreshold:"performance.performance_threshold",pointsPerSale:"performance.points_per_sale",autoGenerateReports:"performance.auto_generate_reports",reportSchedule:"performance.report_schedule",maintenanceMode:"maintenance.mode",maintenanceMessage:"maintenance.message",adminOnlyAccess:"maintenance.admin_only_access",defaultCurrency:"currency.default",currencySymbol:"currency.symbol",currencyPosition:"currency.position",decimalPlaces:"currency.decimal_places"},d=async()=>{try{r(!0),n(null);const{data:e,error:s}=await Dh.from("system_settings").select("*").order("setting_key");if(s)throw s;if(e){const s={...zb};e.forEach(e=>{const t=Object.keys(c).find(t=>c[t]===e.setting_key);if(t){let r=e.setting_value;"number"===e.setting_type?r=Number(r):"boolean"===e.setting_type&&(r="true"===r||!0===r),s[t]=r}}),t(s)}}catch(e){n(e instanceof Error?e.message:"Erreur inconnue"),i({title:"Erreur",description:"Impossible de charger les configurations",variant:"destructive"})}finally{r(!1)}},u=async e=>{var s,r;try{if(!l){const e=new Error("Permissions insuffisantes. Seuls les Admin et SuperAdmin peuvent modifier les configurations.");throw i({title:"Erreur de permissions",description:e.message,variant:"destructive"}),e}const{data:s}=await Dh.from("system_settings").select("setting_key, id"),r=new Set((null==s?void 0:s.map(e=>e.setting_key))||[]),a=[],n=[];if(Object.entries(e).forEach(([e,t])=>{const s=c[e];if(!s)return;let i="string";"number"==typeof t?i="number":"boolean"==typeof t?i="boolean":Array.isArray(t)?i="array":"object"==typeof t&&(i="json");const o={setting_key:s,setting_value:t,setting_type:i,category:s.split(".")[0],updated_at:(new Date).toISOString()};r.has(s)?a.push(o):n.push(o)}),a.length>0)for(const e of a){const{error:t}=await Dh.from("system_settings").update(e).eq("setting_key",e.setting_key);if(t)throw t}if(n.length>0){const{error:e}=await Dh.from("system_settings").insert(n);if(e)throw e}t(e),i({title:"Succs",description:"Toutes les configurations ont t sauvegardes"})}catch(a){throw(null==(s=a.message)?void 0:s.includes("Permissions insuffisantes"))||(null==(r=a.message)?void 0:r.includes("Erreur de scurit"))||i({title:"Erreur",description:"Impossible de sauvegarder les configurations",variant:"destructive"}),a}};return Nt.useEffect(()=>{d()},[]),{settings:e,loading:s,error:a,hasEditPermissions:l,saveSetting:async(e,s)=>{var r,a;try{if(!l){const e=new Error("Permissions insuffisantes. Seuls les Admin et SuperAdmin peuvent modifier les configurations.");throw i({title:"Erreur de permissions",description:e.message,variant:"destructive"}),e}const r=c[e];if(!r)throw new Error(`Cl de configuration invalide: ${e}`);let a="string";"number"==typeof s?a="number":"boolean"==typeof s?a="boolean":Array.isArray(s)?a="array":"object"==typeof s&&(a="json");const{data:n}=await Dh.from("system_settings").select("id").eq("setting_key",r).single();if(n){const{error:e}=await Dh.from("system_settings").update({setting_value:s,setting_type:a,category:r.split(".")[0],updated_at:(new Date).toISOString()}).eq("setting_key",r);if(e)throw e}else{const{error:e}=await Dh.from("system_settings").insert({setting_key:r,setting_value:s,setting_type:a,category:r.split(".")[0],updated_at:(new Date).toISOString()});if(e)throw e}t(t=>({...t,[e]:s})),i({title:"Succs",description:"Configuration sauvegarde"})}catch(n){throw(null==(r=n.message)?void 0:r.includes("Permissions insuffisantes"))||(null==(a=n.message)?void 0:a.includes("Erreur de scurit"))||i({title:"Erreur",description:"Impossible de sauvegarder la configuration",variant:"destructive"}),n}},saveAllSettings:u,resetToDefaults:async()=>{try{await u(zb),i({title:"Succs",description:"Configurations rinitialises aux valeurs par dfaut"})}catch(e){i({title:"Erreur",description:"Impossible de rinitialiser les configurations",variant:"destructive"})}},reloadSettings:d}}(),{loading:c,error:d,store:u,setSingle:h}=$h(),[m,p]=Nt.useState([]),[f,x]=Nt.useState(null),g=Nt.useMemo(()=>m.find(e=>e.id===f)||null,[m,f]);Nt.useEffect(()=>{"SuperAdmin"===(null==t?void 0:t.role)&&(async()=>{const{data:e}=await Dh.from("users").select("id, first_name, last_name, role, status").order("created_at",{ascending:!1});p(e||[])})()},[null==t?void 0:t.role]),Nt.useEffect(()=>{!f&&m.length>0&&x(m[0].id)},[m,f]);const v=async()=>{try{await o(s)}catch(e){}},j=(e,t)=>{i(e,t)};return r?Ne.jsx("div",{className:"flex items-center justify-center h-64",children:Ne.jsxs("div",{className:"text-center",children:[Ne.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),Ne.jsx("p",{className:"text-muted-foreground",children:"Chargement des configurations..."})]})}):a?Ne.jsx("div",{className:"flex items-center justify-center h-64",children:Ne.jsxs("div",{className:"text-center",children:[Ne.jsx(rr,{className:"h-8 w-8 text-destructive mx-auto mb-4"}),Ne.jsx("p",{className:"text-destructive mb-2",children:"Erreur de chargement"}),Ne.jsx("p",{className:"text-muted-foreground text-sm",children:a})]})}):Ne.jsxs("div",{className:"space-y-6",children:[Ne.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[Ne.jsxs("div",{children:[Ne.jsxs("h1",{className:"text-2xl md:text-3xl font-bold flex items-center gap-2",children:[Ne.jsx(Zr,{className:"w-7 h-7 text-primary"}),"Configuration Systme"]}),Ne.jsx("p",{className:"text-muted-foreground",children:"Paramtres avancs du systme GesFlex"})]}),Ne.jsxs("div",{className:"flex gap-2",children:[Ne.jsx(Vh,{variant:"outline",onClick:l,disabled:!n,children:"Rinitialiser"}),Ne.jsxs(Vh,{onClick:v,size:"touch",className:"gap-2",disabled:!n,children:[Ne.jsx(Jr,{className:"w-4 h-4"}),"Sauvegarder"]})]})]}),!n&&Ne.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:Ne.jsxs("div",{className:"flex items-start gap-3",children:[Ne.jsx(rr,{className:"w-5 h-5 text-yellow-600 mt-0.5"}),Ne.jsxs("div",{children:[Ne.jsx("h3",{className:"font-medium text-yellow-800",children:"Permissions limites"}),Ne.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"Vous pouvez consulter les configurations mais vous n'avez pas les permissions pour les modifier. Seuls les utilisateurs Admin et SuperAdmin peuvent modifier les configurations systme."})]})]})}),Ne.jsxs(bp,{defaultValue:"stores",className:"space-y-4",children:[Ne.jsxs(wp,{className:"grid w-full grid-cols-6",children:[Ne.jsx(Np,{value:"stores",children:"Multi-Magasins"}),Ne.jsx(Np,{value:"system",children:"Systme"}),Ne.jsx(Np,{value:"performance",children:"Performance"}),Ne.jsx(Np,{value:"currency",children:"Devise"}),Ne.jsx(Np,{value:"maintenance",children:"Maintenance"}),Ne.jsx(Np,{value:"pages",children:"Pages"})]}),Ne.jsx(_p,{value:"stores",className:"space-y-6",children:Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{children:[Ne.jsxs(Vm,{className:"flex items-center gap-2",children:[Ne.jsx(ra,{className:"w-5 h-5"}),"Configuration Multi-Magasins"]}),Ne.jsx(Bm,{children:"Paramtres globaux pour la gestion multi-magasins"})]}),Ne.jsxs(Hm,{className:"space-y-6",children:["SuperAdmin"===(null==t?void 0:t.role)&&Ne.jsxs("div",{className:"flex items-center justify-between",children:[Ne.jsxs("div",{className:"space-y-0.5",children:[Ne.jsx(Zm,{children:"Transferts automatiques"}),Ne.jsx("p",{className:"text-sm text-muted-foreground",children:"Permettre les transferts automatiques entre magasins (SuperAdmin uniquement)"})]}),Ne.jsx(Nb,{checked:s.enableStoreTransfers,onCheckedChange:e=>j("enableStoreTransfers",e)})]}),Ne.jsx(Qh,{}),Ne.jsxs("div",{className:"flex items-center justify-between",children:[Ne.jsxs("div",{className:"space-y-0.5",children:[Ne.jsx(Zm,{children:"Alertes stock globales"}),Ne.jsx("p",{className:"text-sm text-muted-foreground",children:"Alertes de stock faible pour tous les magasins"})]}),Ne.jsx(Nb,{checked:s.globalStockAlerts,onCheckedChange:e=>j("globalStockAlerts",e)})]}),s.globalStockAlerts&&Ne.jsxs("div",{children:[Ne.jsx(Zm,{htmlFor:"globalStockThreshold",children:"Seuil global d'alerte stock"}),Ne.jsx(Bh,{id:"globalStockThreshold",type:"number",value:s.globalStockThreshold,onChange:e=>j("globalStockThreshold",parseInt(e.target.value)),className:"w-32"}),Ne.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Seuil minimum pour tous les magasins"})]}),Ne.jsx(Qh,{}),Ne.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[Ne.jsxs("div",{children:[Ne.jsx(Zm,{htmlFor:"defaultOpeningTime",children:"Heure d'ouverture par dfaut"}),Ne.jsx(Bh,{id:"defaultOpeningTime",type:"time",value:s.defaultOpeningTime,onChange:e=>j("defaultOpeningTime",e.target.value)})]}),Ne.jsxs("div",{children:[Ne.jsx(Zm,{htmlFor:"defaultClosingTime",children:"Heure de fermeture par dfaut"}),Ne.jsx(Bh,{id:"defaultClosingTime",type:"time",value:s.defaultClosingTime,onChange:e=>j("defaultClosingTime",e.target.value)})]})]})]})]})}),Ne.jsxs(_p,{value:"system",className:"space-y-6",children:[Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{children:[Ne.jsxs(Vm,{className:"flex items-center gap-2",children:[Ne.jsx(wr,{className:"w-5 h-5"}),"Paramtres Systme"]}),Ne.jsx(Bm,{children:"Configuration technique et performance du systme"})]}),Ne.jsxs(Hm,{className:"space-y-6",children:[Ne.jsxs("div",{className:"flex items-center justify-between",children:[Ne.jsxs("div",{className:"space-y-0.5",children:[Ne.jsx(Zm,{children:"Sauvegarde automatique"}),Ne.jsx("p",{className:"text-sm text-muted-foreground",children:"Sauvegarde quotidienne des donnes"})]}),Ne.jsx(Nb,{checked:s.autoBackup,onCheckedChange:e=>j("autoBackup",e)})]}),Ne.jsx(Qh,{}),Ne.jsxs("div",{className:"flex items-center justify-between",children:[Ne.jsxs("div",{className:"space-y-0.5",children:[Ne.jsx(Zm,{children:"Mode debug"}),Ne.jsx("p",{className:"text-sm text-muted-foreground",children:"Activer les logs dtaills pour le support"})]}),Ne.jsx(Nb,{checked:s.debugMode,onCheckedChange:e=>j("debugMode",e)})]}),Ne.jsx(Qh,{}),Ne.jsxs("div",{className:"flex items-center justify-between",children:[Ne.jsxs("div",{className:"space-y-0.5",children:[Ne.jsx(Zm,{children:"Analytics en temps rel"}),Ne.jsx("p",{className:"text-sm text-muted-foreground",children:"Afficher les donnes en temps rel"})]}),Ne.jsx(Nb,{checked:s.enableRealTimeAnalytics,onCheckedChange:e=>j("enableRealTimeAnalytics",e)})]}),Ne.jsx(Qh,{}),Ne.jsxs("div",{className:"space-y-4",children:[Ne.jsx(Zm,{children:"Actions systme"}),Ne.jsxs("div",{className:"flex gap-2 flex-wrap",children:[Ne.jsxs(Vh,{variant:"outline",className:"gap-2",children:[Ne.jsx(wr,{className:"w-4 h-4"}),"Sauvegarder maintenant"]}),Ne.jsxs(Vh,{variant:"outline",className:"gap-2",children:[Ne.jsx(ea,{className:"w-4 h-4"}),"Vrifier intgrit"]}),Ne.jsxs(Vh,{variant:"destructive",className:"gap-2",children:[Ne.jsx(wr,{className:"w-4 h-4"}),"Rinitialiser cache"]})]})]})]})]}),Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{children:[Ne.jsx(Vm,{children:"Informations systme"}),Ne.jsx(Bm,{children:"tat actuel de l'application"})]}),Ne.jsx(Hm,{children:Ne.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{children:"Version de l'application"}),Ne.jsx("p",{className:"text-sm font-mono",children:"v2.1.3"})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{children:"Dernire sauvegarde"}),Ne.jsx("p",{className:"text-sm",children:"27/01/2025  03:00"})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{children:"Base de donnes"}),Ne.jsx("div",{className:"flex items-center gap-2",children:Ne.jsx(Cp,{variant:"default",className:"bg-success text-success-foreground",children:"En ligne"})})]}),Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(Zm,{children:"Espace utilis"}),Ne.jsx("p",{className:"text-sm",children:"2.4 GB / 10 GB"})]})]})})]})]}),Ne.jsx(_p,{value:"performance",className:"space-y-6",children:Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{children:[Ne.jsxs(Vm,{className:"flex items-center gap-2",children:[Ne.jsx(ga,{className:"w-5 h-5"}),"Paramtres de Performance"]}),Ne.jsx(Bm,{children:"Optimisation des performances et seuils de gamification"})]}),Ne.jsxs(Hm,{className:"space-y-6",children:[Ne.jsxs("div",{className:"flex items-center justify-between",children:[Ne.jsxs("div",{className:"space-y-0.5",children:[Ne.jsx(Zm,{children:"Gamification active"}),Ne.jsx("p",{className:"text-sm text-muted-foreground",children:"Activer le systme de rcompenses et points"})]}),Ne.jsx(Nb,{checked:s.gamificationEnabled,onCheckedChange:e=>j("gamificationEnabled",e)})]}),s.gamificationEnabled&&Ne.jsxs(Ne.Fragment,{children:[Ne.jsx(Qh,{}),Ne.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[Ne.jsxs("div",{children:[Ne.jsx(Zm,{htmlFor:"salesTarget",children:"Objectif de vente quotidien"}),Ne.jsx(Bh,{id:"salesTarget",type:"number",value:s.dailySalesTarget,onChange:e=>j("dailySalesTarget",parseFloat(e.target.value))})]}),Ne.jsxs("div",{children:[Ne.jsx(Zm,{htmlFor:"performanceThreshold",children:"Seuil de performance (%)"}),Ne.jsx(Bh,{id:"performanceThreshold",type:"number",value:s.performanceThreshold,onChange:e=>j("performanceThreshold",parseInt(e.target.value))})]})]}),Ne.jsxs("div",{children:[Ne.jsx(Zm,{htmlFor:"pointsPerSale",children:"Points par vente"}),Ne.jsx(Bh,{id:"pointsPerSale",type:"number",value:s.pointsPerSale,onChange:e=>j("pointsPerSale",parseInt(e.target.value)),className:"w-32"})]})]}),Ne.jsx(Qh,{}),Ne.jsxs("div",{className:"flex items-center justify-between",children:[Ne.jsxs("div",{className:"space-y-0.5",children:[Ne.jsx(Zm,{children:"Rapports automatiques"}),Ne.jsx("p",{className:"text-sm text-muted-foreground",children:"Gnrer automatiquement des rapports de performance"})]}),Ne.jsx(Nb,{checked:s.autoGenerateReports,onCheckedChange:e=>j("autoGenerateReports",e)})]}),s.autoGenerateReports&&Ne.jsxs("div",{children:[Ne.jsx(Zm,{htmlFor:"reportSchedule",children:"Frquence des rapports"}),Ne.jsxs(Kf,{value:s.reportSchedule,onValueChange:e=>j("reportSchedule",e),children:[Ne.jsx(Gf,{children:Ne.jsx(Yf,{})}),Ne.jsxs(Xf,{children:[Ne.jsx(Zf,{value:"daily",children:"Quotidien"}),Ne.jsx(Zf,{value:"weekly",children:"Hebdomadaire"}),Ne.jsx(Zf,{value:"monthly",children:"Mensuel"})]})]})]})]})]})}),Ne.jsx(_p,{value:"currency",className:"space-y-6",children:Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{children:[Ne.jsxs(Vm,{className:"flex items-center gap-2",children:[Ne.jsx(_r,{className:"w-5 h-5"}),"Configuration de la Devise"]}),Ne.jsx(Bm,{children:"Paramtres de formatage montaire pour l'application"})]}),Ne.jsxs(Hm,{className:"space-y-6",children:[Ne.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[Ne.jsxs("div",{children:[Ne.jsx(Zm,{htmlFor:"defaultCurrency",children:"Devise par dfaut"}),Ne.jsxs(Kf,{value:s.defaultCurrency,onValueChange:e=>j("defaultCurrency",e),children:[Ne.jsx(Gf,{children:Ne.jsx(Yf,{})}),Ne.jsxs(Xf,{children:[Ne.jsx(Zf,{value:"XOF",children:"Franc CFA (XOF)"}),Ne.jsx(Zf,{value:"EUR",children:"Euro (EUR)"}),Ne.jsx(Zf,{value:"USD",children:"Dollar US (USD)"}),Ne.jsx(Zf,{value:"GBP",children:"Livre Sterling (GBP)"}),Ne.jsx(Zf,{value:"JPY",children:"Yen Japonais (JPY)"}),Ne.jsx(Zf,{value:"CNY",children:"Yuan Chinois (CNY)"})]})]})]}),Ne.jsxs("div",{children:[Ne.jsx(Zm,{htmlFor:"currencySymbol",children:"Symbole de la devise"}),Ne.jsx(Bh,{id:"currencySymbol",value:s.currencySymbol,onChange:e=>j("currencySymbol",e.target.value),placeholder:"CFA, , $, "})]})]}),Ne.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[Ne.jsxs("div",{children:[Ne.jsx(Zm,{htmlFor:"currencyPosition",children:"Position du symbole"}),Ne.jsxs(Kf,{value:s.currencyPosition,onValueChange:e=>j("currencyPosition",e),children:[Ne.jsx(Gf,{children:Ne.jsx(Yf,{})}),Ne.jsxs(Xf,{children:[Ne.jsx(Zf,{value:"before",children:"Avant le montant"}),Ne.jsx(Zf,{value:"after",children:"Aprs le montant"})]})]})]}),Ne.jsxs("div",{children:[Ne.jsx(Zm,{htmlFor:"decimalPlaces",children:"Nombre de dcimales"}),Ne.jsxs(Kf,{value:s.decimalPlaces.toString(),onValueChange:e=>j("decimalPlaces",parseInt(e)),children:[Ne.jsx(Gf,{children:Ne.jsx(Yf,{})}),Ne.jsxs(Xf,{children:[Ne.jsx(Zf,{value:"0",children:"0 (entiers)"}),Ne.jsx(Zf,{value:"2",children:"2 (cents)"}),Ne.jsx(Zf,{value:"3",children:"3 (millimes)"})]})]})]})]}),Ne.jsx(Qh,{}),Ne.jsxs("div",{className:"bg-muted/50 p-4 rounded-lg",children:[Ne.jsx(Zm,{className:"text-sm font-medium mb-2 block",children:"Aperu du formatage"}),Ne.jsxs("div",{className:"space-y-2 text-sm",children:[Ne.jsxs("div",{className:"flex justify-between",children:[Ne.jsx("span",{children:"Montant: 1234567"}),Ne.jsx("span",{className:"font-mono",children:"before"===s.currencyPosition?`${s.currencySymbol} 1,234,567`:`1,234,567 ${s.currencySymbol}`})]}),Ne.jsxs("div",{className:"flex justify-between",children:[Ne.jsx("span",{children:"Montant avec dcimales: 1234.56"}),Ne.jsx("span",{className:"font-mono",children:"before"===s.currencyPosition?`${s.currencySymbol} 1,234${s.decimalPlaces>0?".56":""}`:`1,234${s.decimalPlaces>0?".56":""} ${s.currencySymbol}`})]})]})]})]})]})}),Ne.jsx(_p,{value:"maintenance",className:"space-y-6",children:Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{children:[Ne.jsxs(Vm,{className:"flex items-center gap-2",children:[Ne.jsx(ea,{className:"w-5 h-5"}),"Mode Maintenance"]}),Ne.jsx(Bm,{children:"Contrle d'accs et maintenance du systme"})]}),Ne.jsxs(Hm,{className:"space-y-6",children:[Ne.jsxs("div",{className:"flex items-center justify-between",children:[Ne.jsxs("div",{className:"space-y-0.5",children:[Ne.jsx(Zm,{children:"Mode maintenance"}),Ne.jsx("p",{className:"text-sm text-muted-foreground",children:"Dsactiver l'accs utilisateur temporairement"})]}),Ne.jsxs("div",{className:"flex items-center gap-2",children:[Ne.jsx(Nb,{checked:s.maintenanceMode,onCheckedChange:e=>j("maintenanceMode",e)}),s.maintenanceMode&&Ne.jsx(Cp,{variant:"destructive",children:"Actif"})]})]}),s.maintenanceMode&&Ne.jsxs("div",{children:[Ne.jsx(Zm,{htmlFor:"maintenanceMessage",children:"Message de maintenance"}),Ne.jsx(Bh,{id:"maintenanceMessage",value:s.maintenanceMessage,onChange:e=>j("maintenanceMessage",e.target.value),placeholder:"Le systme est en maintenance..."})]}),Ne.jsx(Qh,{}),Ne.jsxs("div",{className:"flex items-center justify-between",children:[Ne.jsxs("div",{className:"space-y-0.5",children:[Ne.jsx(Zm,{children:"Accs administrateur uniquement"}),Ne.jsx("p",{className:"text-sm text-muted-foreground",children:"Restreindre l'accs aux administrateurs pendant la maintenance"})]}),Ne.jsx(Nb,{checked:s.adminOnlyAccess,onCheckedChange:e=>j("adminOnlyAccess",e)})]}),Ne.jsx(Qh,{}),Ne.jsxs("div",{className:"space-y-4",children:[Ne.jsx(Zm,{children:"Actions de maintenance"}),Ne.jsxs("div",{className:"flex gap-2 flex-wrap",children:[Ne.jsxs(Vh,{variant:"outline",className:"gap-2",children:[Ne.jsx(wr,{className:"w-4 h-4"}),"Optimiser base de donnes"]}),Ne.jsxs(Vh,{variant:"outline",className:"gap-2",children:[Ne.jsx(or,{className:"w-4 h-4"}),"Nettoyer logs"]}),Ne.jsxs(Vh,{variant:"destructive",className:"gap-2",children:[Ne.jsx(ea,{className:"w-4 h-4"}),"Redmarrer services"]})]})]})]})]})}),Ne.jsx(_p,{value:"pages",className:"space-y-6",children:Ne.jsxs(Um,{className:"bg-gradient-card shadow-card",children:[Ne.jsxs(Wm,{children:[Ne.jsx(Vm,{className:"flex items-center gap-2",children:"Gestion d'accs aux pages"}),Ne.jsx(Bm,{children:"Activer/dsactiver l'accs aux pages par utilisateur"})]}),Ne.jsxs(Hm,{className:"space-y-6",children:[d&&Ne.jsx("div",{className:"text-sm text-destructive",children:d}),"SuperAdmin"!==(null==t?void 0:t.role)&&Ne.jsx("div",{className:"text-sm text-muted-foreground",children:"Seul le SuperAdmin peut modifier les accs aux pages."}),"SuperAdmin"===(null==t?void 0:t.role)&&Ne.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 items-end",children:Ne.jsxs("div",{children:[Ne.jsx(Zm,{children:"Utilisateur"}),Ne.jsxs(Kf,{value:f||"",onValueChange:x,children:[Ne.jsx(Gf,{children:Ne.jsx(Yf,{placeholder:"Slectionner un utilisateur"})}),Ne.jsx(Xf,{children:m.map(e=>Ne.jsxs(Zf,{value:e.id,children:[e.first_name," ",e.last_name,"  ",e.role," (",e.status,")"]},e.id))})]})]})}),c?Ne.jsx("div",{className:"text-sm text-muted-foreground",children:"Chargement des accs..."}):Ne.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Fh.map(e=>Ne.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-4",children:[Ne.jsxs("div",{className:"space-y-1",children:[Ne.jsx("div",{className:"font-medium",children:e.label}),Ne.jsxs("div",{className:"text-xs text-muted-foreground",children:["Chemin: ",e.path]}),Ne.jsxs("div",{className:"text-xs text-muted-foreground",children:["Rles autoriss: ",e.allowedRoles.join(", ")]})]}),Ne.jsx(Nb,{checked:(()=>{const s="SuperAdmin"===(null==t?void 0:t.role)&&g?g:t;if(!s)return!1;const r=e.allowedRoles.includes(s.role),a=(u[s.id]||{})[e.key];return"boolean"==typeof a?a:r})(),onCheckedChange:s=>{const r="SuperAdmin"===(null==t?void 0:t.role)&&g?g:t;r&&h(r.id,e.key,s)},disabled:"SuperAdmin"!==(null==t?void 0:t.role)})]},e.key))})]})]})})]}),Ne.jsx("div",{className:"flex justify-end",children:Ne.jsxs(Vh,{onClick:v,size:"lg",className:"gap-2",children:[Ne.jsx(Jr,{className:"w-4 h-4"}),"Sauvegarder tous les paramtres"]})})]})}function Wb(){const{signOut:e,userProfile:t}=Ih();return Ne.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background p-4",children:Ne.jsxs(Um,{className:"w-full max-w-md shadow-lg",children:[Ne.jsxs(Wm,{className:"text-center",children:[Ne.jsx("div",{className:"w-16 h-16 bg-warning/10 rounded-full flex items-center justify-center mx-auto mb-4",children:Ne.jsx(jr,{className:"w-8 h-8",style:{color:"hsl(var(--warning))"}})}),Ne.jsx(Vm,{className:"text-xl",children:"Compte en attente"}),Ne.jsx(Bm,{children:"Votre compte est en cours de validation"})]}),Ne.jsxs(Hm,{className:"space-y-4",children:[Ne.jsxs("div",{className:"text-center space-y-2",children:[Ne.jsxs("p",{className:"text-sm text-muted-foreground",children:["Bonjour ",Ne.jsxs("strong",{children:[null==t?void 0:t.first_name," ",null==t?void 0:t.last_name]})]}),Ne.jsx("p",{className:"text-sm text-muted-foreground",children:"Votre compte a t cr avec succs et est en attente de validation par un administrateur."}),Ne.jsx("p",{className:"text-sm text-muted-foreground",children:"Vous recevrez une notification par email ds que votre compte sera activ."})]}),Ne.jsx("div",{className:"pt-4",children:Ne.jsxs(Vh,{variant:"outline",className:"w-full gap-2",onClick:e,children:[Ne.jsx(Or,{className:"w-4 h-4"}),"Se dconnecter"]})})]})]})})}function Vb(){const[e,t]=Nt.useState([]),[s,r]=Nt.useState([]),[a,n]=Nt.useState([]),[i,o]=Nt.useState([]),[l,c]=Nt.useState([]),[d,u]=Nt.useState([]),[h,m]=Nt.useState(!0),{toast:p}=is(),[f,x]=Nt.useState(!1),[g,v]=Nt.useState(!1),[j,y]=Nt.useState(!1),[b,w]=Nt.useState(!1),[N,_]=Nt.useState(!1),[k,S]=Nt.useState(null),[C,E]=Nt.useState(null),[M,T]=Nt.useState(null),[A,P]=Nt.useState(null),D=[{value:"star",label:"toile",icon:sa},{value:"award",label:"Rcompense",icon:ir},{value:"trophy",label:"Trophe",icon:oa},{value:"target",label:"Cible",icon:aa},{value:"users",label:"Utilisateurs",icon:ma},{value:"trending-up",label:"Tendance",icon:ia}];Nt.useEffect(()=>{R()},[]);const R=async()=>{try{const[e,s,a,i,l,d]=await Promise.all([Dh.from("gamification_levels").select("*").order("min_points"),Dh.from("gamification_point_rules").select("*").order("created_at"),Dh.from("gamification_badges").select("*").order("created_at"),Dh.from("gamification_trophies").select("*").order("created_at"),Dh.from("gamification_points").select("*, users(first_name, last_name)").order("created_at",{ascending:!1}).limit(20),Dh.from("users").select("id, first_name, last_name, role").eq("status","active")]);t(e.data||[]),r(s.data||[]),n(a.data||[]),o(i.data||[]),c(l.data||[]),u(d.data||[])}catch(e){p({title:"Erreur",description:"Impossible de charger les donnes de gamification",variant:"destructive"})}finally{m(!1)}};return h?Ne.jsx("div",{className:"flex items-center justify-center h-64",children:"Chargement..."}):Ne.jsxs("div",{className:"space-y-6",children:[Ne.jsxs("div",{children:[Ne.jsx("h1",{className:"text-3xl font-bold",children:"Gamification"}),Ne.jsx("p",{className:"text-muted-foreground",children:"Configuration du systme de rcompenses"})]}),Ne.jsxs(bp,{defaultValue:"levels",className:"space-y-4",children:[Ne.jsxs(wp,{children:[Ne.jsx(Np,{value:"levels",children:"Niveaux"}),Ne.jsx(Np,{value:"rules",children:"Rgles de Points"}),Ne.jsx(Np,{value:"badges",children:"Badges"}),Ne.jsx(Np,{value:"trophies",children:"Trophes"}),Ne.jsx(Np,{value:"manual",children:"Points Manuels"})]}),Ne.jsx(_p,{value:"levels",children:Ne.jsxs(Um,{children:[Ne.jsx(Wm,{children:Ne.jsxs("div",{className:"flex justify-between items-center",children:[Ne.jsxs("div",{children:[Ne.jsx(Vm,{children:"Niveaux de Points"}),Ne.jsx(Bm,{children:"Configurez les niveaux bass sur les points"})]}),Ne.jsxs(bg,{open:f,onOpenChange:x,children:[Ne.jsx(wg,{asChild:!0,children:Ne.jsxs(Vh,{onClick:()=>S(null),children:[Ne.jsx(Yr,{className:"w-4 h-4 mr-2"}),"Nouveau Niveau"]})}),Ne.jsxs(kg,{children:[Ne.jsx(Sg,{children:Ne.jsxs(Eg,{children:[k?"Modifier":"Crer"," un Niveau"]})}),Ne.jsxs("form",{onSubmit:e=>{e.preventDefault();(async e=>{const t={name:e.get("name"),min_points:parseInt(e.get("min_points")),max_points:parseInt(e.get("max_points")),color:e.get("color"),icon:e.get("icon")};try{k?await Dh.from("gamification_levels").update(t).eq("id",k.id):await Dh.from("gamification_levels").insert(t),p({title:"Succs",description:`Niveau ${k?"modifi":"cr"} avec succs`}),x(!1),S(null),R()}catch(s){p({title:"Erreur",description:"Impossible de sauvegarder le niveau",variant:"destructive"})}})(new FormData(e.currentTarget))},children:[Ne.jsxs("div",{className:"space-y-4",children:[Ne.jsxs("div",{children:[Ne.jsx(Zm,{htmlFor:"name",children:"Nom"}),Ne.jsx(Bh,{name:"name",defaultValue:null==k?void 0:k.name,required:!0})]}),Ne.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[Ne.jsxs("div",{children:[Ne.jsx(Zm,{htmlFor:"min_points",children:"Points Minimum"}),Ne.jsx(Bh,{name:"min_points",type:"number",defaultValue:null==k?void 0:k.min_points,required:!0})]}),Ne.jsxs("div",{children:[Ne.jsx(Zm,{htmlFor:"max_points",children:"Points Maximum"}),Ne.jsx(Bh,{name:"max_points",type:"number",defaultValue:null==k?void 0:k.max_points,required:!0})]})]}),Ne.jsxs("div",{children:[Ne.jsx(Zm,{htmlFor:"color",children:"Couleur"}),Ne.jsx(Bh,{name:"color",type:"color",defaultValue:(null==k?void 0:k.color)||"#3B82F6"})]}),Ne.jsxs("div",{children:[Ne.jsx(Zm,{htmlFor:"icon",children:"Icne"}),Ne.jsxs(Kf,{name:"icon",defaultValue:null==k?void 0:k.icon,children:[Ne.jsx(Gf,{children:Ne.jsx(Yf,{})}),Ne.jsx(Xf,{children:D.map(e=>Ne.jsx(Zf,{value:e.value,children:Ne.jsxs("div",{className:"flex items-center",children:[Ne.jsx(e.icon,{className:"w-4 h-4 mr-2"}),e.label]})},e.value))})]})]})]}),Ne.jsx(Cg,{className:"mt-6",children:Ne.jsx(Vh,{type:"submit",children:"Sauvegarder"})})]})]})]})]})}),Ne.jsx(Hm,{children:Ne.jsxs(fg,{children:[Ne.jsx(xg,{children:Ne.jsxs(vg,{children:[Ne.jsx(jg,{children:"Nom"}),Ne.jsx(jg,{children:"Plage de Points"}),Ne.jsx(jg,{children:"Couleur"}),Ne.jsx(jg,{children:"Actions"})]})}),Ne.jsx(gg,{children:e.map(e=>Ne.jsxs(vg,{children:[Ne.jsx(yg,{className:"font-medium",children:e.name}),Ne.jsxs(yg,{children:[e.min_points," - ",e.max_points]}),Ne.jsx(yg,{children:Ne.jsxs("div",{className:"flex items-center",children:[Ne.jsx("div",{className:"w-4 h-4 rounded mr-2",style:{backgroundColor:e.color}}),e.color]})}),Ne.jsx(yg,{children:Ne.jsx(Vh,{variant:"ghost",size:"sm",onClick:()=>{S(e),x(!0)},children:Ne.jsx(Br,{className:"w-4 h-4"})})})]},e.id))})]})})]})}),Ne.jsx(_p,{value:"rules",children:Ne.jsxs(Um,{children:[Ne.jsx(Wm,{children:Ne.jsxs("div",{className:"flex justify-between items-center",children:[Ne.jsxs("div",{children:[Ne.jsx(Vm,{children:"Rgles d'Attribution de Points"}),Ne.jsx(Bm,{children:"Configurez l'attribution automatique de points"})]}),Ne.jsxs(bg,{open:g,onOpenChange:v,children:[Ne.jsx(wg,{asChild:!0,children:Ne.jsxs(Vh,{onClick:()=>E(null),children:[Ne.jsx(Yr,{className:"w-4 h-4 mr-2"}),"Nouvelle Rgle"]})}),Ne.jsxs(kg,{children:[Ne.jsx(Sg,{children:Ne.jsxs(Eg,{children:[C?"Modifier":"Crer"," une Rgle"]})}),Ne.jsxs("form",{onSubmit:e=>{e.preventDefault();(async e=>{const t={name:e.get("name"),description:e.get("description"),event_type:e.get("event_type"),points_awarded:parseInt(e.get("points_awarded")),condition_value:JSON.parse(e.get("condition_value")||"{}"),is_active:"on"===e.get("is_active")};try{C?await Dh.from("gamification_point_rules").update(t).eq("id",C.id):await Dh.from("gamification_point_rules").insert(t),p({title:"Succs",description:`Rgle ${C?"modifie":"cre"} avec succs`}),v(!1),E(null),R()}catch(s){p({title:"Erreur",description:"Impossible de sauvegarder la rgle",variant:"destructive"})}})(new FormData(e.currentTarget))},children:[Ne.jsxs("div",{className:"space-y-4",children:[Ne.jsxs("div",{children:[Ne.jsx(Zm,{htmlFor:"name",children:"Nom"}),Ne.jsx(Bh,{name:"name",defaultValue:null==C?void 0:C.name,required:!0})]}),Ne.jsxs("div",{children:[Ne.jsx(Zm,{htmlFor:"description",children:"Description"}),Ne.jsx(Tg,{name:"description",defaultValue:null==C?void 0:C.description})]}),Ne.jsxs("div",{children:[Ne.jsx(Zm,{htmlFor:"event_type",children:"Type d'vnement"}),Ne.jsxs(Kf,{name:"event_type",defaultValue:null==C?void 0:C.event_type,children:[Ne.jsx(Gf,{children:Ne.jsx(Yf,{})}),Ne.jsxs(Xf,{children:[Ne.jsx(Zf,{value:"sale",children:"Vente"}),Ne.jsx(Zf,{value:"return",children:"Retour"}),Ne.jsx(Zf,{value:"target_achieved",children:"Objectif Atteint"})]})]})]}),Ne.jsxs("div",{children:[Ne.jsx(Zm,{htmlFor:"points_awarded",children:"Points Attribus"}),Ne.jsx(Bh,{name:"points_awarded",type:"number",defaultValue:null==C?void 0:C.points_awarded,required:!0})]}),Ne.jsxs("div",{children:[Ne.jsx(Zm,{htmlFor:"condition_value",children:"Conditions (JSON)"}),Ne.jsx(Tg,{name:"condition_value",defaultValue:JSON.stringify((null==C?void 0:C.condition_value)||{},null,2),placeholder:'{"min_amount": 100}'})]}),Ne.jsxs("div",{className:"flex items-center space-x-2",children:[Ne.jsx(Nb,{name:"is_active",defaultChecked:!1!==(null==C?void 0:C.is_active)}),Ne.jsx(Zm,{htmlFor:"is_active",children:"Rgle Active"})]})]}),Ne.jsx(Cg,{className:"mt-6",children:Ne.jsx(Vh,{type:"submit",children:"Sauvegarder"})})]})]})]})]})}),Ne.jsx(Hm,{children:Ne.jsxs(fg,{children:[Ne.jsx(xg,{children:Ne.jsxs(vg,{children:[Ne.jsx(jg,{children:"Nom"}),Ne.jsx(jg,{children:"Type"}),Ne.jsx(jg,{children:"Points"}),Ne.jsx(jg,{children:"Statut"}),Ne.jsx(jg,{children:"Actions"})]})}),Ne.jsx(gg,{children:s.map(e=>Ne.jsxs(vg,{children:[Ne.jsx(yg,{className:"font-medium",children:e.name}),Ne.jsx(yg,{children:e.event_type}),Ne.jsxs(yg,{children:[e.points_awarded," pts"]}),Ne.jsx(yg,{children:Ne.jsx(Cp,{variant:e.is_active?"default":"secondary",children:e.is_active?"Active":"Inactive"})}),Ne.jsx(yg,{children:Ne.jsx(Vh,{variant:"ghost",size:"sm",onClick:()=>{E(e),v(!0)},children:Ne.jsx(Br,{className:"w-4 h-4"})})})]},e.id))})]})})]})}),Ne.jsx(_p,{value:"manual",children:Ne.jsx("div",{className:"grid gap-6",children:Ne.jsxs(Um,{children:[Ne.jsx(Wm,{children:Ne.jsxs("div",{className:"flex justify-between items-center",children:[Ne.jsxs("div",{children:[Ne.jsx(Vm,{children:"Attribution Manuelle de Points"}),Ne.jsx(Bm,{children:"Ajoutez ou retirez des points manuellement"})]}),Ne.jsxs(bg,{open:N,onOpenChange:_,children:[Ne.jsx(wg,{asChild:!0,children:Ne.jsxs(Vh,{children:[Ne.jsx(Yr,{className:"w-4 h-4 mr-2"}),"Ajouter Points"]})}),Ne.jsxs(kg,{children:[Ne.jsx(Sg,{children:Ne.jsx(Eg,{children:"Attribution Manuelle de Points"})}),Ne.jsxs("form",{onSubmit:e=>{e.preventDefault();(async e=>{const t={user_id:e.get("user_id"),points:parseInt(e.get("points")),reason:e.get("reason")};try{await Dh.from("gamification_points").insert(t),p({title:"Succs",description:"Points ajouts avec succs"}),_(!1),R()}catch(s){p({title:"Erreur",description:"Impossible d'ajouter les points",variant:"destructive"})}})(new FormData(e.currentTarget))},children:[Ne.jsxs("div",{className:"space-y-4",children:[Ne.jsxs("div",{children:[Ne.jsx(Zm,{htmlFor:"user_id",children:"Utilisateur"}),Ne.jsxs(Kf,{name:"user_id",required:!0,children:[Ne.jsx(Gf,{children:Ne.jsx(Yf,{placeholder:"Slectionner un utilisateur"})}),Ne.jsx(Xf,{children:d.map(e=>Ne.jsxs(Zf,{value:e.id,children:[e.first_name," ",e.last_name," (",e.role,")"]},e.id))})]})]}),Ne.jsxs("div",{children:[Ne.jsx(Zm,{htmlFor:"points",children:"Points (utilisez un nombre ngatif pour retirer)"}),Ne.jsx(Bh,{name:"points",type:"number",required:!0})]}),Ne.jsxs("div",{children:[Ne.jsx(Zm,{htmlFor:"reason",children:"Raison"}),Ne.jsx(Tg,{name:"reason",required:!0})]})]}),Ne.jsx(Cg,{className:"mt-6",children:Ne.jsx(Vh,{type:"submit",children:"Attribuer"})})]})]})]})]})}),Ne.jsx(Hm,{children:Ne.jsxs(fg,{children:[Ne.jsx(xg,{children:Ne.jsxs(vg,{children:[Ne.jsx(jg,{children:"Utilisateur"}),Ne.jsx(jg,{children:"Points"}),Ne.jsx(jg,{children:"Raison"}),Ne.jsx(jg,{children:"Date"})]})}),Ne.jsx(gg,{children:l.map(e=>Ne.jsxs(vg,{children:[Ne.jsxs(yg,{children:[e.users.first_name," ",e.users.last_name]}),Ne.jsx(yg,{children:Ne.jsxs("span",{className:e.points>=0?"text-green-600":"text-red-600",children:[e.points>=0?"+":"",e.points," pts"]})}),Ne.jsx(yg,{children:e.reason}),Ne.jsx(yg,{children:new Date(e.created_at).toLocaleDateString()})]},e.id))})]})})]})})})]})]})}var Bb="Progress",[Hb,Kb]=ke(Bb),[Yb,Gb]=Hb(Bb),Qb=Nt.forwardRef((e,t)=>{const{__scopeProgress:s,value:r=null,max:a,getValueLabel:n=Zb,...i}=e;(a||0===a)&&sw(a);const o=sw(a)?a:100;null!==r&&rw(r,o);const l=rw(r,o)?r:null,c=tw(l)?n(l,o):void 0;return Ne.jsx(Yb,{scope:s,value:l,max:o,children:Ne.jsx(_e.div,{"aria-valuemax":o,"aria-valuemin":0,"aria-valuenow":tw(l)?l:void 0,"aria-valuetext":c,role:"progressbar","data-state":ew(l,o),"data-value":l??void 0,"data-max":o,...i,ref:t})})});Qb.displayName=Bb;var Jb="ProgressIndicator",Xb=Nt.forwardRef((e,t)=>{const{__scopeProgress:s,...r}=e,a=Gb(Jb,s);return Ne.jsx(_e.div,{"data-state":ew(a.value,a.max),"data-value":a.value??void 0,"data-max":a.max,...r,ref:t})});function Zb(e,t){return`${Math.round(e/t*100)}%`}function ew(e,t){return null==e?"indeterminate":e===t?"complete":"loading"}function tw(e){return"number"==typeof e}function sw(e){return tw(e)&&!isNaN(e)&&e>0}function rw(e,t){return tw(e)&&!isNaN(e)&&e<=t&&e>=0}Xb.displayName=Jb;var aw=Qb,nw=Xb;const iw=Nt.forwardRef(({className:e,value:t,...s},r)=>Ne.jsx(aw,{ref:r,className:un("relative h-4 w-full overflow-hidden rounded-full bg-secondary",e),...s,children:Ne.jsx(nw,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(t||0)}%)`}})}));iw.displayName=aw.displayName;var ow={exports:{}},lw={},cw=Nt;var dw="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},uw=cw.useState,hw=cw.useEffect,mw=cw.useLayoutEffect,pw=cw.useDebugValue;function fw(e){var t=e.getSnapshot;e=e.value;try{var s=t();return!dw(e,s)}catch(r){return!0}}var xw="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var s=t(),r=uw({inst:{value:s,getSnapshot:t}}),a=r[0].inst,n=r[1];return mw(function(){a.value=s,a.getSnapshot=t,fw(a)&&n({inst:a})},[e,s,t]),hw(function(){return fw(a)&&n({inst:a}),e(function(){fw(a)&&n({inst:a})})},[e]),pw(s),s};lw.useSyncExternalStore=void 0!==cw.useSyncExternalStore?cw.useSyncExternalStore:xw,ow.exports=lw;var gw=ow.exports;function vw(){return()=>{}}var jw="Avatar",[yw,bw]=ke(jw),[ww,Nw]=yw(jw),_w=Nt.forwardRef((e,t)=>{const{__scopeAvatar:s,...r}=e,[a,n]=Nt.useState("idle");return Ne.jsx(ww,{scope:s,imageLoadingStatus:a,onImageLoadingStatusChange:n,children:Ne.jsx(_e.span,{...r,ref:t})})});_w.displayName=jw;var kw="AvatarImage",Sw=Nt.forwardRef((e,t)=>{const{__scopeAvatar:s,src:r,onLoadingStatusChange:a=()=>{},...n}=e,i=Nw(kw,s),o=function(e,{referrerPolicy:t,crossOrigin:s}){const r=gw.useSyncExternalStore(vw,()=>!0,()=>!1),a=Nt.useRef(null),n=r?(a.current||(a.current=new window.Image),a.current):null,[i,o]=Nt.useState(()=>Mw(n,e));return Oe(()=>{o(Mw(n,e))},[n,e]),Oe(()=>{const e=e=>()=>{o(e)};if(!n)return;const r=e("loaded"),a=e("error");return n.addEventListener("load",r),n.addEventListener("error",a),t&&(n.referrerPolicy=t),"string"==typeof s&&(n.crossOrigin=s),()=>{n.removeEventListener("load",r),n.removeEventListener("error",a)}},[n,s,t]),i}(r,n),l=Pe(e=>{a(e),i.onImageLoadingStatusChange(e)});return Oe(()=>{"idle"!==o&&l(o)},[o,l]),"loaded"===o?Ne.jsx(_e.img,{...n,ref:t,src:r}):null});Sw.displayName=kw;var Cw="AvatarFallback",Ew=Nt.forwardRef((e,t)=>{const{__scopeAvatar:s,delayMs:r,...a}=e,n=Nw(Cw,s),[i,o]=Nt.useState(void 0===r);return Nt.useEffect(()=>{if(void 0!==r){const e=window.setTimeout(()=>o(!0),r);return()=>window.clearTimeout(e)}},[r]),i&&"loaded"!==n.imageLoadingStatus?Ne.jsx(_e.span,{...a,ref:t}):null});function Mw(e,t){return e?t?(e.src!==t&&(e.src=t),e.complete&&e.naturalWidth>0?"loaded":"loading"):"error":"idle"}Ew.displayName=Cw;var Tw=_w,Aw=Sw,Pw=Ew;const Dw=Nt.forwardRef(({className:e,...t},s)=>Ne.jsx(Tw,{ref:s,className:un("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",e),...t}));Dw.displayName=Tw.displayName;Nt.forwardRef(({className:e,...t},s)=>Ne.jsx(Aw,{ref:s,className:un("aspect-square h-full w-full",e),...t})).displayName=Aw.displayName;const Rw=Nt.forwardRef(({className:e,...t},s)=>Ne.jsx(Pw,{ref:s,className:un("flex h-full w-full items-center justify-center rounded-full bg-muted",e),...t}));Rw.displayName=Pw.displayName;const Ow=e=>({star:sa,award:ir,trophy:oa,target:aa,crown:br,gem:Tr,medal:Fr,user:ha}[e]||sa);function qw(){var e,t;const{userProfile:s}=Ih(),[r,a]=Nt.useState(null),[n,i]=Nt.useState(!0),[o,l]=Nt.useState([]),{toast:c}=is();Nt.useEffect(()=>{s&&d()},[s]);const d=async()=>{if(s)try{const{data:e}=await Dh.from("gamification_points").select("points").eq("user_id",s.id),t=(null==e?void 0:e.reduce((e,t)=>e+t.points,0))||0,{data:r}=await Dh.from("gamification_levels").select("*").order("min_points");let n=null,i=null;if(r){for(let e=0;e<r.length;e++){const s=r[e];if(t>=s.min_points&&t<=s.max_points){n=s,i=r[e+1]||null;break}}!n&&r.length>0&&(n=r[0],i=r[1]||null)}const{data:o}=await Dh.from("user_badges").select("\n          awarded_at,\n          gamification_badges (\n            id, name, description, icon\n          )\n        ").eq("user_id",s.id).order("awarded_at",{ascending:!1}),c=(null==o?void 0:o.map(e=>({id:e.gamification_badges.id,name:e.gamification_badges.name,description:e.gamification_badges.description,icon:e.gamification_badges.icon,awarded_at:e.awarded_at})))||[],{data:d}=await Dh.from("user_trophies").select("\n          awarded_at, period_month, period_year,\n          gamification_trophies (\n            id, name, description, icon\n          )\n        ").eq("user_id",s.id).order("awarded_at",{ascending:!1}),u=(null==d?void 0:d.map(e=>({id:e.gamification_trophies.id,name:e.gamification_trophies.name,description:e.gamification_trophies.description,icon:e.gamification_trophies.icon,awarded_at:e.awarded_at,period_month:e.period_month,period_year:e.period_year})))||[],{data:h}=await Dh.from("gamification_points").select("points, reason, created_at").eq("user_id",s.id).order("created_at",{ascending:!1}).limit(10),{data:m}=await Dh.from("user_stores").select("\n          is_primary,\n          stores (\n            id, name, code, is_active\n          )\n        ").eq("user_id",s.id).order("is_primary",{ascending:!1}),p=(m||[]).map(e=>{var t,s,r,a;return{id:null==(t=e.stores)?void 0:t.id,name:null==(s=e.stores)?void 0:s.name,code:(null==(r=e.stores)?void 0:r.code)??null,is_active:(null==(a=e.stores)?void 0:a.is_active)??null,is_primary:Boolean(e.is_primary)}});l(p),a({totalPoints:t,currentLevel:n,nextLevel:i,badges:c,trophies:u,recentPoints:h||[]})}catch(e){c({title:"Erreur",description:"Impossible de charger les statistiques",variant:"destructive"})}finally{i(!1)}};if(n)return Ne.jsx("div",{className:"flex items-center justify-center h-64",children:"Chargement..."});if(!s||!r)return Ne.jsx("div",{className:"flex items-center justify-center h-64",children:"Aucune donne disponible"});const u=r.nextLevel?(r.totalPoints-((null==(e=r.currentLevel)?void 0:e.min_points)||0))/(r.nextLevel.min_points-((null==(t=r.currentLevel)?void 0:t.min_points)||0))*100:100;return Ne.jsxs("div",{className:"space-y-6",children:[Ne.jsxs("div",{children:[Ne.jsx("h1",{className:"text-3xl font-bold",children:"Mon Profil"}),Ne.jsx("p",{className:"text-muted-foreground",children:"Vos informations personnelles et rcompenses"})]}),Ne.jsxs(bp,{defaultValue:"overview",className:"space-y-4",children:[Ne.jsxs(wp,{children:[Ne.jsx(Np,{value:"overview",children:"Vue d'ensemble"}),Ne.jsx(Np,{value:"badges",children:"Mes Badges"}),Ne.jsx(Np,{value:"trophies",children:"Mes Trophes"}),Ne.jsx(Np,{value:"points",children:"Historique Points"}),Ne.jsx(Np,{value:"info",children:"Informations"})]}),Ne.jsxs(_p,{value:"overview",className:"space-y-6",children:[Ne.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[Ne.jsxs(Um,{children:[Ne.jsx(Wm,{children:Ne.jsxs(Vm,{className:"flex items-center gap-4",children:[Ne.jsx(Dw,{className:"w-16 h-16",children:Ne.jsxs(Rw,{children:[s.first_name.charAt(0),s.last_name.charAt(0)]})}),Ne.jsxs("div",{children:[Ne.jsxs("h2",{className:"text-xl font-bold",children:[s.first_name," ",s.last_name]}),Ne.jsx("p",{className:"text-muted-foreground",children:s.role})]})]})}),Ne.jsx(Hm,{className:"space-y-4",children:r.currentLevel&&Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsxs("div",{className:"flex items-center justify-between",children:[Ne.jsxs("div",{className:"flex items-center gap-2",children:[(()=>{const e=Ow(r.currentLevel.icon);return Ne.jsx(e,{className:"w-5 h-5",style:{color:r.currentLevel.color}})})(),Ne.jsxs("span",{className:"font-medium",style:{color:r.currentLevel.color},children:["Niveau ",r.currentLevel.name]})]}),Ne.jsxs("span",{className:"text-sm text-muted-foreground",children:[r.totalPoints," points"]})]}),r.nextLevel&&Ne.jsxs("div",{className:"space-y-2",children:[Ne.jsx(iw,{value:u,className:"h-2"}),Ne.jsxs("p",{className:"text-sm text-muted-foreground",children:[r.nextLevel.min_points-r.totalPoints," points pour atteindre ",r.nextLevel.name]})]})]})})]}),Ne.jsxs(Um,{children:[Ne.jsx(Wm,{children:Ne.jsx(Vm,{children:"Mes Rcompenses"})}),Ne.jsx(Hm,{children:Ne.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[Ne.jsxs("div",{children:[Ne.jsx("div",{className:"text-2xl font-bold text-primary",children:r.totalPoints}),Ne.jsx("p",{className:"text-sm text-muted-foreground",children:"Points Total"})]}),Ne.jsxs("div",{children:[Ne.jsx("div",{className:"text-2xl font-bold text-primary",children:r.badges.length}),Ne.jsx("p",{className:"text-sm text-muted-foreground",children:"Badges"})]}),Ne.jsxs("div",{children:[Ne.jsx("div",{className:"text-2xl font-bold text-primary",children:r.trophies.length}),Ne.jsx("p",{className:"text-sm text-muted-foreground",children:"Trophes"})]})]})})]})]}),Ne.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[Ne.jsxs(Um,{children:[Ne.jsx(Wm,{children:Ne.jsxs(Vm,{className:"flex items-center gap-2",children:[Ne.jsx(ir,{className:"w-5 h-5"}),"Badges Rcents"]})}),Ne.jsx(Hm,{children:r.badges.length>0?Ne.jsx("div",{className:"space-y-3",children:r.badges.slice(0,3).map(e=>{const t=Ow(e.icon);return Ne.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-lg bg-muted/50",children:[Ne.jsx(t,{className:"w-8 h-8 text-primary"}),Ne.jsxs("div",{className:"flex-1",children:[Ne.jsx("p",{className:"font-medium",children:e.name}),Ne.jsx("p",{className:"text-sm text-muted-foreground",children:e.description}),Ne.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(e.awarded_at).toLocaleDateString()})]})]},e.id)})}):Ne.jsx("p",{className:"text-muted-foreground text-center py-4",children:"Aucun badge obtenu"})})]}),Ne.jsxs(Um,{children:[Ne.jsx(Wm,{children:Ne.jsxs(Vm,{className:"flex items-center gap-2",children:[Ne.jsx(oa,{className:"w-5 h-5"}),"Trophes Rcents"]})}),Ne.jsx(Hm,{children:r.trophies.length>0?Ne.jsx("div",{className:"space-y-3",children:r.trophies.slice(0,3).map(e=>{const t=Ow(e.icon);return Ne.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-lg bg-muted/50",children:[Ne.jsx(t,{className:"w-8 h-8 text-yellow-500"}),Ne.jsxs("div",{className:"flex-1",children:[Ne.jsx("p",{className:"font-medium",children:e.name}),Ne.jsx("p",{className:"text-sm text-muted-foreground",children:e.description}),Ne.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.period_month,"/",e.period_year," - ",new Date(e.awarded_at).toLocaleDateString()]})]})]},e.id)})}):Ne.jsx("p",{className:"text-muted-foreground text-center py-4",children:"Aucun trophe obtenu"})})]})]})]}),Ne.jsx(_p,{value:"badges",children:Ne.jsxs(Um,{children:[Ne.jsxs(Wm,{children:[Ne.jsx(Vm,{children:"Tous mes Badges"}),Ne.jsx(Bm,{children:"Les badges que vous avez obtenus au fil du temps"})]}),Ne.jsx(Hm,{children:r.badges.length>0?Ne.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:r.badges.map(e=>{const t=Ow(e.icon);return Ne.jsxs("div",{className:"flex items-center gap-3 p-4 rounded-lg border",children:[Ne.jsx(t,{className:"w-10 h-10 text-primary"}),Ne.jsxs("div",{className:"flex-1",children:[Ne.jsx("p",{className:"font-medium",children:e.name}),Ne.jsx("p",{className:"text-sm text-muted-foreground",children:e.description}),Ne.jsx(Cp,{variant:"secondary",className:"mt-1",children:new Date(e.awarded_at).toLocaleDateString()})]})]},e.id)})}):Ne.jsx("p",{className:"text-muted-foreground text-center py-8",children:"Aucun badge obtenu pour le moment"})})]})}),Ne.jsx(_p,{value:"trophies",children:Ne.jsxs(Um,{children:[Ne.jsxs(Wm,{children:[Ne.jsx(Vm,{children:"Tous mes Trophes"}),Ne.jsx(Bm,{children:"Les trophes que vous avez remports"})]}),Ne.jsx(Hm,{children:r.trophies.length>0?Ne.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:r.trophies.map(e=>{const t=Ow(e.icon);return Ne.jsxs("div",{className:"flex items-center gap-3 p-4 rounded-lg border bg-gradient-to-br from-yellow-50 to-orange-50 dark:from-yellow-900/20 dark:to-orange-900/20",children:[Ne.jsx(t,{className:"w-10 h-10 text-yellow-500"}),Ne.jsxs("div",{className:"flex-1",children:[Ne.jsx("p",{className:"font-medium",children:e.name}),Ne.jsx("p",{className:"text-sm text-muted-foreground",children:e.description}),Ne.jsxs("div",{className:"flex gap-2 mt-1",children:[Ne.jsxs(Cp,{variant:"secondary",children:[e.period_month,"/",e.period_year]}),Ne.jsx(Cp,{variant:"secondary",children:new Date(e.awarded_at).toLocaleDateString()})]})]})]},e.id)})}):Ne.jsx("p",{className:"text-muted-foreground text-center py-8",children:"Aucun trophe obtenu pour le moment"})})]})}),Ne.jsx(_p,{value:"points",children:Ne.jsxs(Um,{children:[Ne.jsxs(Wm,{children:[Ne.jsxs(Vm,{className:"flex items-center gap-2",children:[Ne.jsx(ia,{className:"w-5 h-5"}),"Historique des Points"]}),Ne.jsx(Bm,{children:"Vos dernires activits gnratrices de points"})]}),Ne.jsx(Hm,{children:r.recentPoints.length>0?Ne.jsx("div",{className:"space-y-3",children:r.recentPoints.map((e,t)=>Ne.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border",children:[Ne.jsxs("div",{className:"flex-1",children:[Ne.jsx("p",{className:"font-medium",children:e.reason}),Ne.jsxs("p",{className:"text-sm text-muted-foreground",children:[new Date(e.created_at).toLocaleDateString(),"  ",new Date(e.created_at).toLocaleTimeString()]})]}),Ne.jsxs(Cp,{variant:e.points>=0?"default":"destructive",children:[e.points>=0?"+":"",e.points," pts"]})]},t))}):Ne.jsx("p",{className:"text-muted-foreground text-center py-8",children:"Aucune activit de points enregistre"})})]})}),Ne.jsx(_p,{value:"info",children:Ne.jsxs(Um,{children:[Ne.jsxs(Wm,{children:[Ne.jsx(Vm,{children:"Informations Personnelles"}),Ne.jsx(Bm,{children:"Vos donnes de profil (non modifiables)"})]}),Ne.jsxs(Hm,{className:"space-y-4",children:[Ne.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[Ne.jsxs("div",{className:"flex items-center gap-3",children:[Ne.jsx(ha,{className:"w-5 h-5 text-muted-foreground"}),Ne.jsxs("div",{children:[Ne.jsx("p",{className:"text-sm font-medium",children:"Nom complet"}),Ne.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.first_name," ",s.last_name]})]})]}),Ne.jsxs("div",{className:"flex items-center gap-3",children:[Ne.jsx(qr,{className:"w-5 h-5 text-muted-foreground"}),Ne.jsxs("div",{children:[Ne.jsx("p",{className:"text-sm font-medium",children:"Email"}),Ne.jsx("p",{className:"text-sm text-muted-foreground",children:s.email})]})]}),s.phone&&Ne.jsxs("div",{className:"flex items-center gap-3",children:[Ne.jsx(Hr,{className:"w-5 h-5 text-muted-foreground"}),Ne.jsxs("div",{children:[Ne.jsx("p",{className:"text-sm font-medium",children:"Tlphone"}),Ne.jsx("p",{className:"text-sm text-muted-foreground",children:s.phone})]})]}),Ne.jsxs("div",{className:"flex items-center gap-3",children:[Ne.jsx(br,{className:"w-5 h-5 text-muted-foreground"}),Ne.jsxs("div",{children:[Ne.jsx("p",{className:"text-sm font-medium",children:"Rle"}),Ne.jsx(Cp,{variant:"outline",children:s.role})]})]}),Ne.jsxs("div",{className:"flex items-center gap-3",children:[Ne.jsx(aa,{className:"w-5 h-5 text-muted-foreground"}),Ne.jsxs("div",{children:[Ne.jsx("p",{className:"text-sm font-medium",children:"Statut"}),Ne.jsx(Cp,{variant:"active"===s.status?"default":"secondary",children:"active"===s.status?"Actif":s.status})]})]}),Ne.jsxs("div",{className:"flex items-center gap-3",children:[Ne.jsx(dr,{className:"w-5 h-5 text-muted-foreground"}),Ne.jsxs("div",{children:[Ne.jsx("p",{className:"text-sm font-medium",children:"Membre depuis"}),Ne.jsx("p",{className:"text-sm text-muted-foreground",children:new Date(s.created_at).toLocaleDateString()})]})]})]}),Ne.jsx("div",{className:"space-y-3 pt-4",children:Ne.jsxs("div",{className:"flex items-center gap-3",children:[Ne.jsx(Ir,{className:"w-5 h-5 text-muted-foreground"}),Ne.jsxs("div",{children:[Ne.jsx("p",{className:"text-sm font-medium",children:"Mes Magasins"}),o.length>0?Ne.jsx("div",{className:"mt-2 space-y-2",children:o.map(e=>Ne.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg bg-muted/50",children:[Ne.jsxs("div",{className:"flex items-center gap-2",children:[Ne.jsx("span",{className:"font-medium",children:e.name}),e.code&&Ne.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",e.code,")"]})]}),Ne.jsxs("div",{className:"flex items-center gap-2",children:[e.is_primary&&Ne.jsx(Cp,{variant:"secondary",children:"Principal"}),!e.is_active&&Ne.jsx(Cp,{variant:"outline",children:"Inactif"})]})]},e.id))}):Ne.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Aucun magasin assign"})]})]})})]})]})})]})]})}const Iw=()=>{const e=hl();return Nt.useEffect(()=>{},[e.pathname]),Ne.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:Ne.jsxs("div",{className:"text-center",children:[Ne.jsx("h1",{className:"text-4xl font-bold mb-4",children:"404"}),Ne.jsx("p",{className:"text-xl text-gray-600 mb-4",children:"Oops! Page not found"}),Ne.jsx("a",{href:"/",className:"text-blue-500 hover:text-blue-700 underline",children:"Return to Home"})]})})};function Fw({minimumTimeMs:e=1200}){const[t]=Nt.useState(Date.now()),[s,r]=Nt.useState(!1),a=function(){const[e,t]=Nt.useState(navigator.onLine);return Nt.useEffect(()=>{const e=()=>t(!0),s=()=>t(!1);return window.addEventListener("online",e),window.addEventListener("offline",s),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",s)}},[]),e}();Nt.useEffect(()=>{const s=(()=>{const s=Date.now()-t,a=Math.max(0,e-s),n=setTimeout(()=>r(!0),a);return()=>clearTimeout(n)})();return()=>{"function"==typeof s&&s()}},[t,e]);return!s||!a?Ne.jsx("div",{className:"fixed inset-0 z-[10000] flex items-center justify-center bg-white/95 dark:bg-black/90",children:Ne.jsxs("div",{className:"flex flex-col items-center gap-4",children:[Ne.jsx("img",{src:"/logo.png",alt:"GesFlex",className:"w-16 h-16 animate-gf-bounce"}),Ne.jsxs("div",{className:"relative",children:[Ne.jsx("h1",{className:"text-3xl font-extrabold tracking-wide text-[#1e40af] animate-gf-fade",children:"GesFlex"}),!a&&Ne.jsx("p",{className:"mt-2 text-center text-sm text-red-600 animate-pulse",children:"Vous tes hors ligne. Vrifiez votre connexion internet."})]})]})}):null}const Lw=new oo({defaultOptions:{queries:{retry:3,retryDelay:e=>Math.min(1e3*2**e,3e4),staleTime:3e5,gcTime:6e5},mutations:{retry:2,retryDelay:e=>Math.min(1e3*2**e,1e4)}}}),$w=()=>Ne.jsx(Km,{children:Ne.jsx(fo,{client:Lw,children:Ne.jsxs(fi,{children:[Ne.jsx(Fw,{}),Ne.jsx(jn,{}),Ne.jsx(Un,{}),Ne.jsx(Ol,{children:Ne.jsx(qh,{children:Ne.jsxs(Cl,{children:[Ne.jsx(kl,{path:"/",element:Ne.jsx(Gm,{})}),Ne.jsx(kl,{path:"/login",element:Ne.jsx(kp,{})}),Ne.jsx(kl,{path:"/pending",element:Ne.jsx(Wb,{})}),Ne.jsx(kl,{path:"/admin",element:Ne.jsx(Uh,{allowedRoles:["Admin","SuperAdmin"],pageKey:"dashboard",children:Ne.jsx(zm,{children:Ne.jsx(Ep,{})})})}),Ne.jsx(kl,{path:"/dashboard",element:Ne.jsx(Uh,{allowedRoles:["Vendeur","Manager","Admin","SuperAdmin"],pageKey:"dashboard",children:Ne.jsx(zm,{children:Ne.jsx(pg,{})})})}),Ne.jsx(kl,{path:"/products",element:Ne.jsx(Uh,{allowedRoles:["Vendeur","Manager","Admin","SuperAdmin"],pageKey:"products",children:Ne.jsx(zm,{children:Ne.jsx(Cy,{})})})}),Ne.jsx(kl,{path:"/arrivals",element:Ne.jsx(Uh,{allowedRoles:["Manager","Admin","SuperAdmin"],pageKey:"arrivals",children:Ne.jsx(zm,{children:Ne.jsx(Ty,{})})})}),Ne.jsx(kl,{path:"/purchases",element:Ne.jsx(Uh,{allowedRoles:["Admin","SuperAdmin"],pageKey:"purchases",children:Ne.jsx(zm,{children:Ne.jsx(Dy,{})})})}),Ne.jsx(kl,{path:"/sales",element:Ne.jsx(Uh,{allowedRoles:["Vendeur","Manager","Admin","SuperAdmin"],pageKey:"sales",children:Ne.jsx(zm,{children:Ne.jsx(zy,{})})})}),Ne.jsx(kl,{path:"/returns",element:Ne.jsx(Uh,{allowedRoles:["Vendeur","Manager","Admin","SuperAdmin"],pageKey:"returns",children:Ne.jsx(zm,{children:Ne.jsx(Wy,{})})})}),Ne.jsx(kl,{path:"/transfers",element:Ne.jsx(Uh,{allowedRoles:["SuperAdmin"],pageKey:"transfers",children:Ne.jsx(zm,{children:Ne.jsx($b,{})})})}),Ne.jsx(kl,{path:"/inventory",element:Ne.jsx(Uh,{allowedRoles:["Manager","Admin","SuperAdmin"],pageKey:"inventory",children:Ne.jsx(zm,{children:Ne.jsx(By,{})})})}),Ne.jsx(kl,{path:"/users",element:Ne.jsx(Uh,{allowedRoles:["Admin","SuperAdmin"],pageKey:"users",children:Ne.jsx(zm,{children:Ne.jsx(db,{})})})}),Ne.jsx(kl,{path:"/stores",element:Ne.jsx(Uh,{allowedRoles:["Admin","SuperAdmin"],pageKey:"stores",children:Ne.jsx(zm,{children:Ne.jsx(Sb,{})})})}),Ne.jsx(kl,{path:"/suppliers",element:Ne.jsx(Uh,{allowedRoles:["Admin","SuperAdmin"],pageKey:"suppliers",children:Ne.jsx(zm,{children:Ne.jsx(Eb,{})})})}),Ne.jsx(kl,{path:"/financial",element:Ne.jsx(Uh,{allowedRoles:["Admin","SuperAdmin"],pageKey:"financial",children:Ne.jsx(zm,{children:Ne.jsx(Tb,{})})})}),Ne.jsx(kl,{path:"/analytics",element:Ne.jsx(Uh,{allowedRoles:["Admin","SuperAdmin"],pageKey:"analytics",children:Ne.jsx(zm,{children:Ne.jsx(Ib,{})})})}),Ne.jsx(kl,{path:"/reports",element:Ne.jsx(Uh,{allowedRoles:["Admin","SuperAdmin"],pageKey:"reports",children:Ne.jsx(zm,{children:Ne.jsx(Fb,{})})})}),Ne.jsx(kl,{path:"/settings",element:Ne.jsx(Uh,{allowedRoles:["Admin","SuperAdmin"],pageKey:"settings",children:Ne.jsx(zm,{children:Ne.jsx(Lb,{})})})}),Ne.jsx(kl,{path:"/configuration",element:Ne.jsx(Uh,{allowedRoles:["SuperAdmin"],pageKey:"configuration",children:Ne.jsx(zm,{children:Ne.jsx(Ub,{})})})}),Ne.jsx(kl,{path:"/gamification",element:Ne.jsx(Uh,{allowedRoles:["Admin","SuperAdmin"],pageKey:"gamification",children:Ne.jsx(zm,{children:Ne.jsx(Vb,{})})})}),Ne.jsx(kl,{path:"/profile",element:Ne.jsx(Uh,{allowedRoles:["Vendeur","Manager","Admin","SuperAdmin"],pageKey:"profile",children:Ne.jsx(zm,{children:Ne.jsx(qw,{})})})}),Ne.jsx(kl,{path:"*",element:Ne.jsx(Iw,{})})]})})})]})})});me(document.getElementById("root")).render(Ne.jsx($w,{})),"serviceWorker"in navigator&&window.addEventListener("load",async()=>{try{const e=await navigator.serviceWorker.getRegistration();e&&(e.addEventListener("updatefound",()=>{const t=e.installing;t&&t.addEventListener("statechange",()=>{"installed"===t.state&&navigator.serviceWorker.controller&&t.postMessage({type:"SKIP_WAITING"})})}),navigator.serviceWorker.addEventListener("controllerchange",()=>{window.location.reload()}))}catch{}});
